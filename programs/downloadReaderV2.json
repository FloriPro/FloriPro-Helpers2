{"html.html": "e3tzdHlsZX19DQoNCjxwIGVsZW1lbnQ9InN0YXJ0dXBNZXNzYWdlIj5Mb2FkaW5nIERlcGVuZGVuY2llczwvcD4NCg0KPGRpdiBpZD0ibG9hZGluZyIgZWxlbWVudD0ibG9hZGluZyIgc3R5bGU9ImRpc3BsYXk6IG5vbmU7Ij4NCiAgICA8ZGl2IGNsYXNzPSJsZHMtZWxsaXBzaXMiPg0KICAgICAgICA8ZGl2PjwvZGl2Pg0KICAgICAgICA8ZGl2PjwvZGl2Pg0KICAgICAgICA8ZGl2PjwvZGl2Pg0KICAgICAgICA8ZGl2PjwvZGl2Pg0KICAgIDwvZGl2Pg0KICAgIDxwIGlkPSJsb2FkaW5nU3RhbmRhcmRJbmZvIiBlbGVtZW50PSJsb2FkaW5nU3RhbmRhcmRJbmZvIj5Mb2FkaW5nLi4uPC9wPg0KICAgIDxkaXYgaWQ9ImxvYWRpbmdNZXNzYWdlcyIgZWxlbWVudD0ibG9hZGluZ01lc3NhZ2VzIj4NCiAgICA8L2Rpdj4NCjwvZGl2Pg0KPGRpdiBpZD0iaG9tZSIgZWxlbWVudD0iaG9tZSI+DQogICAgPGgxPlJlYWRlciBEb3dubG9hZGVyPC9oMT4NCiAgICA8YnV0dG9uIGlkPSJidG5Eb3dubG9hZCIgZWxlbWVudD0iYnRuRG93bmxvYWQiPkFkZCBVcmw8L2J1dHRvbj4NCiAgICA8ZGl2IGlkPSJyZWFkZXIiIGVsZW1lbnQ9InJlYWRlciI+PC9kaXY+DQogICAgPGRpdiBpZD0iZG93bmxvYWRlZFBhZ2VzIiBlbGVtZW50PSJkb3dubG9hZGVkUGFnZXMiPg0KICAgIDwvZGl2Pg0KICAgIDxocj4NCiAgICA8YnV0dG9uIGVsZW1lbnQ9ImNsZWFyZGF0YWJhc2UiPkNsZWFyDQogICAgICAgIERhdGFiYXNlPC9idXR0b24+DQogICAgPCEtLTxidXR0b24gb25jbGljaz0ibG9jYXRpb24ucmVsb2FkKCk7Ij5SZWxvYWQ8L2J1dHRvbj4tLT4NCjwvZGl2Pg0KPGRpdiBpZD0icGFnZSIgZWxlbWVudD0icGFnZSIgY2xhc3M9IiI+DQogICAgPGRpdiBpZD0icGFnZU9wdGlvbnMiIGVsZW1lbnQ9InBhZ2VPcHRpb25zIiBjbGFzcz0ic3R5bGVDb2xvclVwZGF0ZSI+DQogICAgICAgIDxkaXYgaWQ9ImF1dG9HZW5EaXNwbGF5VHlwZXMiIGVsZW1lbnQ9ImF1dG9HZW5EaXNwbGF5VHlwZXMiPjwvZGl2Pg0KICAgICAgICA8YnV0dG9uIGVsZW1lbnQ9InBhZ2VFZGl0Ij5FZGl0PC9idXR0b24+DQogICAgICAgIDxicj4NCiAgICAgICAgPGJ1dHRvbiBlbGVtZW50PSJnb0JhY2tIb21lIj5CYWNrPC9idXR0b24+DQogICAgPC9kaXY+DQogICAgPHAgaWQ9InBhZ2VVcmwiIGVsZW1lbnQ9InBhZ2VVcmwiIG9uY2xpY2s9IndpbmRvdy5vcGVuKHRoaXMuaW5uZXJUZXh0KSI+PC9wPg0KICAgIDxkaXYgaWQ9InBhZ2VDb250ZW50IiBlbGVtZW50PSJwYWdlQ29udGVudCI+DQogICAgICAgIDxwIGlkPSJwYWdlQ29udGVudFRpdGxlIiBlbGVtZW50PSJwYWdlQ29udGVudFRpdGxlIj48L3A+DQogICAgICAgIDxkaXYgaWQ9InBhZ2VDb250ZW50Qm9keSIgZWxlbWVudD0icGFnZUNvbnRlbnRCb2R5Ij4NCiAgICAgICAgPC9kaXY+DQogICAgPC9kaXY+DQogICAgPGRpdiBpZD0iZWRpdFBhbmVsIiBlbGVtZW50PSJlZGl0UGFuZWwiIHN0eWxlPSJkaXNwbGF5OiBub25lOyIgY2xhc3M9InN0eWxlQ29sb3JVcGRhdGUiPg0KICAgICAgICA8ZGl2IGlkPSJlZGl0UGFuZWxSZW1vdmVUZXh0cyIgZWxlbWVudD0iZWRpdFBhbmVsUmVtb3ZlVGV4dHMiPg0KICAgICAgICAgICAgPGRpdiBpZD0iZWRpdFBhbmVsUmVtb3ZlVGV4dHNMaXN0IiBlbGVtZW50PSJlZGl0UGFuZWxSZW1vdmVUZXh0c0xpc3QiPg0KICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICA8aW5wdXQgaWQ9ImVkaXRQYW5lbFJlbW92ZVRleHRzSW5wdXQiIGVsZW1lbnQ9ImVkaXRQYW5lbFJlbW92ZVRleHRzSW5wdXQiIHR5cGU9InRleHQiIHBsYWNlaG9sZGVyPSJUZXh0IHRvIHJlbW92ZSI+DQogICAgICAgICAgICA8YnV0dG9uIGVsZW1lbnQ9ImFkZFJlbW92ZVRleHQiPkFkZDwvYnV0dG9uPg0KICAgICAgICA8L2Rpdj4NCiAgICAgICAgPGJ1dHRvbiBlbGVtZW50PSJleGl0RWRpdFBhbmVsIj5FeGl0PC9idXR0b24+DQogICAgPC9kaXY+DQo8L2Rpdj4NCg0KPGRpdiBpZD0ic2VsZWN0IiBlbGVtZW50PSJzZWxlY3QiIHN0eWxlPSJkaXNwbGF5OiBub25lOyI+DQogICAgPGRpdiBpZD0ic2VsZWN0V3JhcGVyIiBlbGVtZW50PSJzZWxlY3RXcmFwZXIiPg0KICAgICAgICA8cCBpZD0ic2VsZWN0VGl0bGUiIGVsZW1lbnQ9InNlbGVjdFRpdGxlIj5UaXRsZTwvcD4NCiAgICAgICAgPGRpdiBpZD0ic2VsZWN0T3B0aW9ucyIgZWxlbWVudD0ic2VsZWN0T3B0aW9ucyI+DQoNCiAgICAgICAgPC9kaXY+DQogICAgICAgIDxicj4NCiAgICAgICAgPGJ1dHRvbiBpZD0ic2VsZWN0Q2xvc2UiIGVsZW1lbnQ9InNlbGVjdENsb3NlIj5DbG9zZTwvYnV0dG9uPg0KICAgIDwvZGl2Pg0KPC9kaXY+", "install.js": "YXN5bmMgZnVuY3Rpb24gcnVuKCkgew0KICAgIC8vZmlsZSBleHRlbnNpb25zDQogICAgYXdhaXQgU3lzdGVtLm9wdGlvbnMuYWRkVmFsdWUoImZpbGVFeHRlbnNpb25PcGVuZXIiLCAicmh0bWwiLCAiYy9wcm9ncmFtcy9kb3dubG9hZFJlYWRlclYyL21haW4uanMiLCB0cnVlKTsgLy9yZWFkZXIgaHRtbA0KDQogICAgYXdhaXQgU3lzdGVtLm9wdGlvbnMuYWRkVmFsdWUoInByb2dyYW1zIiwgImRvd25sb2FkUmVhZGVyVjIiLCB7ICJwYXRoIjogImMvcHJvZ3JhbXMvZG93bmxvYWRSZWFkZXJWMi9tYWluLmpzIiwgIm5hbWUiOiAiRG93bmxvYWQgUmVhZGVyIiwgInJ1biI6ICJjL3Byb2dyYW1zL2Rvd25sb2FkUmVhZGVyVjIvcnVuLmpzIiB9LCB0cnVlKTsNCiAgICBTeXN0ZW1IdG1sLnVwZGF0ZVN0YXJ0bWVudSgpDQoNCiAgICAvL2Rlc2t0b3Agc2hvcnRjdXQNCiAgICBpZiAoIWF3YWl0IFN5c3RlbUh0bWwuZGVza3RvcC5leGlzdHNMaW5rKCJjL3Byb2dyYW1zL2Rvd25sb2FkUmVhZGVyVjIvcnVuLmpzIikpIHsNCiAgICAgICAgYXdhaXQgU3lzdGVtSHRtbC5kZXNrdG9wLmFkZExpbmsoImMvcHJvZ3JhbXMvZG93bmxvYWRSZWFkZXJWMi9ydW4uanMiLCAiRG93bmxvYWQgUmVhZGVyIiwgImMvcHJvZ3JhbXMvZG93bmxvYWRSZWFkZXJWMi9sb2dvLndlYnAiKTsNCiAgICB9DQogICAgcmV0dXJuIHRydWU7DQp9DQpydW4oKTs=", "installLocation.dat": "Yy9wcm9ncmFtcy9kb3dubG9hZFJlYWRlclYy", "logo.webp": "UklGRsIaAABXRUJQVlA4WAoAAAAwAAAAYwAAYwAASUNDUKACAAAAAAKgbGNtcwQwAABtbnRyUkdCIFhZWiAH5gAMAAsAEQA1ADNhY3NwTVNGVAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA9tYAAQAAAADTLWxjbXMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA1kZXNjAAABIAAAAEBjcHJ0AAABYAAAADZ3dHB0AAABmAAAABRjaGFkAAABrAAAACxyWFlaAAAB2AAAABRiWFlaAAAB7AAAABRnWFlaAAACAAAAABRyVFJDAAACFAAAACBnVFJDAAACFAAAACBiVFJDAAACFAAAACBjaHJtAAACNAAAACRkbW5kAAACWAAAACRkbWRkAAACfAAAACRtbHVjAAAAAAAAAAEAAAAMZW5VUwAAACQAAAAcAEcASQBNAFAAIABiAHUAaQBsAHQALQBpAG4AIABzAFIARwBCbWx1YwAAAAAAAAABAAAADGVuVVMAAAAaAAAAHABQAHUAYgBsAGkAYwAgAEQAbwBtAGEAaQBuAABYWVogAAAAAAAA9tYAAQAAAADTLXNmMzIAAAAAAAEMQgAABd7///MlAAAHkwAA/ZD///uh///9ogAAA9wAAMBuWFlaIAAAAAAAAG+gAAA49QAAA5BYWVogAAAAAAAAJJ8AAA+EAAC2xFhZWiAAAAAAAABilwAAt4cAABjZcGFyYQAAAAAAAwAAAAJmZgAA8qcAAA1ZAAAT0AAACltjaHJtAAAAAAADAAAAAKPXAABUfAAATM0AAJmaAAAmZwAAD1xtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAAgAAAAcAEcASQBNAFBtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAAgAAAAcAHMAUgBHAEJBTFBIPREAAAEJBW0bOfq9Ev6A7/8xRPR/AgrXBChPUwJQj5TUyXhdJUGmqUlNXs4JCjTrD342SNeb54SUANQLj5gY0gG8w2DQto2gq8Mf9e85RMQEvG2QaiiqoGjT3LVdY8PY3mbkcwrZIKltdnTcP2+bSs6qSf9PQds2TMIfdHc5REzABFBuJEmSJKlaRM7xXv4Z3a50e2RWdXUNAxExAZ4EQJIkSZIkAEAkZhGNPeL/D1xyTzMVZiZEhIMvb4iICbBmW48iSZLAwN3DIxKLepiZefb/cxbQzN0FWZmREeHu5gaSBmvydG8gIiaAeEVABAErDRAEaJAEIYCACdAGSAMSkSIiSUEwUzWR2kTUDAz+f60jFZqSQRCWaUAyQZPAwJQxCpOZgTNUUCRJbMZmwkSmBoBvZK0UBItQBQjINAlLBAUYACiOFyGKjoxIDDFNFApASp0PxNDam9VitUKxIUWxqIGXDWZQsm1RVCM5wY2NdOHzhUhTdXURHbjzPo5dWVfWN7E6giAQMEVlQgDEiFDQpD1hhSHDHqn4Lt8fES8YLgItAnSXl+SHdelbQXsCQQEsCwnRQUklel4V4hIUE+6iRonheR/JewP7v3Ntgw8QlAXP5/Lk4pFfL9yJRS+piCggLkyMuCB0x/vJmMmkhlq9b0Cxpkxd5EnYxQ/CrAFFliAlzet4tVKMpdQlQKIEFhrCSlhSSVPrz5/nuPt8+IJoZtS9sYR99VIyq7t9/Rn35v4xXsJ04612tnx082g3saYGUkEEKcmBCA6OJB17NBJHu9fztRrirKcEJ05e+5mIAbPrYCDXFx04TIfh3FIuaQlzfPwS6eL7hrCoIRmEGJIYiLSwXBtq6JqwL32x9dXa1SEZkpaeGP4XXSAI4Bhp7c9FUwyacG0v99cXX/4a0uufDoqgSymvBKGQnNnqMb++Ux4FtSGKw1Ol20VJAOOwns/mHAY96bhdD52em5ca9LaO2xfc4e7zti+BiBRj1spYghikGdpt8qq9YI5N2M0LdKbB57qMoEAG/JxfrygMhGywJLfBC7g5kQxjfXVl/abcHdZOhV6OY60z2eCAMrj3rf6qnSeewRlhrll19PR0lCWBEPD956f7gwud1J0DyRBaOpaN1BZ7XjKWVhEJJf5ex1qxYGAGM30dNU+Xvhb5j+uGcPHO5gDVbfgskSIJ3a+hq+s49BvHBKrSUsod0k0jAqi5IbgSkr32/lqxMQPOY9SDqmlK9JUSgV9ltIA8t6CAapMQxFYNFwMjAyAAmGktBSmnNjW1KiiEFuTw99+Ih8Zuzd4384mxexTGtSu1DV21Dip6Ym9OwQYZ4WE7kgEg/G9tSQDrasWqNeOLgCgdh5iey2yG5+f1xwOBbEFSZiJ2RVYbR6UiDI8oRonHuPIrfNddWJwql8wYqhCRYHDEy4XEGP38AeIJpVKf1tAY1QdeYZ7sNoZWQ7Np242800CVmxcJsz9rAUwfUPLHtfWuTpvn4SFvVknkRB7EfAQka8DxLA6w1mWkkd5D36UB7tRG+f+EtDWIA+MP69IJkgojMHGd7l3nA5tTGYDQS4WYu3s2KxTwLQC6oY7hi2Bc2ojx6/h8gtRzf7GgiZYQGtS7w0qh24VA1MCmvczrM1lfBUgeabM30VeOgJ5UFERlVGpXLaYexIj3hBMAsYbbbQBCoqFtuOCFj08g4Rarwbt9N5vNb7gBMCL49ufzMEI7E/McWckIIEhw1gMCIIQFGs6MXEqUQoMIPFx3y70zjyxXcYWnC5pGEEDCBEQtcRgqMCAAgAAIURGiDIJ91YdDa/XD5ljgqlTez7GCgbHTZEpCkx1/fLMfEb9lmiDZNVrMEB60XlrieO8n7woEjrRxpcZwjjhhrrYYi1q7sos2yzAAEtDsvU4AgA9RuY55DIsZx2pHHvnZhwjeIwmghF8GiL3ZXc+oHQ2MZRsYBgCDB6w3teMKxVVggIdCqLKY0m1oFQNOfBjQLBvH1FmdpGrs2mO4ZER4wFZu8EQtohUT6Jqvoycmw6l9aO5a0nRtv1A8RWn2XkEB7JkN7f+7a2oPwm3POnBsBDWCwjcCm5zp50xknCyI5ntG00KK2YgQYbDJratuDlnsAZ7OibFnMEUB8iuui6JHbMuhoYKIbAFigbInF20T9Aydf9rpamYPNV9fR3BKjM0UTJ13+/uPTk8ErOTMIZACjEXCEN2GnWqgZnz03MzggefBWljRATi59DBej/NUUL0VMBv5iyFhmejOQyCbirDrcGb9fii+Y3oY2PHRmYMgTWF2/AUDEdBi2xqyaxyCRjHNUjzPK/h5h6Gds1X8lqctjO4dOGUpAN1O4TIYuU6BPmyaY6XbjEs2Z4gxZlNUBkjPBHzFnr0nZ4uqMzx2REzHetd+JexewQx6wtDgmGnXsVhI2IAvI8hYoZWzkT6zp3oo2LB0cANOxOMSFEFCFXaIgM2NxMyxjRJ+1Z5N40hB7EM5oXxNDQMwohBOupehdO2bQSsGMKRDJiWwby2h1oqI+msYGUyCSEtUOg+Zx3jXSKoUMdh1nhl7JYwHYwU1IyPDwvTUT72ACIHKi4axAFJKSxIYsrHHYId9KDjtF559xHGIcJcI/Topdc3cGwdXpFABCn+DlkiA9qSuGOgazKZlgogU8IzIWsiK9uDJ9C+ORdppH+z/cngYfusFWCB4Pw7MEZQxgHdT6A5JQb/o7CKwZgB4kwN5JkC0WfvY2/yK+ER4UYJi+5rulbQkgQlfEc4DJoD5ZU++4/TY49G0O8zgjGuvHHtjeHNSaQnX589p7bjE7s8bPYstIJbDRi8HdvEQRseeeM8ohOq945X3i9BTkpcCtaxFquauo5/MT61M0nC1xBuh5jTN3rUyckHcfSwBfkCQylDBSKxhReXo1fXZxnGdh2kc+x2elt22PRPA3ZrWWgk3gG9CuZbpl80aUQEf+LnlQ9f1DhCij57k6adhV+fUN5+rIwLwIu+ugM3USnrIl0spEWTwS11V+whGImIPPQUDg3sfXkfVrjEBlJ+UOrEmBtNGhYIK+Hz1U/GnLiDjf0jBhgcz6/xzChQ6S0R+slAgMCRjLlTJ1LF1v9etZxuHQmaUbcCzEqr3SmWcXvnBzhlaIt0yjOuynaKqgPc1BIf3JtahGHqAcWPqyncwQiL8zDkCWq+czhY6Dyj5Tm7r6+JwHrBnrVg0bIN7+MqxRQrhuwV81mkYjEBNVWk/P7UANjemm9Ejxrmfii8gDPTEqTNHMQC2BOkrUikCVZSkKJ2v+OUhzNnxcFZLNHYzE09Po/NJeQzhyeU0IwPGlgBCoQhIoUqlxcTKAx4yvSRjckQ8wDZooxD9x/20TYJuGJkBClSwj5NwLSPPC9KOU0VhzhzTLFAKlBWwZk/OKB72ShGPTcCD4UpcG+ZQZnzM5buVMi2OcWjhTBmWkIJtmi8WAWiy/Xn/486uB7ZHE8CshqZuT2oQxaqAFwME7OYwYROtQK+wHSQggK0TxHrrc9CEUnPQfJyCAbg5yj6sDY20xUqGjYCAFDYAzyaTJGGM+mEChEUEM7Bcpv9oowV0Ap9elxZgGEJvRjQpvU0MJDB0eQEKtYeGy0aEfzERao04riEDqABBtFQinPCcSssbFG0UFdbUAyDsTiKMHXsnQqeNnuZhQTbRjyOCbEP3dxCBtSrh4OCECnKTnJ/A3jZtp3cZpbjhqnnJdSTLzHGDADY6YiyRYwAIjkhj6ip+JgxkSQcbkc+e1oQR9suJAhD0dFcEQQSwDn4Rohze3c5YEaogiVHVQTqDw57//3r957E5h+LEawn3/xY7D4ivYHYngNCzN/AQ8um49VtJIsiGJ14cFhltuB2SfesgBX/9tYaTi4Yryzo7W6WBcKQ8vcw3QXoY/bf62jbRItmJCcgUn6DQoCcomtxOcQCMYE7Axy5VbuDNPgKaw4AqrZ1yBoAoDaOmQnB55lPnlwYpyqve4N5nTGunG6jpiOQw7Q4aJj8R9/n8OBDxQSNDH8xyMUVwpIe8HQkqg9qEe3nNwDRZ6Vm01B9nsIzEp3yXPjkj2CXrY6iFfY0hnyxXRAAfVl9O/ZUUFRORgnzXAAwUmGl3ZE/dBV4rO9LREHPntEu5R2myJo/tmI9VwYhc7OkVK5oAICBvN64tNW37+d7rsH0unlc+68AGAz4O1lQoLvenogDmtO6GFu9cEQQA+VFfgIKA0S2vbFFQbSvCxRxs5VkRIMq8L9oUHLBv4DfpLqoZ8onl1clIJGF0IVeyqJk+zx+jmAZZb+dAk6B3SOux9M/KjPAVLggTMEVSEnlHWM1lDzzcqQg1TWJkzNbY+6JEvthX6UUSIEhEYuccRKwz6CrHejLLq1oIhM5KdzGHngnx6/C0QJmme0P5H7ulAvgGJIBupCkSsTLS1wkoFKo2a6Q+Op/v72WLpoziMNmOj4wR8WvFpQUYs9h1p9O+FwxgwC7MAMcUnXdvUv8JCpywjl+hu7+FhqbREZFi7G/21eg6hTeRT64vVVb8fclp2h8f6YLKVHHb3yclbibsMXfy+fUuFhtCo1NTGcyZdW2FjvSyZMPsea9c/uEUWjGzQF2LawUhgBXOr9JamljXEf++AK2Vmm03+HhKTEKunIYxbKrzIaLW66fUWvCl/zQwyQlilseuZdek+jYtF5eb0HlUjPLJ7ajc8ncYtFxK6L9h+xUGQWu2tFCnvNXAjCSfRacECgEQBoAZSDkczl9eTnQ2PetcIGmWeOjEvAEFjPhS/TGuBc+QgKWVZLR8cv5dWXf5G/4OtwVMmu+3S1A7DUAOReoT+cwChBn7nm4++uInP+e4/cff0+6b+2UyVwTAuM3DRtvgtHUb5eoNxU+4JTwzkN79dttuafjB6fjiCWqiIgDQEBY/jBdNkQORp1Ku9hVRLL4FcG04PPc3b19/084PeZgqMRkrYQVwzuEwrkouFusFikVu4wBCBd/hz399Xm551sgt1zG/+vGr7JaOkIvMrprByyaiNZg2YNs9QA8IevQL2yABgAAI+Nfwv5gtz2/ip1/++VvdWd8TPTl9iXh8uIXafa9z0ym71GadbjfgqqGfuzx6JLebGJO2hV8asAH4BtpdXb/zwS9+FyNeXYSaCU5pLYgWl/p20gn3zop2PcsVNsEeu0OoZ+/Peq6Opkibhn8DAQDMkIenRJsv0iXIendtGbpP78oftjbC7/v/MoGjjRgzfW2lYc7WgN6Ldc/abEe5e7Cv4oQJGwEBDcyQmRy5rF/AWSR7d/X3czvm/RvbHJHiK45B0SrElMFuePrENyTX5KFn1pFFVH/31Vn3pzoImLEhIhhS88HWfd41xYOdTp/NR/y9pTngPr+ugpvVezwaIntsA3107WP9rPXYTtV3fKmCU8G4//l9nJdLAxoEpopm1TPtb9LN2wfR5c7gXmoE7xGON1F511YLYQBRLaVN9rG2VAp/jsDzrT+iFQedduVlQ9ZbeFZU1M+hP8Z39u10+zy2mlNOZEKhu+8ZIYgsQZtJuz2YlRTnWYk9B4NxuG/xC7vWYlU56q3rNaQX82a7x+5YZDqW3Xnxh9bpl62uMwiIwDCP9x//etaBTSODKFovqjV2Hk8QRre44ojk430/9HV1+mo1FwRUU/PUN0EXYt5tUyHThnOaeMLT7aRQhBaoiEhY4k0RQOpU0omG6Sw4lt26cBu06WrVXXGzKnk9nPs7vXUlQ5RVPbOAa2sqgu+ume/WktNc1QwQAEwQCFRtOaA2zJwIqoHtVkLPKutmA3PydPo+lcxEtGq5b32OTeV23x71jTsVLtMC8uLFrXiaSmnCUongJgBMEWlV0dquoyaBglgRjBV2jOrzfHTq3Hp3gsfPn2/x+beHLR2PLsE2et8J1IXK65fP1SgX1aJOFMBsAQBWUDggtgYAAFAkAJ0BKmQAZAA+VR6LRaOhoR4EADgFRLQAaCPwfRPyX9m2rf1f75cr+bnsN/b/1H8Zvgp6j/u39wn9L/7n9o3xAern9uPUB/OP61+vPvkek70AP5l/pOse9A3y0/23+Fr9yv269oXVV2d/6TuGfUP53jfRI/kf5SiiWnOAzABZVnDiS2Uvs62aQg4ojd6SierA49ueVbDN8/mLM1k/UBc1yChmFEcv5L6+8jdeV3n/yv8ncHVzoI/q//rw6FLtoI47VPLtdHe4+fCDrneFS46z+7+Q+DoXFSozH6y7AgsexMLAspEZSL9yLbUl5CjBQCfAxnp0k6yVZo6zCZUAo06phudYlA/5XSGVBOb7TLKciF71yb7w7dThkp4rVBGQXRspMeqPQfEKuBgAAP78+Ea5j2WLgz7Dj/D1MIuVmv67Y+XIo0TZEluK1Of/8xj/2am6b/I3dR9W9fqHB0qTwMNA1EQRmI7+KDLootrMyzKw0j6qiV2lfALmfhH3u+If/xdV5lHBvo65MezrIzr6lWnn1jyYbi2f5cemzavw83C94cPfd/JNekPbmvNNT36dKfQLBeJB07DJkhEt3hM56Zl2tM4er9of7B7g5EzRGMaythYykKguFh2m7/6VjfsJy5Veazha/63SHiCy/4vSsc1A26m9RtTB9AQiObi9UBM4ODFZ78dPzXQ7UP9RE8sV69hbVIqxCit3FVsb3ojC/hlWrZfpx199sTUfD7pirXlRsMObRDGg+1wxhF51v/J+CqHFm2u6h+H/P8FQfy+3MvktCGTx9VoYujVjpM6FvBK8Pw24pfh9KZ1GTNw2LhJ7Fh4aK7L011NWoMjaA11ELNTJfkhnzQR+vuP3mhKFMkgBr8kLAGcM4YyGK2cpwGNYedPg6yBt+1D4u5PKRcnVvebW0/NylQ3HZ+qkAuUBsyoVoAdN87//XJPKpnTk4x7eS+tlijNSJf6oWWwkCL3aWaA3vVPfIlK5Xgeo+HdT3/ZEUkR5oA8LwYdCUPc8MSbJ7nap7gkCujAKF+LsvaRShGURVWx5Au+QuyboaqwMv1KRzKrsJUU4WcmM06TMSolcvk1Q1mA4UFO5EtTVfcuBJzD7ccWiO+RZ1PI/671u3SJzHQIbK0YIVxlk6qfNPsBmb1lP3/7kxq4NALArcNqzLpvcN/xyKC8/sFoZMxMdSHtphR3j/7km8JUjMSQeC+2IJl8q8Lni/gJCmG97uteMDppCbTJRRAbf1+/7NP+Xan9dtLfTVXON+q8A0NaBxLlWvsVAZNWExSMkxZKGrptFDQIkT02nlIuwai/A+wtII3laRs4BpQ1xxaeYq/ydyZS8/F3NWtxKRPd/0ew4OUnFtcNceRec+sczSlVvCfufutxLSofT+PJZQME6cV1FX9jRuQaje+D89U5Qy0/T9W7N9HMwTv/ksIzASPH0FM8Ca8O5YgetUx16BeADViU+8TD2b/QBGWCWHKFlWY5CAyxSUnibdH8lpl1oVOnSl28z4OLiheLWmRC+mYIYrCimsst6J7JpvnEm1A5ICsSXnhCm88Em5KofVP+JS7xAB0wD3j+Phr7tfZayyoWSUORtfvBqn04vT5wEJjNcqrCYsvkfei2T8QrvrCE5JwW9g/71K6loSy+ZJUwBMui142qwYHnlBk1aXCcgrsVZbzrS4b4rBc4ctXF3brWp465FhfyBFkYMcObKL56ksNiEFw5lA7WQrGI6fEqdfzw/ydyZUO/XC7ZEfU7EvdZ/4W3tZlmIALqQntTrfGqWuh3LLvL3CjS7+zuEzg3IcvAoXBNHZHIX1PO3HGH58ZKSbgnFpnI0w0smi2X8Z1tZFiMDoLVZCv75nCrNSy1K5R/v0XsRo7cbJjo/++HkJ0KyvEdlpX3POJthM8dngiP//HE++z1xo7QsFjOXv90PTkCAHed9jnAJ/dChg4PnjeiZF1+LVcaULCAxyg2znFs0Kx5Yh1kqn1SwxpYWT9LicqKRyMwym2BTgsjcALxDUkf8LopyIU3qj95r4IGyeZg4RjfnLUkglR5znTsq38blHkzjW8TopODOSOt3G8cj3/dvPGfnkaRDEA4erqQbN4C7BGaTvWgYxWKR7wEwLBwwxlm8uVA45X8g6Q1+D/QTj4cIkHK2nVV80DzWk/wkjGACVyPLouUyu15k3f3tEVeA+4TKv2bcPSPMSkbtQc+ct/dCVshPFxCaVKHgBHMTql76n99PQ/f71fKigz5pzmC/utwLLvR+StLEzygcPDJ+ksGb/YvRxdBCQ8uEAAAAAAAA", "main.js": "Y2xhc3MgZG93bmxvYWRSZWFkZXJQcm9ncmFtIGV4dGVuZHMgU3lzdGVtLnByb2dyYW0uZGVmYXVsdCB7DQogICAgY29uc3RydWN0b3IoKSB7DQogICAgICAgIHN1cGVyKCkNCiAgICAgICAgLy9kb24ndCB1c2UhDQogICAgfQ0KICAgIGFzeW5jIGluaXQoZmlsZSkgew0KICAgICAgICAvKioNCiAgICAgICAgICogQHR5cGUge0h0bWxXaW5kb3d9DQogICAgICAgICAqLw0KICAgICAgICB0aGlzLndpbmRvdyA9IGF3YWl0IFN5c3RlbUh0bWwuV2luZG93SGFuZGxlci5jcmVhdGVXaW5kb3coIkRvd25sb2FkIFJlYWRlciIsDQogICAgICAgICAgICAvL29ucmVhZHk6DQogICAgICAgICAgICBhc3luYyAoKSA9PiB7DQogICAgICAgICAgICAgICAgLy9zZXQgaHRtbA0KICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMud2luZG93LmFwcGVhcmVuY2Uuc2V0TG9nbyh0aGlzLlBBVEguZm9sZGVyKCkgKyAiL2xvZ28ud2VicCIpDQoNCiAgICAgICAgICAgICAgICBsZXQgc3R5bGUgPSBhd2FpdCBTeXN0ZW1GaWxlU3lzdGVtLmdldEZpbGVTdHJpbmcodGhpcy5QQVRILmZvbGRlcigpICsgIi9zdHlsZS5jc3MiKQ0KICAgICAgICAgICAgICAgIHN0eWxlID0gIjxzdHlsZT4iICsgc3R5bGUgKyAiPC9zdHlsZT4iOw0KDQogICAgICAgICAgICAgICAgYXdhaXQgdGhpcy53aW5kb3cuc2V0Q29udGVudCgoYXdhaXQgU3lzdGVtRmlsZVN5c3RlbS5nZXRGaWxlU3RyaW5nKHRoaXMuUEFUSC5mb2xkZXIoKSArICIvaHRtbC5odG1sIikpLnJlcGxhY2UoInt7c3R5bGV9fSIsIHN0eWxlKS5yZXBsYWNlQWxsKCJ7e3dpbmRvd0lkfX0iLCB0aGlzLndpbmRvdy5nZXRJZCgpKSk7DQogICAgICAgICAgICAgICAgYXdhaXQgdGhpcy53aW5kb3cuc2l6ZS5zZXRTaXplKDQwMCwgMzAwKQ0KICAgICAgICAgICAgICAgIHRoaXMud2luZG93LnNpemUudXNlckNhblJlc2l6ZSh0cnVlKQ0KDQogICAgICAgICAgICAgICAgaWYgKGZpbGUgIT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICAgICAgICAgIC8vVE9ETzogbG9hZCBmaWxlDQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgKGF3YWl0IHRoaXMud2luZG93LmdldEh0bWxFbGVtZW50KCJzdGFydHVwTWVzc2FnZSIpKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOw0KDQoNCiAgICAgICAgICAgICAgICB0aGlzLmd1aSA9IG5ldyBndWkodGhpcy53aW5kb3csIHRoaXMpOw0KICAgICAgICAgICAgICAgIHRoaXMuYXBpID0gbmV3IGFwaSgpOw0KICAgICAgICAgICAgICAgIC8qKg0KICAgICAgICAgICAgICAgICAqIEB0eXBlIHtkYXRhYmFzZX0NCiAgICAgICAgICAgICAgICAgKi8NCiAgICAgICAgICAgICAgICB0aGlzLmRhdGFiYXNlID0gbmV3IGRhdGFiYXNlKCk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgdGhpcy53aW5kb3cuY2xvc2UgPSAoKSA9PiB7DQogICAgICAgICAgICB0aGlzLnN0b3AoKQ0KICAgICAgICAgICAgcmV0dXJuIHRydWUNCiAgICAgICAgfQ0KDQogICAgICAgIHRoaXMucmVhZGVyID0gbmV3IHJlYWRlcih0aGlzLlBBVEgsIHRoaXMpOw0KICAgIH0NCg0KICAgIGFzeW5jIGdldFBhZ2UodXJsKSB7DQogICAgICAgIHZhciBpZCA9IHRoaXMuZ3VpLmxvYWRlci5hZGQoIkRvd25sb2FkaW5nIHBhZ2UgIiArIHVybCk7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICB2YXIgcCA9IGF3YWl0IHRoaXMuYXBpLmdldFBhZ2UodXJsKTsNCiAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgICAgYWxlcnQoZSk7DQogICAgICAgICAgICB0aGlzLmd1aS5sb2FkZXIucmVtb3ZlKGlkKTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICBpZiAocC5zdGF0dXMgIT0gJ29rJykgew0KICAgICAgICAgICAgYWxlcnQoJ0Vycm9yJyk7DQogICAgICAgICAgICB0aGlzLmd1aS5sb2FkZXIucmVtb3ZlKGlkKTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICB2YXIgcmVhZGVyID0gYXdhaXQgdGhpcy5yZWFkZXIuY29udmVydFRvUmVhZGVyKHAuY29udGVudCwgcC51cmwpOw0KICAgICAgICBhd2FpdCB0aGlzLmRhdGFiYXNlLmFkZFBhZ2UocmVhZGVyLnVybCwgcmVhZGVyLmNvbnRlbnQsIHJlYWRlci50aXRsZSk7DQogICAgICAgIHRoaXMuZ3VpLnVwZGF0ZVBhZ2VzKCk7DQogICAgICAgIHRoaXMuZ3VpLmxvYWRlci5yZW1vdmUoaWQpOw0KICAgIH0NCg0KICAgIGFzeW5jIHNob3dQYWdlKHVybCkgew0KICAgICAgICB2YXIgaWQgPSB0aGlzLmd1aS5sb2FkZXIuYWRkKCJMb2FkaW5nIHBhZ2UgIiArIHVybCk7DQogICAgICAgIHZhciBwYWdlID0gYXdhaXQgdGhpcy5kYXRhYmFzZS5nZXRQYWdlKHVybCk7DQogICAgICAgIGlmICghcGFnZSkgew0KICAgICAgICAgICAgYWxlcnQoJ0Vycm9yJyk7DQogICAgICAgICAgICB0aGlzLmd1aS5sb2FkZXIucmVtb3ZlKGlkKTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLmd1aS5zaG93UGFnZShwYWdlLnVybCwgcGFnZS5jb250ZW50LCBwYWdlLnRpdGxlLCBwYWdlLm9wdGlvbnMpOw0KICAgICAgICB0aGlzLmd1aS5sb2FkZXIucmVtb3ZlKGlkKTsNCiAgICB9DQoNCiAgICBhc3luYyByZWxvYWRQYWdlKCkgew0KICAgICAgICB2YXIgaWQgPSB0aGlzLmd1aS5sb2FkZXIuYWRkKCJSZWxvYWRpbmcgcGFnZSIpOw0KICAgICAgICB2YXIgcGFnZSA9IGF3YWl0IHRoaXMuZGF0YWJhc2UuZ2V0UGFnZSh0aGlzLmd1aS5jdXJyZW50UGFnZSk7DQogICAgICAgIHRoaXMuZ3VpLnNob3dQYWdlKHBhZ2UudXJsLCBwYWdlLmNvbnRlbnQsIHBhZ2UudGl0bGUsIHBhZ2Uub3B0aW9ucyk7DQogICAgICAgIHRoaXMuZ3VpLmxvYWRlci5yZW1vdmUoaWQpOw0KICAgIH0NCg0KICAgIHBhZ2VDbGlja2VkKHVybCkgew0KICAgICAgICB0aGlzLmd1aS5wYWdlUmVhZGVyLm9wdGlvbnNPcGVuID0gZmFsc2U7DQogICAgICAgIHRoaXMuZ3VpLnBhZ2VSZWFkZXIudXBkYXRlT3B0aW9ucygpOw0KICAgICAgICB0aGlzLmd1aS5vcGVuU2VsZWN0KHsNCiAgICAgICAgICAgIHRpdGxlOiAiQ2xpY2tlZCBsaW5rICgiICsgdXJsICsgIikiLA0KICAgICAgICAgICAgb3B0aW9uczogWw0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgdGV4dDogIk9wZW4gaW4gYnJvd3NlciIsDQogICAgICAgICAgICAgICAgICAgIGFjdGlvbjogKCkgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93Lm9wZW4odXJsLCAnX2JsYW5rJyk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgdGV4dDogIkRvd25sb2FkIHBhZ2UiLA0KICAgICAgICAgICAgICAgICAgICBhY3Rpb246ICgpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2V0UGFnZSh1cmwpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHRleHQ6ICJEb3dubG9hZCBhbmQgb3BlbiBwYWdlIiwNCiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiBhc3luYyAoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmdldFBhZ2UodXJsKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd1BhZ2UodXJsKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIF0NCiAgICAgICAgfSkNCiAgICB9DQp9DQoNCmNsYXNzIHJlYWRlciB7DQogICAgY29uc3RydWN0b3IocGF0aCwgY29udHJvbGxlcikgew0KICAgICAgICB0aGlzLlBBVEggPSBwYXRoOw0KICAgICAgICB0aGlzLmNvbnRyb2xsZXIgPSBjb250cm9sbGVyOw0KICAgICAgICB0aGlzLmluaXQoKTsNCiAgICB9DQoNCiAgICBhc3luYyBpbml0KCkgew0KICAgICAgICB0aGlzLlJlYWRhYmlsaXR5ID0gKGF3YWl0IFN5c3RlbS5ydW4odGhpcy5QQVRILmZvbGRlcigpICsgIi9SZWFkYWJpbGl0eS5qcyIpKTsNCiAgICAgICAgdGhpcy5QdXJpZnkgPSAoYXdhaXQgU3lzdGVtLnJ1bih0aGlzLlBBVEguZm9sZGVyKCkgKyAiL3B1cmlmeS5qcyIpKTsNCiAgICB9DQoNCiAgICBhc3luYyBjb252ZXJ0VG9SZWFkZXIoaHRtbFRleHQsIHVybCkgew0KICAgICAgICB2YXIgZG9tID0gKG5ldyBET01QYXJzZXIoKSkucGFyc2VGcm9tU3RyaW5nKGh0bWxUZXh0LCAidGV4dC9odG1sIikNCiAgICAgICAgdmFyIHJlYWRlciA9IG5ldyB0aGlzLlJlYWRhYmlsaXR5KGRvbSwgeyBuZXdCYXNlVVJJOiB1cmwgfSk7DQoNCiAgICAgICAgdmFyIGFydGljbGUgPSByZWFkZXIucGFyc2UoKTsNCg0KICAgICAgICB2YXIgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICB2YXIgY2xlYW5BcnRpY2xlID0gdGhpcy5QdXJpZnkuc2FuaXRpemUoYXJ0aWNsZS5jb250ZW50KTsNCiAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgICAgY29uc29sZS5lcnJvcihlKTsNCg0KICAgICAgICAgICAgdmFyIHIgPSBhd2FpdCB0aGlzLmNvbnRyb2xsZXIuZ3VpLmFzeW5jU2VsZWN0KCJFcnJvciB3aGlsZSBzYW5pdGl6aW5nIGFydGljbGUuIERvIHlvdSB3YW50IHRvIGNvbnRpbnVlPyIsIFsiWWVzIiwgIk5vIl0pOw0KICAgICAgICAgICAgaWYgKHIgPT0gIlllcyIpIHsNCiAgICAgICAgICAgICAgICB2YXIgY2xlYW5BcnRpY2xlID0gYXJ0aWNsZS5jb250ZW50Ow0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBjbGVhbkFydGljbGUgPSAiPHA+QXJ0aWNsZSBjb3VsZCBub3QgYmUgc2FuaXRpemVkLjwvcD4iOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiB7IGNvbnRlbnQ6IGNsZWFuQXJ0aWNsZSwgdGl0bGU6IGFydGljbGUudGl0bGUsIHVybDogdXJsIH07DQogICAgfQ0KDQogICAgYXBwbHlPcHRpb25zKGNvbnRlbnQsIG9wdGlvbnMpIHsNCiAgICAgICAgdmFyIGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOw0KICAgICAgICBkaXYuaW5uZXJIVE1MID0gY29udGVudDsNCg0KICAgICAgICAvL3JlbW92ZSB1bndhbnRlZCB0ZXh0cw0KICAgICAgICBpZiAob3B0aW9ucy5yZW1vdmVkVGV4dHMgPT0gdW5kZWZpbmVkKSBvcHRpb25zLnJlbW92ZWRUZXh0cyA9IFtdOw0KICAgICAgICBkaXYucXVlcnlTZWxlY3RvckFsbCgiKiIpLmZvckVhY2goKGVsZW1lbnQpID0+IHsNCiAgICAgICAgICAgIC8vb25seSBnZXQgdGV4dCBub2Rlcw0KICAgICAgICAgICAgdmFyIHdhbGtlciA9IGRvY3VtZW50LmNyZWF0ZVRyZWVXYWxrZXIoZWxlbWVudCwgTm9kZUZpbHRlci5TSE9XX1RFWFQsIG51bGwsIGZhbHNlKTsNCiAgICAgICAgICAgIHZhciBub2RlOw0KICAgICAgICAgICAgd2hpbGUgKG5vZGUgPSB3YWxrZXIubmV4dE5vZGUoKSkgew0KICAgICAgICAgICAgICAgIHZhciB0ZXh0ID0gbm9kZS5ub2RlVmFsdWU7DQogICAgICAgICAgICAgICAgb3B0aW9ucy5yZW1vdmVkVGV4dHMuZm9yRWFjaCgocmVtb3ZlZFRleHQpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHRleHQuaW5jbHVkZXMocmVtb3ZlZFRleHQpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBub2RlLm5vZGVWYWx1ZSA9IHRleHQucmVwbGFjZShyZW1vdmVkVGV4dCwgIiIpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KDQogICAgICAgIC8vY2hhbmdlIGFsbCBsaW5rcw0KICAgICAgICBkaXYucXVlcnlTZWxlY3RvckFsbCgiYSIpLmZvckVhY2goKGVsZW1lbnQpID0+IHsNCiAgICAgICAgICAgIHZhciBvZ0xpbmsgPSBlbGVtZW50LmdldEF0dHJpYnV0ZSgiaHJlZiIpOw0KICAgICAgICAgICAgaWYgKCFvZ0xpbmspIHJldHVybjsNCg0KICAgICAgICAgICAgLy9tYWtlIGEgcnVuIHRoaXMuY29udHJvbGxlci5wYWdlQ2xpY2tlZChvZ0xpbmspOyBpZiB0aGUgbGluayBpcyBjbGlja2VkIGluc3RlYWQgb2Ygb3BlbmluZyBpdA0KICAgICAgICAgICAgZWxlbWVudC50aXRsZSA9IG9nTGluazsNCiAgICAgICAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKCJocmVmIiwgIiMiKTsNCiAgICAgICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LmFkZCgibGluayIpOw0KICAgICAgICAgICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoImVsZW1lbnQiLCAibGluayIpOw0KICAgICAgICB9KTsNCg0KICAgICAgICByZXR1cm4gZGl2LmlubmVySFRNTDsNCiAgICB9DQp9DQoNCmNsYXNzIGFwaSB7DQogICAgY29uc3RydWN0b3IoKSB7DQogICAgICAgIC8vdGhpcy51cmwgPSAnaHR0cDovL2xvY2FsaG9zdDozMDAwL2FwaS8nOw0KICAgICAgICB0aGlzLnVybCA9ICJodHRwczovL3Byb3h5LmZsdWx1LmV1LyINCiAgICB9DQogICAgI2dldCh1cmwsIGNhbGxiYWNrLCBlcnJvciA9IG51bGwpIHsNCiAgICAgICAgZmV0Y2godGhpcy51cmwgKyB1cmwpDQogICAgICAgICAgICAudGhlbihyZXNwb25zZSA9PiByZXNwb25zZS5qc29uKCkpDQogICAgICAgICAgICAudGhlbihkYXRhID0+IGNhbGxiYWNrKGRhdGEpKS5jYXRjaChlcnIgPT4gew0KICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTsNCiAgICAgICAgICAgICAgICBpZiAoZXJyb3IpIGVycm9yKGVycik7DQogICAgICAgICAgICB9KTsNCiAgICB9DQogICAgLyoqDQogICAgICogDQogICAgICogQHBhcmFtIHsqfSB1cmwgDQogICAgICogQHBhcmFtIHsqfSBkYXRhIA0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlfQ0KICAgICAqLw0KICAgICNhc3luY0dldCh1cmwpIHsNCiAgICAgICAgdmFyIHByb21pc2UgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7DQogICAgICAgICAgICB0aGlzLiNnZXQodXJsLCByZXNvbHZlLCByZWplY3QpOw0KICAgICAgICB9KTsNCiAgICAgICAgcmV0dXJuIHByb21pc2U7DQogICAgfQ0KDQogICAgI3Bvc3QodXJsLCBkYXRhLCBjYWxsYmFjaywgZXJyb3IgPSBudWxsKSB7DQogICAgICAgIGZldGNoKHRoaXMudXJsICsgdXJsLCB7DQogICAgICAgICAgICBtZXRob2Q6ICdQT1NUJywNCiAgICAgICAgICAgIGhlYWRlcnM6IHsNCiAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoZGF0YSksDQogICAgICAgIH0pLnRoZW4ocmVzcG9uc2UgPT4gcmVzcG9uc2UuanNvbigpKQ0KICAgICAgICAgICAgLnRoZW4oZGF0YSA9PiBjYWxsYmFjayhkYXRhKSkuY2F0Y2goZXJyID0+IHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7DQogICAgICAgICAgICAgICAgaWYgKGVycm9yKSBlcnJvcihlcnIpOw0KICAgICAgICAgICAgfSk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIA0KICAgICAqIEBwYXJhbSB7Kn0gdXJsIA0KICAgICAqIEBwYXJhbSB7Kn0gZGF0YQ0KICAgICAqIEByZXR1cm5zIHtQcm9taXNlfQ0KICAgICAqLw0KICAgICNhc3luY1Bvc3QodXJsLCBkYXRhKSB7DQogICAgICAgIHZhciBwcm9taXNlID0gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gew0KICAgICAgICAgICAgdGhpcy4jcG9zdCh1cmwsIGRhdGEsIHJlc29sdmUsIHJlamVjdCk7DQogICAgICAgIH0pOw0KICAgICAgICByZXR1cm4gcHJvbWlzZTsNCiAgICB9DQoNCiAgICBhc3luYyBnZXRQYWdlKHVybCkgew0KICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy4jYXN5bmNHZXQoJ3BhZ2U/dXJsPScgKyB1cmwpOw0KICAgIH0NCn0NCmNsYXNzIGd1aSB7DQogICAgLyoqDQogICAgICogDQogICAgICogQHBhcmFtIHtIdG1sV2luZG93fSB3aW5kb3cgDQogICAgICogQHBhcmFtIHtkb3dubG9hZFJlYWRlclByb2dyYW19IGNvbnRyb2xsZXIgDQogICAgICovDQogICAgY29uc3RydWN0b3Iod2luZG93LCBjb250cm9sbGVyKSB7DQogICAgICAgIHRoaXMud2luZG93ID0gd2luZG93Ow0KICAgICAgICB0aGlzLmNvbnRyb2xsZXIgPSBjb250cm9sbGVyOw0KDQogICAgICAgIHRoaXMucGFnZVJlYWRlciA9IG5ldyBwYWdlUmVhZGVyKHRoaXMud2luZG93LCB0aGlzLmNvbnRyb2xsZXIpOw0KICAgICAgICB0aGlzLmxvYWRlciA9IG5ldyBsb2FkZXIodGhpcy53aW5kb3cpOw0KDQogICAgICAgIHRoaXMuaW5pdCgpOw0KICAgIH0NCg0KICAgIGFzeW5jIGFkZEV2ZW50cygpIHsNCiAgICAgICAgLy9jbGVhcmRhdGFiYXNlDQogICAgICAgIHRoaXMud2luZG93LmFkZEh0bWxFdmVudExpc3RlbmVyKCJjbGljayIsICJjbGVhcmRhdGFiYXNlIiwgYXN5bmMgKCkgPT4gew0KICAgICAgICAgICAgLy9pZiAoY29uZmlybSgnUmVhbHkgZGVsZXRlIGV2ZXJ5dGhpbmc/JykpIENPTlRST0xMRVIuZGF0YWJhc2UuZnVsbGRlbGV0ZSgpDQogICAgICAgICAgICBpZiAoYXdhaXQgU3lzdGVtSHRtbC5XaW5kb3dIYW5kbGVyLnByZXNldHMuY3JlYXRlQ29uZmlybURpYWxvZygiUmVhbHkgZGVsZXRlIGV2ZXJ5dGhpbmc/IikpIHsNCiAgICAgICAgICAgICAgICB0aGlzLmNvbnRyb2xsZXIuZGF0YWJhc2UuZnVsbGRlbGV0ZSgpDQogICAgICAgICAgICB9DQogICAgICAgIH0sIHRoaXMpOw0KDQogICAgICAgIC8vcGFnZUVkaXQNCiAgICAgICAgdGhpcy53aW5kb3cuYWRkSHRtbEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgInBhZ2VFZGl0IiwgYXN5bmMgKCkgPT4gew0KICAgICAgICAgICAgdGhpcy5wYWdlUmVhZGVyLmVkaXQoKTsNCiAgICAgICAgfSwgdGhpcyk7DQoNCiAgICAgICAgLy9nb0JhY2tIb21lDQogICAgICAgIHRoaXMud2luZG93LmFkZEh0bWxFdmVudExpc3RlbmVyKCJjbGljayIsICJnb0JhY2tIb21lIiwgYXN5bmMgKCkgPT4gew0KICAgICAgICAgICAgdGhpcy5zaG93VGFiKCdIb21lJyk7DQogICAgICAgICAgICB0aGlzLnBhZ2VSZWFkZXIudG9nZ2xlT3B0aW9ucygpOw0KICAgICAgICB9LCB0aGlzKTsNCg0KICAgICAgICAvL2FkZFJlbW92ZVRleHQNCiAgICAgICAgdGhpcy53aW5kb3cuYWRkSHRtbEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgImFkZFJlbW92ZVRleHQiLCBhc3luYyAoKSA9PiB7DQogICAgICAgICAgICB0aGlzLnBhZ2VSZWFkZXIuYWRkUmVtb3ZlVGV4dCgpOw0KICAgICAgICB9LCB0aGlzKTsNCg0KICAgICAgICAvL2V4aXRFZGl0UGFuZWwNCiAgICAgICAgdGhpcy53aW5kb3cuYWRkSHRtbEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgImV4aXRFZGl0UGFuZWwiLCBhc3luYyAoKSA9PiB7DQogICAgICAgICAgICB0aGlzLnBhZ2VSZWFkZXIuZWRpdCgpOw0KICAgICAgICB9LCB0aGlzKTsNCg0KICAgICAgICAvL2J0bkRvd25sb2FkDQogICAgICAgIHRoaXMud2luZG93LmFkZEh0bWxFdmVudExpc3RlbmVyKCJjbGljayIsICJidG5Eb3dubG9hZCIsIGFzeW5jICgpID0+IHsNCiAgICAgICAgICAgIHRoaXMuYnV0dG9uQWRkVXJsKCk7DQogICAgICAgIH0sIHRoaXMpOw0KDQogICAgICAgIHRoaXMud2luZG93LmFkZEh0bWxFdmVudExpc3RlbmVyKCJjbGljayIsICJwYWdlIiwgYXN5bmMgKF8sIF9fLCBfX18sIGV2ZW50KSA9PiB7DQogICAgICAgICAgICB2YXIgY3AgPSBldmVudC5jb21wb3NlZFBhdGgoKTsNCiAgICAgICAgICAgIGZvciAodmFyIHggPSAwOyB4IDwgNDsgeCsrKSB7DQogICAgICAgICAgICAgICAgaWYgKGNwW3hdLmdldEF0dHJpYnV0ZSgiZWxlbWVudCIpID09ICJsaW5rIikgew0KICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRyb2xsZXIucGFnZUNsaWNrZWQoY3BbeF0udGl0bGUpOw0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vaWYgKGV2ZW50LnRhcmdldC5nZXRBdHRyaWJ1dGUoImVsZW1lbnQiKSA9PSAibGluayIgfHwgZXZlbnQuY29tcG9zZWRQYXRoKClbMV0uZ2V0QXR0cmlidXRlKCJlbGVtZW50IikgPT0gImxpbmsiIHx8IGV2ZW50LmNvbXBvc2VkUGF0aCgpWzJdLmdldEF0dHJpYnV0ZSgiZWxlbWVudCIpID09ICJsaW5rIiB8fCBldmVudC5jb21wb3NlZFBhdGgoKVszXS5nZXRBdHRyaWJ1dGUoImVsZW1lbnQiKSA9PSAibGluayIpIHsNCiAgICAgICAgICAgIC8vICAgIHRoaXMuY29udHJvbGxlci5wYWdlQ2xpY2tlZChldmVudC50YXJnZXQudGl0bGUpOw0KICAgICAgICAgICAgLy99DQogICAgICAgIH0pOw0KICAgIH0NCg0KICAgIGFzeW5jIGluaXQoKSB7DQogICAgICAgIHRoaXMud2FzTWF4T25jZSA9IGZhbHNlOw0KDQogICAgICAgIGF3YWl0IHRoaXMuYWRkRXZlbnRzKCk7DQoNCiAgICAgICAgdGhpcy51cGRhdGVQYWdlcygpOw0KDQogICAgICAgIHRoaXMuY3VycmVudFRhYiA9ICJIb21lIjsNCiAgICAgICAgdGhpcy50YWIgPSB7DQogICAgICAgICAgICAiSG9tZSI6IHsNCiAgICAgICAgICAgICAgICAiaWQiOiAiaG9tZSIsDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgIlBhZ2UiOiB7DQogICAgICAgICAgICAgICAgImlkIjogInBhZ2UiLA0KICAgICAgICAgICAgfQ0KICAgICAgICB9Ow0KICAgICAgICB0aGlzLnNob3dUYWIodGhpcy5jdXJyZW50VGFiKTsNCg0KICAgICAgICB0aGlzLmN1cnJlbnRQYWdlID0gbnVsbDsNCg0KICAgICAgICB0aGlzLmxvYWREaXNwbGF5VHlwZXMoKTsNCiAgICB9DQoNCiAgICBhc3luYyBsb2FkRGlzcGxheVR5cGVzKCkgew0KICAgICAgICB0aGlzLnBhZ2VEaXNwbGF5VHlwZXMgPSB7DQogICAgICAgICAgICBNYXJnaW46IHsNCiAgICAgICAgICAgICAgICAiVHlwZSAxIjogInR5cGUxY29udGFpbmVyIiwNCiAgICAgICAgICAgICAgICAiVHlwZSAyIjogInR5cGUyY29udGFpbmVyIiwNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBDb2xvcjogew0KICAgICAgICAgICAgICAgICJMaWdodCI6ICJ0eXBlMWNvbG9yIiwNCiAgICAgICAgICAgICAgICAiRGFyayI6ICJ0eXBlMmNvbG9yIiwNCiAgICAgICAgICAgICAgICAiRGFyayBEYXJrIjogInR5cGUyM2NvbG9yIiwNCiAgICAgICAgICAgICAgICAiTWlkIERhcmsiOiAidHlwZTNjb2xvciIsDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgRm9udDogew0KICAgICAgICAgICAgICAgICJTZXJpZiI6ICJ0eXBlMWZvbnQiLA0KICAgICAgICAgICAgICAgICJTYW5zLVNlcmlmIjogInR5cGUyZm9udCIsDQogICAgICAgICAgICAgICAgIk1vbm9zcGFjZSI6ICJ0eXBlM2ZvbnQiLA0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIFNpemU6IHsNCiAgICAgICAgICAgICAgICAiRXh0cmEgU21hbGwiOiAidHlwZTBzaXplIiwNCiAgICAgICAgICAgICAgICAiU21hbGwiOiAidHlwZTFzaXplIiwNCiAgICAgICAgICAgICAgICAiTWVkaXVtIjogInR5cGUyc2l6ZSIsDQogICAgICAgICAgICAgICAgIkxhcmdlIjogInR5cGUzc2l6ZSIsDQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgdGhpcy5wYWdlRGlzcGxheVR5cGVzU3RhbmRhcmQgPSB7DQogICAgICAgICAgICBNYXJnaW46ICJUeXBlIDEiLA0KICAgICAgICAgICAgQ29sb3I6ICJNaWQgRGFyayIsDQogICAgICAgICAgICBGb250OiAiU2Fucy1TZXJpZiIsDQogICAgICAgICAgICBTaXplOiAiTWVkaXVtIiwNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChhd2FpdCB0aGlzLmNvbnRyb2xsZXIuZGF0YWJhc2Uub3B0aW9uRXhpc3RzKCJwYWdlRGlzcGxheVR5cGVzIikpIHsNCiAgICAgICAgICAgIHRoaXMucGFnZURpc3BsYXlUeXBlc1N0YW5kYXJkID0gYXdhaXQgdGhpcy5jb250cm9sbGVyLmRhdGFiYXNlLmdldE9wdGlvbigicGFnZURpc3BsYXlUeXBlcyIpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgYXdhaXQgdGhpcy5jb250cm9sbGVyLmRhdGFiYXNlLnNldE9wdGlvbigicGFnZURpc3BsYXlUeXBlcyIsIHRoaXMucGFnZURpc3BsYXlUeXBlc1N0YW5kYXJkKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHRoaXMuc3BlY2lhbFR5cGVDb2RlID0gew0KICAgICAgICAgICAgQ29sb3I6ICh0eXBlLCB0eXBlMikgPT4gew0KICAgICAgICAgICAgICAgIC8vc2V0IG1ldGEgdGhlbWUtY29sb3IgdGFnDQogICAgICAgICAgICAgICAgLy92YXIgbWV0YSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ21ldGFbbmFtZT0idGhlbWUtY29sb3IiXScpOyAvL1RPRE8gYWRkIHRvIFN5c3RlbQ0KICAgICAgICAgICAgICAgIHZhciBjb2xvcnMgPSB7DQogICAgICAgICAgICAgICAgICAgICJMaWdodCI6ICIjZmZmZmZmIiwNCiAgICAgICAgICAgICAgICAgICAgIkRhcmsiOiAiIzAwMDAwMCIsDQogICAgICAgICAgICAgICAgICAgICJEYXJrIERhcmsiOiAiIzAwMDAwMCIsDQogICAgICAgICAgICAgICAgICAgICJNaWQgRGFyayI6ICIjNWE1MTUxIiwNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgLy9tZXRhLnNldEF0dHJpYnV0ZSgiY29udGVudCIsIGNvbG9yc1t0eXBlMl0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHRoaXMucmV2ZXJzZVBhZ2VEaXNwbGF5VHlwZXMgPSB7fQ0KICAgICAgICB0aGlzLnBhZ2VEaXNwbGF5VHlwZXNEb20gPSB7fQ0KICAgICAgICB0aGlzLnBhZ2VEaXNwbGF5VHlwZXNTZWxlY3RlZCA9IHt9DQogICAgICAgIHRoaXMuYWRkUGFnZURpc3BsYXlUeXBlcygpOw0KICAgIH0NCg0KICAgIGJ1dHRvbkFkZFVybCgpIHsNCiAgICAgICAgdmFyIHVybCA9IHByb21wdCgnRW50ZXIgVVJMJywgJycpOw0KICAgICAgICBpZiAoIXVybCkgcmV0dXJuOw0KICAgICAgICB0aGlzLmNvbnRyb2xsZXIuZ2V0UGFnZSh1cmwpOw0KICAgIH0NCg0KICAgIGFzeW5jIHVwZGF0ZVBhZ2VzKCkgew0KICAgICAgICB2YXIgaWQgPSB0aGlzLmxvYWRlci5hZGQoKTsNCiAgICAgICAgdmFyIHAgPSBhd2FpdCB0aGlzLmNvbnRyb2xsZXIuZGF0YWJhc2UuZ2V0UGFnZXMoKTsNCiAgICAgICAgdmFyIGRpdiA9IGF3YWl0IHRoaXMud2luZG93LmdldEh0bWxFbGVtZW50KCJkb3dubG9hZGVkUGFnZXMiKTsNCiAgICAgICAgZGl2LmlubmVySFRNTCA9ICcnOw0KICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHAubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIGRpdi5hcHBlbmRDaGlsZCh0aGlzLmdldFBhZ2UocFtpXS51cmwpKTsNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLmxvYWRlci5yZW1vdmUoaWQpOw0KICAgIH0NCiAgICBnZXRQYWdlKHVybCkgew0KICAgICAgICB2YXIgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7DQogICAgICAgIGRpdi5jbGFzc0xpc3QuYWRkKCdkb3dubG9hZGVkUGFnZScpOw0KICAgICAgICBkaXYub25jbGljayA9IHRoaXMucGFnZUNsaWNrLmJpbmQodGhpcywgdXJsKTsNCg0KICAgICAgICB2YXIgcFVybCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTsNCiAgICAgICAgcFVybC5pbm5lclRleHQgPSB1cmw7DQogICAgICAgIHBVcmwuc3R5bGUub3ZlcmZsb3dXcmFwID0gImFueXdoZXJlIjsNCiAgICAgICAgZGl2LmFwcGVuZENoaWxkKHBVcmwpOw0KDQogICAgICAgIHZhciBidG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTsNCiAgICAgICAgYnRuLmlubmVyVGV4dCA9ICdEZWxldGUnOw0KICAgICAgICBidG4ub25jbGljayA9IHRoaXMuZGVsZXRlUGFnZS5iaW5kKHRoaXMsIHVybCk7DQogICAgICAgIGRpdi5hcHBlbmRDaGlsZChidG4pOw0KDQogICAgICAgIHRoaXMuY29udHJvbGxlci5kYXRhYmFzZS5nZXRQYWdlKHVybCkudGhlbihkYkluZm8gPT4gew0KICAgICAgICAgICAgaWYgKCFkYkluZm8pIHJldHVybjsNCg0KICAgICAgICAgICAgdmFyIHBUaXRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTsNCiAgICAgICAgICAgIHBUaXRsZS5jbGFzc0xpc3QuYWRkKCd0aXRsZScpOw0KICAgICAgICAgICAgcFRpdGxlLmlubmVyVGV4dCA9IGRiSW5mby50aXRsZTsNCiAgICAgICAgICAgIGRpdi5wcmVwZW5kKHBUaXRsZSk7DQoNCiAgICAgICAgICAgIHBVcmwuc3R5bGUuZm9udFNpemUgPSAnMC44ZW0nOw0KICAgICAgICB9KTsNCg0KDQogICAgICAgIHJldHVybiBkaXY7DQogICAgfQ0KICAgIHBhZ2VDbGljayh1cmwpIHsNCiAgICAgICAgdGhpcy5jb250cm9sbGVyLnNob3dQYWdlKHVybCk7DQogICAgfQ0KDQogICAgZGVsZXRlUGFnZSh1cmwpIHsNCiAgICAgICAgdGhpcy5jb250cm9sbGVyLmRhdGFiYXNlLmRlbGV0ZVBhZ2UodXJsKS50aGVuKCgpID0+IHsNCiAgICAgICAgICAgIHRoaXMudXBkYXRlUGFnZXMoKTsNCiAgICAgICAgfSk7DQogICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOw0KICAgIH0NCg0KICAgIGFzeW5jIHNob3dUYWIodGFiKSB7DQogICAgICAgIHRoaXMuY3VycmVudFRhYiA9IHRhYjsNCiAgICAgICAgZm9yICh2YXIgdCBpbiB0aGlzLnRhYikgew0KICAgICAgICAgICAgaWYgKHQgPT0gdGFiKSB7DQogICAgICAgICAgICAgICAgKGF3YWl0IHRoaXMud2luZG93LmdldEh0bWxFbGVtZW50KHRoaXMudGFiW3RdLmlkKSkuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIChhd2FpdCB0aGlzLndpbmRvdy5nZXRIdG1sRWxlbWVudCh0aGlzLnRhYlt0XS5pZCkpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBpZiAodGFiICE9ICJQYWdlIikgew0KICAgICAgICAgICAgdGhpcy5jdXJyZW50UGFnZSA9IG51bGw7DQogICAgICAgICAgICBpZiAodGhpcy53YXNNYXhPbmNlKSB7DQogICAgICAgICAgICAgICAgdGhpcy53aW5kb3cuc2l6ZS5iYWNrRnJvbUZ1bGxNYXgoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBpZiAodGFiID09ICJQYWdlIikgew0KICAgICAgICAgICAgdGhpcy53aW5kb3cuc2l6ZS5zZXRmdWxsTWF4KCk7DQogICAgICAgICAgICB0aGlzLndhc01heE9uY2UgPSB0cnVlOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgYXN5bmMgYWRkUGFnZURpc3BsYXlUeXBlcygpIHsNCiAgICAgICAgdmFyIGRpdiA9IGF3YWl0IHRoaXMud2luZG93LmdldEh0bWxFbGVtZW50KCJhdXRvR2VuRGlzcGxheVR5cGVzIik7DQogICAgICAgIGZvciAodmFyIHQgaW4gdGhpcy5wYWdlRGlzcGxheVR5cGVzKSB7DQogICAgICAgICAgICB2YXIgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7DQogICAgICAgICAgICB2YXIgcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTsNCiAgICAgICAgICAgIHAuaW5uZXJUZXh0ID0gdCArICc6JzsNCiAgICAgICAgICAgIHAuc3R5bGUubWFyZ2luID0gJzAnOw0KICAgICAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHApOw0KICAgICAgICAgICAgY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2Rpc3BsYXlUeXBlU2VsZWN0Um93Jyk7DQoNCiAgICAgICAgICAgIHRoaXMucGFnZURpc3BsYXlUeXBlc1NlbGVjdGVkW3RdID0gT2JqZWN0LnZhbHVlcyh0aGlzLnBhZ2VEaXNwbGF5VHlwZXNbdF0pWzBdOw0KICAgICAgICAgICAgdGhpcy5wYWdlRGlzcGxheVR5cGVzRG9tW3RdID0geyBjb250YWluZXI6IGNvbnRhaW5lciwgaXRlbXM6IHt9IH0NCiAgICAgICAgICAgIHRoaXMucmV2ZXJzZVBhZ2VEaXNwbGF5VHlwZXNbdF0gPSB7fQ0KICAgICAgICAgICAgZm9yICh2YXIgdDIgaW4gdGhpcy5wYWdlRGlzcGxheVR5cGVzW3RdKSB7DQogICAgICAgICAgICAgICAgdmFyIGJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpOw0KICAgICAgICAgICAgICAgIGJ0bi5pbm5lclRleHQgPSB0MjsNCiAgICAgICAgICAgICAgICBidG4ub25jbGljayA9IHRoaXMuc2V0UGFnZURpc3BsYXlUeXBlLmJpbmQodGhpcywgdCwgdDIpOw0KICAgICAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChidG4pOw0KICAgICAgICAgICAgICAgIHRoaXMucGFnZURpc3BsYXlUeXBlc0RvbVt0XS5pdGVtc1t0Ml0gPSBidG47DQogICAgICAgICAgICAgICAgdGhpcy5yZXZlcnNlUGFnZURpc3BsYXlUeXBlc1t0XVt0aGlzLnBhZ2VEaXNwbGF5VHlwZXNbdF1bdDJdXSA9IHQyOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgYXdhaXQgdGhpcy5zZXRQYWdlRGlzcGxheVR5cGUodCwgdGhpcy5wYWdlRGlzcGxheVR5cGVzU3RhbmRhcmRbdF0pOw0KICAgICAgICAgICAgZGl2LmFwcGVuZENoaWxkKGNvbnRhaW5lcik7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBhc3luYyBzZXRQYWdlRGlzcGxheVR5cGUodHlwZSwgdHlwZTIpIHsNCiAgICAgICAgdmFyIG9sZCA9IHRoaXMucGFnZURpc3BsYXlUeXBlc1NlbGVjdGVkW3R5cGVdOw0KICAgICAgICBpZiAodGhpcy5wYWdlRGlzcGxheVR5cGVzRG9tW3R5cGVdLml0ZW1zW3RoaXMucmV2ZXJzZVBhZ2VEaXNwbGF5VHlwZXNbdHlwZV1bb2xkXV0pIHsNCiAgICAgICAgICAgIHRoaXMucGFnZURpc3BsYXlUeXBlc0RvbVt0eXBlXS5pdGVtc1t0aGlzLnJldmVyc2VQYWdlRGlzcGxheVR5cGVzW3R5cGVdW29sZF1dLmNsYXNzTGlzdC5yZW1vdmUoJ3NlbGVjdGVkJyk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBjb25zb2xlLmxvZygnbm8gb2xkJyk7DQogICAgICAgIH0NCg0KICAgICAgICB0aGlzLnBhZ2VEaXNwbGF5VHlwZXNTZWxlY3RlZFt0eXBlXSA9IHRoaXMucGFnZURpc3BsYXlUeXBlc1t0eXBlXVt0eXBlMl07DQogICAgICAgIHRoaXMucGFnZURpc3BsYXlUeXBlc0RvbVt0eXBlXS5pdGVtc1t0eXBlMl0uY2xhc3NMaXN0LmFkZCgnc2VsZWN0ZWQnKTsNCiAgICAgICAgdmFyIHBhZ2UgPSBhd2FpdCB0aGlzLndpbmRvdy5nZXRIdG1sRWxlbWVudCgicGFnZSIpOw0KICAgICAgICBwYWdlLmNsYXNzTGlzdC5yZW1vdmUob2xkKTsNCiAgICAgICAgcGFnZS5jbGFzc0xpc3QuYWRkKHRoaXMucGFnZURpc3BsYXlUeXBlc1NlbGVjdGVkW3R5cGVdKTsNCiAgICAgICAgaWYgKHRoaXMuc3BlY2lhbFR5cGVDb2RlW3R5cGVdKSB7DQogICAgICAgICAgICB0aGlzLnNwZWNpYWxUeXBlQ29kZVt0eXBlXSh0eXBlLCB0eXBlMik7DQogICAgICAgIH0NCg0KICAgICAgICB2YXIgc2VsZWN0ZWRGdWxsTmFtZXMgPSB7fQ0KICAgICAgICBmb3IgKHZhciB0IGluIHRoaXMucGFnZURpc3BsYXlUeXBlc1NlbGVjdGVkKSB7DQogICAgICAgICAgICBzZWxlY3RlZEZ1bGxOYW1lc1t0XSA9IHRoaXMucmV2ZXJzZVBhZ2VEaXNwbGF5VHlwZXNbdF1bdGhpcy5wYWdlRGlzcGxheVR5cGVzU2VsZWN0ZWRbdF1dOw0KICAgICAgICB9DQogICAgICAgIHRoaXMuY29udHJvbGxlci5kYXRhYmFzZS5zZXRPcHRpb24oInBhZ2VEaXNwbGF5VHlwZXMiLCBzZWxlY3RlZEZ1bGxOYW1lcyk7DQogICAgfQ0KDQogICAgYXN5bmMgc2hvd1BhZ2UodXJsLCBjb250ZW50LCB0aXRsZSwgb3B0aW9ucykgew0KICAgICAgICB0aGlzLnNob3dUYWIoIlBhZ2UiKTsNCg0KICAgICAgICB0aGlzLmN1cnJlbnRQYWdlID0gdXJsOw0KDQogICAgICAgIChhd2FpdCB0aGlzLndpbmRvdy5nZXRIdG1sRWxlbWVudCgicGFnZVVybCIpKS5pbm5lclRleHQgPSB1cmw7DQogICAgICAgIChhd2FpdCB0aGlzLndpbmRvdy5nZXRIdG1sRWxlbWVudCgicGFnZUNvbnRlbnRCb2R5IikpLmlubmVySFRNTCA9IHRoaXMuY29udHJvbGxlci5yZWFkZXIuYXBwbHlPcHRpb25zKGNvbnRlbnQsIG9wdGlvbnMpOw0KICAgICAgICAoYXdhaXQgdGhpcy53aW5kb3cuZ2V0SHRtbEVsZW1lbnQoInBhZ2VDb250ZW50VGl0bGUiKSkuaW5uZXJUZXh0ID0gdGl0bGU7DQoNCiAgICB9DQoNCiAgICBhc3luYyBvcGVuU2VsZWN0KGRhdGEpIHsNCiAgICAgICAgdmFyIHNlbGVjdCA9IGF3YWl0IHRoaXMud2luZG93LmdldEh0bWxFbGVtZW50KCJzZWxlY3QiKTsNCiAgICAgICAgdmFyIHNlbGVjdFRpdGxlID0gYXdhaXQgdGhpcy53aW5kb3cuZ2V0SHRtbEVsZW1lbnQoInNlbGVjdFRpdGxlIik7DQogICAgICAgIHZhciBzZWxlY3RPcHRpb25zID0gYXdhaXQgdGhpcy53aW5kb3cuZ2V0SHRtbEVsZW1lbnQoInNlbGVjdE9wdGlvbnMiKTsNCiAgICAgICAgdmFyIHNlbGVjdENsb3NlID0gYXdhaXQgdGhpcy53aW5kb3cuZ2V0SHRtbEVsZW1lbnQoInNlbGVjdENsb3NlIik7DQoNCiAgICAgICAgdmFyIGRpdiA9IHNlbGVjdDsNCiAgICAgICAgZGl2LnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7DQoNCiAgICAgICAgdmFyIHRpdGxlID0gc2VsZWN0VGl0bGU7DQogICAgICAgIHRpdGxlLmlubmVyVGV4dCA9IGRhdGEudGl0bGU7DQoNCiAgICAgICAgdmFyIG9wdGlvbnMgPSBzZWxlY3RPcHRpb25zOw0KICAgICAgICBvcHRpb25zLmlubmVySFRNTCA9ICcnOw0KICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGRhdGEub3B0aW9ucy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgdmFyIGJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpOw0KICAgICAgICAgICAgYnRuLmlubmVyVGV4dCA9IGRhdGEub3B0aW9uc1tpXS50ZXh0Ow0KICAgICAgICAgICAgYnRuLm9uY2xpY2sgPSAoKGFjdGlvbiwgZGl2KSA9PiB7DQogICAgICAgICAgICAgICAgYWN0aW9uKCk7DQogICAgICAgICAgICAgICAgZGl2LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgICAgICAgICB9KS5iaW5kKHRoaXMsIGRhdGEub3B0aW9uc1tpXS5hY3Rpb24sIGRpdik7DQogICAgICAgICAgICBvcHRpb25zLmFwcGVuZENoaWxkKGJ0bik7DQogICAgICAgIH0NCg0KICAgICAgICB2YXIgY2xvc2UgPSBzZWxlY3RDbG9zZTsNCiAgICAgICAgY2xvc2Uub25jbGljayA9ICgoKSA9PiB7DQogICAgICAgICAgICBkaXYuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgICAgICAgICAgIG9wdGlvbnMuaW5uZXJIVE1MID0gJyc7DQogICAgICAgICAgICBpZiAoZGF0YS5vbkNsb3NlKSB7DQogICAgICAgICAgICAgICAgZGF0YS5vbkNsb3NlKCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0pLmJpbmQodGhpcyk7DQogICAgfQ0KDQogICAgYXN5bmMgYXN5bmNTZWxlY3QodGl0bGUsIG9wdGlvbnMpIHsNCiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsNCiAgICAgICAgICAgIHZhciBvcCA9IFtdDQogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9wdGlvbnMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgICAgICB2YXIgZCA9IHsNCiAgICAgICAgICAgICAgICAgICAgdGV4dDogb3B0aW9uc1tpXSwNCiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiAoKGkpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUob3B0aW9uc1tpXSk7DQogICAgICAgICAgICAgICAgICAgIH0pLmJpbmQodGhpcywgaSkNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgb3AucHVzaChkKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgdGhpcy5vcGVuU2VsZWN0KHsNCiAgICAgICAgICAgICAgICB0aXRsZTogdGl0bGUsDQogICAgICAgICAgICAgICAgb3B0aW9uczogb3AsDQogICAgICAgICAgICAgICAgb25DbG9zZTogKCkgPT4gew0KICAgICAgICAgICAgICAgICAgICByZXNvbHZlKG51bGwpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9KTsNCiAgICB9DQp9DQoNCmNsYXNzIHBhZ2VSZWFkZXIgew0KICAgIGNvbnN0cnVjdG9yKHdpbmRvdywgY29udHJvbGxlcikgew0KICAgICAgICB0aGlzLndpbmRvdyA9IHdpbmRvdzsNCiAgICAgICAgdGhpcy5jb250cm9sbGVyID0gY29udHJvbGxlcjsNCiAgICAgICAgdGhpcy5pbml0KCk7DQogICAgfQ0KDQogICAgYXN5bmMgaW5pdCgpIHsNCiAgICAgICAgdGhpcy5kaXYgPSBhd2FpdCB0aGlzLndpbmRvdy5nZXRIdG1sRWxlbWVudCgicGFnZSIpOw0KICAgICAgICB0aGlzLmRpdi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuY2xpY2suYmluZCh0aGlzKSk7DQoNCiAgICAgICAgdGhpcy5vcHRpb25zT3BlbiA9IGZhbHNlOw0KICAgICAgICB0aGlzLmVkaXRQYW5lbE9wZW4gPSBmYWxzZTsNCiAgICAgICAgdGhpcy51cGRhdGVPcHRpb25zKCk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogDQogICAgICogQHBhcmFtIHtNb3VzZUV2ZW50fSBldmVudCANCiAgICAgKi8NCiAgICBhc3luYyBjbGljayhldmVudCkgew0KICAgICAgICAvL2lmICNwYWdlT3B0aW9ucyBpcyBub3QgY2xpY2tlZA0KICAgICAgICBpZiAoIWV2ZW50LmNvbXBvc2VkUGF0aCgpLmluY2x1ZGVzKGF3YWl0IHRoaXMud2luZG93LmdldEh0bWxFbGVtZW50KCdwYWdlT3B0aW9ucycpKSAmJiAhZXZlbnQuY29tcG9zZWRQYXRoKCkuaW5jbHVkZXMoYXdhaXQgdGhpcy53aW5kb3cuZ2V0SHRtbEVsZW1lbnQoJ2VkaXRQYW5lbCcpKSAmJiAhZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygibGluayIpKSB7DQogICAgICAgICAgICB0aGlzLnRvZ2dsZU9wdGlvbnMoKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHRvZ2dsZU9wdGlvbnMoKSB7DQogICAgICAgIHRoaXMub3B0aW9uc09wZW4gPSAhdGhpcy5vcHRpb25zT3BlbjsNCiAgICAgICAgdGhpcy51cGRhdGVPcHRpb25zKCk7DQogICAgfQ0KDQogICAgYXN5bmMgdXBkYXRlT3B0aW9ucygpIHsNCiAgICAgICAgaWYgKHRoaXMub3B0aW9uc09wZW4pIHsNCiAgICAgICAgICAgIChhd2FpdCB0aGlzLndpbmRvdy5nZXRIdG1sRWxlbWVudCgncGFnZU9wdGlvbnMnKSkuc3R5bGUuZGlzcGxheSA9ICcnOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgKGF3YWl0IHRoaXMud2luZG93LmdldEh0bWxFbGVtZW50KCdwYWdlT3B0aW9ucycpKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgZWRpdCgpIHsNCiAgICAgICAgdGhpcy5lZGl0UGFuZWxPcGVuID0gIXRoaXMuZWRpdFBhbmVsT3BlbjsNCiAgICAgICAgdGhpcy51cGRhdGVFZGl0UGFuZWwoKTsNCiAgICB9DQoNCiAgICBhc3luYyB1cGRhdGVFZGl0UGFuZWwoKSB7DQogICAgICAgIGlmICh0aGlzLmVkaXRQYW5lbE9wZW4pIHsNCiAgICAgICAgICAgIChhd2FpdCB0aGlzLndpbmRvdy5nZXRIdG1sRWxlbWVudCgnZWRpdFBhbmVsJykpLnN0eWxlLmRpc3BsYXkgPSAnJzsNCiAgICAgICAgICAgIHRoaXMub3B0aW9uc09wZW4gPSBmYWxzZTsNCiAgICAgICAgICAgIHRoaXMudXBkYXRlT3B0aW9ucygpOw0KICAgICAgICAgICAgdGhpcy5tYWtlRWRpdFBhbmVsKCk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAoYXdhaXQgdGhpcy53aW5kb3cuZ2V0SHRtbEVsZW1lbnQoJ2VkaXRQYW5lbCcpKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgICAgICAgICAgdGhpcy5jb250cm9sbGVyLnJlbG9hZFBhZ2UoKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIGFzeW5jIG1ha2VFZGl0UGFuZWwoKSB7DQogICAgICAgIHZhciBkYXRhID0gYXdhaXQgdGhpcy5jb250cm9sbGVyLmRhdGFiYXNlLmdldFBhZ2UodGhpcy5jb250cm9sbGVyLmd1aS5jdXJyZW50UGFnZSk7DQoNCiAgICAgICAgdGhpcy5yZW1vdmVkVGV4dHMgPSBbXTsNCiAgICAgICAgaWYgKGRhdGEub3B0aW9ucy5yZW1vdmVkVGV4dHMpIHsNCiAgICAgICAgICAgIHRoaXMucmVtb3ZlZFRleHRzID0gZGF0YS5vcHRpb25zLnJlbW92ZWRUZXh0czsNCiAgICAgICAgfQ0KICAgICAgICB2YXIgZWRpdFBhbmVsUmVtb3ZlVGV4dHNMaXN0ID0gYXdhaXQgdGhpcy53aW5kb3cuZ2V0SHRtbEVsZW1lbnQoJ2VkaXRQYW5lbFJlbW92ZVRleHRzTGlzdCcpOw0KICAgICAgICBlZGl0UGFuZWxSZW1vdmVUZXh0c0xpc3QuaW5uZXJIVE1MID0gJyc7DQogICAgICAgIGZvciAodmFyIHQgb2YgdGhpcy5yZW1vdmVkVGV4dHMpIHsNCiAgICAgICAgICAgIHZhciBwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpOw0KICAgICAgICAgICAgcC5pbm5lclRleHQgPSB0Ow0KICAgICAgICAgICAgcC50aXRsZSA9ICJjbGljayB0byByZW1vdmUiOw0KICAgICAgICAgICAgcC5vbmNsaWNrID0gdGhpcy5yZW1vdmVSZW1vdmVUZXh0LmJpbmQodGhpcywgdCk7DQogICAgICAgICAgICBlZGl0UGFuZWxSZW1vdmVUZXh0c0xpc3QuYXBwZW5kQ2hpbGQocCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBhc3luYyBhZGRSZW1vdmVUZXh0KCkgew0KICAgICAgICB2YXIgdGV4dCA9IChhd2FpdCB0aGlzLndpbmRvdy5nZXRIdG1sRWxlbWVudCgnZWRpdFBhbmVsUmVtb3ZlVGV4dHNJbnB1dCcpKS52YWx1ZTsNCiAgICAgICAgaWYgKHRleHQgJiYgdGV4dCAhPSAiIiAmJiB0ZXh0ICE9ICIgIikgew0KICAgICAgICAgICAgdGhpcy5yZW1vdmVkVGV4dHMucHVzaCh0ZXh0KTsNCiAgICAgICAgICAgIHRoaXMuY29udHJvbGxlci5kYXRhYmFzZS5zZXRQYWdlT3B0aW9uKHRoaXMuY29udHJvbGxlci5ndWkuY3VycmVudFBhZ2UsICJyZW1vdmVkVGV4dHMiLCB0aGlzLnJlbW92ZWRUZXh0cykudGhlbigoKSA9PiB7DQogICAgICAgICAgICAgICAgdGhpcy5jb250cm9sbGVyLmd1aS5wYWdlUmVhZGVyLm1ha2VFZGl0UGFuZWwoKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgICAgIChhd2FpdCB0aGlzLndpbmRvdy5nZXRIdG1sRWxlbWVudCgnZWRpdFBhbmVsUmVtb3ZlVGV4dHNJbnB1dCcpKS52YWx1ZSA9ICIiOw0KICAgIH0NCiAgICByZW1vdmVSZW1vdmVUZXh0KHRleHQpIHsNCiAgICAgICAgdGhpcy5yZW1vdmVkVGV4dHMuc3BsaWNlKHRoaXMucmVtb3ZlZFRleHRzLmluZGV4T2YodGV4dCksIDEpOw0KICAgICAgICB0aGlzLmNvbnRyb2xsZXIuZGF0YWJhc2Uuc2V0UGFnZU9wdGlvbih0aGlzLmNvbnRyb2xsZXIuZ3VpLmN1cnJlbnRQYWdlLCAicmVtb3ZlZFRleHRzIiwgdGhpcy5yZW1vdmVkVGV4dHMpLnRoZW4oKCkgPT4gew0KICAgICAgICAgICAgdGhpcy5jb250cm9sbGVyLmd1aS5wYWdlUmVhZGVyLm1ha2VFZGl0UGFuZWwoKTsNCiAgICAgICAgfSk7DQogICAgfQ0KfQ0KDQpjbGFzcyBsb2FkZXIgew0KICAgIGNvbnN0cnVjdG9yKHdpbmRvdykgew0KICAgICAgICB0aGlzLndpbmRvdyA9IHdpbmRvdzsNCiAgICAgICAgdGhpcy5pbml0KCk7DQogICAgfQ0KDQogICAgYXN5bmMgaW5pdCgpIHsNCiAgICAgICAgdGhpcy5kaXYgPSBhd2FpdCB0aGlzLndpbmRvdy5nZXRIdG1sRWxlbWVudCgnbG9hZGluZycpOw0KICAgICAgICB0aGlzLmlkcyA9IHt9Ow0KICAgIH0NCg0KICAgIHJhbmRvbUlkKCkgew0KICAgICAgICB2YXIgaWQgPSBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHJpbmcoMiwgMTUpICsgTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDIsIDE1KTsNCiAgICAgICAgd2hpbGUgKHRoaXMuaWRzW2lkXSkgew0KICAgICAgICAgICAgaWQgPSBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHJpbmcoMiwgMTUpICsgTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDIsIDE1KTsNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLmlkc1tpZF0gPSB7IGFjdGl2ZTogdHJ1ZSB9Ow0KICAgICAgICByZXR1cm4gaWQ7DQogICAgfQ0KDQogICAgYWRkKG1lc3NhZ2UgPSBudWxsKSB7DQogICAgICAgIHZhciBpZCA9IHRoaXMucmFuZG9tSWQoKTsNCiAgICAgICAgaWYgKG1lc3NhZ2UpIHsNCiAgICAgICAgICAgIHRoaXMuaWRzW2lkXS5tZXNzYWdlID0gbWVzc2FnZTsNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLnVwZGF0ZSgpOw0KICAgICAgICByZXR1cm4gaWQ7DQogICAgfQ0KICAgIHJlbW92ZShpZCkgew0KICAgICAgICBkZWxldGUgdGhpcy5pZHNbaWRdOw0KICAgICAgICB0aGlzLnVwZGF0ZSgpOw0KICAgIH0NCg0KICAgIGFzeW5jIHVwZGF0ZSgpIHsNCiAgICAgICAgaWYgKE9iamVjdC5rZXlzKHRoaXMuaWRzKS5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICB0aGlzLmRpdi5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOw0KDQogICAgICAgICAgICB2YXIgaGFzTWVzc2FnZSA9IGZhbHNlOw0KICAgICAgICAgICAgdmFyIG1lc3NhZ2VzID0gW107DQogICAgICAgICAgICBmb3IgKHZhciBpZCBpbiB0aGlzLmlkcykgew0KICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkc1tpZF0ubWVzc2FnZSkgew0KICAgICAgICAgICAgICAgICAgICBoYXNNZXNzYWdlID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZXMucHVzaCh0aGlzLmlkc1tpZF0ubWVzc2FnZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKCFoYXNNZXNzYWdlKSB7DQogICAgICAgICAgICAgICAgKGF3YWl0IHRoaXMud2luZG93LmdldEh0bWxFbGVtZW50KCJsb2FkaW5nU3RhbmRhcmRJbmZvIikpLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAoYXdhaXQgdGhpcy53aW5kb3cuZ2V0SHRtbEVsZW1lbnQoImxvYWRpbmdTdGFuZGFyZEluZm8iKSkuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCg0KICAgICAgICAgICAgICAgIChhd2FpdCB0aGlzLndpbmRvdy5nZXRIdG1sRWxlbWVudCgibG9hZGluZ01lc3NhZ2VzIikpLmlubmVySFRNTCA9ICcnOw0KICAgICAgICAgICAgICAgIGZvciAodmFyIG1zZyBvZiBtZXNzYWdlcykgew0KICAgICAgICAgICAgICAgICAgICB2YXIgcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTsNCiAgICAgICAgICAgICAgICAgICAgcC5pbm5lclRleHQgPSBtc2c7DQogICAgICAgICAgICAgICAgICAgIChhd2FpdCB0aGlzLndpbmRvdy5nZXRIdG1sRWxlbWVudCgibG9hZGluZ01lc3NhZ2VzIikpLmFwcGVuZENoaWxkKHApOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHRoaXMuZGl2LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgICAgIH0NCiAgICB9DQp9DQoNCmNsYXNzIGRhdGFiYXNlIHsNCiAgICAvL3RoaXMgaXMgbm90IGEgcmVhbCBkYXRhYmFzZSBhbnltb3JlLCBpdCB1c2VzIHRoZSBpbnRlZ3JhdGVkIGZpbGUgc3lzdGVtIG9mIGZsdWx1LmV1DQogICAgY29uc3RydWN0b3IoKSB7DQogICAgICAgIHRoaXMuY2hlY2tGaWxlU3RydWN0dXJlKCk7DQogICAgICAgIHRoaXMuZnNjID0gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gew0KICAgICAgICAgICAgdGhpcy5mc2NSZXNvbHZlID0gcmVzb2x2ZTsNCiAgICAgICAgfSk7DQogICAgfQ0KDQogICAgYXN5bmMgY2hlY2tGaWxlU3RydWN0dXJlKCkgew0KICAgICAgICBpZiAoIWF3YWl0IFN5c3RlbUZpbGVTeXN0ZW0uZmlsZUV4aXN0cygiYy91c2VyL2Rvd25sb2FkUmVhZGVyL3BhZ2VzLmpzb24iKSkgew0KICAgICAgICAgICAgYXdhaXQgU3lzdGVtRmlsZVN5c3RlbS5zZXRGaWxlU3RyaW5nKCJjL3VzZXIvZG93bmxvYWRSZWFkZXIvcGFnZXMuanNvbiIsICJ7fSIpOw0KICAgICAgICB9DQogICAgICAgIGlmICghYXdhaXQgU3lzdGVtRmlsZVN5c3RlbS5maWxlRXhpc3RzKCJjL3VzZXIvZG93bmxvYWRSZWFkZXIvc2V0dGluZ3MuanNvbiIpKSB7DQogICAgICAgICAgICBhd2FpdCBTeXN0ZW1GaWxlU3lzdGVtLnNldEZpbGVTdHJpbmcoImMvdXNlci9kb3dubG9hZFJlYWRlci9zZXR0aW5ncy5qc29uIiwgSlNPTi5zdHJpbmdpZnkoe30pKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoIWF3YWl0IFN5c3RlbUZpbGVTeXN0ZW0uZm9sZGVyRXhpc3RzKCJjL3VzZXIvZG93bmxvYWRSZWFkZXIvcGFnZXMiKSkgew0KICAgICAgICAgICAgYXdhaXQgU3lzdGVtRmlsZVN5c3RlbS5jcmVhdGVGb2xkZXIoImMvdXNlci9kb3dubG9hZFJlYWRlciIsICJwYWdlcyIpOw0KICAgICAgICB9DQogICAgICAgIGNvbnNvbGUubG9nKCJGaWxlIFN0cnVjdHVyZSBjaGVja2VkIik7DQogICAgICAgIHRoaXMuZnNjUmVzb2x2ZSgpOw0KICAgIH0NCg0KICAgIC8qDQogICAgICAgIEZpbGUgU3RydWN0dXJlOg0KICAgICAgICAvdXNlci9kb3dubG9hZFJlYWRlci8NCiAgICAgICAgICAgIC0gcGFnZXMvDQogICAgICAgICAgICAgICAgLSBwYWdlMS8NCiAgICAgICAgICAgICAgICAgICAgLSBwYWdlLnJodG1sDQogICAgICAgICAgICAgICAgICAgIC0gb3B0aW9ucy5qc29uDQogICAgICAgICAgICAgICAgLSBwYWdlMi8NCiAgICAgICAgICAgICAgICAgICAgLSBwYWdlLnJodG1sDQogICAgICAgICAgICAgICAgICAgIC0gb3B0aW9ucy5qc29uDQogICAgICAgICAgICAgICAgLi4uDQogICAgICAgICAgICAtIHBhZ2VzLmpzb24NCiAgICAgICAgICAgIC0gc2V0dGluZ3MuanNvbg0KICAgICovDQoNCiAgICBhc3luYyBhZGRQYWdlKHVybCwgY29udGVudCwgdGl0bGUpIHsNCiAgICAgICAgYXdhaXQgdGhpcy5mc2M7DQoNCiAgICAgICAgdmFyIGRhdGEgPSBhd2FpdCBTeXN0ZW1GaWxlU3lzdGVtLmdldEZpbGVKc29uKCJjL3VzZXIvZG93bmxvYWRSZWFkZXIvcGFnZXMuanNvbiIpOw0KICAgICAgICBpZiAoIWRhdGFbdXJsXSkgew0KICAgICAgICAgICAgdmFyIGZvbGRlcklkID0gU3lzdGVtLm1ha2VpZCgxMCk7DQogICAgICAgIH0NCiAgICAgICAgZGF0YVt1cmxdID0gew0KICAgICAgICAgICAgdXJsOiB1cmwsDQogICAgICAgICAgICBmb2xkZXJJZDogZm9sZGVySWQNCiAgICAgICAgfTsNCiAgICAgICAgYXdhaXQgU3lzdGVtRmlsZVN5c3RlbS5zZXRGaWxlU3RyaW5nKCJjL3VzZXIvZG93bmxvYWRSZWFkZXIvcGFnZXMuanNvbiIsIEpTT04uc3RyaW5naWZ5KGRhdGEpKTsNCg0KDQogICAgICAgIGlmICghYXdhaXQgU3lzdGVtRmlsZVN5c3RlbS5mb2xkZXJFeGlzdHMoImMvdXNlci9kb3dubG9hZFJlYWRlci9wYWdlcy8iICsgZm9sZGVySWQpKSB7DQogICAgICAgICAgICBhd2FpdCBTeXN0ZW1GaWxlU3lzdGVtLmNyZWF0ZUZvbGRlcigiYy91c2VyL2Rvd25sb2FkUmVhZGVyL3BhZ2VzIiwgZm9sZGVySWQpOw0KICAgICAgICB9DQoNCiAgICAgICAgYXdhaXQgU3lzdGVtRmlsZVN5c3RlbS5zZXRGaWxlU3RyaW5nKCJjL3VzZXIvZG93bmxvYWRSZWFkZXIvcGFnZXMvIiArIGZvbGRlcklkICsgIi9wYWdlLnJodG1sIiwgY29udGVudCk7DQogICAgICAgIGF3YWl0IFN5c3RlbUZpbGVTeXN0ZW0uc2V0RmlsZVN0cmluZygiYy91c2VyL2Rvd25sb2FkUmVhZGVyL3BhZ2VzLyIgKyBmb2xkZXJJZCArICIvb3B0aW9ucy5qc29uIiwgSlNPTi5zdHJpbmdpZnkoew0KICAgICAgICAgICAgdGl0bGU6IHRpdGxlLA0KICAgICAgICAgICAgb3B0aW9uczoge30sDQogICAgICAgICAgICBkYXRlOiBEYXRlLm5vdygpLA0KICAgICAgICAgICAgdXJsOiB1cmwNCiAgICAgICAgfSkpOw0KICAgIH0NCg0KICAgIGFzeW5jIGdldFBhZ2VJZCh1cmwpIHsNCiAgICAgICAgYXdhaXQgdGhpcy5mc2M7DQoNCiAgICAgICAgdmFyIGRhdGEgPSBhd2FpdCBTeXN0ZW1GaWxlU3lzdGVtLmdldEZpbGVKc29uKCJjL3VzZXIvZG93bmxvYWRSZWFkZXIvcGFnZXMuanNvbiIpOw0KICAgICAgICByZXR1cm4gZGF0YVt1cmxdLmZvbGRlcklkOw0KICAgIH0NCg0KICAgIGFzeW5jIHNldFBhZ2VPcHRpb24odXJsLCBuYW1lLCB2YWx1ZSkgew0KICAgICAgICBhd2FpdCB0aGlzLmZzYzsNCg0KICAgICAgICB2YXIgZm9sZGVySWQgPSBhd2FpdCB0aGlzLmdldFBhZ2VJZCh1cmwpOw0KICAgICAgICB2YXIgZGF0YSA9IGF3YWl0IFN5c3RlbUZpbGVTeXN0ZW0uZ2V0RmlsZUpzb24oImMvdXNlci9kb3dubG9hZFJlYWRlci9wYWdlcy8iICsgZm9sZGVySWQgKyAiL29wdGlvbnMuanNvbiIpOw0KICAgICAgICBkYXRhLm9wdGlvbnNbbmFtZV0gPSB2YWx1ZTsNCiAgICAgICAgYXdhaXQgU3lzdGVtRmlsZVN5c3RlbS5zZXRGaWxlU3RyaW5nKCJjL3VzZXIvZG93bmxvYWRSZWFkZXIvcGFnZXMvIiArIGZvbGRlcklkICsgIi9vcHRpb25zLmpzb24iLCBKU09OLnN0cmluZ2lmeShkYXRhKSk7DQogICAgfQ0KDQogICAgYXN5bmMgZ2V0UGFnZSh1cmwpIHsNCiAgICAgICAgYXdhaXQgdGhpcy5mc2M7DQoNCiAgICAgICAgLy9yZXR1cm5zIGNvbnRlbnQsIGRhdGUsIG9wdGlvbnMsIHRpdGxlLCB1cmwNCiAgICAgICAgdmFyIGZvbGRlcklkID0gYXdhaXQgdGhpcy5nZXRQYWdlSWQodXJsKTsNCiAgICAgICAgdmFyIGRhdGEgPSBhd2FpdCBTeXN0ZW1GaWxlU3lzdGVtLmdldEZpbGVKc29uKCJjL3VzZXIvZG93bmxvYWRSZWFkZXIvcGFnZXMvIiArIGZvbGRlcklkICsgIi9vcHRpb25zLmpzb24iKTsNCiAgICAgICAgdmFyIGNvbnRlbnQgPSBhd2FpdCBTeXN0ZW1GaWxlU3lzdGVtLmdldEZpbGVTdHJpbmcoImMvdXNlci9kb3dubG9hZFJlYWRlci9wYWdlcy8iICsgZm9sZGVySWQgKyAiL3BhZ2Uucmh0bWwiKTsNCiAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgIGNvbnRlbnQ6IGNvbnRlbnQsDQogICAgICAgICAgICBkYXRlOiBkYXRhLmRhdGUsDQogICAgICAgICAgICBvcHRpb25zOiBkYXRhLm9wdGlvbnMsDQogICAgICAgICAgICB0aXRsZTogZGF0YS50aXRsZSwNCiAgICAgICAgICAgIHVybDogZGF0YS51cmwNCiAgICAgICAgfTsNCiAgICB9DQoNCiAgICBhc3luYyBkZWxldGVQYWdlKHVybCkgew0KICAgICAgICBhd2FpdCB0aGlzLmZzYzsNCg0KICAgICAgICB2YXIgZm9sZGVySWQgPSBhd2FpdCB0aGlzLmdldFBhZ2VJZCh1cmwpOw0KICAgICAgICB2YXIgZGF0YSA9IGF3YWl0IFN5c3RlbUZpbGVTeXN0ZW0uZ2V0RmlsZUpzb24oImMvdXNlci9kb3dubG9hZFJlYWRlci9wYWdlcy5qc29uIik7DQogICAgICAgIGRlbGV0ZSBkYXRhW3VybF07DQogICAgICAgIGF3YWl0IFN5c3RlbUZpbGVTeXN0ZW0uc2V0RmlsZVN0cmluZygiYy91c2VyL2Rvd25sb2FkUmVhZGVyL3BhZ2VzLmpzb24iLCBKU09OLnN0cmluZ2lmeShkYXRhKSk7DQogICAgICAgIGF3YWl0IFN5c3RlbUZpbGVTeXN0ZW0ucmVtb3ZlRm9sZGVyKCJjL3VzZXIvZG93bmxvYWRSZWFkZXIvcGFnZXMvIiArIGZvbGRlcklkKTsNCiAgICB9DQoNCiAgICBhc3luYyBnZXRQYWdlcygpIHsNCiAgICAgICAgYXdhaXQgdGhpcy5mc2M7DQoNCiAgICAgICAgLy9yZXR1cm5zIHVybHMNCiAgICAgICAgdmFyIGRhdGEgPSBhd2FpdCBTeXN0ZW1GaWxlU3lzdGVtLmdldEZpbGVKc29uKCJjL3VzZXIvZG93bmxvYWRSZWFkZXIvcGFnZXMuanNvbiIpOw0KICAgICAgICB2YXIgdXJscyA9IFtdOw0KICAgICAgICBmb3IgKHZhciB1cmwgaW4gZGF0YSkgew0KICAgICAgICAgICAgdXJscy5wdXNoKHsgdXJsOiB1cmwsIHRpdGxlOiBkYXRhW3VybF0udGl0bGUgfSk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHVybHM7DQogICAgfQ0KDQogICAgYXN5bmMgc2V0T3B0aW9uKG5hbWUsIHZhbHVlKSB7DQogICAgICAgIGF3YWl0IHRoaXMuZnNjOw0KDQogICAgICAgIHZhciBkYXRhID0gYXdhaXQgU3lzdGVtRmlsZVN5c3RlbS5nZXRGaWxlSnNvbigiYy91c2VyL2Rvd25sb2FkUmVhZGVyL3NldHRpbmdzLmpzb24iKTsNCiAgICAgICAgZGF0YVtuYW1lXSA9IHZhbHVlOw0KICAgICAgICBhd2FpdCBTeXN0ZW1GaWxlU3lzdGVtLnNldEZpbGVTdHJpbmcoImMvdXNlci9kb3dubG9hZFJlYWRlci9zZXR0aW5ncy5qc29uIiwgSlNPTi5zdHJpbmdpZnkoZGF0YSkpOw0KICAgIH0NCg0KICAgIGFzeW5jIGdldE9wdGlvbihuYW1lKSB7DQogICAgICAgIGF3YWl0IHRoaXMuZnNjOw0KDQogICAgICAgIHZhciBkYXRhID0gYXdhaXQgU3lzdGVtRmlsZVN5c3RlbS5nZXRGaWxlSnNvbigiYy91c2VyL2Rvd25sb2FkUmVhZGVyL3NldHRpbmdzLmpzb24iKTsNCiAgICAgICAgcmV0dXJuIGRhdGFbbmFtZV07DQogICAgfQ0KDQogICAgYXN5bmMgb3B0aW9uRXhpc3RzKG5hbWUpIHsNCiAgICAgICAgYXdhaXQgdGhpcy5mc2M7DQoNCiAgICAgICAgdmFyIGRhdGEgPSBhd2FpdCBTeXN0ZW1GaWxlU3lzdGVtLmdldEZpbGVKc29uKCJjL3VzZXIvZG93bmxvYWRSZWFkZXIvc2V0dGluZ3MuanNvbiIpOw0KICAgICAgICBjb25zb2xlLmxvZyhkYXRhKTsNCiAgICAgICAgcmV0dXJuIGRhdGFbbmFtZV0gIT0gdW5kZWZpbmVkOw0KICAgIH0NCg0KICAgIGFzeW5jIGZ1bGxkZWxldGUoKSB7DQogICAgICAgIGF3YWl0IHRoaXMuZnNjOw0KDQogICAgICAgIGF3YWl0IFN5c3RlbUZpbGVTeXN0ZW0ucmVtb3ZlRm9sZGVyKCJjL3VzZXIvZG93bmxvYWRSZWFkZXIiKTsNCiAgICB9DQp9DQoNCm5ldyBkb3dubG9hZFJlYWRlclByb2dyYW0oKTs=", "purify.js": "LyohIEBsaWNlbnNlIERPTVB1cmlmeSAzLjAuMyB8IChjKSBDdXJlNTMgYW5kIG90aGVyIGNvbnRyaWJ1dG9ycyB8IFJlbGVhc2VkIHVuZGVyIHRoZSBBcGFjaGUgbGljZW5zZSAyLjAgYW5kIE1vemlsbGEgUHVibGljIExpY2Vuc2UgMi4wIHwgZ2l0aHViLmNvbS9jdXJlNTMvRE9NUHVyaWZ5L2Jsb2IvMy4wLjMvTElDRU5TRSAqLwoKdmFyIG91dHB1dCA9IG51bGw7CihmdW5jdGlvbiAoZ2xvYmFsLCBmYWN0b3J5KSB7CiAgb3V0cHV0ID0gZmFjdG9yeSgpOwp9KSh0aGlzLCAoZnVuY3Rpb24gKCkgewogICd1c2Ugc3RyaWN0JzsKCiAgY29uc3QgewogICAgZW50cmllcywKICAgIHNldFByb3RvdHlwZU9mLAogICAgaXNGcm96ZW4sCiAgICBnZXRQcm90b3R5cGVPZiwKICAgIGdldE93blByb3BlcnR5RGVzY3JpcHRvcgogIH0gPSBPYmplY3Q7CiAgbGV0IHsKICAgIGZyZWV6ZSwKICAgIHNlYWwsCiAgICBjcmVhdGUKICB9ID0gT2JqZWN0OyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIGltcG9ydC9uby1tdXRhYmxlLWV4cG9ydHMKCiAgbGV0IHsKICAgIGFwcGx5LAogICAgY29uc3RydWN0CiAgfSA9IHR5cGVvZiBSZWZsZWN0ICE9PSAndW5kZWZpbmVkJyAmJiBSZWZsZWN0OwoKICBpZiAoIWFwcGx5KSB7CiAgICBhcHBseSA9IGZ1bmN0aW9uIGFwcGx5KGZ1biwgdGhpc1ZhbHVlLCBhcmdzKSB7CiAgICAgIHJldHVybiBmdW4uYXBwbHkodGhpc1ZhbHVlLCBhcmdzKTsKICAgIH07CiAgfQoKICBpZiAoIWZyZWV6ZSkgewogICAgZnJlZXplID0gZnVuY3Rpb24gZnJlZXplKHgpIHsKICAgICAgcmV0dXJuIHg7CiAgICB9OwogIH0KCiAgaWYgKCFzZWFsKSB7CiAgICBzZWFsID0gZnVuY3Rpb24gc2VhbCh4KSB7CiAgICAgIHJldHVybiB4OwogICAgfTsKICB9CgogIGlmICghY29uc3RydWN0KSB7CiAgICBjb25zdHJ1Y3QgPSBmdW5jdGlvbiBjb25zdHJ1Y3QoRnVuYywgYXJncykgewogICAgICByZXR1cm4gbmV3IEZ1bmMoLi4uYXJncyk7CiAgICB9OwogIH0KCiAgY29uc3QgYXJyYXlGb3JFYWNoID0gdW5hcHBseShBcnJheS5wcm90b3R5cGUuZm9yRWFjaCk7CiAgY29uc3QgYXJyYXlQb3AgPSB1bmFwcGx5KEFycmF5LnByb3RvdHlwZS5wb3ApOwogIGNvbnN0IGFycmF5UHVzaCA9IHVuYXBwbHkoQXJyYXkucHJvdG90eXBlLnB1c2gpOwogIGNvbnN0IHN0cmluZ1RvTG93ZXJDYXNlID0gdW5hcHBseShTdHJpbmcucHJvdG90eXBlLnRvTG93ZXJDYXNlKTsKICBjb25zdCBzdHJpbmdUb1N0cmluZyA9IHVuYXBwbHkoU3RyaW5nLnByb3RvdHlwZS50b1N0cmluZyk7CiAgY29uc3Qgc3RyaW5nTWF0Y2ggPSB1bmFwcGx5KFN0cmluZy5wcm90b3R5cGUubWF0Y2gpOwogIGNvbnN0IHN0cmluZ1JlcGxhY2UgPSB1bmFwcGx5KFN0cmluZy5wcm90b3R5cGUucmVwbGFjZSk7CiAgY29uc3Qgc3RyaW5nSW5kZXhPZiA9IHVuYXBwbHkoU3RyaW5nLnByb3RvdHlwZS5pbmRleE9mKTsKICBjb25zdCBzdHJpbmdUcmltID0gdW5hcHBseShTdHJpbmcucHJvdG90eXBlLnRyaW0pOwogIGNvbnN0IHJlZ0V4cFRlc3QgPSB1bmFwcGx5KFJlZ0V4cC5wcm90b3R5cGUudGVzdCk7CiAgY29uc3QgdHlwZUVycm9yQ3JlYXRlID0gdW5jb25zdHJ1Y3QoVHlwZUVycm9yKTsKICBmdW5jdGlvbiB1bmFwcGx5KGZ1bmMpIHsKICAgIHJldHVybiBmdW5jdGlvbiAodGhpc0FyZykgewogICAgICBmb3IgKHZhciBfbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgYXJncyA9IG5ldyBBcnJheShfbGVuID4gMSA/IF9sZW4gLSAxIDogMCksIF9rZXkgPSAxOyBfa2V5IDwgX2xlbjsgX2tleSsrKSB7CiAgICAgICAgYXJnc1tfa2V5IC0gMV0gPSBhcmd1bWVudHNbX2tleV07CiAgICAgIH0KCiAgICAgIHJldHVybiBhcHBseShmdW5jLCB0aGlzQXJnLCBhcmdzKTsKICAgIH07CiAgfQogIGZ1bmN0aW9uIHVuY29uc3RydWN0KGZ1bmMpIHsKICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgIGZvciAodmFyIF9sZW4yID0gYXJndW1lbnRzLmxlbmd0aCwgYXJncyA9IG5ldyBBcnJheShfbGVuMiksIF9rZXkyID0gMDsgX2tleTIgPCBfbGVuMjsgX2tleTIrKykgewogICAgICAgIGFyZ3NbX2tleTJdID0gYXJndW1lbnRzW19rZXkyXTsKICAgICAgfQoKICAgICAgcmV0dXJuIGNvbnN0cnVjdChmdW5jLCBhcmdzKTsKICAgIH07CiAgfQogIC8qIEFkZCBwcm9wZXJ0aWVzIHRvIGEgbG9va3VwIHRhYmxlICovCgogIGZ1bmN0aW9uIGFkZFRvU2V0KHNldCwgYXJyYXksIHRyYW5zZm9ybUNhc2VGdW5jKSB7CiAgICB2YXIgX3RyYW5zZm9ybUNhc2VGdW5jOwoKICAgIHRyYW5zZm9ybUNhc2VGdW5jID0gKF90cmFuc2Zvcm1DYXNlRnVuYyA9IHRyYW5zZm9ybUNhc2VGdW5jKSAhPT0gbnVsbCAmJiBfdHJhbnNmb3JtQ2FzZUZ1bmMgIT09IHZvaWQgMCA/IF90cmFuc2Zvcm1DYXNlRnVuYyA6IHN0cmluZ1RvTG93ZXJDYXNlOwoKICAgIGlmIChzZXRQcm90b3R5cGVPZikgewogICAgICAvLyBNYWtlICdpbicgYW5kIHRydXRoeSBjaGVja3MgbGlrZSBCb29sZWFuKHNldC5jb25zdHJ1Y3RvcikKICAgICAgLy8gaW5kZXBlbmRlbnQgb2YgYW55IHByb3BlcnRpZXMgZGVmaW5lZCBvbiBPYmplY3QucHJvdG90eXBlLgogICAgICAvLyBQcmV2ZW50IHByb3RvdHlwZSBzZXR0ZXJzIGZyb20gaW50ZXJjZXB0aW5nIHNldCBhcyBhIHRoaXMgdmFsdWUuCiAgICAgIHNldFByb3RvdHlwZU9mKHNldCwgbnVsbCk7CiAgICB9CgogICAgbGV0IGwgPSBhcnJheS5sZW5ndGg7CgogICAgd2hpbGUgKGwtLSkgewogICAgICBsZXQgZWxlbWVudCA9IGFycmF5W2xdOwoKICAgICAgaWYgKHR5cGVvZiBlbGVtZW50ID09PSAnc3RyaW5nJykgewogICAgICAgIGNvbnN0IGxjRWxlbWVudCA9IHRyYW5zZm9ybUNhc2VGdW5jKGVsZW1lbnQpOwoKICAgICAgICBpZiAobGNFbGVtZW50ICE9PSBlbGVtZW50KSB7CiAgICAgICAgICAvLyBDb25maWcgcHJlc2V0cyAoZS5nLiB0YWdzLmpzLCBhdHRycy5qcykgYXJlIGltbXV0YWJsZS4KICAgICAgICAgIGlmICghaXNGcm96ZW4oYXJyYXkpKSB7CiAgICAgICAgICAgIGFycmF5W2xdID0gbGNFbGVtZW50OwogICAgICAgICAgfQoKICAgICAgICAgIGVsZW1lbnQgPSBsY0VsZW1lbnQ7CiAgICAgICAgfQogICAgICB9CgogICAgICBzZXRbZWxlbWVudF0gPSB0cnVlOwogICAgfQoKICAgIHJldHVybiBzZXQ7CiAgfQogIC8qIFNoYWxsb3cgY2xvbmUgYW4gb2JqZWN0ICovCgogIGZ1bmN0aW9uIGNsb25lKG9iamVjdCkgewogICAgY29uc3QgbmV3T2JqZWN0ID0gY3JlYXRlKG51bGwpOwoKICAgIGZvciAoY29uc3QgW3Byb3BlcnR5LCB2YWx1ZV0gb2YgZW50cmllcyhvYmplY3QpKSB7CiAgICAgIG5ld09iamVjdFtwcm9wZXJ0eV0gPSB2YWx1ZTsKICAgIH0KCiAgICByZXR1cm4gbmV3T2JqZWN0OwogIH0KICAvKiBUaGlzIG1ldGhvZCBhdXRvbWF0aWNhbGx5IGNoZWNrcyBpZiB0aGUgcHJvcCBpcyBmdW5jdGlvbgogICAqIG9yIGdldHRlciBhbmQgYmVoYXZlcyBhY2NvcmRpbmdseS4gKi8KCiAgZnVuY3Rpb24gbG9va3VwR2V0dGVyKG9iamVjdCwgcHJvcCkgewogICAgd2hpbGUgKG9iamVjdCAhPT0gbnVsbCkgewogICAgICBjb25zdCBkZXNjID0gZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgcHJvcCk7CgogICAgICBpZiAoZGVzYykgewogICAgICAgIGlmIChkZXNjLmdldCkgewogICAgICAgICAgcmV0dXJuIHVuYXBwbHkoZGVzYy5nZXQpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHR5cGVvZiBkZXNjLnZhbHVlID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICByZXR1cm4gdW5hcHBseShkZXNjLnZhbHVlKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIG9iamVjdCA9IGdldFByb3RvdHlwZU9mKG9iamVjdCk7CiAgICB9CgogICAgZnVuY3Rpb24gZmFsbGJhY2tWYWx1ZShlbGVtZW50KSB7CiAgICAgIGNvbnNvbGUud2FybignZmFsbGJhY2sgdmFsdWUgZm9yJywgZWxlbWVudCk7CiAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIHJldHVybiBmYWxsYmFja1ZhbHVlOwogIH0KCiAgY29uc3QgaHRtbCQxID0gZnJlZXplKFsnYScsICdhYmJyJywgJ2Fjcm9ueW0nLCAnYWRkcmVzcycsICdhcmVhJywgJ2FydGljbGUnLCAnYXNpZGUnLCAnYXVkaW8nLCAnYicsICdiZGknLCAnYmRvJywgJ2JpZycsICdibGluaycsICdibG9ja3F1b3RlJywgJ2JvZHknLCAnYnInLCAnYnV0dG9uJywgJ2NhbnZhcycsICdjYXB0aW9uJywgJ2NlbnRlcicsICdjaXRlJywgJ2NvZGUnLCAnY29sJywgJ2NvbGdyb3VwJywgJ2NvbnRlbnQnLCAnZGF0YScsICdkYXRhbGlzdCcsICdkZCcsICdkZWNvcmF0b3InLCAnZGVsJywgJ2RldGFpbHMnLCAnZGZuJywgJ2RpYWxvZycsICdkaXInLCAnZGl2JywgJ2RsJywgJ2R0JywgJ2VsZW1lbnQnLCAnZW0nLCAnZmllbGRzZXQnLCAnZmlnY2FwdGlvbicsICdmaWd1cmUnLCAnZm9udCcsICdmb290ZXInLCAnZm9ybScsICdoMScsICdoMicsICdoMycsICdoNCcsICdoNScsICdoNicsICdoZWFkJywgJ2hlYWRlcicsICdoZ3JvdXAnLCAnaHInLCAnaHRtbCcsICdpJywgJ2ltZycsICdpbnB1dCcsICdpbnMnLCAna2JkJywgJ2xhYmVsJywgJ2xlZ2VuZCcsICdsaScsICdtYWluJywgJ21hcCcsICdtYXJrJywgJ21hcnF1ZWUnLCAnbWVudScsICdtZW51aXRlbScsICdtZXRlcicsICduYXYnLCAnbm9icicsICdvbCcsICdvcHRncm91cCcsICdvcHRpb24nLCAnb3V0cHV0JywgJ3AnLCAncGljdHVyZScsICdwcmUnLCAncHJvZ3Jlc3MnLCAncScsICdycCcsICdydCcsICdydWJ5JywgJ3MnLCAnc2FtcCcsICdzZWN0aW9uJywgJ3NlbGVjdCcsICdzaGFkb3cnLCAnc21hbGwnLCAnc291cmNlJywgJ3NwYWNlcicsICdzcGFuJywgJ3N0cmlrZScsICdzdHJvbmcnLCAnc3R5bGUnLCAnc3ViJywgJ3N1bW1hcnknLCAnc3VwJywgJ3RhYmxlJywgJ3Rib2R5JywgJ3RkJywgJ3RlbXBsYXRlJywgJ3RleHRhcmVhJywgJ3Rmb290JywgJ3RoJywgJ3RoZWFkJywgJ3RpbWUnLCAndHInLCAndHJhY2snLCAndHQnLCAndScsICd1bCcsICd2YXInLCAndmlkZW8nLCAnd2JyJ10pOyAvLyBTVkcKCiAgY29uc3Qgc3ZnJDEgPSBmcmVlemUoWydzdmcnLCAnYScsICdhbHRnbHlwaCcsICdhbHRnbHlwaGRlZicsICdhbHRnbHlwaGl0ZW0nLCAnYW5pbWF0ZWNvbG9yJywgJ2FuaW1hdGVtb3Rpb24nLCAnYW5pbWF0ZXRyYW5zZm9ybScsICdjaXJjbGUnLCAnY2xpcHBhdGgnLCAnZGVmcycsICdkZXNjJywgJ2VsbGlwc2UnLCAnZmlsdGVyJywgJ2ZvbnQnLCAnZycsICdnbHlwaCcsICdnbHlwaHJlZicsICdoa2VybicsICdpbWFnZScsICdsaW5lJywgJ2xpbmVhcmdyYWRpZW50JywgJ21hcmtlcicsICdtYXNrJywgJ21ldGFkYXRhJywgJ21wYXRoJywgJ3BhdGgnLCAncGF0dGVybicsICdwb2x5Z29uJywgJ3BvbHlsaW5lJywgJ3JhZGlhbGdyYWRpZW50JywgJ3JlY3QnLCAnc3RvcCcsICdzdHlsZScsICdzd2l0Y2gnLCAnc3ltYm9sJywgJ3RleHQnLCAndGV4dHBhdGgnLCAndGl0bGUnLCAndHJlZicsICd0c3BhbicsICd2aWV3JywgJ3ZrZXJuJ10pOwogIGNvbnN0IHN2Z0ZpbHRlcnMgPSBmcmVlemUoWydmZUJsZW5kJywgJ2ZlQ29sb3JNYXRyaXgnLCAnZmVDb21wb25lbnRUcmFuc2ZlcicsICdmZUNvbXBvc2l0ZScsICdmZUNvbnZvbHZlTWF0cml4JywgJ2ZlRGlmZnVzZUxpZ2h0aW5nJywgJ2ZlRGlzcGxhY2VtZW50TWFwJywgJ2ZlRGlzdGFudExpZ2h0JywgJ2ZlRHJvcFNoYWRvdycsICdmZUZsb29kJywgJ2ZlRnVuY0EnLCAnZmVGdW5jQicsICdmZUZ1bmNHJywgJ2ZlRnVuY1InLCAnZmVHYXVzc2lhbkJsdXInLCAnZmVJbWFnZScsICdmZU1lcmdlJywgJ2ZlTWVyZ2VOb2RlJywgJ2ZlTW9ycGhvbG9neScsICdmZU9mZnNldCcsICdmZVBvaW50TGlnaHQnLCAnZmVTcGVjdWxhckxpZ2h0aW5nJywgJ2ZlU3BvdExpZ2h0JywgJ2ZlVGlsZScsICdmZVR1cmJ1bGVuY2UnXSk7IC8vIExpc3Qgb2YgU1ZHIGVsZW1lbnRzIHRoYXQgYXJlIGRpc2FsbG93ZWQgYnkgZGVmYXVsdC4KICAvLyBXZSBzdGlsbCBuZWVkIHRvIGtub3cgdGhlbSBzbyB0aGF0IHdlIGNhbiBkbyBuYW1lc3BhY2UKICAvLyBjaGVja3MgcHJvcGVybHkgaW4gY2FzZSBvbmUgd2FudHMgdG8gYWRkIHRoZW0gdG8KICAvLyBhbGxvdy1saXN0LgoKICBjb25zdCBzdmdEaXNhbGxvd2VkID0gZnJlZXplKFsnYW5pbWF0ZScsICdjb2xvci1wcm9maWxlJywgJ2N1cnNvcicsICdkaXNjYXJkJywgJ2ZvbnQtZmFjZScsICdmb250LWZhY2UtZm9ybWF0JywgJ2ZvbnQtZmFjZS1uYW1lJywgJ2ZvbnQtZmFjZS1zcmMnLCAnZm9udC1mYWNlLXVyaScsICdmb3JlaWdub2JqZWN0JywgJ2hhdGNoJywgJ2hhdGNocGF0aCcsICdtZXNoJywgJ21lc2hncmFkaWVudCcsICdtZXNocGF0Y2gnLCAnbWVzaHJvdycsICdtaXNzaW5nLWdseXBoJywgJ3NjcmlwdCcsICdzZXQnLCAnc29saWRjb2xvcicsICd1bmtub3duJywgJ3VzZSddKTsKICBjb25zdCBtYXRoTWwkMSA9IGZyZWV6ZShbJ21hdGgnLCAnbWVuY2xvc2UnLCAnbWVycm9yJywgJ21mZW5jZWQnLCAnbWZyYWMnLCAnbWdseXBoJywgJ21pJywgJ21sYWJlbGVkdHInLCAnbW11bHRpc2NyaXB0cycsICdtbicsICdtbycsICdtb3ZlcicsICdtcGFkZGVkJywgJ21waGFudG9tJywgJ21yb290JywgJ21yb3cnLCAnbXMnLCAnbXNwYWNlJywgJ21zcXJ0JywgJ21zdHlsZScsICdtc3ViJywgJ21zdXAnLCAnbXN1YnN1cCcsICdtdGFibGUnLCAnbXRkJywgJ210ZXh0JywgJ210cicsICdtdW5kZXInLCAnbXVuZGVyb3ZlcicsICdtcHJlc2NyaXB0cyddKTsgLy8gU2ltaWxhcmx5IHRvIFNWRywgd2Ugd2FudCB0byBrbm93IGFsbCBNYXRoTUwgZWxlbWVudHMsCiAgLy8gZXZlbiB0aG9zZSB0aGF0IHdlIGRpc2FsbG93IGJ5IGRlZmF1bHQuCgogIGNvbnN0IG1hdGhNbERpc2FsbG93ZWQgPSBmcmVlemUoWydtYWN0aW9uJywgJ21hbGlnbmdyb3VwJywgJ21hbGlnbm1hcmsnLCAnbWxvbmdkaXYnLCAnbXNjYXJyaWVzJywgJ21zY2FycnknLCAnbXNncm91cCcsICdtc3RhY2snLCAnbXNsaW5lJywgJ21zcm93JywgJ3NlbWFudGljcycsICdhbm5vdGF0aW9uJywgJ2Fubm90YXRpb24teG1sJywgJ21wcmVzY3JpcHRzJywgJ25vbmUnXSk7CiAgY29uc3QgdGV4dCA9IGZyZWV6ZShbJyN0ZXh0J10pOwoKICBjb25zdCBodG1sID0gZnJlZXplKFsnYWNjZXB0JywgJ2FjdGlvbicsICdhbGlnbicsICdhbHQnLCAnYXV0b2NhcGl0YWxpemUnLCAnYXV0b2NvbXBsZXRlJywgJ2F1dG9waWN0dXJlaW5waWN0dXJlJywgJ2F1dG9wbGF5JywgJ2JhY2tncm91bmQnLCAnYmdjb2xvcicsICdib3JkZXInLCAnY2FwdHVyZScsICdjZWxscGFkZGluZycsICdjZWxsc3BhY2luZycsICdjaGVja2VkJywgJ2NpdGUnLCAnY2xhc3MnLCAnY2xlYXInLCAnY29sb3InLCAnY29scycsICdjb2xzcGFuJywgJ2NvbnRyb2xzJywgJ2NvbnRyb2xzbGlzdCcsICdjb29yZHMnLCAnY3Jvc3NvcmlnaW4nLCAnZGF0ZXRpbWUnLCAnZGVjb2RpbmcnLCAnZGVmYXVsdCcsICdkaXInLCAnZGlzYWJsZWQnLCAnZGlzYWJsZXBpY3R1cmVpbnBpY3R1cmUnLCAnZGlzYWJsZXJlbW90ZXBsYXliYWNrJywgJ2Rvd25sb2FkJywgJ2RyYWdnYWJsZScsICdlbmN0eXBlJywgJ2VudGVya2V5aGludCcsICdmYWNlJywgJ2ZvcicsICdoZWFkZXJzJywgJ2hlaWdodCcsICdoaWRkZW4nLCAnaGlnaCcsICdocmVmJywgJ2hyZWZsYW5nJywgJ2lkJywgJ2lucHV0bW9kZScsICdpbnRlZ3JpdHknLCAnaXNtYXAnLCAna2luZCcsICdsYWJlbCcsICdsYW5nJywgJ2xpc3QnLCAnbG9hZGluZycsICdsb29wJywgJ2xvdycsICdtYXgnLCAnbWF4bGVuZ3RoJywgJ21lZGlhJywgJ21ldGhvZCcsICdtaW4nLCAnbWlubGVuZ3RoJywgJ211bHRpcGxlJywgJ211dGVkJywgJ25hbWUnLCAnbm9uY2UnLCAnbm9zaGFkZScsICdub3ZhbGlkYXRlJywgJ25vd3JhcCcsICdvcGVuJywgJ29wdGltdW0nLCAncGF0dGVybicsICdwbGFjZWhvbGRlcicsICdwbGF5c2lubGluZScsICdwb3N0ZXInLCAncHJlbG9hZCcsICdwdWJkYXRlJywgJ3JhZGlvZ3JvdXAnLCAncmVhZG9ubHknLCAncmVsJywgJ3JlcXVpcmVkJywgJ3JldicsICdyZXZlcnNlZCcsICdyb2xlJywgJ3Jvd3MnLCAncm93c3BhbicsICdzcGVsbGNoZWNrJywgJ3Njb3BlJywgJ3NlbGVjdGVkJywgJ3NoYXBlJywgJ3NpemUnLCAnc2l6ZXMnLCAnc3BhbicsICdzcmNsYW5nJywgJ3N0YXJ0JywgJ3NyYycsICdzcmNzZXQnLCAnc3RlcCcsICdzdHlsZScsICdzdW1tYXJ5JywgJ3RhYmluZGV4JywgJ3RpdGxlJywgJ3RyYW5zbGF0ZScsICd0eXBlJywgJ3VzZW1hcCcsICd2YWxpZ24nLCAndmFsdWUnLCAnd2lkdGgnLCAneG1sbnMnLCAnc2xvdCddKTsKICBjb25zdCBzdmcgPSBmcmVlemUoWydhY2NlbnQtaGVpZ2h0JywgJ2FjY3VtdWxhdGUnLCAnYWRkaXRpdmUnLCAnYWxpZ25tZW50LWJhc2VsaW5lJywgJ2FzY2VudCcsICdhdHRyaWJ1dGVuYW1lJywgJ2F0dHJpYnV0ZXR5cGUnLCAnYXppbXV0aCcsICdiYXNlZnJlcXVlbmN5JywgJ2Jhc2VsaW5lLXNoaWZ0JywgJ2JlZ2luJywgJ2JpYXMnLCAnYnknLCAnY2xhc3MnLCAnY2xpcCcsICdjbGlwcGF0aHVuaXRzJywgJ2NsaXAtcGF0aCcsICdjbGlwLXJ1bGUnLCAnY29sb3InLCAnY29sb3ItaW50ZXJwb2xhdGlvbicsICdjb2xvci1pbnRlcnBvbGF0aW9uLWZpbHRlcnMnLCAnY29sb3ItcHJvZmlsZScsICdjb2xvci1yZW5kZXJpbmcnLCAnY3gnLCAnY3knLCAnZCcsICdkeCcsICdkeScsICdkaWZmdXNlY29uc3RhbnQnLCAnZGlyZWN0aW9uJywgJ2Rpc3BsYXknLCAnZGl2aXNvcicsICdkdXInLCAnZWRnZW1vZGUnLCAnZWxldmF0aW9uJywgJ2VuZCcsICdmaWxsJywgJ2ZpbGwtb3BhY2l0eScsICdmaWxsLXJ1bGUnLCAnZmlsdGVyJywgJ2ZpbHRlcnVuaXRzJywgJ2Zsb29kLWNvbG9yJywgJ2Zsb29kLW9wYWNpdHknLCAnZm9udC1mYW1pbHknLCAnZm9udC1zaXplJywgJ2ZvbnQtc2l6ZS1hZGp1c3QnLCAnZm9udC1zdHJldGNoJywgJ2ZvbnQtc3R5bGUnLCAnZm9udC12YXJpYW50JywgJ2ZvbnQtd2VpZ2h0JywgJ2Z4JywgJ2Z5JywgJ2cxJywgJ2cyJywgJ2dseXBoLW5hbWUnLCAnZ2x5cGhyZWYnLCAnZ3JhZGllbnR1bml0cycsICdncmFkaWVudHRyYW5zZm9ybScsICdoZWlnaHQnLCAnaHJlZicsICdpZCcsICdpbWFnZS1yZW5kZXJpbmcnLCAnaW4nLCAnaW4yJywgJ2snLCAnazEnLCAnazInLCAnazMnLCAnazQnLCAna2VybmluZycsICdrZXlwb2ludHMnLCAna2V5c3BsaW5lcycsICdrZXl0aW1lcycsICdsYW5nJywgJ2xlbmd0aGFkanVzdCcsICdsZXR0ZXItc3BhY2luZycsICdrZXJuZWxtYXRyaXgnLCAna2VybmVsdW5pdGxlbmd0aCcsICdsaWdodGluZy1jb2xvcicsICdsb2NhbCcsICdtYXJrZXItZW5kJywgJ21hcmtlci1taWQnLCAnbWFya2VyLXN0YXJ0JywgJ21hcmtlcmhlaWdodCcsICdtYXJrZXJ1bml0cycsICdtYXJrZXJ3aWR0aCcsICdtYXNrY29udGVudHVuaXRzJywgJ21hc2t1bml0cycsICdtYXgnLCAnbWFzaycsICdtZWRpYScsICdtZXRob2QnLCAnbW9kZScsICdtaW4nLCAnbmFtZScsICdudW1vY3RhdmVzJywgJ29mZnNldCcsICdvcGVyYXRvcicsICdvcGFjaXR5JywgJ29yZGVyJywgJ29yaWVudCcsICdvcmllbnRhdGlvbicsICdvcmlnaW4nLCAnb3ZlcmZsb3cnLCAncGFpbnQtb3JkZXInLCAncGF0aCcsICdwYXRobGVuZ3RoJywgJ3BhdHRlcm5jb250ZW50dW5pdHMnLCAncGF0dGVybnRyYW5zZm9ybScsICdwYXR0ZXJudW5pdHMnLCAncG9pbnRzJywgJ3ByZXNlcnZlYWxwaGEnLCAncHJlc2VydmVhc3BlY3RyYXRpbycsICdwcmltaXRpdmV1bml0cycsICdyJywgJ3J4JywgJ3J5JywgJ3JhZGl1cycsICdyZWZ4JywgJ3JlZnknLCAncmVwZWF0Y291bnQnLCAncmVwZWF0ZHVyJywgJ3Jlc3RhcnQnLCAncmVzdWx0JywgJ3JvdGF0ZScsICdzY2FsZScsICdzZWVkJywgJ3NoYXBlLXJlbmRlcmluZycsICdzcGVjdWxhcmNvbnN0YW50JywgJ3NwZWN1bGFyZXhwb25lbnQnLCAnc3ByZWFkbWV0aG9kJywgJ3N0YXJ0b2Zmc2V0JywgJ3N0ZGRldmlhdGlvbicsICdzdGl0Y2h0aWxlcycsICdzdG9wLWNvbG9yJywgJ3N0b3Atb3BhY2l0eScsICdzdHJva2UtZGFzaGFycmF5JywgJ3N0cm9rZS1kYXNob2Zmc2V0JywgJ3N0cm9rZS1saW5lY2FwJywgJ3N0cm9rZS1saW5lam9pbicsICdzdHJva2UtbWl0ZXJsaW1pdCcsICdzdHJva2Utb3BhY2l0eScsICdzdHJva2UnLCAnc3Ryb2tlLXdpZHRoJywgJ3N0eWxlJywgJ3N1cmZhY2VzY2FsZScsICdzeXN0ZW1sYW5ndWFnZScsICd0YWJpbmRleCcsICd0YXJnZXR4JywgJ3RhcmdldHknLCAndHJhbnNmb3JtJywgJ3RyYW5zZm9ybS1vcmlnaW4nLCAndGV4dC1hbmNob3InLCAndGV4dC1kZWNvcmF0aW9uJywgJ3RleHQtcmVuZGVyaW5nJywgJ3RleHRsZW5ndGgnLCAndHlwZScsICd1MScsICd1MicsICd1bmljb2RlJywgJ3ZhbHVlcycsICd2aWV3Ym94JywgJ3Zpc2liaWxpdHknLCAndmVyc2lvbicsICd2ZXJ0LWFkdi15JywgJ3ZlcnQtb3JpZ2luLXgnLCAndmVydC1vcmlnaW4teScsICd3aWR0aCcsICd3b3JkLXNwYWNpbmcnLCAnd3JhcCcsICd3cml0aW5nLW1vZGUnLCAneGNoYW5uZWxzZWxlY3RvcicsICd5Y2hhbm5lbHNlbGVjdG9yJywgJ3gnLCAneDEnLCAneDInLCAneG1sbnMnLCAneScsICd5MScsICd5MicsICd6JywgJ3pvb21hbmRwYW4nXSk7CiAgY29uc3QgbWF0aE1sID0gZnJlZXplKFsnYWNjZW50JywgJ2FjY2VudHVuZGVyJywgJ2FsaWduJywgJ2JldmVsbGVkJywgJ2Nsb3NlJywgJ2NvbHVtbnNhbGlnbicsICdjb2x1bW5saW5lcycsICdjb2x1bW5zcGFuJywgJ2Rlbm9tYWxpZ24nLCAnZGVwdGgnLCAnZGlyJywgJ2Rpc3BsYXknLCAnZGlzcGxheXN0eWxlJywgJ2VuY29kaW5nJywgJ2ZlbmNlJywgJ2ZyYW1lJywgJ2hlaWdodCcsICdocmVmJywgJ2lkJywgJ2xhcmdlb3AnLCAnbGVuZ3RoJywgJ2xpbmV0aGlja25lc3MnLCAnbHNwYWNlJywgJ2xxdW90ZScsICdtYXRoYmFja2dyb3VuZCcsICdtYXRoY29sb3InLCAnbWF0aHNpemUnLCAnbWF0aHZhcmlhbnQnLCAnbWF4c2l6ZScsICdtaW5zaXplJywgJ21vdmFibGVsaW1pdHMnLCAnbm90YXRpb24nLCAnbnVtYWxpZ24nLCAnb3BlbicsICdyb3dhbGlnbicsICdyb3dsaW5lcycsICdyb3dzcGFjaW5nJywgJ3Jvd3NwYW4nLCAncnNwYWNlJywgJ3JxdW90ZScsICdzY3JpcHRsZXZlbCcsICdzY3JpcHRtaW5zaXplJywgJ3NjcmlwdHNpemVtdWx0aXBsaWVyJywgJ3NlbGVjdGlvbicsICdzZXBhcmF0b3InLCAnc2VwYXJhdG9ycycsICdzdHJldGNoeScsICdzdWJzY3JpcHRzaGlmdCcsICdzdXBzY3JpcHRzaGlmdCcsICdzeW1tZXRyaWMnLCAndm9mZnNldCcsICd3aWR0aCcsICd4bWxucyddKTsKICBjb25zdCB4bWwgPSBmcmVlemUoWyd4bGluazpocmVmJywgJ3htbDppZCcsICd4bGluazp0aXRsZScsICd4bWw6c3BhY2UnLCAneG1sbnM6eGxpbmsnXSk7CgogIGNvbnN0IE1VU1RBQ0hFX0VYUFIgPSBzZWFsKC9ce1x7W1x3XFddKnxbXHdcV10qXH1cfS9nbSk7IC8vIFNwZWNpZnkgdGVtcGxhdGUgZGV0ZWN0aW9uIHJlZ2V4IGZvciBTQUZFX0ZPUl9URU1QTEFURVMgbW9kZQoKICBjb25zdCBFUkJfRVhQUiA9IHNlYWwoLzwlW1x3XFddKnxbXHdcV10qJT4vZ20pOwogIGNvbnN0IFRNUExJVF9FWFBSID0gc2VhbCgvXCR7W1x3XFddKn0vZ20pOwogIGNvbnN0IERBVEFfQVRUUiA9IHNlYWwoL15kYXRhLVtcLVx3Llx1MDBCNy1cdUZGRkZdLyk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tdXNlbGVzcy1lc2NhcGUKCiAgY29uc3QgQVJJQV9BVFRSID0gc2VhbCgvXmFyaWEtW1wtXHddKyQvKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby11c2VsZXNzLWVzY2FwZQoKICBjb25zdCBJU19BTExPV0VEX1VSSSA9IHNlYWwoL14oPzooPzooPzpmfGh0KXRwcz98bWFpbHRvfHRlbHxjYWxsdG98c21zfGNpZHx4bXBwKTp8W15hLXpdfFthLXorLlwtXSsoPzpbXmEteisuXC06XXwkKSkvaSAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLXVzZWxlc3MtZXNjYXBlCiAgKTsKICBjb25zdCBJU19TQ1JJUFRfT1JfREFUQSA9IHNlYWwoL14oPzpcdytzY3JpcHR8ZGF0YSk6L2kpOwogIGNvbnN0IEFUVFJfV0hJVEVTUEFDRSA9IHNlYWwoL1tcdTAwMDAtXHUwMDIwXHUwMEEwXHUxNjgwXHUxODBFXHUyMDAwLVx1MjAyOVx1MjA1Rlx1MzAwMF0vZyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWNvbnRyb2wtcmVnZXgKICApOwogIGNvbnN0IERPQ1RZUEVfTkFNRSA9IHNlYWwoL15odG1sJC9pKTsKCiAgdmFyIEVYUFJFU1NJT05TID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoewogICAgX19wcm90b19fOiBudWxsLAogICAgTVVTVEFDSEVfRVhQUjogTVVTVEFDSEVfRVhQUiwKICAgIEVSQl9FWFBSOiBFUkJfRVhQUiwKICAgIFRNUExJVF9FWFBSOiBUTVBMSVRfRVhQUiwKICAgIERBVEFfQVRUUjogREFUQV9BVFRSLAogICAgQVJJQV9BVFRSOiBBUklBX0FUVFIsCiAgICBJU19BTExPV0VEX1VSSTogSVNfQUxMT1dFRF9VUkksCiAgICBJU19TQ1JJUFRfT1JfREFUQTogSVNfU0NSSVBUX09SX0RBVEEsCiAgICBBVFRSX1dISVRFU1BBQ0U6IEFUVFJfV0hJVEVTUEFDRSwKICAgIERPQ1RZUEVfTkFNRTogRE9DVFlQRV9OQU1FCiAgfSk7CgogIGNvbnN0IGdldEdsb2JhbCA9ICgpID0+IHR5cGVvZiB3aW5kb3cgPT09ICd1bmRlZmluZWQnID8gbnVsbCA6IHdpbmRvdzsKICAvKioKICAgKiBDcmVhdGVzIGEgbm8tb3AgcG9saWN5IGZvciBpbnRlcm5hbCB1c2Ugb25seS4KICAgKiBEb24ndCBleHBvcnQgdGhpcyBmdW5jdGlvbiBvdXRzaWRlIHRoaXMgbW9kdWxlIQogICAqIEBwYXJhbSB7P1RydXN0ZWRUeXBlUG9saWN5RmFjdG9yeX0gdHJ1c3RlZFR5cGVzIFRoZSBwb2xpY3kgZmFjdG9yeS4KICAgKiBAcGFyYW0ge0hUTUxTY3JpcHRFbGVtZW50fSBwdXJpZnlIb3N0RWxlbWVudCBUaGUgU2NyaXB0IGVsZW1lbnQgdXNlZCB0byBsb2FkIERPTVB1cmlmeSAodG8gZGV0ZXJtaW5lIHBvbGljeSBuYW1lIHN1ZmZpeCkuCiAgICogQHJldHVybiB7P1RydXN0ZWRUeXBlUG9saWN5fSBUaGUgcG9saWN5IGNyZWF0ZWQgKG9yIG51bGwsIGlmIFRydXN0ZWQgVHlwZXMKICAgKiBhcmUgbm90IHN1cHBvcnRlZCBvciBjcmVhdGluZyB0aGUgcG9saWN5IGZhaWxlZCkuCiAgICovCgoKICBjb25zdCBfY3JlYXRlVHJ1c3RlZFR5cGVzUG9saWN5ID0gZnVuY3Rpb24gX2NyZWF0ZVRydXN0ZWRUeXBlc1BvbGljeSh0cnVzdGVkVHlwZXMsIHB1cmlmeUhvc3RFbGVtZW50KSB7CiAgICBpZiAodHlwZW9mIHRydXN0ZWRUeXBlcyAhPT0gJ29iamVjdCcgfHwgdHlwZW9mIHRydXN0ZWRUeXBlcy5jcmVhdGVQb2xpY3kgIT09ICdmdW5jdGlvbicpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9IC8vIEFsbG93IHRoZSBjYWxsZXJzIHRvIGNvbnRyb2wgdGhlIHVuaXF1ZSBwb2xpY3kgbmFtZQogICAgLy8gYnkgYWRkaW5nIGEgZGF0YS10dC1wb2xpY3ktc3VmZml4IHRvIHRoZSBzY3JpcHQgZWxlbWVudCB3aXRoIHRoZSBET01QdXJpZnkuCiAgICAvLyBQb2xpY3kgY3JlYXRpb24gd2l0aCBkdXBsaWNhdGUgbmFtZXMgdGhyb3dzIGluIFRydXN0ZWQgVHlwZXMuCgoKICAgIGxldCBzdWZmaXggPSBudWxsOwogICAgY29uc3QgQVRUUl9OQU1FID0gJ2RhdGEtdHQtcG9saWN5LXN1ZmZpeCc7CgogICAgaWYgKHB1cmlmeUhvc3RFbGVtZW50ICYmIHB1cmlmeUhvc3RFbGVtZW50Lmhhc0F0dHJpYnV0ZShBVFRSX05BTUUpKSB7CiAgICAgIHN1ZmZpeCA9IHB1cmlmeUhvc3RFbGVtZW50LmdldEF0dHJpYnV0ZShBVFRSX05BTUUpOwogICAgfQoKICAgIGNvbnN0IHBvbGljeU5hbWUgPSAnZG9tcHVyaWZ5JyArIChzdWZmaXggPyAnIycgKyBzdWZmaXggOiAnJyk7CgogICAgdHJ5IHsKICAgICAgcmV0dXJuIHRydXN0ZWRUeXBlcy5jcmVhdGVQb2xpY3kocG9saWN5TmFtZSwgewogICAgICAgIGNyZWF0ZUhUTUwoaHRtbCkgewogICAgICAgICAgcmV0dXJuIGh0bWw7CiAgICAgICAgfSwKCiAgICAgICAgY3JlYXRlU2NyaXB0VVJMKHNjcmlwdFVybCkgewogICAgICAgICAgcmV0dXJuIHNjcmlwdFVybDsKICAgICAgICB9CgogICAgICB9KTsKICAgIH0gY2F0Y2ggKF8pIHsKICAgICAgLy8gUG9saWN5IGNyZWF0aW9uIGZhaWxlZCAobW9zdCBsaWtlbHkgYW5vdGhlciBET01QdXJpZnkgc2NyaXB0IGhhcwogICAgICAvLyBhbHJlYWR5IHJ1bikuIFNraXAgY3JlYXRpbmcgdGhlIHBvbGljeSwgYXMgdGhpcyB3aWxsIG9ubHkgY2F1c2UgZXJyb3JzCiAgICAgIC8vIGlmIFRUIGFyZSBlbmZvcmNlZC4KICAgICAgY29uc29sZS53YXJuKCdUcnVzdGVkVHlwZXMgcG9saWN5ICcgKyBwb2xpY3lOYW1lICsgJyBjb3VsZCBub3QgYmUgY3JlYXRlZC4nKTsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgfTsKCiAgZnVuY3Rpb24gY3JlYXRlRE9NUHVyaWZ5KCkgewogICAgbGV0IHdpbmRvdyA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogZ2V0R2xvYmFsKCk7CgogICAgY29uc3QgRE9NUHVyaWZ5ID0gcm9vdCA9PiBjcmVhdGVET01QdXJpZnkocm9vdCk7CiAgICAvKioKICAgICAqIFZlcnNpb24gbGFiZWwsIGV4cG9zZWQgZm9yIGVhc2llciBjaGVja3MKICAgICAqIGlmIERPTVB1cmlmeSBpcyB1cCB0byBkYXRlIG9yIG5vdAogICAgICovCgoKICAgIERPTVB1cmlmeS52ZXJzaW9uID0gJzMuMC4zJzsKICAgIC8qKgogICAgICogQXJyYXkgb2YgZWxlbWVudHMgdGhhdCBET01QdXJpZnkgcmVtb3ZlZCBkdXJpbmcgc2FuaXRhdGlvbi4KICAgICAqIEVtcHR5IGlmIG5vdGhpbmcgd2FzIHJlbW92ZWQuCiAgICAgKi8KCiAgICBET01QdXJpZnkucmVtb3ZlZCA9IFtdOwoKICAgIGlmICghd2luZG93IHx8ICF3aW5kb3cuZG9jdW1lbnQgfHwgd2luZG93LmRvY3VtZW50Lm5vZGVUeXBlICE9PSA5KSB7CiAgICAgIC8vIE5vdCBydW5uaW5nIGluIGEgYnJvd3NlciwgcHJvdmlkZSBhIGZhY3RvcnkgZnVuY3Rpb24KICAgICAgLy8gc28gdGhhdCB5b3UgY2FuIHBhc3MgeW91ciBvd24gV2luZG93CiAgICAgIERPTVB1cmlmeS5pc1N1cHBvcnRlZCA9IGZhbHNlOwogICAgICByZXR1cm4gRE9NUHVyaWZ5OwogICAgfQoKICAgIGNvbnN0IG9yaWdpbmFsRG9jdW1lbnQgPSB3aW5kb3cuZG9jdW1lbnQ7CiAgICBjb25zdCBjdXJyZW50U2NyaXB0ID0gb3JpZ2luYWxEb2N1bWVudC5jdXJyZW50U2NyaXB0OwogICAgbGV0IHsKICAgICAgZG9jdW1lbnQKICAgIH0gPSB3aW5kb3c7CiAgICBjb25zdCB7CiAgICAgIERvY3VtZW50RnJhZ21lbnQsCiAgICAgIEhUTUxUZW1wbGF0ZUVsZW1lbnQsCiAgICAgIE5vZGUsCiAgICAgIEVsZW1lbnQsCiAgICAgIE5vZGVGaWx0ZXIsCiAgICAgIE5hbWVkTm9kZU1hcCA9IHdpbmRvdy5OYW1lZE5vZGVNYXAgfHwgd2luZG93Lk1vek5hbWVkQXR0ck1hcCwKICAgICAgSFRNTEZvcm1FbGVtZW50LAogICAgICBET01QYXJzZXIsCiAgICAgIHRydXN0ZWRUeXBlcwogICAgfSA9IHdpbmRvdzsKICAgIGNvbnN0IEVsZW1lbnRQcm90b3R5cGUgPSBFbGVtZW50LnByb3RvdHlwZTsKICAgIGNvbnN0IGNsb25lTm9kZSA9IGxvb2t1cEdldHRlcihFbGVtZW50UHJvdG90eXBlLCAnY2xvbmVOb2RlJyk7CiAgICBjb25zdCBnZXROZXh0U2libGluZyA9IGxvb2t1cEdldHRlcihFbGVtZW50UHJvdG90eXBlLCAnbmV4dFNpYmxpbmcnKTsKICAgIGNvbnN0IGdldENoaWxkTm9kZXMgPSBsb29rdXBHZXR0ZXIoRWxlbWVudFByb3RvdHlwZSwgJ2NoaWxkTm9kZXMnKTsKICAgIGNvbnN0IGdldFBhcmVudE5vZGUgPSBsb29rdXBHZXR0ZXIoRWxlbWVudFByb3RvdHlwZSwgJ3BhcmVudE5vZGUnKTsgLy8gQXMgcGVyIGlzc3VlICM0NywgdGhlIHdlYi1jb21wb25lbnRzIHJlZ2lzdHJ5IGlzIGluaGVyaXRlZCBieSBhCiAgICAvLyBuZXcgZG9jdW1lbnQgY3JlYXRlZCB2aWEgY3JlYXRlSFRNTERvY3VtZW50LiBBcyBwZXIgdGhlIHNwZWMKICAgIC8vIChodHRwOi8vdzNjLmdpdGh1Yi5pby93ZWJjb21wb25lbnRzL3NwZWMvY3VzdG9tLyNjcmVhdGluZy1hbmQtcGFzc2luZy1yZWdpc3RyaWVzKQogICAgLy8gYSBuZXcgZW1wdHkgcmVnaXN0cnkgaXMgdXNlZCB3aGVuIGNyZWF0aW5nIGEgdGVtcGxhdGUgY29udGVudHMgb3duZXIKICAgIC8vIGRvY3VtZW50LCBzbyB3ZSB1c2UgdGhhdCBhcyBvdXIgcGFyZW50IGRvY3VtZW50IHRvIGVuc3VyZSBub3RoaW5nCiAgICAvLyBpcyBpbmhlcml0ZWQuCgogICAgaWYgKHR5cGVvZiBIVE1MVGVtcGxhdGVFbGVtZW50ID09PSAnZnVuY3Rpb24nKSB7CiAgICAgIGNvbnN0IHRlbXBsYXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGVtcGxhdGUnKTsKCiAgICAgIGlmICh0ZW1wbGF0ZS5jb250ZW50ICYmIHRlbXBsYXRlLmNvbnRlbnQub3duZXJEb2N1bWVudCkgewogICAgICAgIGRvY3VtZW50ID0gdGVtcGxhdGUuY29udGVudC5vd25lckRvY3VtZW50OwogICAgICB9CiAgICB9CgogICAgbGV0IHRydXN0ZWRUeXBlc1BvbGljeTsKICAgIGxldCBlbXB0eUhUTUwgPSAnJzsKICAgIGNvbnN0IHsKICAgICAgaW1wbGVtZW50YXRpb24sCiAgICAgIGNyZWF0ZU5vZGVJdGVyYXRvciwKICAgICAgY3JlYXRlRG9jdW1lbnRGcmFnbWVudCwKICAgICAgZ2V0RWxlbWVudHNCeVRhZ05hbWUKICAgIH0gPSBkb2N1bWVudDsKICAgIGNvbnN0IHsKICAgICAgaW1wb3J0Tm9kZQogICAgfSA9IG9yaWdpbmFsRG9jdW1lbnQ7CiAgICBsZXQgaG9va3MgPSB7fTsKICAgIC8qKgogICAgICogRXhwb3NlIHdoZXRoZXIgdGhpcyBicm93c2VyIHN1cHBvcnRzIHJ1bm5pbmcgdGhlIGZ1bGwgRE9NUHVyaWZ5LgogICAgICovCgogICAgRE9NUHVyaWZ5LmlzU3VwcG9ydGVkID0gdHlwZW9mIGVudHJpZXMgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mIGdldFBhcmVudE5vZGUgPT09ICdmdW5jdGlvbicgJiYgaW1wbGVtZW50YXRpb24gJiYgaW1wbGVtZW50YXRpb24uY3JlYXRlSFRNTERvY3VtZW50ICE9PSB1bmRlZmluZWQ7CiAgICBjb25zdCB7CiAgICAgIE1VU1RBQ0hFX0VYUFIsCiAgICAgIEVSQl9FWFBSLAogICAgICBUTVBMSVRfRVhQUiwKICAgICAgREFUQV9BVFRSLAogICAgICBBUklBX0FUVFIsCiAgICAgIElTX1NDUklQVF9PUl9EQVRBLAogICAgICBBVFRSX1dISVRFU1BBQ0UKICAgIH0gPSBFWFBSRVNTSU9OUzsKICAgIGxldCB7CiAgICAgIElTX0FMTE9XRURfVVJJOiBJU19BTExPV0VEX1VSSSQxCiAgICB9ID0gRVhQUkVTU0lPTlM7CiAgICAvKioKICAgICAqIFdlIGNvbnNpZGVyIHRoZSBlbGVtZW50cyBhbmQgYXR0cmlidXRlcyBiZWxvdyB0byBiZSBzYWZlLiBJZGVhbGx5CiAgICAgKiBkb24ndCBhZGQgYW55IG5ldyBvbmVzIGJ1dCBmZWVsIGZyZWUgdG8gcmVtb3ZlIHVud2FudGVkIG9uZXMuCiAgICAgKi8KCiAgICAvKiBhbGxvd2VkIGVsZW1lbnQgbmFtZXMgKi8KCiAgICBsZXQgQUxMT1dFRF9UQUdTID0gbnVsbDsKICAgIGNvbnN0IERFRkFVTFRfQUxMT1dFRF9UQUdTID0gYWRkVG9TZXQoe30sIFsuLi5odG1sJDEsIC4uLnN2ZyQxLCAuLi5zdmdGaWx0ZXJzLCAuLi5tYXRoTWwkMSwgLi4udGV4dF0pOwogICAgLyogQWxsb3dlZCBhdHRyaWJ1dGUgbmFtZXMgKi8KCiAgICBsZXQgQUxMT1dFRF9BVFRSID0gbnVsbDsKICAgIGNvbnN0IERFRkFVTFRfQUxMT1dFRF9BVFRSID0gYWRkVG9TZXQoe30sIFsuLi5odG1sLCAuLi5zdmcsIC4uLm1hdGhNbCwgLi4ueG1sXSk7CiAgICAvKgogICAgICogQ29uZmlndXJlIGhvdyBET01QVXJpZnkgc2hvdWxkIGhhbmRsZSBjdXN0b20gZWxlbWVudHMgYW5kIHRoZWlyIGF0dHJpYnV0ZXMgYXMgd2VsbCBhcyBjdXN0b21pemVkIGJ1aWx0LWluIGVsZW1lbnRzLgogICAgICogQHByb3BlcnR5IHtSZWdFeHB8RnVuY3Rpb258bnVsbH0gdGFnTmFtZUNoZWNrIG9uZSBvZiBbbnVsbCwgcmVnZXhQYXR0ZXJuLCBwcmVkaWNhdGVdLiBEZWZhdWx0OiBgbnVsbGAgKGRpc2FsbG93IGFueSBjdXN0b20gZWxlbWVudHMpCiAgICAgKiBAcHJvcGVydHkge1JlZ0V4cHxGdW5jdGlvbnxudWxsfSBhdHRyaWJ1dGVOYW1lQ2hlY2sgb25lIG9mIFtudWxsLCByZWdleFBhdHRlcm4sIHByZWRpY2F0ZV0uIERlZmF1bHQ6IGBudWxsYCAoZGlzYWxsb3cgYW55IGF0dHJpYnV0ZXMgbm90IG9uIHRoZSBhbGxvdyBsaXN0KQogICAgICogQHByb3BlcnR5IHtib29sZWFufSBhbGxvd0N1c3RvbWl6ZWRCdWlsdEluRWxlbWVudHMgYWxsb3cgY3VzdG9tIGVsZW1lbnRzIGRlcml2ZWQgZnJvbSBidWlsdC1pbnMgaWYgdGhleSBwYXNzIENVU1RPTV9FTEVNRU5UX0hBTkRMSU5HLnRhZ05hbWVDaGVjay4gRGVmYXVsdDogYGZhbHNlYC4KICAgICAqLwoKICAgIGxldCBDVVNUT01fRUxFTUVOVF9IQU5ETElORyA9IE9iamVjdC5zZWFsKE9iamVjdC5jcmVhdGUobnVsbCwgewogICAgICB0YWdOYW1lQ2hlY2s6IHsKICAgICAgICB3cml0YWJsZTogdHJ1ZSwKICAgICAgICBjb25maWd1cmFibGU6IGZhbHNlLAogICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgdmFsdWU6IG51bGwKICAgICAgfSwKICAgICAgYXR0cmlidXRlTmFtZUNoZWNrOiB7CiAgICAgICAgd3JpdGFibGU6IHRydWUsCiAgICAgICAgY29uZmlndXJhYmxlOiBmYWxzZSwKICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICAgIHZhbHVlOiBudWxsCiAgICAgIH0sCiAgICAgIGFsbG93Q3VzdG9taXplZEJ1aWx0SW5FbGVtZW50czogewogICAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICAgIGNvbmZpZ3VyYWJsZTogZmFsc2UsCiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICB2YWx1ZTogZmFsc2UKICAgICAgfQogICAgfSkpOwogICAgLyogRXhwbGljaXRseSBmb3JiaWRkZW4gdGFncyAob3ZlcnJpZGVzIEFMTE9XRURfVEFHUy9BRERfVEFHUykgKi8KCiAgICBsZXQgRk9SQklEX1RBR1MgPSBudWxsOwogICAgLyogRXhwbGljaXRseSBmb3JiaWRkZW4gYXR0cmlidXRlcyAob3ZlcnJpZGVzIEFMTE9XRURfQVRUUi9BRERfQVRUUikgKi8KCiAgICBsZXQgRk9SQklEX0FUVFIgPSBudWxsOwogICAgLyogRGVjaWRlIGlmIEFSSUEgYXR0cmlidXRlcyBhcmUgb2theSAqLwoKICAgIGxldCBBTExPV19BUklBX0FUVFIgPSB0cnVlOwogICAgLyogRGVjaWRlIGlmIGN1c3RvbSBkYXRhIGF0dHJpYnV0ZXMgYXJlIG9rYXkgKi8KCiAgICBsZXQgQUxMT1dfREFUQV9BVFRSID0gdHJ1ZTsKICAgIC8qIERlY2lkZSBpZiB1bmtub3duIHByb3RvY29scyBhcmUgb2theSAqLwoKICAgIGxldCBBTExPV19VTktOT1dOX1BST1RPQ09MUyA9IGZhbHNlOwogICAgLyogRGVjaWRlIGlmIHNlbGYtY2xvc2luZyB0YWdzIGluIGF0dHJpYnV0ZXMgYXJlIGFsbG93ZWQuCiAgICAgKiBVc3VhbGx5IHJlbW92ZWQgZHVlIHRvIGEgbVhTUyBpc3N1ZSBpbiBqUXVlcnkgMy4wICovCgogICAgbGV0IEFMTE9XX1NFTEZfQ0xPU0VfSU5fQVRUUiA9IHRydWU7CiAgICAvKiBPdXRwdXQgc2hvdWxkIGJlIHNhZmUgZm9yIGNvbW1vbiB0ZW1wbGF0ZSBlbmdpbmVzLgogICAgICogVGhpcyBtZWFucywgRE9NUHVyaWZ5IHJlbW92ZXMgZGF0YSBhdHRyaWJ1dGVzLCBtdXN0YWNoZXMgYW5kIEVSQgogICAgICovCgogICAgbGV0IFNBRkVfRk9SX1RFTVBMQVRFUyA9IGZhbHNlOwogICAgLyogRGVjaWRlIGlmIGRvY3VtZW50IHdpdGggPGh0bWw+Li4uIHNob3VsZCBiZSByZXR1cm5lZCAqLwoKICAgIGxldCBXSE9MRV9ET0NVTUVOVCA9IGZhbHNlOwogICAgLyogVHJhY2sgd2hldGhlciBjb25maWcgaXMgYWxyZWFkeSBzZXQgb24gdGhpcyBpbnN0YW5jZSBvZiBET01QdXJpZnkuICovCgogICAgbGV0IFNFVF9DT05GSUcgPSBmYWxzZTsKICAgIC8qIERlY2lkZSBpZiBhbGwgZWxlbWVudHMgKGUuZy4gc3R5bGUsIHNjcmlwdCkgbXVzdCBiZSBjaGlsZHJlbiBvZgogICAgICogZG9jdW1lbnQuYm9keS4gQnkgZGVmYXVsdCwgYnJvd3NlcnMgbWlnaHQgbW92ZSB0aGVtIHRvIGRvY3VtZW50LmhlYWQgKi8KCiAgICBsZXQgRk9SQ0VfQk9EWSA9IGZhbHNlOwogICAgLyogRGVjaWRlIGlmIGEgRE9NIGBIVE1MQm9keUVsZW1lbnRgIHNob3VsZCBiZSByZXR1cm5lZCwgaW5zdGVhZCBvZiBhIGh0bWwKICAgICAqIHN0cmluZyAob3IgYSBUcnVzdGVkSFRNTCBvYmplY3QgaWYgVHJ1c3RlZCBUeXBlcyBhcmUgc3VwcG9ydGVkKS4KICAgICAqIElmIGBXSE9MRV9ET0NVTUVOVGAgaXMgZW5hYmxlZCBhIGBIVE1MSHRtbEVsZW1lbnRgIHdpbGwgYmUgcmV0dXJuZWQgaW5zdGVhZAogICAgICovCgogICAgbGV0IFJFVFVSTl9ET00gPSBmYWxzZTsKICAgIC8qIERlY2lkZSBpZiBhIERPTSBgRG9jdW1lbnRGcmFnbWVudGAgc2hvdWxkIGJlIHJldHVybmVkLCBpbnN0ZWFkIG9mIGEgaHRtbAogICAgICogc3RyaW5nICAob3IgYSBUcnVzdGVkSFRNTCBvYmplY3QgaWYgVHJ1c3RlZCBUeXBlcyBhcmUgc3VwcG9ydGVkKSAqLwoKICAgIGxldCBSRVRVUk5fRE9NX0ZSQUdNRU5UID0gZmFsc2U7CiAgICAvKiBUcnkgdG8gcmV0dXJuIGEgVHJ1c3RlZCBUeXBlIG9iamVjdCBpbnN0ZWFkIG9mIGEgc3RyaW5nLCByZXR1cm4gYSBzdHJpbmcgaW4KICAgICAqIGNhc2UgVHJ1c3RlZCBUeXBlcyBhcmUgbm90IHN1cHBvcnRlZCAgKi8KCiAgICBsZXQgUkVUVVJOX1RSVVNURURfVFlQRSA9IGZhbHNlOwogICAgLyogT3V0cHV0IHNob3VsZCBiZSBmcmVlIGZyb20gRE9NIGNsb2JiZXJpbmcgYXR0YWNrcz8KICAgICAqIFRoaXMgc2FuaXRpemVzIG1hcmt1cHMgbmFtZWQgd2l0aCBjb2xsaWRpbmcsIGNsb2JiZXJhYmxlIGJ1aWx0LWluIERPTSBBUElzLgogICAgICovCgogICAgbGV0IFNBTklUSVpFX0RPTSA9IHRydWU7CiAgICAvKiBBY2hpZXZlIGZ1bGwgRE9NIENsb2JiZXJpbmcgcHJvdGVjdGlvbiBieSBpc29sYXRpbmcgdGhlIG5hbWVzcGFjZSBvZiBuYW1lZAogICAgICogcHJvcGVydGllcyBhbmQgSlMgdmFyaWFibGVzLCBtaXRpZ2F0aW5nIGF0dGFja3MgdGhhdCBhYnVzZSB0aGUgSFRNTC9ET00gc3BlYyBydWxlcy4KICAgICAqCiAgICAgKiBIVE1ML0RPTSBzcGVjIHJ1bGVzIHRoYXQgZW5hYmxlIERPTSBDbG9iYmVyaW5nOgogICAgICogICAtIE5hbWVkIEFjY2VzcyBvbiBXaW5kb3cgKMKnNy4zLjMpCiAgICAgKiAgIC0gRE9NIFRyZWUgQWNjZXNzb3JzICjCpzMuMS41KQogICAgICogICAtIEZvcm0gRWxlbWVudCBQYXJlbnQtQ2hpbGQgUmVsYXRpb25zICjCpzQuMTAuMykKICAgICAqICAgLSBJZnJhbWUgc3JjZG9jIC8gTmVzdGVkIFdpbmRvd1Byb3hpZXMgKMKnNC44LjUpCiAgICAgKiAgIC0gSFRNTENvbGxlY3Rpb24gKMKnNC4yLjEwLjIpCiAgICAgKgogICAgICogTmFtZXNwYWNlIGlzb2xhdGlvbiBpcyBpbXBsZW1lbnRlZCBieSBwcmVmaXhpbmcgYGlkYCBhbmQgYG5hbWVgIGF0dHJpYnV0ZXMKICAgICAqIHdpdGggYSBjb25zdGFudCBzdHJpbmcsIGkuZS4sIGB1c2VyLWNvbnRlbnQtYAogICAgICovCgogICAgbGV0IFNBTklUSVpFX05BTUVEX1BST1BTID0gZmFsc2U7CiAgICBjb25zdCBTQU5JVElaRV9OQU1FRF9QUk9QU19QUkVGSVggPSAndXNlci1jb250ZW50LSc7CiAgICAvKiBLZWVwIGVsZW1lbnQgY29udGVudCB3aGVuIHJlbW92aW5nIGVsZW1lbnQ/ICovCgogICAgbGV0IEtFRVBfQ09OVEVOVCA9IHRydWU7CiAgICAvKiBJZiBhIGBOb2RlYCBpcyBwYXNzZWQgdG8gc2FuaXRpemUoKSwgdGhlbiBwZXJmb3JtcyBzYW5pdGl6YXRpb24gaW4tcGxhY2UgaW5zdGVhZAogICAgICogb2YgaW1wb3J0aW5nIGl0IGludG8gYSBuZXcgRG9jdW1lbnQgYW5kIHJldHVybmluZyBhIHNhbml0aXplZCBjb3B5ICovCgogICAgbGV0IElOX1BMQUNFID0gZmFsc2U7CiAgICAvKiBBbGxvdyB1c2FnZSBvZiBwcm9maWxlcyBsaWtlIGh0bWwsIHN2ZyBhbmQgbWF0aE1sICovCgogICAgbGV0IFVTRV9QUk9GSUxFUyA9IHt9OwogICAgLyogVGFncyB0byBpZ25vcmUgY29udGVudCBvZiB3aGVuIEtFRVBfQ09OVEVOVCBpcyB0cnVlICovCgogICAgbGV0IEZPUkJJRF9DT05URU5UUyA9IG51bGw7CiAgICBjb25zdCBERUZBVUxUX0ZPUkJJRF9DT05URU5UUyA9IGFkZFRvU2V0KHt9LCBbJ2Fubm90YXRpb24teG1sJywgJ2F1ZGlvJywgJ2NvbGdyb3VwJywgJ2Rlc2MnLCAnZm9yZWlnbm9iamVjdCcsICdoZWFkJywgJ2lmcmFtZScsICdtYXRoJywgJ21pJywgJ21uJywgJ21vJywgJ21zJywgJ210ZXh0JywgJ25vZW1iZWQnLCAnbm9mcmFtZXMnLCAnbm9zY3JpcHQnLCAncGxhaW50ZXh0JywgJ3NjcmlwdCcsICdzdHlsZScsICdzdmcnLCAndGVtcGxhdGUnLCAndGhlYWQnLCAndGl0bGUnLCAndmlkZW8nLCAneG1wJ10pOwogICAgLyogVGFncyB0aGF0IGFyZSBzYWZlIGZvciBkYXRhOiBVUklzICovCgogICAgbGV0IERBVEFfVVJJX1RBR1MgPSBudWxsOwogICAgY29uc3QgREVGQVVMVF9EQVRBX1VSSV9UQUdTID0gYWRkVG9TZXQoe30sIFsnYXVkaW8nLCAndmlkZW8nLCAnaW1nJywgJ3NvdXJjZScsICdpbWFnZScsICd0cmFjayddKTsKICAgIC8qIEF0dHJpYnV0ZXMgc2FmZSBmb3IgdmFsdWVzIGxpa2UgImphdmFzY3JpcHQ6IiAqLwoKICAgIGxldCBVUklfU0FGRV9BVFRSSUJVVEVTID0gbnVsbDsKICAgIGNvbnN0IERFRkFVTFRfVVJJX1NBRkVfQVRUUklCVVRFUyA9IGFkZFRvU2V0KHt9LCBbJ2FsdCcsICdjbGFzcycsICdmb3InLCAnaWQnLCAnbGFiZWwnLCAnbmFtZScsICdwYXR0ZXJuJywgJ3BsYWNlaG9sZGVyJywgJ3JvbGUnLCAnc3VtbWFyeScsICd0aXRsZScsICd2YWx1ZScsICdzdHlsZScsICd4bWxucyddKTsKICAgIGNvbnN0IE1BVEhNTF9OQU1FU1BBQ0UgPSAnaHR0cDovL3d3dy53My5vcmcvMTk5OC9NYXRoL01hdGhNTCc7CiAgICBjb25zdCBTVkdfTkFNRVNQQUNFID0gJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJzsKICAgIGNvbnN0IEhUTUxfTkFNRVNQQUNFID0gJ2h0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwnOwogICAgLyogRG9jdW1lbnQgbmFtZXNwYWNlICovCgogICAgbGV0IE5BTUVTUEFDRSA9IEhUTUxfTkFNRVNQQUNFOwogICAgbGV0IElTX0VNUFRZX0lOUFVUID0gZmFsc2U7CiAgICAvKiBBbGxvd2VkIFhIVE1MK1hNTCBuYW1lc3BhY2VzICovCgogICAgbGV0IEFMTE9XRURfTkFNRVNQQUNFUyA9IG51bGw7CiAgICBjb25zdCBERUZBVUxUX0FMTE9XRURfTkFNRVNQQUNFUyA9IGFkZFRvU2V0KHt9LCBbTUFUSE1MX05BTUVTUEFDRSwgU1ZHX05BTUVTUEFDRSwgSFRNTF9OQU1FU1BBQ0VdLCBzdHJpbmdUb1N0cmluZyk7CiAgICAvKiBQYXJzaW5nIG9mIHN0cmljdCBYSFRNTCBkb2N1bWVudHMgKi8KCiAgICBsZXQgUEFSU0VSX01FRElBX1RZUEU7CiAgICBjb25zdCBTVVBQT1JURURfUEFSU0VSX01FRElBX1RZUEVTID0gWydhcHBsaWNhdGlvbi94aHRtbCt4bWwnLCAndGV4dC9odG1sJ107CiAgICBjb25zdCBERUZBVUxUX1BBUlNFUl9NRURJQV9UWVBFID0gJ3RleHQvaHRtbCc7CiAgICBsZXQgdHJhbnNmb3JtQ2FzZUZ1bmM7CiAgICAvKiBLZWVwIGEgcmVmZXJlbmNlIHRvIGNvbmZpZyB0byBwYXNzIHRvIGhvb2tzICovCgogICAgbGV0IENPTkZJRyA9IG51bGw7CiAgICAvKiBJZGVhbGx5LCBkbyBub3QgdG91Y2ggYW55dGhpbmcgYmVsb3cgdGhpcyBsaW5lICovCgogICAgLyogX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXyAqLwoKICAgIGNvbnN0IGZvcm1FbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZm9ybScpOwoKICAgIGNvbnN0IGlzUmVnZXhPckZ1bmN0aW9uID0gZnVuY3Rpb24gaXNSZWdleE9yRnVuY3Rpb24odGVzdFZhbHVlKSB7CiAgICAgIHJldHVybiB0ZXN0VmFsdWUgaW5zdGFuY2VvZiBSZWdFeHAgfHwgdGVzdFZhbHVlIGluc3RhbmNlb2YgRnVuY3Rpb247CiAgICB9OwogICAgLyoqCiAgICAgKiBfcGFyc2VDb25maWcKICAgICAqCiAgICAgKiBAcGFyYW0gIHtPYmplY3R9IGNmZyBvcHRpb25hbCBjb25maWcgbGl0ZXJhbAogICAgICovCiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgY29tcGxleGl0eQoKCiAgICBjb25zdCBfcGFyc2VDb25maWcgPSBmdW5jdGlvbiBfcGFyc2VDb25maWcoY2ZnKSB7CiAgICAgIGlmIChDT05GSUcgJiYgQ09ORklHID09PSBjZmcpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgLyogU2hpZWxkIGNvbmZpZ3VyYXRpb24gb2JqZWN0IGZyb20gdGFtcGVyaW5nICovCgoKICAgICAgaWYgKCFjZmcgfHwgdHlwZW9mIGNmZyAhPT0gJ29iamVjdCcpIHsKICAgICAgICBjZmcgPSB7fTsKICAgICAgfQogICAgICAvKiBTaGllbGQgY29uZmlndXJhdGlvbiBvYmplY3QgZnJvbSBwcm90b3R5cGUgcG9sbHV0aW9uICovCgoKICAgICAgY2ZnID0gY2xvbmUoY2ZnKTsKICAgICAgUEFSU0VSX01FRElBX1RZUEUgPSAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgdW5pY29ybi9wcmVmZXItaW5jbHVkZXMKICAgICAgICBTVVBQT1JURURfUEFSU0VSX01FRElBX1RZUEVTLmluZGV4T2YoY2ZnLlBBUlNFUl9NRURJQV9UWVBFKSA9PT0gLTEgPyBQQVJTRVJfTUVESUFfVFlQRSA9IERFRkFVTFRfUEFSU0VSX01FRElBX1RZUEUgOiBQQVJTRVJfTUVESUFfVFlQRSA9IGNmZy5QQVJTRVJfTUVESUFfVFlQRTsgLy8gSFRNTCB0YWdzIGFuZCBhdHRyaWJ1dGVzIGFyZSBub3QgY2FzZS1zZW5zaXRpdmUsIGNvbnZlcnRpbmcgdG8gbG93ZXJjYXNlLiBLZWVwaW5nIFhIVE1MIGFzIGlzLgoKICAgICAgdHJhbnNmb3JtQ2FzZUZ1bmMgPSBQQVJTRVJfTUVESUFfVFlQRSA9PT0gJ2FwcGxpY2F0aW9uL3hodG1sK3htbCcgPyBzdHJpbmdUb1N0cmluZyA6IHN0cmluZ1RvTG93ZXJDYXNlOwogICAgICAvKiBTZXQgY29uZmlndXJhdGlvbiBwYXJhbWV0ZXJzICovCgogICAgICBBTExPV0VEX1RBR1MgPSAnQUxMT1dFRF9UQUdTJyBpbiBjZmcgPyBhZGRUb1NldCh7fSwgY2ZnLkFMTE9XRURfVEFHUywgdHJhbnNmb3JtQ2FzZUZ1bmMpIDogREVGQVVMVF9BTExPV0VEX1RBR1M7CiAgICAgIEFMTE9XRURfQVRUUiA9ICdBTExPV0VEX0FUVFInIGluIGNmZyA/IGFkZFRvU2V0KHt9LCBjZmcuQUxMT1dFRF9BVFRSLCB0cmFuc2Zvcm1DYXNlRnVuYykgOiBERUZBVUxUX0FMTE9XRURfQVRUUjsKICAgICAgQUxMT1dFRF9OQU1FU1BBQ0VTID0gJ0FMTE9XRURfTkFNRVNQQUNFUycgaW4gY2ZnID8gYWRkVG9TZXQoe30sIGNmZy5BTExPV0VEX05BTUVTUEFDRVMsIHN0cmluZ1RvU3RyaW5nKSA6IERFRkFVTFRfQUxMT1dFRF9OQU1FU1BBQ0VTOwogICAgICBVUklfU0FGRV9BVFRSSUJVVEVTID0gJ0FERF9VUklfU0FGRV9BVFRSJyBpbiBjZmcgPyBhZGRUb1NldChjbG9uZShERUZBVUxUX1VSSV9TQUZFX0FUVFJJQlVURVMpLCAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIGluZGVudAogICAgICAgIGNmZy5BRERfVVJJX1NBRkVfQVRUUiwgLy8gZXNsaW50LWRpc2FibGUtbGluZSBpbmRlbnQKICAgICAgICB0cmFuc2Zvcm1DYXNlRnVuYyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIGluZGVudAogICAgICApIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgaW5kZW50CiAgICAgICAgOiBERUZBVUxUX1VSSV9TQUZFX0FUVFJJQlVURVM7CiAgICAgIERBVEFfVVJJX1RBR1MgPSAnQUREX0RBVEFfVVJJX1RBR1MnIGluIGNmZyA/IGFkZFRvU2V0KGNsb25lKERFRkFVTFRfREFUQV9VUklfVEFHUyksIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgaW5kZW50CiAgICAgICAgY2ZnLkFERF9EQVRBX1VSSV9UQUdTLCAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIGluZGVudAogICAgICAgIHRyYW5zZm9ybUNhc2VGdW5jIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgaW5kZW50CiAgICAgICkgLy8gZXNsaW50LWRpc2FibGUtbGluZSBpbmRlbnQKICAgICAgICA6IERFRkFVTFRfREFUQV9VUklfVEFHUzsKICAgICAgRk9SQklEX0NPTlRFTlRTID0gJ0ZPUkJJRF9DT05URU5UUycgaW4gY2ZnID8gYWRkVG9TZXQoe30sIGNmZy5GT1JCSURfQ09OVEVOVFMsIHRyYW5zZm9ybUNhc2VGdW5jKSA6IERFRkFVTFRfRk9SQklEX0NPTlRFTlRTOwogICAgICBGT1JCSURfVEFHUyA9ICdGT1JCSURfVEFHUycgaW4gY2ZnID8gYWRkVG9TZXQoe30sIGNmZy5GT1JCSURfVEFHUywgdHJhbnNmb3JtQ2FzZUZ1bmMpIDoge307CiAgICAgIEZPUkJJRF9BVFRSID0gJ0ZPUkJJRF9BVFRSJyBpbiBjZmcgPyBhZGRUb1NldCh7fSwgY2ZnLkZPUkJJRF9BVFRSLCB0cmFuc2Zvcm1DYXNlRnVuYykgOiB7fTsKICAgICAgVVNFX1BST0ZJTEVTID0gJ1VTRV9QUk9GSUxFUycgaW4gY2ZnID8gY2ZnLlVTRV9QUk9GSUxFUyA6IGZhbHNlOwogICAgICBBTExPV19BUklBX0FUVFIgPSBjZmcuQUxMT1dfQVJJQV9BVFRSICE9PSBmYWxzZTsgLy8gRGVmYXVsdCB0cnVlCgogICAgICBBTExPV19EQVRBX0FUVFIgPSBjZmcuQUxMT1dfREFUQV9BVFRSICE9PSBmYWxzZTsgLy8gRGVmYXVsdCB0cnVlCgogICAgICBBTExPV19VTktOT1dOX1BST1RPQ09MUyA9IGNmZy5BTExPV19VTktOT1dOX1BST1RPQ09MUyB8fCBmYWxzZTsgLy8gRGVmYXVsdCBmYWxzZQoKICAgICAgQUxMT1dfU0VMRl9DTE9TRV9JTl9BVFRSID0gY2ZnLkFMTE9XX1NFTEZfQ0xPU0VfSU5fQVRUUiAhPT0gZmFsc2U7IC8vIERlZmF1bHQgdHJ1ZQoKICAgICAgU0FGRV9GT1JfVEVNUExBVEVTID0gY2ZnLlNBRkVfRk9SX1RFTVBMQVRFUyB8fCBmYWxzZTsgLy8gRGVmYXVsdCBmYWxzZQoKICAgICAgV0hPTEVfRE9DVU1FTlQgPSBjZmcuV0hPTEVfRE9DVU1FTlQgfHwgZmFsc2U7IC8vIERlZmF1bHQgZmFsc2UKCiAgICAgIFJFVFVSTl9ET00gPSBjZmcuUkVUVVJOX0RPTSB8fCBmYWxzZTsgLy8gRGVmYXVsdCBmYWxzZQoKICAgICAgUkVUVVJOX0RPTV9GUkFHTUVOVCA9IGNmZy5SRVRVUk5fRE9NX0ZSQUdNRU5UIHx8IGZhbHNlOyAvLyBEZWZhdWx0IGZhbHNlCgogICAgICBSRVRVUk5fVFJVU1RFRF9UWVBFID0gY2ZnLlJFVFVSTl9UUlVTVEVEX1RZUEUgfHwgZmFsc2U7IC8vIERlZmF1bHQgZmFsc2UKCiAgICAgIEZPUkNFX0JPRFkgPSBjZmcuRk9SQ0VfQk9EWSB8fCBmYWxzZTsgLy8gRGVmYXVsdCBmYWxzZQoKICAgICAgU0FOSVRJWkVfRE9NID0gY2ZnLlNBTklUSVpFX0RPTSAhPT0gZmFsc2U7IC8vIERlZmF1bHQgdHJ1ZQoKICAgICAgU0FOSVRJWkVfTkFNRURfUFJPUFMgPSBjZmcuU0FOSVRJWkVfTkFNRURfUFJPUFMgfHwgZmFsc2U7IC8vIERlZmF1bHQgZmFsc2UKCiAgICAgIEtFRVBfQ09OVEVOVCA9IGNmZy5LRUVQX0NPTlRFTlQgIT09IGZhbHNlOyAvLyBEZWZhdWx0IHRydWUKCiAgICAgIElOX1BMQUNFID0gY2ZnLklOX1BMQUNFIHx8IGZhbHNlOyAvLyBEZWZhdWx0IGZhbHNlCgogICAgICBJU19BTExPV0VEX1VSSSQxID0gY2ZnLkFMTE9XRURfVVJJX1JFR0VYUCB8fCBJU19BTExPV0VEX1VSSTsKICAgICAgTkFNRVNQQUNFID0gY2ZnLk5BTUVTUEFDRSB8fCBIVE1MX05BTUVTUEFDRTsKICAgICAgQ1VTVE9NX0VMRU1FTlRfSEFORExJTkcgPSBjZmcuQ1VTVE9NX0VMRU1FTlRfSEFORExJTkcgfHwge307CgogICAgICBpZiAoY2ZnLkNVU1RPTV9FTEVNRU5UX0hBTkRMSU5HICYmIGlzUmVnZXhPckZ1bmN0aW9uKGNmZy5DVVNUT01fRUxFTUVOVF9IQU5ETElORy50YWdOYW1lQ2hlY2spKSB7CiAgICAgICAgQ1VTVE9NX0VMRU1FTlRfSEFORExJTkcudGFnTmFtZUNoZWNrID0gY2ZnLkNVU1RPTV9FTEVNRU5UX0hBTkRMSU5HLnRhZ05hbWVDaGVjazsKICAgICAgfQoKICAgICAgaWYgKGNmZy5DVVNUT01fRUxFTUVOVF9IQU5ETElORyAmJiBpc1JlZ2V4T3JGdW5jdGlvbihjZmcuQ1VTVE9NX0VMRU1FTlRfSEFORExJTkcuYXR0cmlidXRlTmFtZUNoZWNrKSkgewogICAgICAgIENVU1RPTV9FTEVNRU5UX0hBTkRMSU5HLmF0dHJpYnV0ZU5hbWVDaGVjayA9IGNmZy5DVVNUT01fRUxFTUVOVF9IQU5ETElORy5hdHRyaWJ1dGVOYW1lQ2hlY2s7CiAgICAgIH0KCiAgICAgIGlmIChjZmcuQ1VTVE9NX0VMRU1FTlRfSEFORExJTkcgJiYgdHlwZW9mIGNmZy5DVVNUT01fRUxFTUVOVF9IQU5ETElORy5hbGxvd0N1c3RvbWl6ZWRCdWlsdEluRWxlbWVudHMgPT09ICdib29sZWFuJykgewogICAgICAgIENVU1RPTV9FTEVNRU5UX0hBTkRMSU5HLmFsbG93Q3VzdG9taXplZEJ1aWx0SW5FbGVtZW50cyA9IGNmZy5DVVNUT01fRUxFTUVOVF9IQU5ETElORy5hbGxvd0N1c3RvbWl6ZWRCdWlsdEluRWxlbWVudHM7CiAgICAgIH0KCiAgICAgIGlmIChTQUZFX0ZPUl9URU1QTEFURVMpIHsKICAgICAgICBBTExPV19EQVRBX0FUVFIgPSBmYWxzZTsKICAgICAgfQoKICAgICAgaWYgKFJFVFVSTl9ET01fRlJBR01FTlQpIHsKICAgICAgICBSRVRVUk5fRE9NID0gdHJ1ZTsKICAgICAgfQogICAgICAvKiBQYXJzZSBwcm9maWxlIGluZm8gKi8KCgogICAgICBpZiAoVVNFX1BST0ZJTEVTKSB7CiAgICAgICAgQUxMT1dFRF9UQUdTID0gYWRkVG9TZXQoe30sIFsuLi50ZXh0XSk7CiAgICAgICAgQUxMT1dFRF9BVFRSID0gW107CgogICAgICAgIGlmIChVU0VfUFJPRklMRVMuaHRtbCA9PT0gdHJ1ZSkgewogICAgICAgICAgYWRkVG9TZXQoQUxMT1dFRF9UQUdTLCBodG1sJDEpOwogICAgICAgICAgYWRkVG9TZXQoQUxMT1dFRF9BVFRSLCBodG1sKTsKICAgICAgICB9CgogICAgICAgIGlmIChVU0VfUFJPRklMRVMuc3ZnID09PSB0cnVlKSB7CiAgICAgICAgICBhZGRUb1NldChBTExPV0VEX1RBR1MsIHN2ZyQxKTsKICAgICAgICAgIGFkZFRvU2V0KEFMTE9XRURfQVRUUiwgc3ZnKTsKICAgICAgICAgIGFkZFRvU2V0KEFMTE9XRURfQVRUUiwgeG1sKTsKICAgICAgICB9CgogICAgICAgIGlmIChVU0VfUFJPRklMRVMuc3ZnRmlsdGVycyA9PT0gdHJ1ZSkgewogICAgICAgICAgYWRkVG9TZXQoQUxMT1dFRF9UQUdTLCBzdmdGaWx0ZXJzKTsKICAgICAgICAgIGFkZFRvU2V0KEFMTE9XRURfQVRUUiwgc3ZnKTsKICAgICAgICAgIGFkZFRvU2V0KEFMTE9XRURfQVRUUiwgeG1sKTsKICAgICAgICB9CgogICAgICAgIGlmIChVU0VfUFJPRklMRVMubWF0aE1sID09PSB0cnVlKSB7CiAgICAgICAgICBhZGRUb1NldChBTExPV0VEX1RBR1MsIG1hdGhNbCQxKTsKICAgICAgICAgIGFkZFRvU2V0KEFMTE9XRURfQVRUUiwgbWF0aE1sKTsKICAgICAgICAgIGFkZFRvU2V0KEFMTE9XRURfQVRUUiwgeG1sKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgLyogTWVyZ2UgY29uZmlndXJhdGlvbiBwYXJhbWV0ZXJzICovCgoKICAgICAgaWYgKGNmZy5BRERfVEFHUykgewogICAgICAgIGlmIChBTExPV0VEX1RBR1MgPT09IERFRkFVTFRfQUxMT1dFRF9UQUdTKSB7CiAgICAgICAgICBBTExPV0VEX1RBR1MgPSBjbG9uZShBTExPV0VEX1RBR1MpOwogICAgICAgIH0KCiAgICAgICAgYWRkVG9TZXQoQUxMT1dFRF9UQUdTLCBjZmcuQUREX1RBR1MsIHRyYW5zZm9ybUNhc2VGdW5jKTsKICAgICAgfQoKICAgICAgaWYgKGNmZy5BRERfQVRUUikgewogICAgICAgIGlmIChBTExPV0VEX0FUVFIgPT09IERFRkFVTFRfQUxMT1dFRF9BVFRSKSB7CiAgICAgICAgICBBTExPV0VEX0FUVFIgPSBjbG9uZShBTExPV0VEX0FUVFIpOwogICAgICAgIH0KCiAgICAgICAgYWRkVG9TZXQoQUxMT1dFRF9BVFRSLCBjZmcuQUREX0FUVFIsIHRyYW5zZm9ybUNhc2VGdW5jKTsKICAgICAgfQoKICAgICAgaWYgKGNmZy5BRERfVVJJX1NBRkVfQVRUUikgewogICAgICAgIGFkZFRvU2V0KFVSSV9TQUZFX0FUVFJJQlVURVMsIGNmZy5BRERfVVJJX1NBRkVfQVRUUiwgdHJhbnNmb3JtQ2FzZUZ1bmMpOwogICAgICB9CgogICAgICBpZiAoY2ZnLkZPUkJJRF9DT05URU5UUykgewogICAgICAgIGlmIChGT1JCSURfQ09OVEVOVFMgPT09IERFRkFVTFRfRk9SQklEX0NPTlRFTlRTKSB7CiAgICAgICAgICBGT1JCSURfQ09OVEVOVFMgPSBjbG9uZShGT1JCSURfQ09OVEVOVFMpOwogICAgICAgIH0KCiAgICAgICAgYWRkVG9TZXQoRk9SQklEX0NPTlRFTlRTLCBjZmcuRk9SQklEX0NPTlRFTlRTLCB0cmFuc2Zvcm1DYXNlRnVuYyk7CiAgICAgIH0KICAgICAgLyogQWRkICN0ZXh0IGluIGNhc2UgS0VFUF9DT05URU5UIGlzIHNldCB0byB0cnVlICovCgoKICAgICAgaWYgKEtFRVBfQ09OVEVOVCkgewogICAgICAgIEFMTE9XRURfVEFHU1snI3RleHQnXSA9IHRydWU7CiAgICAgIH0KICAgICAgLyogQWRkIGh0bWwsIGhlYWQgYW5kIGJvZHkgdG8gQUxMT1dFRF9UQUdTIGluIGNhc2UgV0hPTEVfRE9DVU1FTlQgaXMgdHJ1ZSAqLwoKCiAgICAgIGlmIChXSE9MRV9ET0NVTUVOVCkgewogICAgICAgIGFkZFRvU2V0KEFMTE9XRURfVEFHUywgWydodG1sJywgJ2hlYWQnLCAnYm9keSddKTsKICAgICAgfQogICAgICAvKiBBZGQgdGJvZHkgdG8gQUxMT1dFRF9UQUdTIGluIGNhc2UgdGFibGVzIGFyZSBwZXJtaXR0ZWQsIHNlZSAjMjg2LCAjMzY1ICovCgoKICAgICAgaWYgKEFMTE9XRURfVEFHUy50YWJsZSkgewogICAgICAgIGFkZFRvU2V0KEFMTE9XRURfVEFHUywgWyd0Ym9keSddKTsKICAgICAgICBkZWxldGUgRk9SQklEX1RBR1MudGJvZHk7CiAgICAgIH0KCiAgICAgIGlmIChjZmcuVFJVU1RFRF9UWVBFU19QT0xJQ1kpIHsKICAgICAgICBpZiAodHlwZW9mIGNmZy5UUlVTVEVEX1RZUEVTX1BPTElDWS5jcmVhdGVIVE1MICE9PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICB0aHJvdyB0eXBlRXJyb3JDcmVhdGUoJ1RSVVNURURfVFlQRVNfUE9MSUNZIGNvbmZpZ3VyYXRpb24gb3B0aW9uIG11c3QgcHJvdmlkZSBhICJjcmVhdGVIVE1MIiBob29rLicpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHR5cGVvZiBjZmcuVFJVU1RFRF9UWVBFU19QT0xJQ1kuY3JlYXRlU2NyaXB0VVJMICE9PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICB0aHJvdyB0eXBlRXJyb3JDcmVhdGUoJ1RSVVNURURfVFlQRVNfUE9MSUNZIGNvbmZpZ3VyYXRpb24gb3B0aW9uIG11c3QgcHJvdmlkZSBhICJjcmVhdGVTY3JpcHRVUkwiIGhvb2suJyk7CiAgICAgICAgfSAvLyBPdmVyd3JpdGUgZXhpc3RpbmcgVHJ1c3RlZFR5cGVzIHBvbGljeS4KCgogICAgICAgIHRydXN0ZWRUeXBlc1BvbGljeSA9IGNmZy5UUlVTVEVEX1RZUEVTX1BPTElDWTsgLy8gU2lnbiBsb2NhbCB2YXJpYWJsZXMgcmVxdWlyZWQgYnkgYHNhbml0aXplYC4KCiAgICAgICAgZW1wdHlIVE1MID0gdHJ1c3RlZFR5cGVzUG9saWN5LmNyZWF0ZUhUTUwoJycpOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFVuaW5pdGlhbGl6ZWQgcG9saWN5LCBhdHRlbXB0IHRvIGluaXRpYWxpemUgdGhlIGludGVybmFsIGRvbXB1cmlmeSBwb2xpY3kuCiAgICAgICAgaWYgKHRydXN0ZWRUeXBlc1BvbGljeSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICB0cnVzdGVkVHlwZXNQb2xpY3kgPSBfY3JlYXRlVHJ1c3RlZFR5cGVzUG9saWN5KHRydXN0ZWRUeXBlcywgY3VycmVudFNjcmlwdCk7CiAgICAgICAgfSAvLyBJZiBjcmVhdGluZyB0aGUgaW50ZXJuYWwgcG9saWN5IHN1Y2NlZWRlZCBzaWduIGludGVybmFsIHZhcmlhYmxlcy4KCgogICAgICAgIGlmICh0cnVzdGVkVHlwZXNQb2xpY3kgIT09IG51bGwgJiYgdHlwZW9mIGVtcHR5SFRNTCA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgIGVtcHR5SFRNTCA9IHRydXN0ZWRUeXBlc1BvbGljeS5jcmVhdGVIVE1MKCcnKTsKICAgICAgICB9CiAgICAgIH0gLy8gUHJldmVudCBmdXJ0aGVyIG1hbmlwdWxhdGlvbiBvZiBjb25maWd1cmF0aW9uLgogICAgICAvLyBOb3QgYXZhaWxhYmxlIGluIElFOCwgU2FmYXJpIDUsIGV0Yy4KCgogICAgICBpZiAoZnJlZXplKSB7CiAgICAgICAgZnJlZXplKGNmZyk7CiAgICAgIH0KCiAgICAgIENPTkZJRyA9IGNmZzsKICAgIH07CgogICAgY29uc3QgTUFUSE1MX1RFWFRfSU5URUdSQVRJT05fUE9JTlRTID0gYWRkVG9TZXQoe30sIFsnbWknLCAnbW8nLCAnbW4nLCAnbXMnLCAnbXRleHQnXSk7CiAgICBjb25zdCBIVE1MX0lOVEVHUkFUSU9OX1BPSU5UUyA9IGFkZFRvU2V0KHt9LCBbJ2ZvcmVpZ25vYmplY3QnLCAnZGVzYycsICd0aXRsZScsICdhbm5vdGF0aW9uLXhtbCddKTsgLy8gQ2VydGFpbiBlbGVtZW50cyBhcmUgYWxsb3dlZCBpbiBib3RoIFNWRyBhbmQgSFRNTAogICAgLy8gbmFtZXNwYWNlLiBXZSBuZWVkIHRvIHNwZWNpZnkgdGhlbSBleHBsaWNpdGx5CiAgICAvLyBzbyB0aGF0IHRoZXkgZG9uJ3QgZ2V0IGVycm9uZW91c2x5IGRlbGV0ZWQgZnJvbQogICAgLy8gSFRNTCBuYW1lc3BhY2UuCgogICAgY29uc3QgQ09NTU9OX1NWR19BTkRfSFRNTF9FTEVNRU5UUyA9IGFkZFRvU2V0KHt9LCBbJ3RpdGxlJywgJ3N0eWxlJywgJ2ZvbnQnLCAnYScsICdzY3JpcHQnXSk7CiAgICAvKiBLZWVwIHRyYWNrIG9mIGFsbCBwb3NzaWJsZSBTVkcgYW5kIE1hdGhNTCB0YWdzCiAgICAgKiBzbyB0aGF0IHdlIGNhbiBwZXJmb3JtIHRoZSBuYW1lc3BhY2UgY2hlY2tzCiAgICAgKiBjb3JyZWN0bHkuICovCgogICAgY29uc3QgQUxMX1NWR19UQUdTID0gYWRkVG9TZXQoe30sIHN2ZyQxKTsKICAgIGFkZFRvU2V0KEFMTF9TVkdfVEFHUywgc3ZnRmlsdGVycyk7CiAgICBhZGRUb1NldChBTExfU1ZHX1RBR1MsIHN2Z0Rpc2FsbG93ZWQpOwogICAgY29uc3QgQUxMX01BVEhNTF9UQUdTID0gYWRkVG9TZXQoe30sIG1hdGhNbCQxKTsKICAgIGFkZFRvU2V0KEFMTF9NQVRITUxfVEFHUywgbWF0aE1sRGlzYWxsb3dlZCk7CiAgICAvKioKICAgICAqCiAgICAgKgogICAgICogQHBhcmFtICB7RWxlbWVudH0gZWxlbWVudCBhIERPTSBlbGVtZW50IHdob3NlIG5hbWVzcGFjZSBpcyBiZWluZyBjaGVja2VkCiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJuIGZhbHNlIGlmIHRoZSBlbGVtZW50IGhhcyBhCiAgICAgKiAgbmFtZXNwYWNlIHRoYXQgYSBzcGVjLWNvbXBsaWFudCBwYXJzZXIgd291bGQgbmV2ZXIKICAgICAqICByZXR1cm4uIFJldHVybiB0cnVlIG90aGVyd2lzZS4KICAgICAqLwoKICAgIGNvbnN0IF9jaGVja1ZhbGlkTmFtZXNwYWNlID0gZnVuY3Rpb24gX2NoZWNrVmFsaWROYW1lc3BhY2UoZWxlbWVudCkgewogICAgICBsZXQgcGFyZW50ID0gZ2V0UGFyZW50Tm9kZShlbGVtZW50KTsgLy8gSW4gSlNET00sIGlmIHdlJ3JlIGluc2lkZSBzaGFkb3cgRE9NLCB0aGVuIHBhcmVudE5vZGUKICAgICAgLy8gY2FuIGJlIG51bGwuIFdlIGp1c3Qgc2ltdWxhdGUgcGFyZW50IGluIHRoaXMgY2FzZS4KCiAgICAgIGlmICghcGFyZW50IHx8ICFwYXJlbnQudGFnTmFtZSkgewogICAgICAgIHBhcmVudCA9IHsKICAgICAgICAgIG5hbWVzcGFjZVVSSTogTkFNRVNQQUNFLAogICAgICAgICAgdGFnTmFtZTogJ3RlbXBsYXRlJwogICAgICAgIH07CiAgICAgIH0KCiAgICAgIGNvbnN0IHRhZ05hbWUgPSBzdHJpbmdUb0xvd2VyQ2FzZShlbGVtZW50LnRhZ05hbWUpOwogICAgICBjb25zdCBwYXJlbnRUYWdOYW1lID0gc3RyaW5nVG9Mb3dlckNhc2UocGFyZW50LnRhZ05hbWUpOwoKICAgICAgaWYgKCFBTExPV0VEX05BTUVTUEFDRVNbZWxlbWVudC5uYW1lc3BhY2VVUkldKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICBpZiAoZWxlbWVudC5uYW1lc3BhY2VVUkkgPT09IFNWR19OQU1FU1BBQ0UpIHsKICAgICAgICAvLyBUaGUgb25seSB3YXkgdG8gc3dpdGNoIGZyb20gSFRNTCBuYW1lc3BhY2UgdG8gU1ZHCiAgICAgICAgLy8gaXMgdmlhIDxzdmc+LiBJZiBpdCBoYXBwZW5zIHZpYSBhbnkgb3RoZXIgdGFnLCB0aGVuCiAgICAgICAgLy8gaXQgc2hvdWxkIGJlIGtpbGxlZC4KICAgICAgICBpZiAocGFyZW50Lm5hbWVzcGFjZVVSSSA9PT0gSFRNTF9OQU1FU1BBQ0UpIHsKICAgICAgICAgIHJldHVybiB0YWdOYW1lID09PSAnc3ZnJzsKICAgICAgICB9IC8vIFRoZSBvbmx5IHdheSB0byBzd2l0Y2ggZnJvbSBNYXRoTUwgdG8gU1ZHIGlzIHZpYWAKICAgICAgICAvLyBzdmcgaWYgcGFyZW50IGlzIGVpdGhlciA8YW5ub3RhdGlvbi14bWw+IG9yIE1hdGhNTAogICAgICAgIC8vIHRleHQgaW50ZWdyYXRpb24gcG9pbnRzLgoKCiAgICAgICAgaWYgKHBhcmVudC5uYW1lc3BhY2VVUkkgPT09IE1BVEhNTF9OQU1FU1BBQ0UpIHsKICAgICAgICAgIHJldHVybiB0YWdOYW1lID09PSAnc3ZnJyAmJiAocGFyZW50VGFnTmFtZSA9PT0gJ2Fubm90YXRpb24teG1sJyB8fCBNQVRITUxfVEVYVF9JTlRFR1JBVElPTl9QT0lOVFNbcGFyZW50VGFnTmFtZV0pOwogICAgICAgIH0gLy8gV2Ugb25seSBhbGxvdyBlbGVtZW50cyB0aGF0IGFyZSBkZWZpbmVkIGluIFNWRwogICAgICAgIC8vIHNwZWMuIEFsbCBvdGhlcnMgYXJlIGRpc2FsbG93ZWQgaW4gU1ZHIG5hbWVzcGFjZS4KCgogICAgICAgIHJldHVybiBCb29sZWFuKEFMTF9TVkdfVEFHU1t0YWdOYW1lXSk7CiAgICAgIH0KCiAgICAgIGlmIChlbGVtZW50Lm5hbWVzcGFjZVVSSSA9PT0gTUFUSE1MX05BTUVTUEFDRSkgewogICAgICAgIC8vIFRoZSBvbmx5IHdheSB0byBzd2l0Y2ggZnJvbSBIVE1MIG5hbWVzcGFjZSB0byBNYXRoTUwKICAgICAgICAvLyBpcyB2aWEgPG1hdGg+LiBJZiBpdCBoYXBwZW5zIHZpYSBhbnkgb3RoZXIgdGFnLCB0aGVuCiAgICAgICAgLy8gaXQgc2hvdWxkIGJlIGtpbGxlZC4KICAgICAgICBpZiAocGFyZW50Lm5hbWVzcGFjZVVSSSA9PT0gSFRNTF9OQU1FU1BBQ0UpIHsKICAgICAgICAgIHJldHVybiB0YWdOYW1lID09PSAnbWF0aCc7CiAgICAgICAgfSAvLyBUaGUgb25seSB3YXkgdG8gc3dpdGNoIGZyb20gU1ZHIHRvIE1hdGhNTCBpcyB2aWEKICAgICAgICAvLyA8bWF0aD4gYW5kIEhUTUwgaW50ZWdyYXRpb24gcG9pbnRzCgoKICAgICAgICBpZiAocGFyZW50Lm5hbWVzcGFjZVVSSSA9PT0gU1ZHX05BTUVTUEFDRSkgewogICAgICAgICAgcmV0dXJuIHRhZ05hbWUgPT09ICdtYXRoJyAmJiBIVE1MX0lOVEVHUkFUSU9OX1BPSU5UU1twYXJlbnRUYWdOYW1lXTsKICAgICAgICB9IC8vIFdlIG9ubHkgYWxsb3cgZWxlbWVudHMgdGhhdCBhcmUgZGVmaW5lZCBpbiBNYXRoTUwKICAgICAgICAvLyBzcGVjLiBBbGwgb3RoZXJzIGFyZSBkaXNhbGxvd2VkIGluIE1hdGhNTCBuYW1lc3BhY2UuCgoKICAgICAgICByZXR1cm4gQm9vbGVhbihBTExfTUFUSE1MX1RBR1NbdGFnTmFtZV0pOwogICAgICB9CgogICAgICBpZiAoZWxlbWVudC5uYW1lc3BhY2VVUkkgPT09IEhUTUxfTkFNRVNQQUNFKSB7CiAgICAgICAgLy8gVGhlIG9ubHkgd2F5IHRvIHN3aXRjaCBmcm9tIFNWRyB0byBIVE1MIGlzIHZpYQogICAgICAgIC8vIEhUTUwgaW50ZWdyYXRpb24gcG9pbnRzLCBhbmQgZnJvbSBNYXRoTUwgdG8gSFRNTAogICAgICAgIC8vIGlzIHZpYSBNYXRoTUwgdGV4dCBpbnRlZ3JhdGlvbiBwb2ludHMKICAgICAgICBpZiAocGFyZW50Lm5hbWVzcGFjZVVSSSA9PT0gU1ZHX05BTUVTUEFDRSAmJiAhSFRNTF9JTlRFR1JBVElPTl9QT0lOVFNbcGFyZW50VGFnTmFtZV0pIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIGlmIChwYXJlbnQubmFtZXNwYWNlVVJJID09PSBNQVRITUxfTkFNRVNQQUNFICYmICFNQVRITUxfVEVYVF9JTlRFR1JBVElPTl9QT0lOVFNbcGFyZW50VGFnTmFtZV0pIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9IC8vIFdlIGRpc2FsbG93IHRhZ3MgdGhhdCBhcmUgc3BlY2lmaWMgZm9yIE1hdGhNTAogICAgICAgIC8vIG9yIFNWRyBhbmQgc2hvdWxkIG5ldmVyIGFwcGVhciBpbiBIVE1MIG5hbWVzcGFjZQoKCiAgICAgICAgcmV0dXJuICFBTExfTUFUSE1MX1RBR1NbdGFnTmFtZV0gJiYgKENPTU1PTl9TVkdfQU5EX0hUTUxfRUxFTUVOVFNbdGFnTmFtZV0gfHwgIUFMTF9TVkdfVEFHU1t0YWdOYW1lXSk7CiAgICAgIH0gLy8gRm9yIFhIVE1MIGFuZCBYTUwgZG9jdW1lbnRzIHRoYXQgc3VwcG9ydCBjdXN0b20gbmFtZXNwYWNlcwoKCiAgICAgIGlmIChQQVJTRVJfTUVESUFfVFlQRSA9PT0gJ2FwcGxpY2F0aW9uL3hodG1sK3htbCcgJiYgQUxMT1dFRF9OQU1FU1BBQ0VTW2VsZW1lbnQubmFtZXNwYWNlVVJJXSkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9IC8vIFRoZSBjb2RlIHNob3VsZCBuZXZlciByZWFjaCB0aGlzIHBsYWNlICh0aGlzIG1lYW5zCiAgICAgIC8vIHRoYXQgdGhlIGVsZW1lbnQgc29tZWhvdyBnb3QgbmFtZXNwYWNlIHRoYXQgaXMgbm90CiAgICAgIC8vIEhUTUwsIFNWRywgTWF0aE1MIG9yIGFsbG93ZWQgdmlhIEFMTE9XRURfTkFNRVNQQUNFUykuCiAgICAgIC8vIFJldHVybiBmYWxzZSBqdXN0IGluIGNhc2UuCgoKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfTsKICAgIC8qKgogICAgICogX2ZvcmNlUmVtb3ZlCiAgICAgKgogICAgICogQHBhcmFtICB7Tm9kZX0gbm9kZSBhIERPTSBub2RlCiAgICAgKi8KCgogICAgY29uc3QgX2ZvcmNlUmVtb3ZlID0gZnVuY3Rpb24gX2ZvcmNlUmVtb3ZlKG5vZGUpIHsKICAgICAgYXJyYXlQdXNoKERPTVB1cmlmeS5yZW1vdmVkLCB7CiAgICAgICAgZWxlbWVudDogbm9kZQogICAgICB9KTsKCiAgICAgIHRyeSB7CiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHVuaWNvcm4vcHJlZmVyLWRvbS1ub2RlLXJlbW92ZQogICAgICAgIG5vZGUucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChub2RlKTsKICAgICAgfSBjYXRjaCAoXykgewogICAgICAgIG5vZGUucmVtb3ZlKCk7CiAgICAgIH0KICAgIH07CiAgICAvKioKICAgICAqIF9yZW1vdmVBdHRyaWJ1dGUKICAgICAqCiAgICAgKiBAcGFyYW0gIHtTdHJpbmd9IG5hbWUgYW4gQXR0cmlidXRlIG5hbWUKICAgICAqIEBwYXJhbSAge05vZGV9IG5vZGUgYSBET00gbm9kZQogICAgICovCgoKICAgIGNvbnN0IF9yZW1vdmVBdHRyaWJ1dGUgPSBmdW5jdGlvbiBfcmVtb3ZlQXR0cmlidXRlKG5hbWUsIG5vZGUpIHsKICAgICAgdHJ5IHsKICAgICAgICBhcnJheVB1c2goRE9NUHVyaWZ5LnJlbW92ZWQsIHsKICAgICAgICAgIGF0dHJpYnV0ZTogbm9kZS5nZXRBdHRyaWJ1dGVOb2RlKG5hbWUpLAogICAgICAgICAgZnJvbTogbm9kZQogICAgICAgIH0pOwogICAgICB9IGNhdGNoIChfKSB7CiAgICAgICAgYXJyYXlQdXNoKERPTVB1cmlmeS5yZW1vdmVkLCB7CiAgICAgICAgICBhdHRyaWJ1dGU6IG51bGwsCiAgICAgICAgICBmcm9tOiBub2RlCiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIG5vZGUucmVtb3ZlQXR0cmlidXRlKG5hbWUpOyAvLyBXZSB2b2lkIGF0dHJpYnV0ZSB2YWx1ZXMgZm9yIHVucmVtb3ZhYmxlICJpcyIiIGF0dHJpYnV0ZXMKCiAgICAgIGlmIChuYW1lID09PSAnaXMnICYmICFBTExPV0VEX0FUVFJbbmFtZV0pIHsKICAgICAgICBpZiAoUkVUVVJOX0RPTSB8fCBSRVRVUk5fRE9NX0ZSQUdNRU5UKSB7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICBfZm9yY2VSZW1vdmUobm9kZSk7CiAgICAgICAgICB9IGNhdGNoIChfKSB7IH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgbm9kZS5zZXRBdHRyaWJ1dGUobmFtZSwgJycpOwogICAgICAgICAgfSBjYXRjaCAoXykgeyB9CiAgICAgICAgfQogICAgICB9CiAgICB9OwogICAgLyoqCiAgICAgKiBfaW5pdERvY3VtZW50CiAgICAgKgogICAgICogQHBhcmFtICB7U3RyaW5nfSBkaXJ0eSBhIHN0cmluZyBvZiBkaXJ0eSBtYXJrdXAKICAgICAqIEByZXR1cm4ge0RvY3VtZW50fSBhIERPTSwgZmlsbGVkIHdpdGggdGhlIGRpcnR5IG1hcmt1cAogICAgICovCgoKICAgIGNvbnN0IF9pbml0RG9jdW1lbnQgPSBmdW5jdGlvbiBfaW5pdERvY3VtZW50KGRpcnR5KSB7CiAgICAgIC8qIENyZWF0ZSBhIEhUTUwgZG9jdW1lbnQgKi8KICAgICAgbGV0IGRvYzsKICAgICAgbGV0IGxlYWRpbmdXaGl0ZXNwYWNlOwoKICAgICAgaWYgKEZPUkNFX0JPRFkpIHsKICAgICAgICBkaXJ0eSA9ICc8cmVtb3ZlPjwvcmVtb3ZlPicgKyBkaXJ0eTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvKiBJZiBGT1JDRV9CT0RZIGlzbid0IHVzZWQsIGxlYWRpbmcgd2hpdGVzcGFjZSBuZWVkcyB0byBiZSBwcmVzZXJ2ZWQgbWFudWFsbHkgKi8KICAgICAgICBjb25zdCBtYXRjaGVzID0gc3RyaW5nTWF0Y2goZGlydHksIC9eW1xyXG5cdCBdKy8pOwogICAgICAgIGxlYWRpbmdXaGl0ZXNwYWNlID0gbWF0Y2hlcyAmJiBtYXRjaGVzWzBdOwogICAgICB9CgogICAgICBpZiAoUEFSU0VSX01FRElBX1RZUEUgPT09ICdhcHBsaWNhdGlvbi94aHRtbCt4bWwnICYmIE5BTUVTUEFDRSA9PT0gSFRNTF9OQU1FU1BBQ0UpIHsKICAgICAgICAvLyBSb290IG9mIFhIVE1MIGRvYyBtdXN0IGNvbnRhaW4geG1sbnMgZGVjbGFyYXRpb24gKHNlZSBodHRwczovL3d3dy53My5vcmcvVFIveGh0bWwxL25vcm1hdGl2ZS5odG1sI3N0cmljdCkKICAgICAgICBkaXJ0eSA9ICc8aHRtbCB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCI+PGhlYWQ+PC9oZWFkPjxib2R5PicgKyBkaXJ0eSArICc8L2JvZHk+PC9odG1sPic7CiAgICAgIH0KCiAgICAgIGNvbnN0IGRpcnR5UGF5bG9hZCA9IHRydXN0ZWRUeXBlc1BvbGljeSA/IHRydXN0ZWRUeXBlc1BvbGljeS5jcmVhdGVIVE1MKGRpcnR5KSA6IGRpcnR5OwogICAgICAvKgogICAgICAgKiBVc2UgdGhlIERPTVBhcnNlciBBUEkgYnkgZGVmYXVsdCwgZmFsbGJhY2sgbGF0ZXIgaWYgbmVlZHMgYmUKICAgICAgICogRE9NUGFyc2VyIG5vdCB3b3JrIGZvciBzdmcgd2hlbiBoYXMgbXVsdGlwbGUgcm9vdCBlbGVtZW50LgogICAgICAgKi8KCiAgICAgIGlmIChOQU1FU1BBQ0UgPT09IEhUTUxfTkFNRVNQQUNFKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGRvYyA9IG5ldyBET01QYXJzZXIoKS5wYXJzZUZyb21TdHJpbmcoZGlydHlQYXlsb2FkLCBQQVJTRVJfTUVESUFfVFlQRSk7CiAgICAgICAgfSBjYXRjaCAoXykgeyB9CiAgICAgIH0KICAgICAgLyogVXNlIGNyZWF0ZUhUTUxEb2N1bWVudCBpbiBjYXNlIERPTVBhcnNlciBpcyBub3QgYXZhaWxhYmxlICovCgoKICAgICAgaWYgKCFkb2MgfHwgIWRvYy5kb2N1bWVudEVsZW1lbnQpIHsKICAgICAgICBkb2MgPSBpbXBsZW1lbnRhdGlvbi5jcmVhdGVEb2N1bWVudChOQU1FU1BBQ0UsICd0ZW1wbGF0ZScsIG51bGwpOwoKICAgICAgICB0cnkgewogICAgICAgICAgZG9jLmRvY3VtZW50RWxlbWVudC5pbm5lckhUTUwgPSBJU19FTVBUWV9JTlBVVCA/IGVtcHR5SFRNTCA6IGRpcnR5UGF5bG9hZDsKICAgICAgICB9IGNhdGNoIChfKSB7Ly8gU3ludGF4IGVycm9yIGlmIGRpcnR5UGF5bG9hZCBpcyBpbnZhbGlkIHhtbAogICAgICAgIH0KICAgICAgfQoKICAgICAgY29uc3QgYm9keSA9IGRvYy5ib2R5IHx8IGRvYy5kb2N1bWVudEVsZW1lbnQ7CgogICAgICBpZiAoZGlydHkgJiYgbGVhZGluZ1doaXRlc3BhY2UpIHsKICAgICAgICBib2R5Lmluc2VydEJlZm9yZShkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShsZWFkaW5nV2hpdGVzcGFjZSksIGJvZHkuY2hpbGROb2Rlc1swXSB8fCBudWxsKTsKICAgICAgfQogICAgICAvKiBXb3JrIG9uIHdob2xlIGRvY3VtZW50IG9yIGp1c3QgaXRzIGJvZHkgKi8KCgogICAgICBpZiAoTkFNRVNQQUNFID09PSBIVE1MX05BTUVTUEFDRSkgewogICAgICAgIHJldHVybiBnZXRFbGVtZW50c0J5VGFnTmFtZS5jYWxsKGRvYywgV0hPTEVfRE9DVU1FTlQgPyAnaHRtbCcgOiAnYm9keScpWzBdOwogICAgICB9CgogICAgICByZXR1cm4gV0hPTEVfRE9DVU1FTlQgPyBkb2MuZG9jdW1lbnRFbGVtZW50IDogYm9keTsKICAgIH07CiAgICAvKioKICAgICAqIF9jcmVhdGVJdGVyYXRvcgogICAgICoKICAgICAqIEBwYXJhbSAge0RvY3VtZW50fSByb290IGRvY3VtZW50L2ZyYWdtZW50IHRvIGNyZWF0ZSBpdGVyYXRvciBmb3IKICAgICAqIEByZXR1cm4ge0l0ZXJhdG9yfSBpdGVyYXRvciBpbnN0YW5jZQogICAgICovCgoKICAgIGNvbnN0IF9jcmVhdGVJdGVyYXRvciA9IGZ1bmN0aW9uIF9jcmVhdGVJdGVyYXRvcihyb290KSB7CiAgICAgIHJldHVybiBjcmVhdGVOb2RlSXRlcmF0b3IuY2FsbChyb290Lm93bmVyRG9jdW1lbnQgfHwgcm9vdCwgcm9vdCwgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWJpdHdpc2UKICAgICAgICBOb2RlRmlsdGVyLlNIT1dfRUxFTUVOVCB8IE5vZGVGaWx0ZXIuU0hPV19DT01NRU5UIHwgTm9kZUZpbHRlci5TSE9XX1RFWFQsIG51bGwsIGZhbHNlKTsKICAgIH07CiAgICAvKioKICAgICAqIF9pc0Nsb2JiZXJlZAogICAgICoKICAgICAqIEBwYXJhbSAge05vZGV9IGVsbSBlbGVtZW50IHRvIGNoZWNrIGZvciBjbG9iYmVyaW5nIGF0dGFja3MKICAgICAqIEByZXR1cm4ge0Jvb2xlYW59IHRydWUgaWYgY2xvYmJlcmVkLCBmYWxzZSBpZiBzYWZlCiAgICAgKi8KCgogICAgY29uc3QgX2lzQ2xvYmJlcmVkID0gZnVuY3Rpb24gX2lzQ2xvYmJlcmVkKGVsbSkgewogICAgICByZXR1cm4gZWxtIGluc3RhbmNlb2YgSFRNTEZvcm1FbGVtZW50ICYmICh0eXBlb2YgZWxtLm5vZGVOYW1lICE9PSAnc3RyaW5nJyB8fCB0eXBlb2YgZWxtLnRleHRDb250ZW50ICE9PSAnc3RyaW5nJyB8fCB0eXBlb2YgZWxtLnJlbW92ZUNoaWxkICE9PSAnZnVuY3Rpb24nIHx8ICEoZWxtLmF0dHJpYnV0ZXMgaW5zdGFuY2VvZiBOYW1lZE5vZGVNYXApIHx8IHR5cGVvZiBlbG0ucmVtb3ZlQXR0cmlidXRlICE9PSAnZnVuY3Rpb24nIHx8IHR5cGVvZiBlbG0uc2V0QXR0cmlidXRlICE9PSAnZnVuY3Rpb24nIHx8IHR5cGVvZiBlbG0ubmFtZXNwYWNlVVJJICE9PSAnc3RyaW5nJyB8fCB0eXBlb2YgZWxtLmluc2VydEJlZm9yZSAhPT0gJ2Z1bmN0aW9uJyB8fCB0eXBlb2YgZWxtLmhhc0NoaWxkTm9kZXMgIT09ICdmdW5jdGlvbicpOwogICAgfTsKICAgIC8qKgogICAgICogX2lzTm9kZQogICAgICoKICAgICAqIEBwYXJhbSAge05vZGV9IG9iaiBvYmplY3QgdG8gY2hlY2sgd2hldGhlciBpdCdzIGEgRE9NIG5vZGUKICAgICAqIEByZXR1cm4ge0Jvb2xlYW59IHRydWUgaXMgb2JqZWN0IGlzIGEgRE9NIG5vZGUKICAgICAqLwoKCiAgICBjb25zdCBfaXNOb2RlID0gZnVuY3Rpb24gX2lzTm9kZShvYmplY3QpIHsKICAgICAgcmV0dXJuIHR5cGVvZiBOb2RlID09PSAnb2JqZWN0JyA/IG9iamVjdCBpbnN0YW5jZW9mIE5vZGUgOiBvYmplY3QgJiYgdHlwZW9mIG9iamVjdCA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG9iamVjdC5ub2RlVHlwZSA9PT0gJ251bWJlcicgJiYgdHlwZW9mIG9iamVjdC5ub2RlTmFtZSA9PT0gJ3N0cmluZyc7CiAgICB9OwogICAgLyoqCiAgICAgKiBfZXhlY3V0ZUhvb2sKICAgICAqIEV4ZWN1dGUgdXNlciBjb25maWd1cmFibGUgaG9va3MKICAgICAqCiAgICAgKiBAcGFyYW0gIHtTdHJpbmd9IGVudHJ5UG9pbnQgIE5hbWUgb2YgdGhlIGhvb2sncyBlbnRyeSBwb2ludAogICAgICogQHBhcmFtICB7Tm9kZX0gY3VycmVudE5vZGUgbm9kZSB0byB3b3JrIG9uIHdpdGggdGhlIGhvb2sKICAgICAqIEBwYXJhbSAge09iamVjdH0gZGF0YSBhZGRpdGlvbmFsIGhvb2sgcGFyYW1ldGVycwogICAgICovCgoKICAgIGNvbnN0IF9leGVjdXRlSG9vayA9IGZ1bmN0aW9uIF9leGVjdXRlSG9vayhlbnRyeVBvaW50LCBjdXJyZW50Tm9kZSwgZGF0YSkgewogICAgICBpZiAoIWhvb2tzW2VudHJ5UG9pbnRdKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBhcnJheUZvckVhY2goaG9va3NbZW50cnlQb2ludF0sIGhvb2sgPT4gewogICAgICAgIGhvb2suY2FsbChET01QdXJpZnksIGN1cnJlbnROb2RlLCBkYXRhLCBDT05GSUcpOwogICAgICB9KTsKICAgIH07CiAgICAvKioKICAgICAqIF9zYW5pdGl6ZUVsZW1lbnRzCiAgICAgKgogICAgICogQHByb3RlY3Qgbm9kZU5hbWUKICAgICAqIEBwcm90ZWN0IHRleHRDb250ZW50CiAgICAgKiBAcHJvdGVjdCByZW1vdmVDaGlsZAogICAgICoKICAgICAqIEBwYXJhbSAgIHtOb2RlfSBjdXJyZW50Tm9kZSB0byBjaGVjayBmb3IgcGVybWlzc2lvbiB0byBleGlzdAogICAgICogQHJldHVybiAge0Jvb2xlYW59IHRydWUgaWYgbm9kZSB3YXMga2lsbGVkLCBmYWxzZSBpZiBsZWZ0IGFsaXZlCiAgICAgKi8KCgogICAgY29uc3QgX3Nhbml0aXplRWxlbWVudHMgPSBmdW5jdGlvbiBfc2FuaXRpemVFbGVtZW50cyhjdXJyZW50Tm9kZSkgewogICAgICBsZXQgY29udGVudDsKICAgICAgLyogRXhlY3V0ZSBhIGhvb2sgaWYgcHJlc2VudCAqLwoKICAgICAgX2V4ZWN1dGVIb29rKCdiZWZvcmVTYW5pdGl6ZUVsZW1lbnRzJywgY3VycmVudE5vZGUsIG51bGwpOwogICAgICAvKiBDaGVjayBpZiBlbGVtZW50IGlzIGNsb2JiZXJlZCBvciBjYW4gY2xvYmJlciAqLwoKCiAgICAgIGlmIChfaXNDbG9iYmVyZWQoY3VycmVudE5vZGUpKSB7CiAgICAgICAgX2ZvcmNlUmVtb3ZlKGN1cnJlbnROb2RlKTsKCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgLyogTm93IGxldCdzIGNoZWNrIHRoZSBlbGVtZW50J3MgdHlwZSBhbmQgbmFtZSAqLwoKCiAgICAgIGNvbnN0IHRhZ05hbWUgPSB0cmFuc2Zvcm1DYXNlRnVuYyhjdXJyZW50Tm9kZS5ub2RlTmFtZSk7CiAgICAgIC8qIEV4ZWN1dGUgYSBob29rIGlmIHByZXNlbnQgKi8KCiAgICAgIF9leGVjdXRlSG9vaygndXBvblNhbml0aXplRWxlbWVudCcsIGN1cnJlbnROb2RlLCB7CiAgICAgICAgdGFnTmFtZSwKICAgICAgICBhbGxvd2VkVGFnczogQUxMT1dFRF9UQUdTCiAgICAgIH0pOwogICAgICAvKiBEZXRlY3QgbVhTUyBhdHRlbXB0cyBhYnVzaW5nIG5hbWVzcGFjZSBjb25mdXNpb24gKi8KCgogICAgICBpZiAoY3VycmVudE5vZGUuaGFzQ2hpbGROb2RlcygpICYmICFfaXNOb2RlKGN1cnJlbnROb2RlLmZpcnN0RWxlbWVudENoaWxkKSAmJiAoIV9pc05vZGUoY3VycmVudE5vZGUuY29udGVudCkgfHwgIV9pc05vZGUoY3VycmVudE5vZGUuY29udGVudC5maXJzdEVsZW1lbnRDaGlsZCkpICYmIHJlZ0V4cFRlc3QoLzxbL1x3XS9nLCBjdXJyZW50Tm9kZS5pbm5lckhUTUwpICYmIHJlZ0V4cFRlc3QoLzxbL1x3XS9nLCBjdXJyZW50Tm9kZS50ZXh0Q29udGVudCkpIHsKICAgICAgICBfZm9yY2VSZW1vdmUoY3VycmVudE5vZGUpOwoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICAvKiBSZW1vdmUgZWxlbWVudCBpZiBhbnl0aGluZyBmb3JiaWRzIGl0cyBwcmVzZW5jZSAqLwoKCiAgICAgIGlmICghQUxMT1dFRF9UQUdTW3RhZ05hbWVdIHx8IEZPUkJJRF9UQUdTW3RhZ05hbWVdKSB7CiAgICAgICAgLyogQ2hlY2sgaWYgd2UgaGF2ZSBhIGN1c3RvbSBlbGVtZW50IHRvIGhhbmRsZSAqLwogICAgICAgIGlmICghRk9SQklEX1RBR1NbdGFnTmFtZV0gJiYgX2Jhc2ljQ3VzdG9tRWxlbWVudFRlc3QodGFnTmFtZSkpIHsKICAgICAgICAgIGlmIChDVVNUT01fRUxFTUVOVF9IQU5ETElORy50YWdOYW1lQ2hlY2sgaW5zdGFuY2VvZiBSZWdFeHAgJiYgcmVnRXhwVGVzdChDVVNUT01fRUxFTUVOVF9IQU5ETElORy50YWdOYW1lQ2hlY2ssIHRhZ05hbWUpKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICBpZiAoQ1VTVE9NX0VMRU1FTlRfSEFORExJTkcudGFnTmFtZUNoZWNrIGluc3RhbmNlb2YgRnVuY3Rpb24gJiYgQ1VTVE9NX0VMRU1FTlRfSEFORExJTkcudGFnTmFtZUNoZWNrKHRhZ05hbWUpKSByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIC8qIEtlZXAgY29udGVudCBleGNlcHQgZm9yIGJhZC1saXN0ZWQgZWxlbWVudHMgKi8KCgogICAgICAgIGlmIChLRUVQX0NPTlRFTlQgJiYgIUZPUkJJRF9DT05URU5UU1t0YWdOYW1lXSkgewogICAgICAgICAgY29uc3QgcGFyZW50Tm9kZSA9IGdldFBhcmVudE5vZGUoY3VycmVudE5vZGUpIHx8IGN1cnJlbnROb2RlLnBhcmVudE5vZGU7CiAgICAgICAgICBjb25zdCBjaGlsZE5vZGVzID0gZ2V0Q2hpbGROb2RlcyhjdXJyZW50Tm9kZSkgfHwgY3VycmVudE5vZGUuY2hpbGROb2RlczsKCiAgICAgICAgICBpZiAoY2hpbGROb2RlcyAmJiBwYXJlbnROb2RlKSB7CiAgICAgICAgICAgIGNvbnN0IGNoaWxkQ291bnQgPSBjaGlsZE5vZGVzLmxlbmd0aDsKCiAgICAgICAgICAgIGZvciAobGV0IGkgPSBjaGlsZENvdW50IC0gMTsgaSA+PSAwOyAtLWkpIHsKICAgICAgICAgICAgICBwYXJlbnROb2RlLmluc2VydEJlZm9yZShjbG9uZU5vZGUoY2hpbGROb2Rlc1tpXSwgdHJ1ZSksIGdldE5leHRTaWJsaW5nKGN1cnJlbnROb2RlKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIF9mb3JjZVJlbW92ZShjdXJyZW50Tm9kZSk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIC8qIENoZWNrIHdoZXRoZXIgZWxlbWVudCBoYXMgYSB2YWxpZCBuYW1lc3BhY2UgKi8KCgogICAgICBpZiAoY3VycmVudE5vZGUgaW5zdGFuY2VvZiBFbGVtZW50ICYmICFfY2hlY2tWYWxpZE5hbWVzcGFjZShjdXJyZW50Tm9kZSkpIHsKICAgICAgICBfZm9yY2VSZW1vdmUoY3VycmVudE5vZGUpOwoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICAvKiBNYWtlIHN1cmUgdGhhdCBvbGRlciBicm93c2VycyBkb24ndCBnZXQgbm9zY3JpcHQgbVhTUyAqLwoKCiAgICAgIGlmICgodGFnTmFtZSA9PT0gJ25vc2NyaXB0JyB8fCB0YWdOYW1lID09PSAnbm9lbWJlZCcpICYmIHJlZ0V4cFRlc3QoLzxcL25vKHNjcmlwdHxlbWJlZCkvaSwgY3VycmVudE5vZGUuaW5uZXJIVE1MKSkgewogICAgICAgIF9mb3JjZVJlbW92ZShjdXJyZW50Tm9kZSk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIC8qIFNhbml0aXplIGVsZW1lbnQgY29udGVudCB0byBiZSB0ZW1wbGF0ZS1zYWZlICovCgoKICAgICAgaWYgKFNBRkVfRk9SX1RFTVBMQVRFUyAmJiBjdXJyZW50Tm9kZS5ub2RlVHlwZSA9PT0gMykgewogICAgICAgIC8qIEdldCB0aGUgZWxlbWVudCdzIHRleHQgY29udGVudCAqLwogICAgICAgIGNvbnRlbnQgPSBjdXJyZW50Tm9kZS50ZXh0Q29udGVudDsKICAgICAgICBjb250ZW50ID0gc3RyaW5nUmVwbGFjZShjb250ZW50LCBNVVNUQUNIRV9FWFBSLCAnICcpOwogICAgICAgIGNvbnRlbnQgPSBzdHJpbmdSZXBsYWNlKGNvbnRlbnQsIEVSQl9FWFBSLCAnICcpOwogICAgICAgIGNvbnRlbnQgPSBzdHJpbmdSZXBsYWNlKGNvbnRlbnQsIFRNUExJVF9FWFBSLCAnICcpOwoKICAgICAgICBpZiAoY3VycmVudE5vZGUudGV4dENvbnRlbnQgIT09IGNvbnRlbnQpIHsKICAgICAgICAgIGFycmF5UHVzaChET01QdXJpZnkucmVtb3ZlZCwgewogICAgICAgICAgICBlbGVtZW50OiBjdXJyZW50Tm9kZS5jbG9uZU5vZGUoKQogICAgICAgICAgfSk7CiAgICAgICAgICBjdXJyZW50Tm9kZS50ZXh0Q29udGVudCA9IGNvbnRlbnQ7CiAgICAgICAgfQogICAgICB9CiAgICAgIC8qIEV4ZWN1dGUgYSBob29rIGlmIHByZXNlbnQgKi8KCgogICAgICBfZXhlY3V0ZUhvb2soJ2FmdGVyU2FuaXRpemVFbGVtZW50cycsIGN1cnJlbnROb2RlLCBudWxsKTsKCiAgICAgIHJldHVybiBmYWxzZTsKICAgIH07CiAgICAvKioKICAgICAqIF9pc1ZhbGlkQXR0cmlidXRlCiAgICAgKgogICAgICogQHBhcmFtICB7c3RyaW5nfSBsY1RhZyBMb3dlcmNhc2UgdGFnIG5hbWUgb2YgY29udGFpbmluZyBlbGVtZW50LgogICAgICogQHBhcmFtICB7c3RyaW5nfSBsY05hbWUgTG93ZXJjYXNlIGF0dHJpYnV0ZSBuYW1lLgogICAgICogQHBhcmFtICB7c3RyaW5nfSB2YWx1ZSBBdHRyaWJ1dGUgdmFsdWUuCiAgICAgKiBAcmV0dXJuIHtCb29sZWFufSBSZXR1cm5zIHRydWUgaWYgYHZhbHVlYCBpcyB2YWxpZCwgb3RoZXJ3aXNlIGZhbHNlLgogICAgICovCiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgY29tcGxleGl0eQoKCiAgICBjb25zdCBfaXNWYWxpZEF0dHJpYnV0ZSA9IGZ1bmN0aW9uIF9pc1ZhbGlkQXR0cmlidXRlKGxjVGFnLCBsY05hbWUsIHZhbHVlKSB7CiAgICAgIC8qIE1ha2Ugc3VyZSBhdHRyaWJ1dGUgY2Fubm90IGNsb2JiZXIgKi8KICAgICAgaWYgKFNBTklUSVpFX0RPTSAmJiAobGNOYW1lID09PSAnaWQnIHx8IGxjTmFtZSA9PT0gJ25hbWUnKSAmJiAodmFsdWUgaW4gZG9jdW1lbnQgfHwgdmFsdWUgaW4gZm9ybUVsZW1lbnQpKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIC8qIEFsbG93IHZhbGlkIGRhdGEtKiBhdHRyaWJ1dGVzOiBBdCBsZWFzdCBvbmUgY2hhcmFjdGVyIGFmdGVyICItIgogICAgICAgICAgKGh0dHBzOi8vaHRtbC5zcGVjLndoYXR3Zy5vcmcvbXVsdGlwYWdlL2RvbS5odG1sI2VtYmVkZGluZy1jdXN0b20tbm9uLXZpc2libGUtZGF0YS13aXRoLXRoZS1kYXRhLSotYXR0cmlidXRlcykKICAgICAgICAgIFhNTC1jb21wYXRpYmxlIChodHRwczovL2h0bWwuc3BlYy53aGF0d2cub3JnL211bHRpcGFnZS9pbmZyYXN0cnVjdHVyZS5odG1sI3htbC1jb21wYXRpYmxlIGFuZCBodHRwOi8vd3d3LnczLm9yZy9UUi94bWwvI2QwZTgwNCkKICAgICAgICAgIFdlIGRvbid0IG5lZWQgdG8gY2hlY2sgdGhlIHZhbHVlOyBpdCdzIGFsd2F5cyBVUkkgc2FmZS4gKi8KCgogICAgICBpZiAoQUxMT1dfREFUQV9BVFRSICYmICFGT1JCSURfQVRUUltsY05hbWVdICYmIHJlZ0V4cFRlc3QoREFUQV9BVFRSLCBsY05hbWUpKTsgZWxzZSBpZiAoQUxMT1dfQVJJQV9BVFRSICYmIHJlZ0V4cFRlc3QoQVJJQV9BVFRSLCBsY05hbWUpKTsgZWxzZSBpZiAoIUFMTE9XRURfQVRUUltsY05hbWVdIHx8IEZPUkJJRF9BVFRSW2xjTmFtZV0pIHsKICAgICAgICBpZiAoIC8vIEZpcnN0IGNvbmRpdGlvbiBkb2VzIGEgdmVyeSBiYXNpYyBjaGVjayBpZiBhKSBpdCdzIGJhc2ljYWxseSBhIHZhbGlkIGN1c3RvbSBlbGVtZW50IHRhZ25hbWUgQU5ECiAgICAgICAgICAvLyBiKSBpZiB0aGUgdGFnTmFtZSBwYXNzZXMgd2hhdGV2ZXIgdGhlIHVzZXIgaGFzIGNvbmZpZ3VyZWQgZm9yIENVU1RPTV9FTEVNRU5UX0hBTkRMSU5HLnRhZ05hbWVDaGVjawogICAgICAgICAgLy8gYW5kIGMpIGlmIHRoZSBhdHRyaWJ1dGUgbmFtZSBwYXNzZXMgd2hhdGV2ZXIgdGhlIHVzZXIgaGFzIGNvbmZpZ3VyZWQgZm9yIENVU1RPTV9FTEVNRU5UX0hBTkRMSU5HLmF0dHJpYnV0ZU5hbWVDaGVjawogICAgICAgICAgX2Jhc2ljQ3VzdG9tRWxlbWVudFRlc3QobGNUYWcpICYmIChDVVNUT01fRUxFTUVOVF9IQU5ETElORy50YWdOYW1lQ2hlY2sgaW5zdGFuY2VvZiBSZWdFeHAgJiYgcmVnRXhwVGVzdChDVVNUT01fRUxFTUVOVF9IQU5ETElORy50YWdOYW1lQ2hlY2ssIGxjVGFnKSB8fCBDVVNUT01fRUxFTUVOVF9IQU5ETElORy50YWdOYW1lQ2hlY2sgaW5zdGFuY2VvZiBGdW5jdGlvbiAmJiBDVVNUT01fRUxFTUVOVF9IQU5ETElORy50YWdOYW1lQ2hlY2sobGNUYWcpKSAmJiAoQ1VTVE9NX0VMRU1FTlRfSEFORExJTkcuYXR0cmlidXRlTmFtZUNoZWNrIGluc3RhbmNlb2YgUmVnRXhwICYmIHJlZ0V4cFRlc3QoQ1VTVE9NX0VMRU1FTlRfSEFORExJTkcuYXR0cmlidXRlTmFtZUNoZWNrLCBsY05hbWUpIHx8IENVU1RPTV9FTEVNRU5UX0hBTkRMSU5HLmF0dHJpYnV0ZU5hbWVDaGVjayBpbnN0YW5jZW9mIEZ1bmN0aW9uICYmIENVU1RPTV9FTEVNRU5UX0hBTkRMSU5HLmF0dHJpYnV0ZU5hbWVDaGVjayhsY05hbWUpKSB8fCAvLyBBbHRlcm5hdGl2ZSwgc2Vjb25kIGNvbmRpdGlvbiBjaGVja3MgaWYgaXQncyBhbiBgaXNgLWF0dHJpYnV0ZSwgQU5ECiAgICAgICAgICAvLyB0aGUgdmFsdWUgcGFzc2VzIHdoYXRldmVyIHRoZSB1c2VyIGhhcyBjb25maWd1cmVkIGZvciBDVVNUT01fRUxFTUVOVF9IQU5ETElORy50YWdOYW1lQ2hlY2sKICAgICAgICAgIGxjTmFtZSA9PT0gJ2lzJyAmJiBDVVNUT01fRUxFTUVOVF9IQU5ETElORy5hbGxvd0N1c3RvbWl6ZWRCdWlsdEluRWxlbWVudHMgJiYgKENVU1RPTV9FTEVNRU5UX0hBTkRMSU5HLnRhZ05hbWVDaGVjayBpbnN0YW5jZW9mIFJlZ0V4cCAmJiByZWdFeHBUZXN0KENVU1RPTV9FTEVNRU5UX0hBTkRMSU5HLnRhZ05hbWVDaGVjaywgdmFsdWUpIHx8IENVU1RPTV9FTEVNRU5UX0hBTkRMSU5HLnRhZ05hbWVDaGVjayBpbnN0YW5jZW9mIEZ1bmN0aW9uICYmIENVU1RPTV9FTEVNRU5UX0hBTkRMSU5HLnRhZ05hbWVDaGVjayh2YWx1ZSkpKTsgZWxzZSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIC8qIENoZWNrIHZhbHVlIGlzIHNhZmUuIEZpcnN0LCBpcyBhdHRyIGluZXJ0PyBJZiBzbywgaXMgc2FmZSAqLwoKICAgICAgfSBlbHNlIGlmIChVUklfU0FGRV9BVFRSSUJVVEVTW2xjTmFtZV0pOyBlbHNlIGlmIChyZWdFeHBUZXN0KElTX0FMTE9XRURfVVJJJDEsIHN0cmluZ1JlcGxhY2UodmFsdWUsIEFUVFJfV0hJVEVTUEFDRSwgJycpKSk7IGVsc2UgaWYgKChsY05hbWUgPT09ICdzcmMnIHx8IGxjTmFtZSA9PT0gJ3hsaW5rOmhyZWYnIHx8IGxjTmFtZSA9PT0gJ2hyZWYnKSAmJiBsY1RhZyAhPT0gJ3NjcmlwdCcgJiYgc3RyaW5nSW5kZXhPZih2YWx1ZSwgJ2RhdGE6JykgPT09IDAgJiYgREFUQV9VUklfVEFHU1tsY1RhZ10pOyBlbHNlIGlmIChBTExPV19VTktOT1dOX1BST1RPQ09MUyAmJiAhcmVnRXhwVGVzdChJU19TQ1JJUFRfT1JfREFUQSwgc3RyaW5nUmVwbGFjZSh2YWx1ZSwgQVRUUl9XSElURVNQQUNFLCAnJykpKTsgZWxzZSBpZiAodmFsdWUpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0gZWxzZTsKCiAgICAgIHJldHVybiB0cnVlOwogICAgfTsKICAgIC8qKgogICAgICogX2Jhc2ljQ3VzdG9tRWxlbWVudENoZWNrCiAgICAgKiBjaGVja3MgaWYgYXQgbGVhc3Qgb25lIGRhc2ggaXMgaW5jbHVkZWQgaW4gdGFnTmFtZSwgYW5kIGl0J3Mgbm90IHRoZSBmaXJzdCBjaGFyCiAgICAgKiBmb3IgbW9yZSBzb3BoaXN0aWNhdGVkIGNoZWNraW5nIHNlZSBodHRwczovL2dpdGh1Yi5jb20vc2luZHJlc29yaHVzL3ZhbGlkYXRlLWVsZW1lbnQtbmFtZQogICAgICogQHBhcmFtIHtzdHJpbmd9IHRhZ05hbWUgbmFtZSBvZiB0aGUgdGFnIG9mIHRoZSBub2RlIHRvIHNhbml0aXplCiAgICAgKi8KCgogICAgY29uc3QgX2Jhc2ljQ3VzdG9tRWxlbWVudFRlc3QgPSBmdW5jdGlvbiBfYmFzaWNDdXN0b21FbGVtZW50VGVzdCh0YWdOYW1lKSB7CiAgICAgIHJldHVybiB0YWdOYW1lLmluZGV4T2YoJy0nKSA+IDA7CiAgICB9OwogICAgLyoqCiAgICAgKiBfc2FuaXRpemVBdHRyaWJ1dGVzCiAgICAgKgogICAgICogQHByb3RlY3QgYXR0cmlidXRlcwogICAgICogQHByb3RlY3Qgbm9kZU5hbWUKICAgICAqIEBwcm90ZWN0IHJlbW92ZUF0dHJpYnV0ZQogICAgICogQHByb3RlY3Qgc2V0QXR0cmlidXRlCiAgICAgKgogICAgICogQHBhcmFtICB7Tm9kZX0gY3VycmVudE5vZGUgdG8gc2FuaXRpemUKICAgICAqLwoKCiAgICBjb25zdCBfc2FuaXRpemVBdHRyaWJ1dGVzID0gZnVuY3Rpb24gX3Nhbml0aXplQXR0cmlidXRlcyhjdXJyZW50Tm9kZSkgewogICAgICBsZXQgYXR0cjsKICAgICAgbGV0IHZhbHVlOwogICAgICBsZXQgbGNOYW1lOwogICAgICBsZXQgbDsKICAgICAgLyogRXhlY3V0ZSBhIGhvb2sgaWYgcHJlc2VudCAqLwoKICAgICAgX2V4ZWN1dGVIb29rKCdiZWZvcmVTYW5pdGl6ZUF0dHJpYnV0ZXMnLCBjdXJyZW50Tm9kZSwgbnVsbCk7CgogICAgICBjb25zdCB7CiAgICAgICAgYXR0cmlidXRlcwogICAgICB9ID0gY3VycmVudE5vZGU7CiAgICAgIC8qIENoZWNrIGlmIHdlIGhhdmUgYXR0cmlidXRlczsgaWYgbm90IHdlIG1pZ2h0IGhhdmUgYSB0ZXh0IG5vZGUgKi8KCiAgICAgIGlmICghYXR0cmlidXRlcykgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3QgaG9va0V2ZW50ID0gewogICAgICAgIGF0dHJOYW1lOiAnJywKICAgICAgICBhdHRyVmFsdWU6ICcnLAogICAgICAgIGtlZXBBdHRyOiB0cnVlLAogICAgICAgIGFsbG93ZWRBdHRyaWJ1dGVzOiBBTExPV0VEX0FUVFIKICAgICAgfTsKICAgICAgbCA9IGF0dHJpYnV0ZXMubGVuZ3RoOwogICAgICAvKiBHbyBiYWNrd2FyZHMgb3ZlciBhbGwgYXR0cmlidXRlczsgc2FmZWx5IHJlbW92ZSBiYWQgb25lcyAqLwoKICAgICAgd2hpbGUgKGwtLSkgewogICAgICAgIGF0dHIgPSBhdHRyaWJ1dGVzW2xdOwogICAgICAgIGNvbnN0IHsKICAgICAgICAgIG5hbWUsCiAgICAgICAgICBuYW1lc3BhY2VVUkkKICAgICAgICB9ID0gYXR0cjsKICAgICAgICB2YWx1ZSA9IG5hbWUgPT09ICd2YWx1ZScgPyBhdHRyLnZhbHVlIDogc3RyaW5nVHJpbShhdHRyLnZhbHVlKTsKICAgICAgICBsY05hbWUgPSB0cmFuc2Zvcm1DYXNlRnVuYyhuYW1lKTsKICAgICAgICAvKiBFeGVjdXRlIGEgaG9vayBpZiBwcmVzZW50ICovCgogICAgICAgIGhvb2tFdmVudC5hdHRyTmFtZSA9IGxjTmFtZTsKICAgICAgICBob29rRXZlbnQuYXR0clZhbHVlID0gdmFsdWU7CiAgICAgICAgaG9va0V2ZW50LmtlZXBBdHRyID0gdHJ1ZTsKICAgICAgICBob29rRXZlbnQuZm9yY2VLZWVwQXR0ciA9IHVuZGVmaW5lZDsgLy8gQWxsb3dzIGRldmVsb3BlcnMgdG8gc2VlIHRoaXMgaXMgYSBwcm9wZXJ0eSB0aGV5IGNhbiBzZXQKCiAgICAgICAgX2V4ZWN1dGVIb29rKCd1cG9uU2FuaXRpemVBdHRyaWJ1dGUnLCBjdXJyZW50Tm9kZSwgaG9va0V2ZW50KTsKCiAgICAgICAgdmFsdWUgPSBob29rRXZlbnQuYXR0clZhbHVlOwogICAgICAgIC8qIERpZCB0aGUgaG9va3MgYXBwcm92ZSBvZiB0aGUgYXR0cmlidXRlPyAqLwoKICAgICAgICBpZiAoaG9va0V2ZW50LmZvcmNlS2VlcEF0dHIpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICAvKiBSZW1vdmUgYXR0cmlidXRlICovCgoKICAgICAgICBfcmVtb3ZlQXR0cmlidXRlKG5hbWUsIGN1cnJlbnROb2RlKTsKICAgICAgICAvKiBEaWQgdGhlIGhvb2tzIGFwcHJvdmUgb2YgdGhlIGF0dHJpYnV0ZT8gKi8KCgogICAgICAgIGlmICghaG9va0V2ZW50LmtlZXBBdHRyKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgLyogV29yayBhcm91bmQgYSBzZWN1cml0eSBpc3N1ZSBpbiBqUXVlcnkgMy4wICovCgoKICAgICAgICBpZiAoIUFMTE9XX1NFTEZfQ0xPU0VfSU5fQVRUUiAmJiByZWdFeHBUZXN0KC9cLz4vaSwgdmFsdWUpKSB7CiAgICAgICAgICBfcmVtb3ZlQXR0cmlidXRlKG5hbWUsIGN1cnJlbnROb2RlKTsKCiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgLyogU2FuaXRpemUgYXR0cmlidXRlIGNvbnRlbnQgdG8gYmUgdGVtcGxhdGUtc2FmZSAqLwoKCiAgICAgICAgaWYgKFNBRkVfRk9SX1RFTVBMQVRFUykgewogICAgICAgICAgdmFsdWUgPSBzdHJpbmdSZXBsYWNlKHZhbHVlLCBNVVNUQUNIRV9FWFBSLCAnICcpOwogICAgICAgICAgdmFsdWUgPSBzdHJpbmdSZXBsYWNlKHZhbHVlLCBFUkJfRVhQUiwgJyAnKTsKICAgICAgICAgIHZhbHVlID0gc3RyaW5nUmVwbGFjZSh2YWx1ZSwgVE1QTElUX0VYUFIsICcgJyk7CiAgICAgICAgfQogICAgICAgIC8qIElzIGB2YWx1ZWAgdmFsaWQgZm9yIHRoaXMgYXR0cmlidXRlPyAqLwoKCiAgICAgICAgY29uc3QgbGNUYWcgPSB0cmFuc2Zvcm1DYXNlRnVuYyhjdXJyZW50Tm9kZS5ub2RlTmFtZSk7CgogICAgICAgIGlmICghX2lzVmFsaWRBdHRyaWJ1dGUobGNUYWcsIGxjTmFtZSwgdmFsdWUpKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgLyogRnVsbCBET00gQ2xvYmJlcmluZyBwcm90ZWN0aW9uIHZpYSBuYW1lc3BhY2UgaXNvbGF0aW9uLAogICAgICAgICAqIFByZWZpeCBpZCBhbmQgbmFtZSBhdHRyaWJ1dGVzIHdpdGggYHVzZXItY29udGVudC1gCiAgICAgICAgICovCgoKICAgICAgICBpZiAoU0FOSVRJWkVfTkFNRURfUFJPUFMgJiYgKGxjTmFtZSA9PT0gJ2lkJyB8fCBsY05hbWUgPT09ICduYW1lJykpIHsKICAgICAgICAgIC8vIFJlbW92ZSB0aGUgYXR0cmlidXRlIHdpdGggdGhpcyB2YWx1ZQogICAgICAgICAgX3JlbW92ZUF0dHJpYnV0ZShuYW1lLCBjdXJyZW50Tm9kZSk7IC8vIFByZWZpeCB0aGUgdmFsdWUgYW5kIGxhdGVyIHJlLWNyZWF0ZSB0aGUgYXR0cmlidXRlIHdpdGggdGhlIHNhbml0aXplZCB2YWx1ZQoKCiAgICAgICAgICB2YWx1ZSA9IFNBTklUSVpFX05BTUVEX1BST1BTX1BSRUZJWCArIHZhbHVlOwogICAgICAgIH0KICAgICAgICAvKiBIYW5kbGUgYXR0cmlidXRlcyB0aGF0IHJlcXVpcmUgVHJ1c3RlZCBUeXBlcyAqLwoKCiAgICAgICAgaWYgKHRydXN0ZWRUeXBlc1BvbGljeSAmJiB0eXBlb2YgdHJ1c3RlZFR5cGVzID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgdHJ1c3RlZFR5cGVzLmdldEF0dHJpYnV0ZVR5cGUgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgIGlmIChuYW1lc3BhY2VVUkkpOyBlbHNlIHsKICAgICAgICAgICAgc3dpdGNoICh0cnVzdGVkVHlwZXMuZ2V0QXR0cmlidXRlVHlwZShsY1RhZywgbGNOYW1lKSkgewogICAgICAgICAgICAgIGNhc2UgJ1RydXN0ZWRIVE1MJzoKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgdmFsdWUgPSB0cnVzdGVkVHlwZXNQb2xpY3kuY3JlYXRlSFRNTCh2YWx1ZSk7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBjYXNlICdUcnVzdGVkU2NyaXB0VVJMJzoKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgdmFsdWUgPSB0cnVzdGVkVHlwZXNQb2xpY3kuY3JlYXRlU2NyaXB0VVJMKHZhbHVlKTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgLyogSGFuZGxlIGludmFsaWQgZGF0YS0qIGF0dHJpYnV0ZSBzZXQgYnkgdHJ5LWNhdGNoaW5nIGl0ICovCgoKICAgICAgICB0cnkgewogICAgICAgICAgaWYgKG5hbWVzcGFjZVVSSSkgewogICAgICAgICAgICBjdXJyZW50Tm9kZS5zZXRBdHRyaWJ1dGVOUyhuYW1lc3BhY2VVUkksIG5hbWUsIHZhbHVlKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8qIEZhbGxiYWNrIHRvIHNldEF0dHJpYnV0ZSgpIGZvciBicm93c2VyLXVucmVjb2duaXplZCBuYW1lc3BhY2VzIGUuZy4gIngtc2NoZW1hIi4gKi8KICAgICAgICAgICAgY3VycmVudE5vZGUuc2V0QXR0cmlidXRlKG5hbWUsIHZhbHVlKTsKICAgICAgICAgIH0KCiAgICAgICAgICBhcnJheVBvcChET01QdXJpZnkucmVtb3ZlZCk7CiAgICAgICAgfSBjYXRjaCAoXykgeyB9CiAgICAgIH0KICAgICAgLyogRXhlY3V0ZSBhIGhvb2sgaWYgcHJlc2VudCAqLwoKCiAgICAgIF9leGVjdXRlSG9vaygnYWZ0ZXJTYW5pdGl6ZUF0dHJpYnV0ZXMnLCBjdXJyZW50Tm9kZSwgbnVsbCk7CiAgICB9OwogICAgLyoqCiAgICAgKiBfc2FuaXRpemVTaGFkb3dET00KICAgICAqCiAgICAgKiBAcGFyYW0gIHtEb2N1bWVudEZyYWdtZW50fSBmcmFnbWVudCB0byBpdGVyYXRlIG92ZXIgcmVjdXJzaXZlbHkKICAgICAqLwoKCiAgICBjb25zdCBfc2FuaXRpemVTaGFkb3dET00gPSBmdW5jdGlvbiBfc2FuaXRpemVTaGFkb3dET00oZnJhZ21lbnQpIHsKICAgICAgbGV0IHNoYWRvd05vZGU7CgogICAgICBjb25zdCBzaGFkb3dJdGVyYXRvciA9IF9jcmVhdGVJdGVyYXRvcihmcmFnbWVudCk7CiAgICAgIC8qIEV4ZWN1dGUgYSBob29rIGlmIHByZXNlbnQgKi8KCgogICAgICBfZXhlY3V0ZUhvb2soJ2JlZm9yZVNhbml0aXplU2hhZG93RE9NJywgZnJhZ21lbnQsIG51bGwpOwoKICAgICAgd2hpbGUgKHNoYWRvd05vZGUgPSBzaGFkb3dJdGVyYXRvci5uZXh0Tm9kZSgpKSB7CiAgICAgICAgLyogRXhlY3V0ZSBhIGhvb2sgaWYgcHJlc2VudCAqLwogICAgICAgIF9leGVjdXRlSG9vaygndXBvblNhbml0aXplU2hhZG93Tm9kZScsIHNoYWRvd05vZGUsIG51bGwpOwogICAgICAgIC8qIFNhbml0aXplIHRhZ3MgYW5kIGVsZW1lbnRzICovCgoKICAgICAgICBpZiAoX3Nhbml0aXplRWxlbWVudHMoc2hhZG93Tm9kZSkpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICAvKiBEZWVwIHNoYWRvdyBET00gZGV0ZWN0ZWQgKi8KCgogICAgICAgIGlmIChzaGFkb3dOb2RlLmNvbnRlbnQgaW5zdGFuY2VvZiBEb2N1bWVudEZyYWdtZW50KSB7CiAgICAgICAgICBfc2FuaXRpemVTaGFkb3dET00oc2hhZG93Tm9kZS5jb250ZW50KTsKICAgICAgICB9CiAgICAgICAgLyogQ2hlY2sgYXR0cmlidXRlcywgc2FuaXRpemUgaWYgbmVjZXNzYXJ5ICovCgoKICAgICAgICBfc2FuaXRpemVBdHRyaWJ1dGVzKHNoYWRvd05vZGUpOwogICAgICB9CiAgICAgIC8qIEV4ZWN1dGUgYSBob29rIGlmIHByZXNlbnQgKi8KCgogICAgICBfZXhlY3V0ZUhvb2soJ2FmdGVyU2FuaXRpemVTaGFkb3dET00nLCBmcmFnbWVudCwgbnVsbCk7CiAgICB9OwogICAgLyoqCiAgICAgKiBTYW5pdGl6ZQogICAgICogUHVibGljIG1ldGhvZCBwcm92aWRpbmcgY29yZSBzYW5pdGF0aW9uIGZ1bmN0aW9uYWxpdHkKICAgICAqCiAgICAgKiBAcGFyYW0ge1N0cmluZ3xOb2RlfSBkaXJ0eSBzdHJpbmcgb3IgRE9NIG5vZGUKICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjb25maWd1cmF0aW9uIG9iamVjdAogICAgICovCiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgY29tcGxleGl0eQoKCiAgICBET01QdXJpZnkuc2FuaXRpemUgPSBmdW5jdGlvbiAoZGlydHkpIHsKICAgICAgbGV0IGNmZyA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDoge307CiAgICAgIGxldCBib2R5OwogICAgICBsZXQgaW1wb3J0ZWROb2RlOwogICAgICBsZXQgY3VycmVudE5vZGU7CiAgICAgIGxldCByZXR1cm5Ob2RlOwogICAgICAvKiBNYWtlIHN1cmUgd2UgaGF2ZSBhIHN0cmluZyB0byBzYW5pdGl6ZS4KICAgICAgICBETyBOT1QgcmV0dXJuIGVhcmx5LCBhcyB0aGlzIHdpbGwgcmV0dXJuIHRoZSB3cm9uZyB0eXBlIGlmCiAgICAgICAgdGhlIHVzZXIgaGFzIHJlcXVlc3RlZCBhIERPTSBvYmplY3QgcmF0aGVyIHRoYW4gYSBzdHJpbmcgKi8KCiAgICAgIElTX0VNUFRZX0lOUFVUID0gIWRpcnR5OwoKICAgICAgaWYgKElTX0VNUFRZX0lOUFVUKSB7CiAgICAgICAgZGlydHkgPSAnPCEtLT4nOwogICAgICB9CiAgICAgIC8qIFN0cmluZ2lmeSwgaW4gY2FzZSBkaXJ0eSBpcyBhbiBvYmplY3QgKi8KCgogICAgICBpZiAodHlwZW9mIGRpcnR5ICE9PSAnc3RyaW5nJyAmJiAhX2lzTm9kZShkaXJ0eSkpIHsKICAgICAgICBpZiAodHlwZW9mIGRpcnR5LnRvU3RyaW5nID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICBkaXJ0eSA9IGRpcnR5LnRvU3RyaW5nKCk7CgogICAgICAgICAgaWYgKHR5cGVvZiBkaXJ0eSAhPT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgdGhyb3cgdHlwZUVycm9yQ3JlYXRlKCdkaXJ0eSBpcyBub3QgYSBzdHJpbmcsIGFib3J0aW5nJyk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRocm93IHR5cGVFcnJvckNyZWF0ZSgndG9TdHJpbmcgaXMgbm90IGEgZnVuY3Rpb24nKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgLyogUmV0dXJuIGRpcnR5IEhUTUwgaWYgRE9NUHVyaWZ5IGNhbm5vdCBydW4gKi8KCgogICAgICBpZiAoIURPTVB1cmlmeS5pc1N1cHBvcnRlZCkgewogICAgICAgIHJldHVybiBkaXJ0eTsKICAgICAgfQogICAgICAvKiBBc3NpZ24gY29uZmlnIHZhcnMgKi8KCgogICAgICBpZiAoIVNFVF9DT05GSUcpIHsKICAgICAgICBfcGFyc2VDb25maWcoY2ZnKTsKICAgICAgfQogICAgICAvKiBDbGVhbiB1cCByZW1vdmVkIGVsZW1lbnRzICovCgoKICAgICAgRE9NUHVyaWZ5LnJlbW92ZWQgPSBbXTsKICAgICAgLyogQ2hlY2sgaWYgZGlydHkgaXMgY29ycmVjdGx5IHR5cGVkIGZvciBJTl9QTEFDRSAqLwoKICAgICAgaWYgKHR5cGVvZiBkaXJ0eSA9PT0gJ3N0cmluZycpIHsKICAgICAgICBJTl9QTEFDRSA9IGZhbHNlOwogICAgICB9CgogICAgICBpZiAoSU5fUExBQ0UpIHsKICAgICAgICAvKiBEbyBzb21lIGVhcmx5IHByZS1zYW5pdGl6YXRpb24gdG8gYXZvaWQgdW5zYWZlIHJvb3Qgbm9kZXMgKi8KICAgICAgICBpZiAoZGlydHkubm9kZU5hbWUpIHsKICAgICAgICAgIGNvbnN0IHRhZ05hbWUgPSB0cmFuc2Zvcm1DYXNlRnVuYyhkaXJ0eS5ub2RlTmFtZSk7CgogICAgICAgICAgaWYgKCFBTExPV0VEX1RBR1NbdGFnTmFtZV0gfHwgRk9SQklEX1RBR1NbdGFnTmFtZV0pIHsKICAgICAgICAgICAgdGhyb3cgdHlwZUVycm9yQ3JlYXRlKCdyb290IG5vZGUgaXMgZm9yYmlkZGVuIGFuZCBjYW5ub3QgYmUgc2FuaXRpemVkIGluLXBsYWNlJyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKGRpcnR5IGluc3RhbmNlb2YgTm9kZSkgewogICAgICAgIC8qIElmIGRpcnR5IGlzIGEgRE9NIGVsZW1lbnQsIGFwcGVuZCB0byBhbiBlbXB0eSBkb2N1bWVudCB0byBhdm9pZAogICAgICAgICAgIGVsZW1lbnRzIGJlaW5nIHN0cmlwcGVkIGJ5IHRoZSBwYXJzZXIgKi8KICAgICAgICBib2R5ID0gX2luaXREb2N1bWVudCgnPCEtLS0tPicpOwogICAgICAgIGltcG9ydGVkTm9kZSA9IGJvZHkub3duZXJEb2N1bWVudC5pbXBvcnROb2RlKGRpcnR5LCB0cnVlKTsKCiAgICAgICAgaWYgKGltcG9ydGVkTm9kZS5ub2RlVHlwZSA9PT0gMSAmJiBpbXBvcnRlZE5vZGUubm9kZU5hbWUgPT09ICdCT0RZJykgewogICAgICAgICAgLyogTm9kZSBpcyBhbHJlYWR5IGEgYm9keSwgdXNlIGFzIGlzICovCiAgICAgICAgICBib2R5ID0gaW1wb3J0ZWROb2RlOwogICAgICAgIH0gZWxzZSBpZiAoaW1wb3J0ZWROb2RlLm5vZGVOYW1lID09PSAnSFRNTCcpIHsKICAgICAgICAgIGJvZHkgPSBpbXBvcnRlZE5vZGU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSB1bmljb3JuL3ByZWZlci1kb20tbm9kZS1hcHBlbmQKICAgICAgICAgIGJvZHkuYXBwZW5kQ2hpbGQoaW1wb3J0ZWROb2RlKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLyogRXhpdCBkaXJlY3RseSBpZiB3ZSBoYXZlIG5vdGhpbmcgdG8gZG8gKi8KICAgICAgICBpZiAoIVJFVFVSTl9ET00gJiYgIVNBRkVfRk9SX1RFTVBMQVRFUyAmJiAhV0hPTEVfRE9DVU1FTlQgJiYgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHVuaWNvcm4vcHJlZmVyLWluY2x1ZGVzCiAgICAgICAgICBkaXJ0eS5pbmRleE9mKCc8JykgPT09IC0xKSB7CiAgICAgICAgICByZXR1cm4gdHJ1c3RlZFR5cGVzUG9saWN5ICYmIFJFVFVSTl9UUlVTVEVEX1RZUEUgPyB0cnVzdGVkVHlwZXNQb2xpY3kuY3JlYXRlSFRNTChkaXJ0eSkgOiBkaXJ0eTsKICAgICAgICB9CiAgICAgICAgLyogSW5pdGlhbGl6ZSB0aGUgZG9jdW1lbnQgdG8gd29yayBvbiAqLwoKCiAgICAgICAgYm9keSA9IF9pbml0RG9jdW1lbnQoZGlydHkpOwogICAgICAgIC8qIENoZWNrIHdlIGhhdmUgYSBET00gbm9kZSBmcm9tIHRoZSBkYXRhICovCgogICAgICAgIGlmICghYm9keSkgewogICAgICAgICAgcmV0dXJuIFJFVFVSTl9ET00gPyBudWxsIDogUkVUVVJOX1RSVVNURURfVFlQRSA/IGVtcHR5SFRNTCA6ICcnOwogICAgICAgIH0KICAgICAgfQogICAgICAvKiBSZW1vdmUgZmlyc3QgZWxlbWVudCBub2RlIChvdXJzKSBpZiBGT1JDRV9CT0RZIGlzIHNldCAqLwoKCiAgICAgIGlmIChib2R5ICYmIEZPUkNFX0JPRFkpIHsKICAgICAgICBfZm9yY2VSZW1vdmUoYm9keS5maXJzdENoaWxkKTsKICAgICAgfQogICAgICAvKiBHZXQgbm9kZSBpdGVyYXRvciAqLwoKCiAgICAgIGNvbnN0IG5vZGVJdGVyYXRvciA9IF9jcmVhdGVJdGVyYXRvcihJTl9QTEFDRSA/IGRpcnR5IDogYm9keSk7CiAgICAgIC8qIE5vdyBzdGFydCBpdGVyYXRpbmcgb3ZlciB0aGUgY3JlYXRlZCBkb2N1bWVudCAqLwoKCiAgICAgIHdoaWxlIChjdXJyZW50Tm9kZSA9IG5vZGVJdGVyYXRvci5uZXh0Tm9kZSgpKSB7CiAgICAgICAgLyogU2FuaXRpemUgdGFncyBhbmQgZWxlbWVudHMgKi8KICAgICAgICBpZiAoX3Nhbml0aXplRWxlbWVudHMoY3VycmVudE5vZGUpKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgLyogU2hhZG93IERPTSBkZXRlY3RlZCwgc2FuaXRpemUgaXQgKi8KCgogICAgICAgIGlmIChjdXJyZW50Tm9kZS5jb250ZW50IGluc3RhbmNlb2YgRG9jdW1lbnRGcmFnbWVudCkgewogICAgICAgICAgX3Nhbml0aXplU2hhZG93RE9NKGN1cnJlbnROb2RlLmNvbnRlbnQpOwogICAgICAgIH0KICAgICAgICAvKiBDaGVjayBhdHRyaWJ1dGVzLCBzYW5pdGl6ZSBpZiBuZWNlc3NhcnkgKi8KCgogICAgICAgIF9zYW5pdGl6ZUF0dHJpYnV0ZXMoY3VycmVudE5vZGUpOwogICAgICB9CiAgICAgIC8qIElmIHdlIHNhbml0aXplZCBgZGlydHlgIGluLXBsYWNlLCByZXR1cm4gaXQuICovCgoKICAgICAgaWYgKElOX1BMQUNFKSB7CiAgICAgICAgcmV0dXJuIGRpcnR5OwogICAgICB9CiAgICAgIC8qIFJldHVybiBzYW5pdGl6ZWQgc3RyaW5nIG9yIERPTSAqLwoKCiAgICAgIGlmIChSRVRVUk5fRE9NKSB7CiAgICAgICAgaWYgKFJFVFVSTl9ET01fRlJBR01FTlQpIHsKICAgICAgICAgIHJldHVybk5vZGUgPSBjcmVhdGVEb2N1bWVudEZyYWdtZW50LmNhbGwoYm9keS5vd25lckRvY3VtZW50KTsKCiAgICAgICAgICB3aGlsZSAoYm9keS5maXJzdENoaWxkKSB7CiAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSB1bmljb3JuL3ByZWZlci1kb20tbm9kZS1hcHBlbmQKICAgICAgICAgICAgcmV0dXJuTm9kZS5hcHBlbmRDaGlsZChib2R5LmZpcnN0Q2hpbGQpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm5Ob2RlID0gYm9keTsKICAgICAgICB9CgogICAgICAgIGlmIChBTExPV0VEX0FUVFIuc2hhZG93cm9vdCB8fCBBTExPV0VEX0FUVFIuc2hhZG93cm9vdG1vZCkgewogICAgICAgICAgLyoKICAgICAgICAgICAgQWRvcHROb2RlKCkgaXMgbm90IHVzZWQgYmVjYXVzZSBpbnRlcm5hbCBzdGF0ZSBpcyBub3QgcmVzZXQKICAgICAgICAgICAgKGUuZy4gdGhlIHBhc3QgbmFtZXMgbWFwIG9mIGEgSFRNTEZvcm1FbGVtZW50KSwgdGhpcyBpcyBzYWZlCiAgICAgICAgICAgIGluIHRoZW9yeSBidXQgd2Ugd291bGQgcmF0aGVyIG5vdCByaXNrIGFub3RoZXIgYXR0YWNrIHZlY3Rvci4KICAgICAgICAgICAgVGhlIHN0YXRlIHRoYXQgaXMgY2xvbmVkIGJ5IGltcG9ydE5vZGUoKSBpcyBleHBsaWNpdGx5IGRlZmluZWQKICAgICAgICAgICAgYnkgdGhlIHNwZWNzLgogICAgICAgICAgKi8KICAgICAgICAgIHJldHVybk5vZGUgPSBpbXBvcnROb2RlLmNhbGwob3JpZ2luYWxEb2N1bWVudCwgcmV0dXJuTm9kZSwgdHJ1ZSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gcmV0dXJuTm9kZTsKICAgICAgfQoKICAgICAgbGV0IHNlcmlhbGl6ZWRIVE1MID0gV0hPTEVfRE9DVU1FTlQgPyBib2R5Lm91dGVySFRNTCA6IGJvZHkuaW5uZXJIVE1MOwogICAgICAvKiBTZXJpYWxpemUgZG9jdHlwZSBpZiBhbGxvd2VkICovCgogICAgICBpZiAoV0hPTEVfRE9DVU1FTlQgJiYgQUxMT1dFRF9UQUdTWychZG9jdHlwZSddICYmIGJvZHkub3duZXJEb2N1bWVudCAmJiBib2R5Lm93bmVyRG9jdW1lbnQuZG9jdHlwZSAmJiBib2R5Lm93bmVyRG9jdW1lbnQuZG9jdHlwZS5uYW1lICYmIHJlZ0V4cFRlc3QoRE9DVFlQRV9OQU1FLCBib2R5Lm93bmVyRG9jdW1lbnQuZG9jdHlwZS5uYW1lKSkgewogICAgICAgIHNlcmlhbGl6ZWRIVE1MID0gJzwhRE9DVFlQRSAnICsgYm9keS5vd25lckRvY3VtZW50LmRvY3R5cGUubmFtZSArICc+XG4nICsgc2VyaWFsaXplZEhUTUw7CiAgICAgIH0KICAgICAgLyogU2FuaXRpemUgZmluYWwgc3RyaW5nIHRlbXBsYXRlLXNhZmUgKi8KCgogICAgICBpZiAoU0FGRV9GT1JfVEVNUExBVEVTKSB7CiAgICAgICAgc2VyaWFsaXplZEhUTUwgPSBzdHJpbmdSZXBsYWNlKHNlcmlhbGl6ZWRIVE1MLCBNVVNUQUNIRV9FWFBSLCAnICcpOwogICAgICAgIHNlcmlhbGl6ZWRIVE1MID0gc3RyaW5nUmVwbGFjZShzZXJpYWxpemVkSFRNTCwgRVJCX0VYUFIsICcgJyk7CiAgICAgICAgc2VyaWFsaXplZEhUTUwgPSBzdHJpbmdSZXBsYWNlKHNlcmlhbGl6ZWRIVE1MLCBUTVBMSVRfRVhQUiwgJyAnKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydXN0ZWRUeXBlc1BvbGljeSAmJiBSRVRVUk5fVFJVU1RFRF9UWVBFID8gdHJ1c3RlZFR5cGVzUG9saWN5LmNyZWF0ZUhUTUwoc2VyaWFsaXplZEhUTUwpIDogc2VyaWFsaXplZEhUTUw7CiAgICB9OwogICAgLyoqCiAgICAgKiBQdWJsaWMgbWV0aG9kIHRvIHNldCB0aGUgY29uZmlndXJhdGlvbiBvbmNlCiAgICAgKiBzZXRDb25maWcKICAgICAqCiAgICAgKiBAcGFyYW0ge09iamVjdH0gY2ZnIGNvbmZpZ3VyYXRpb24gb2JqZWN0CiAgICAgKi8KCgogICAgRE9NUHVyaWZ5LnNldENvbmZpZyA9IGZ1bmN0aW9uIChjZmcpIHsKICAgICAgX3BhcnNlQ29uZmlnKGNmZyk7CgogICAgICBTRVRfQ09ORklHID0gdHJ1ZTsKICAgIH07CiAgICAvKioKICAgICAqIFB1YmxpYyBtZXRob2QgdG8gcmVtb3ZlIHRoZSBjb25maWd1cmF0aW9uCiAgICAgKiBjbGVhckNvbmZpZwogICAgICoKICAgICAqLwoKCiAgICBET01QdXJpZnkuY2xlYXJDb25maWcgPSBmdW5jdGlvbiAoKSB7CiAgICAgIENPTkZJRyA9IG51bGw7CiAgICAgIFNFVF9DT05GSUcgPSBmYWxzZTsKICAgIH07CiAgICAvKioKICAgICAqIFB1YmxpYyBtZXRob2QgdG8gY2hlY2sgaWYgYW4gYXR0cmlidXRlIHZhbHVlIGlzIHZhbGlkLgogICAgICogVXNlcyBsYXN0IHNldCBjb25maWcsIGlmIGFueS4gT3RoZXJ3aXNlLCB1c2VzIGNvbmZpZyBkZWZhdWx0cy4KICAgICAqIGlzVmFsaWRBdHRyaWJ1dGUKICAgICAqCiAgICAgKiBAcGFyYW0gIHtzdHJpbmd9IHRhZyBUYWcgbmFtZSBvZiBjb250YWluaW5nIGVsZW1lbnQuCiAgICAgKiBAcGFyYW0gIHtzdHJpbmd9IGF0dHIgQXR0cmlidXRlIG5hbWUuCiAgICAgKiBAcGFyYW0gIHtzdHJpbmd9IHZhbHVlIEF0dHJpYnV0ZSB2YWx1ZS4KICAgICAqIEByZXR1cm4ge0Jvb2xlYW59IFJldHVybnMgdHJ1ZSBpZiBgdmFsdWVgIGlzIHZhbGlkLiBPdGhlcndpc2UsIHJldHVybnMgZmFsc2UuCiAgICAgKi8KCgogICAgRE9NUHVyaWZ5LmlzVmFsaWRBdHRyaWJ1dGUgPSBmdW5jdGlvbiAodGFnLCBhdHRyLCB2YWx1ZSkgewogICAgICAvKiBJbml0aWFsaXplIHNoYXJlZCBjb25maWcgdmFycyBpZiBuZWNlc3NhcnkuICovCiAgICAgIGlmICghQ09ORklHKSB7CiAgICAgICAgX3BhcnNlQ29uZmlnKHt9KTsKICAgICAgfQoKICAgICAgY29uc3QgbGNUYWcgPSB0cmFuc2Zvcm1DYXNlRnVuYyh0YWcpOwogICAgICBjb25zdCBsY05hbWUgPSB0cmFuc2Zvcm1DYXNlRnVuYyhhdHRyKTsKICAgICAgcmV0dXJuIF9pc1ZhbGlkQXR0cmlidXRlKGxjVGFnLCBsY05hbWUsIHZhbHVlKTsKICAgIH07CiAgICAvKioKICAgICAqIEFkZEhvb2sKICAgICAqIFB1YmxpYyBtZXRob2QgdG8gYWRkIERPTVB1cmlmeSBob29rcwogICAgICoKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBlbnRyeVBvaW50IGVudHJ5IHBvaW50IGZvciB0aGUgaG9vayB0byBhZGQKICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGhvb2tGdW5jdGlvbiBmdW5jdGlvbiB0byBleGVjdXRlCiAgICAgKi8KCgogICAgRE9NUHVyaWZ5LmFkZEhvb2sgPSBmdW5jdGlvbiAoZW50cnlQb2ludCwgaG9va0Z1bmN0aW9uKSB7CiAgICAgIGlmICh0eXBlb2YgaG9va0Z1bmN0aW9uICE9PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBob29rc1tlbnRyeVBvaW50XSA9IGhvb2tzW2VudHJ5UG9pbnRdIHx8IFtdOwogICAgICBhcnJheVB1c2goaG9va3NbZW50cnlQb2ludF0sIGhvb2tGdW5jdGlvbik7CiAgICB9OwogICAgLyoqCiAgICAgKiBSZW1vdmVIb29rCiAgICAgKiBQdWJsaWMgbWV0aG9kIHRvIHJlbW92ZSBhIERPTVB1cmlmeSBob29rIGF0IGEgZ2l2ZW4gZW50cnlQb2ludAogICAgICogKHBvcHMgaXQgZnJvbSB0aGUgc3RhY2sgb2YgaG9va3MgaWYgbW9yZSBhcmUgcHJlc2VudCkKICAgICAqCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gZW50cnlQb2ludCBlbnRyeSBwb2ludCBmb3IgdGhlIGhvb2sgdG8gcmVtb3ZlCiAgICAgKiBAcmV0dXJuIHtGdW5jdGlvbn0gcmVtb3ZlZChwb3BwZWQpIGhvb2sKICAgICAqLwoKCiAgICBET01QdXJpZnkucmVtb3ZlSG9vayA9IGZ1bmN0aW9uIChlbnRyeVBvaW50KSB7CiAgICAgIGlmIChob29rc1tlbnRyeVBvaW50XSkgewogICAgICAgIHJldHVybiBhcnJheVBvcChob29rc1tlbnRyeVBvaW50XSk7CiAgICAgIH0KICAgIH07CiAgICAvKioKICAgICAqIFJlbW92ZUhvb2tzCiAgICAgKiBQdWJsaWMgbWV0aG9kIHRvIHJlbW92ZSBhbGwgRE9NUHVyaWZ5IGhvb2tzIGF0IGEgZ2l2ZW4gZW50cnlQb2ludAogICAgICoKICAgICAqIEBwYXJhbSAge1N0cmluZ30gZW50cnlQb2ludCBlbnRyeSBwb2ludCBmb3IgdGhlIGhvb2tzIHRvIHJlbW92ZQogICAgICovCgoKICAgIERPTVB1cmlmeS5yZW1vdmVIb29rcyA9IGZ1bmN0aW9uIChlbnRyeVBvaW50KSB7CiAgICAgIGlmIChob29rc1tlbnRyeVBvaW50XSkgewogICAgICAgIGhvb2tzW2VudHJ5UG9pbnRdID0gW107CiAgICAgIH0KICAgIH07CiAgICAvKioKICAgICAqIFJlbW92ZUFsbEhvb2tzCiAgICAgKiBQdWJsaWMgbWV0aG9kIHRvIHJlbW92ZSBhbGwgRE9NUHVyaWZ5IGhvb2tzCiAgICAgKgogICAgICovCgoKICAgIERPTVB1cmlmeS5yZW1vdmVBbGxIb29rcyA9IGZ1bmN0aW9uICgpIHsKICAgICAgaG9va3MgPSB7fTsKICAgIH07CgogICAgcmV0dXJuIERPTVB1cmlmeTsKICB9CgogIHZhciBwdXJpZnkgPSBjcmVhdGVET01QdXJpZnkoKTsKCiAgcmV0dXJuIHB1cmlmeTsKCn0pKTsKCm91dHB1dDs=", "Readability.js": "Ly8vIDxyZWZlcmVuY2Ugbm8tZGVmYXVsdC1saWI9InRydWUiLz4NCg0KLyoNCiAqIENvcHlyaWdodCAoYykgMjAxMCBBcmM5MCBJbmMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KDQovKg0KICogVGhpcyBjb2RlIGlzIGhlYXZpbHkgYmFzZWQgb24gQXJjOTAncyByZWFkYWJpbGl0eS5qcyAoMS43LjEpIHNjcmlwdA0KICogYXZhaWxhYmxlIGF0OiBodHRwOi8vY29kZS5nb29nbGUuY29tL3AvYXJjOTBsYWJzLXJlYWRhYmlsaXR5DQogKi8NCg0KLyoqDQogKiBQdWJsaWMgY29uc3RydWN0b3IuDQogKiBAcGFyYW0ge0hUTUxEb2N1bWVudH0gZG9jICAgICBUaGUgZG9jdW1lbnQgdG8gcGFyc2UuDQogKiBAcGFyYW0ge09iamVjdH0gICAgICAgb3B0aW9ucyBUaGUgb3B0aW9ucyBvYmplY3QuDQogKi8NCmZ1bmN0aW9uIFJlYWRhYmlsaXR5KGRvYywgb3B0aW9ucykgew0KICAvLyBJbiBzb21lIG9sZGVyIHZlcnNpb25zLCBwZW9wbGUgcGFzc2VkIGEgVVJJIGFzIHRoZSBmaXJzdCBhcmd1bWVudC4gQ29wZToNCiAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5kb2N1bWVudEVsZW1lbnQpIHsNCiAgICBkb2MgPSBvcHRpb25zOw0KICAgIG9wdGlvbnMgPSBhcmd1bWVudHNbMl07DQogIH0gZWxzZSBpZiAoIWRvYyB8fCAhZG9jLmRvY3VtZW50RWxlbWVudCkgew0KICAgIHRocm93IG5ldyBFcnJvcigiRmlyc3QgYXJndW1lbnQgdG8gUmVhZGFiaWxpdHkgY29uc3RydWN0b3Igc2hvdWxkIGJlIGEgZG9jdW1lbnQgb2JqZWN0LiIpOw0KICB9DQogIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9Ow0KDQogIHRoaXMubmV3QmFzZVVSSSA9IG9wdGlvbnMubmV3QmFzZVVSSSB8fCBkb2MuYmFzZVVSSQ0KICB0aGlzLl9kb2MgPSBkb2M7DQogIHRoaXMuX2RvY0pTRE9NUGFyc2VyID0gdGhpcy5fZG9jLmZpcnN0Q2hpbGQuX19KU0RPTVBhcnNlcl9fOw0KICB0aGlzLl9hcnRpY2xlVGl0bGUgPSBudWxsOw0KICB0aGlzLl9hcnRpY2xlQnlsaW5lID0gbnVsbDsNCiAgdGhpcy5fYXJ0aWNsZURpciA9IG51bGw7DQogIHRoaXMuX2FydGljbGVTaXRlTmFtZSA9IG51bGw7DQogIHRoaXMuX2F0dGVtcHRzID0gW107DQoNCiAgLy8gQ29uZmlndXJhYmxlIG9wdGlvbnMNCiAgdGhpcy5fZGVidWcgPSAhIW9wdGlvbnMuZGVidWc7DQogIHRoaXMuX21heEVsZW1zVG9QYXJzZSA9IG9wdGlvbnMubWF4RWxlbXNUb1BhcnNlIHx8IHRoaXMuREVGQVVMVF9NQVhfRUxFTVNfVE9fUEFSU0U7DQogIHRoaXMuX25iVG9wQ2FuZGlkYXRlcyA9IG9wdGlvbnMubmJUb3BDYW5kaWRhdGVzIHx8IHRoaXMuREVGQVVMVF9OX1RPUF9DQU5ESURBVEVTOw0KICB0aGlzLl9jaGFyVGhyZXNob2xkID0gb3B0aW9ucy5jaGFyVGhyZXNob2xkIHx8IHRoaXMuREVGQVVMVF9DSEFSX1RIUkVTSE9MRDsNCiAgdGhpcy5fY2xhc3Nlc1RvUHJlc2VydmUgPSB0aGlzLkNMQVNTRVNfVE9fUFJFU0VSVkUuY29uY2F0KG9wdGlvbnMuY2xhc3Nlc1RvUHJlc2VydmUgfHwgW10pOw0KICB0aGlzLl9rZWVwQ2xhc3NlcyA9ICEhb3B0aW9ucy5rZWVwQ2xhc3NlczsNCiAgdGhpcy5fc2VyaWFsaXplciA9IG9wdGlvbnMuc2VyaWFsaXplciB8fCBmdW5jdGlvbiAoZWwpIHsNCiAgICByZXR1cm4gZWwuaW5uZXJIVE1MOw0KICB9Ow0KICB0aGlzLl9kaXNhYmxlSlNPTkxEID0gISFvcHRpb25zLmRpc2FibGVKU09OTEQ7DQogIHRoaXMuX2FsbG93ZWRWaWRlb1JlZ2V4ID0gb3B0aW9ucy5hbGxvd2VkVmlkZW9SZWdleCB8fCB0aGlzLlJFR0VYUFMudmlkZW9zOw0KDQogIC8vIFN0YXJ0IHdpdGggYWxsIGZsYWdzIHNldA0KICB0aGlzLl9mbGFncyA9IHRoaXMuRkxBR19TVFJJUF9VTkxJS0VMWVMgfA0KICAgIHRoaXMuRkxBR19XRUlHSFRfQ0xBU1NFUyB8DQogICAgdGhpcy5GTEFHX0NMRUFOX0NPTkRJVElPTkFMTFk7DQoNCg0KICAvLyBDb250cm9sIHdoZXRoZXIgbG9nIG1lc3NhZ2VzIGFyZSBzZW50IHRvIHRoZSBjb25zb2xlDQogIGlmICh0aGlzLl9kZWJ1Zykgew0KICAgIGxldCBsb2dOb2RlID0gZnVuY3Rpb24gKG5vZGUpIHsNCiAgICAgIGlmIChub2RlLm5vZGVUeXBlID09IG5vZGUuVEVYVF9OT0RFKSB7DQogICAgICAgIHJldHVybiBgJHtub2RlLm5vZGVOYW1lfSAoIiR7bm9kZS50ZXh0Q29udGVudH0iKWA7DQogICAgICB9DQogICAgICBsZXQgYXR0clBhaXJzID0gQXJyYXkuZnJvbShub2RlLmF0dHJpYnV0ZXMgfHwgW10sIGZ1bmN0aW9uIChhdHRyKSB7DQogICAgICAgIHJldHVybiBgJHthdHRyLm5hbWV9PSIke2F0dHIudmFsdWV9ImA7DQogICAgICB9KS5qb2luKCIgIik7DQogICAgICByZXR1cm4gYDwke25vZGUubG9jYWxOYW1lfSAke2F0dHJQYWlyc30+YDsNCiAgICB9Ow0KICAgIHRoaXMubG9nID0gZnVuY3Rpb24gKCkgew0KICAgICAgaWYgKHR5cGVvZiBjb25zb2xlICE9PSAidW5kZWZpbmVkIikgew0KICAgICAgICBsZXQgYXJncyA9IEFycmF5LmZyb20oYXJndW1lbnRzLCBhcmcgPT4gew0KICAgICAgICAgIGlmIChhcmcgJiYgYXJnLm5vZGVUeXBlID09IHRoaXMuRUxFTUVOVF9OT0RFKSB7DQogICAgICAgICAgICByZXR1cm4gbG9nTm9kZShhcmcpOw0KICAgICAgICAgIH0NCiAgICAgICAgICByZXR1cm4gYXJnOw0KICAgICAgICB9KTsNCiAgICAgICAgYXJncy51bnNoaWZ0KCJSZWFkZXI6IChSZWFkYWJpbGl0eSkiKTsNCiAgICAgICAgY29uc29sZS5sb2cuYXBwbHkoY29uc29sZSwgYXJncyk7DQogICAgICB9IGVsc2UgaWYgKHR5cGVvZiBkdW1wICE9PSAidW5kZWZpbmVkIikgew0KICAgICAgICAvKiBnbG9iYWwgZHVtcCAqLw0KICAgICAgICB2YXIgbXNnID0gQXJyYXkucHJvdG90eXBlLm1hcC5jYWxsKGFyZ3VtZW50cywgZnVuY3Rpb24gKHgpIHsNCiAgICAgICAgICByZXR1cm4gKHggJiYgeC5ub2RlTmFtZSkgPyBsb2dOb2RlKHgpIDogeDsNCiAgICAgICAgfSkuam9pbigiICIpOw0KICAgICAgICBkdW1wKCJSZWFkZXI6IChSZWFkYWJpbGl0eSkgIiArIG1zZyArICJcbiIpOw0KICAgICAgfQ0KICAgIH07DQogIH0gZWxzZSB7DQogICAgdGhpcy5sb2cgPSBmdW5jdGlvbiAoKSB7IH07DQogIH0NCn0NCg0KUmVhZGFiaWxpdHkucHJvdG90eXBlID0gew0KICBGTEFHX1NUUklQX1VOTElLRUxZUzogMHgxLA0KICBGTEFHX1dFSUdIVF9DTEFTU0VTOiAweDIsDQogIEZMQUdfQ0xFQU5fQ09ORElUSU9OQUxMWTogMHg0LA0KDQogIC8vIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9Ob2RlL25vZGVUeXBlDQogIEVMRU1FTlRfTk9ERTogMSwNCiAgVEVYVF9OT0RFOiAzLA0KDQogIC8vIE1heCBudW1iZXIgb2Ygbm9kZXMgc3VwcG9ydGVkIGJ5IHRoaXMgcGFyc2VyLiBEZWZhdWx0OiAwIChubyBsaW1pdCkNCiAgREVGQVVMVF9NQVhfRUxFTVNfVE9fUEFSU0U6IDAsDQoNCiAgLy8gVGhlIG51bWJlciBvZiB0b3AgY2FuZGlkYXRlcyB0byBjb25zaWRlciB3aGVuIGFuYWx5c2luZyBob3cNCiAgLy8gdGlnaHQgdGhlIGNvbXBldGl0aW9uIGlzIGFtb25nIGNhbmRpZGF0ZXMuDQogIERFRkFVTFRfTl9UT1BfQ0FORElEQVRFUzogNSwNCg0KICAvLyBFbGVtZW50IHRhZ3MgdG8gc2NvcmUgYnkgZGVmYXVsdC4NCiAgREVGQVVMVF9UQUdTX1RPX1NDT1JFOiAic2VjdGlvbixoMixoMyxoNCxoNSxoNixwLHRkLHByZSIudG9VcHBlckNhc2UoKS5zcGxpdCgiLCIpLA0KDQogIC8vIFRoZSBkZWZhdWx0IG51bWJlciBvZiBjaGFycyBhbiBhcnRpY2xlIG11c3QgaGF2ZSBpbiBvcmRlciB0byByZXR1cm4gYSByZXN1bHQNCiAgREVGQVVMVF9DSEFSX1RIUkVTSE9MRDogNTAwLA0KDQogIC8vIEFsbCBvZiB0aGUgcmVndWxhciBleHByZXNzaW9ucyBpbiB1c2Ugd2l0aGluIHJlYWRhYmlsaXR5Lg0KICAvLyBEZWZpbmVkIHVwIGhlcmUgc28gd2UgZG9uJ3QgaW5zdGFudGlhdGUgdGhlbSByZXBlYXRlZGx5IGluIGxvb3BzLg0KICBSRUdFWFBTOiB7DQogICAgLy8gTk9URTogVGhlc2UgdHdvIHJlZ3VsYXIgZXhwcmVzc2lvbnMgYXJlIGR1cGxpY2F0ZWQgaW4NCiAgICAvLyBSZWFkYWJpbGl0eS1yZWFkZXJhYmxlLmpzLiBQbGVhc2Uga2VlcCBib3RoIGNvcGllcyBpbiBzeW5jLg0KICAgIHVubGlrZWx5Q2FuZGlkYXRlczogLy1hZC18YWkyaHRtbHxiYW5uZXJ8YnJlYWRjcnVtYnN8Y29tYnh8Y29tbWVudHxjb21tdW5pdHl8Y292ZXItd3JhcHxkaXNxdXN8ZXh0cmF8Zm9vdGVyfGdkcHJ8aGVhZGVyfGxlZ2VuZHN8bWVudXxyZWxhdGVkfHJlbWFya3xyZXBsaWVzfHJzc3xzaG91dGJveHxzaWRlYmFyfHNreXNjcmFwZXJ8c29jaWFsfHNwb25zb3J8c3VwcGxlbWVudGFsfGFkLWJyZWFrfGFnZWdhdGV8cGFnaW5hdGlvbnxwYWdlcnxwb3B1cHx5b20tcmVtb3RlL2ksDQogICAgb2tNYXliZUl0c0FDYW5kaWRhdGU6IC9hbmR8YXJ0aWNsZXxib2R5fGNvbHVtbnxjb250ZW50fG1haW58c2hhZG93L2ksDQoNCiAgICBwb3NpdGl2ZTogL2FydGljbGV8Ym9keXxjb250ZW50fGVudHJ5fGhlbnRyeXxoLWVudHJ5fG1haW58cGFnZXxwYWdpbmF0aW9ufHBvc3R8dGV4dHxibG9nfHN0b3J5L2ksDQogICAgbmVnYXRpdmU6IC8tYWQtfGhpZGRlbnxeaGlkJHwgaGlkJHwgaGlkIHxeaGlkIHxiYW5uZXJ8Y29tYnh8Y29tbWVudHxjb20tfGNvbnRhY3R8Zm9vdHxmb290ZXJ8Zm9vdG5vdGV8Z2RwcnxtYXN0aGVhZHxtZWRpYXxtZXRhfG91dGJyYWlufHByb21vfHJlbGF0ZWR8c2Nyb2xsfHNoYXJlfHNob3V0Ym94fHNpZGViYXJ8c2t5c2NyYXBlcnxzcG9uc29yfHNob3BwaW5nfHRhZ3N8dG9vbHx3aWRnZXQvaSwNCiAgICBleHRyYW5lb3VzOiAvcHJpbnR8YXJjaGl2ZXxjb21tZW50fGRpc2N1c3N8ZVtcLV0/bWFpbHxzaGFyZXxyZXBseXxhbGx8bG9naW58c2lnbnxzaW5nbGV8dXRpbGl0eS9pLA0KICAgIGJ5bGluZTogL2J5bGluZXxhdXRob3J8ZGF0ZWxpbmV8d3JpdHRlbmJ5fHAtYXV0aG9yL2ksDQogICAgcmVwbGFjZUZvbnRzOiAvPChcLz8pZm9udFtePl0qPi9naSwNCiAgICBub3JtYWxpemU6IC9cc3syLH0vZywNCiAgICB2aWRlb3M6IC9cL1wvKHd3d1wuKT8oKGRhaWx5bW90aW9ufHlvdXR1YmV8eW91dHViZS1ub2Nvb2tpZXxwbGF5ZXJcLnZpbWVvfHZcLnFxKVwuY29tfChhcmNoaXZlfHVwbG9hZFwud2lraW1lZGlhKVwub3JnfHBsYXllclwudHdpdGNoXC50dikvaSwNCiAgICBzaGFyZUVsZW1lbnRzOiAvKFxifF8pKHNoYXJlfHNoYXJlZGFkZHkpKFxifF8pL2ksDQogICAgbmV4dExpbms6IC8obmV4dHx3ZWl0ZXJ8Y29udGludWV8PihbXlx8XXwkKXzCuyhbXlx8XXwkKSkvaSwNCiAgICBwcmV2TGluazogLyhwcmV2fGVhcmx8b2xkfG5ld3w8fMKrKS9pLA0KICAgIHRva2VuaXplOiAvXFcrL2csDQogICAgd2hpdGVzcGFjZTogL15ccyokLywNCiAgICBoYXNDb250ZW50OiAvXFMkLywNCiAgICBoYXNoVXJsOiAvXiMuKy8sDQogICAgc3Jjc2V0VXJsOiAvKFxTKykoXHMrW1xkLl0rW3h3XSk/KFxzKig/Oix8JCkpL2csDQogICAgYjY0RGF0YVVybDogL15kYXRhOlxzKihbXlxzOyxdKylccyo7XHMqYmFzZTY0XHMqLC9pLA0KICAgIC8vIENvbW1hcyBhcyB1c2VkIGluIExhdGluLCBTaW5kaGksIENoaW5lc2UgYW5kIHZhcmlvdXMgb3RoZXIgc2NyaXB0cy4NCiAgICAvLyBzZWU6IGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0NvbW1hI0NvbW1hX3ZhcmlhbnRzDQogICAgY29tbWFzOiAvXHUwMDJDfFx1MDYwQ3xcdUZFNTB8XHVGRTEwfFx1RkUxMXxcdTJFNDF8XHUyRTM0fFx1MkUzMnxcdUZGMEMvZywNCiAgICAvLyBTZWU6IGh0dHBzOi8vc2NoZW1hLm9yZy9BcnRpY2xlDQogICAganNvbkxkQXJ0aWNsZVR5cGVzOiAvXkFydGljbGV8QWR2ZXJ0aXNlckNvbnRlbnRBcnRpY2xlfE5ld3NBcnRpY2xlfEFuYWx5c2lzTmV3c0FydGljbGV8QXNrUHVibGljTmV3c0FydGljbGV8QmFja2dyb3VuZE5ld3NBcnRpY2xlfE9waW5pb25OZXdzQXJ0aWNsZXxSZXBvcnRhZ2VOZXdzQXJ0aWNsZXxSZXZpZXdOZXdzQXJ0aWNsZXxSZXBvcnR8U2F0aXJpY2FsQXJ0aWNsZXxTY2hvbGFybHlBcnRpY2xlfE1lZGljYWxTY2hvbGFybHlBcnRpY2xlfFNvY2lhbE1lZGlhUG9zdGluZ3xCbG9nUG9zdGluZ3xMaXZlQmxvZ1Bvc3Rpbmd8RGlzY3Vzc2lvbkZvcnVtUG9zdGluZ3xUZWNoQXJ0aWNsZXxBUElSZWZlcmVuY2UkLw0KICB9LA0KDQogIFVOTElLRUxZX1JPTEVTOiBbIm1lbnUiLCAibWVudWJhciIsICJjb21wbGVtZW50YXJ5IiwgIm5hdmlnYXRpb24iLCAiYWxlcnQiLCAiYWxlcnRkaWFsb2ciLCAiZGlhbG9nIl0sDQoNCiAgRElWX1RPX1BfRUxFTVM6IG5ldyBTZXQoWyJCTE9DS1FVT1RFIiwgIkRMIiwgIkRJViIsICJJTUciLCAiT0wiLCAiUCIsICJQUkUiLCAiVEFCTEUiLCAiVUwiXSksDQoNCiAgQUxURVJfVE9fRElWX0VYQ0VQVElPTlM6IFsiRElWIiwgIkFSVElDTEUiLCAiU0VDVElPTiIsICJQIl0sDQoNCiAgUFJFU0VOVEFUSU9OQUxfQVRUUklCVVRFUzogWyJhbGlnbiIsICJiYWNrZ3JvdW5kIiwgImJnY29sb3IiLCAiYm9yZGVyIiwgImNlbGxwYWRkaW5nIiwgImNlbGxzcGFjaW5nIiwgImZyYW1lIiwgImhzcGFjZSIsICJydWxlcyIsICJzdHlsZSIsICJ2YWxpZ24iLCAidnNwYWNlIl0sDQoNCiAgREVQUkVDQVRFRF9TSVpFX0FUVFJJQlVURV9FTEVNUzogWyJUQUJMRSIsICJUSCIsICJURCIsICJIUiIsICJQUkUiXSwNCg0KICAvLyBUaGUgY29tbWVudGVkIG91dCBlbGVtZW50cyBxdWFsaWZ5IGFzIHBocmFzaW5nIGNvbnRlbnQgYnV0IHRlbmQgdG8gYmUNCiAgLy8gcmVtb3ZlZCBieSByZWFkYWJpbGl0eSB3aGVuIHB1dCBpbnRvIHBhcmFncmFwaHMsIHNvIHdlIGlnbm9yZSB0aGVtIGhlcmUuDQogIFBIUkFTSU5HX0VMRU1TOiBbDQogICAgLy8gIkNBTlZBUyIsICJJRlJBTUUiLCAiU1ZHIiwgIlZJREVPIiwNCiAgICAiQUJCUiIsICJBVURJTyIsICJCIiwgIkJETyIsICJCUiIsICJCVVRUT04iLCAiQ0lURSIsICJDT0RFIiwgIkRBVEEiLA0KICAgICJEQVRBTElTVCIsICJERk4iLCAiRU0iLCAiRU1CRUQiLCAiSSIsICJJTUciLCAiSU5QVVQiLCAiS0JEIiwgIkxBQkVMIiwNCiAgICAiTUFSSyIsICJNQVRIIiwgIk1FVEVSIiwgIk5PU0NSSVBUIiwgIk9CSkVDVCIsICJPVVRQVVQiLCAiUFJPR1JFU1MiLCAiUSIsDQogICAgIlJVQlkiLCAiU0FNUCIsICJTQ1JJUFQiLCAiU0VMRUNUIiwgIlNNQUxMIiwgIlNQQU4iLCAiU1RST05HIiwgIlNVQiIsDQogICAgIlNVUCIsICJURVhUQVJFQSIsICJUSU1FIiwgIlZBUiIsICJXQlIiDQogIF0sDQoNCiAgLy8gVGhlc2UgYXJlIHRoZSBjbGFzc2VzIHRoYXQgcmVhZGFiaWxpdHkgc2V0cyBpdHNlbGYuDQogIENMQVNTRVNfVE9fUFJFU0VSVkU6IFsicGFnZSJdLA0KDQogIC8vIFRoZXNlIGFyZSB0aGUgbGlzdCBvZiBIVE1MIGVudGl0aWVzIHRoYXQgbmVlZCB0byBiZSBlc2NhcGVkLg0KICBIVE1MX0VTQ0FQRV9NQVA6IHsNCiAgICAibHQiOiAiPCIsDQogICAgImd0IjogIj4iLA0KICAgICJhbXAiOiAiJiIsDQogICAgInF1b3QiOiAnIicsDQogICAgImFwb3MiOiAiJyIsDQogIH0sDQoNCiAgLyoqDQogICAqIFJ1biBhbnkgcG9zdC1wcm9jZXNzIG1vZGlmaWNhdGlvbnMgdG8gYXJ0aWNsZSBjb250ZW50IGFzIG5lY2Vzc2FyeS4NCiAgICoNCiAgICogQHBhcmFtIEVsZW1lbnQNCiAgICogQHJldHVybiB2b2lkDQogICoqLw0KICBfcG9zdFByb2Nlc3NDb250ZW50OiBmdW5jdGlvbiAoYXJ0aWNsZUNvbnRlbnQpIHsNCiAgICAvLyBSZWFkYWJpbGl0eSBjYW5ub3Qgb3BlbiByZWxhdGl2ZSB1cmlzIHNvIHdlIGNvbnZlcnQgdGhlbSB0byBhYnNvbHV0ZSB1cmlzLg0KICAgIHRoaXMuX2ZpeFJlbGF0aXZlVXJpcyhhcnRpY2xlQ29udGVudCk7DQoNCiAgICB0aGlzLl9zaW1wbGlmeU5lc3RlZEVsZW1lbnRzKGFydGljbGVDb250ZW50KTsNCg0KICAgIGlmICghdGhpcy5fa2VlcENsYXNzZXMpIHsNCiAgICAgIC8vIFJlbW92ZSBjbGFzc2VzLg0KICAgICAgdGhpcy5fY2xlYW5DbGFzc2VzKGFydGljbGVDb250ZW50KTsNCiAgICB9DQogIH0sDQoNCiAgLyoqDQogICAqIEl0ZXJhdGVzIG92ZXIgYSBOb2RlTGlzdCwgY2FsbHMgYGZpbHRlckZuYCBmb3IgZWFjaCBub2RlIGFuZCByZW1vdmVzIG5vZGUNCiAgICogaWYgZnVuY3Rpb24gcmV0dXJuZWQgYHRydWVgLg0KICAgKg0KICAgKiBJZiBmdW5jdGlvbiBpcyBub3QgcGFzc2VkLCByZW1vdmVzIGFsbCB0aGUgbm9kZXMgaW4gbm9kZSBsaXN0Lg0KICAgKg0KICAgKiBAcGFyYW0gTm9kZUxpc3Qgbm9kZUxpc3QgVGhlIG5vZGVzIHRvIG9wZXJhdGUgb24NCiAgICogQHBhcmFtIEZ1bmN0aW9uIGZpbHRlckZuIHRoZSBmdW5jdGlvbiB0byB1c2UgYXMgYSBmaWx0ZXINCiAgICogQHJldHVybiB2b2lkDQogICAqLw0KICBfcmVtb3ZlTm9kZXM6IGZ1bmN0aW9uIChub2RlTGlzdCwgZmlsdGVyRm4pIHsNCiAgICAvLyBBdm9pZCBldmVyIG9wZXJhdGluZyBvbiBsaXZlIG5vZGUgbGlzdHMuDQogICAgaWYgKHRoaXMuX2RvY0pTRE9NUGFyc2VyICYmIG5vZGVMaXN0Ll9pc0xpdmVOb2RlTGlzdCkgew0KICAgICAgdGhyb3cgbmV3IEVycm9yKCJEbyBub3QgcGFzcyBsaXZlIG5vZGUgbGlzdHMgdG8gX3JlbW92ZU5vZGVzIik7DQogICAgfQ0KICAgIGZvciAodmFyIGkgPSBub2RlTGlzdC5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgew0KICAgICAgdmFyIG5vZGUgPSBub2RlTGlzdFtpXTsNCiAgICAgIHZhciBwYXJlbnROb2RlID0gbm9kZS5wYXJlbnROb2RlOw0KICAgICAgaWYgKHBhcmVudE5vZGUpIHsNCiAgICAgICAgaWYgKCFmaWx0ZXJGbiB8fCBmaWx0ZXJGbi5jYWxsKHRoaXMsIG5vZGUsIGksIG5vZGVMaXN0KSkgew0KICAgICAgICAgIHBhcmVudE5vZGUucmVtb3ZlQ2hpbGQobm9kZSk7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9DQogIH0sDQoNCiAgLyoqDQogICAqIEl0ZXJhdGVzIG92ZXIgYSBOb2RlTGlzdCwgYW5kIGNhbGxzIF9zZXROb2RlVGFnIGZvciBlYWNoIG5vZGUuDQogICAqDQogICAqIEBwYXJhbSBOb2RlTGlzdCBub2RlTGlzdCBUaGUgbm9kZXMgdG8gb3BlcmF0ZSBvbg0KICAgKiBAcGFyYW0gU3RyaW5nIG5ld1RhZ05hbWUgdGhlIG5ldyB0YWcgbmFtZSB0byB1c2UNCiAgICogQHJldHVybiB2b2lkDQogICAqLw0KICBfcmVwbGFjZU5vZGVUYWdzOiBmdW5jdGlvbiAobm9kZUxpc3QsIG5ld1RhZ05hbWUpIHsNCiAgICAvLyBBdm9pZCBldmVyIG9wZXJhdGluZyBvbiBsaXZlIG5vZGUgbGlzdHMuDQogICAgaWYgKHRoaXMuX2RvY0pTRE9NUGFyc2VyICYmIG5vZGVMaXN0Ll9pc0xpdmVOb2RlTGlzdCkgew0KICAgICAgdGhyb3cgbmV3IEVycm9yKCJEbyBub3QgcGFzcyBsaXZlIG5vZGUgbGlzdHMgdG8gX3JlcGxhY2VOb2RlVGFncyIpOw0KICAgIH0NCiAgICBmb3IgKGNvbnN0IG5vZGUgb2Ygbm9kZUxpc3QpIHsNCiAgICAgIHRoaXMuX3NldE5vZGVUYWcobm9kZSwgbmV3VGFnTmFtZSk7DQogICAgfQ0KICB9LA0KDQogIC8qKg0KICAgKiBJdGVyYXRlIG92ZXIgYSBOb2RlTGlzdCwgd2hpY2ggZG9lc24ndCBuYXRpdmVseSBmdWxseSBpbXBsZW1lbnQgdGhlIEFycmF5DQogICAqIGludGVyZmFjZS4NCiAgICoNCiAgICogRm9yIGNvbnZlbmllbmNlLCB0aGUgY3VycmVudCBvYmplY3QgY29udGV4dCBpcyBhcHBsaWVkIHRvIHRoZSBwcm92aWRlZA0KICAgKiBpdGVyYXRlIGZ1bmN0aW9uLg0KICAgKg0KICAgKiBAcGFyYW0gIE5vZGVMaXN0IG5vZGVMaXN0IFRoZSBOb2RlTGlzdC4NCiAgICogQHBhcmFtICBGdW5jdGlvbiBmbiAgICAgICBUaGUgaXRlcmF0ZSBmdW5jdGlvbi4NCiAgICogQHJldHVybiB2b2lkDQogICAqLw0KICBfZm9yRWFjaE5vZGU6IGZ1bmN0aW9uIChub2RlTGlzdCwgZm4pIHsNCiAgICBBcnJheS5wcm90b3R5cGUuZm9yRWFjaC5jYWxsKG5vZGVMaXN0LCBmbiwgdGhpcyk7DQogIH0sDQoNCiAgLyoqDQogICAqIEl0ZXJhdGUgb3ZlciBhIE5vZGVMaXN0LCBhbmQgcmV0dXJuIHRoZSBmaXJzdCBub2RlIHRoYXQgcGFzc2VzDQogICAqIHRoZSBzdXBwbGllZCB0ZXN0IGZ1bmN0aW9uDQogICAqDQogICAqIEZvciBjb252ZW5pZW5jZSwgdGhlIGN1cnJlbnQgb2JqZWN0IGNvbnRleHQgaXMgYXBwbGllZCB0byB0aGUgcHJvdmlkZWQNCiAgICogdGVzdCBmdW5jdGlvbi4NCiAgICoNCiAgICogQHBhcmFtICBOb2RlTGlzdCBub2RlTGlzdCBUaGUgTm9kZUxpc3QuDQogICAqIEBwYXJhbSAgRnVuY3Rpb24gZm4gICAgICAgVGhlIHRlc3QgZnVuY3Rpb24uDQogICAqIEByZXR1cm4gdm9pZA0KICAgKi8NCiAgX2ZpbmROb2RlOiBmdW5jdGlvbiAobm9kZUxpc3QsIGZuKSB7DQogICAgcmV0dXJuIEFycmF5LnByb3RvdHlwZS5maW5kLmNhbGwobm9kZUxpc3QsIGZuLCB0aGlzKTsNCiAgfSwNCg0KICAvKioNCiAgICogSXRlcmF0ZSBvdmVyIGEgTm9kZUxpc3QsIHJldHVybiB0cnVlIGlmIGFueSBvZiB0aGUgcHJvdmlkZWQgaXRlcmF0ZQ0KICAgKiBmdW5jdGlvbiBjYWxscyByZXR1cm5zIHRydWUsIGZhbHNlIG90aGVyd2lzZS4NCiAgICoNCiAgICogRm9yIGNvbnZlbmllbmNlLCB0aGUgY3VycmVudCBvYmplY3QgY29udGV4dCBpcyBhcHBsaWVkIHRvIHRoZQ0KICAgKiBwcm92aWRlZCBpdGVyYXRlIGZ1bmN0aW9uLg0KICAgKg0KICAgKiBAcGFyYW0gIE5vZGVMaXN0IG5vZGVMaXN0IFRoZSBOb2RlTGlzdC4NCiAgICogQHBhcmFtICBGdW5jdGlvbiBmbiAgICAgICBUaGUgaXRlcmF0ZSBmdW5jdGlvbi4NCiAgICogQHJldHVybiBCb29sZWFuDQogICAqLw0KICBfc29tZU5vZGU6IGZ1bmN0aW9uIChub2RlTGlzdCwgZm4pIHsNCiAgICByZXR1cm4gQXJyYXkucHJvdG90eXBlLnNvbWUuY2FsbChub2RlTGlzdCwgZm4sIHRoaXMpOw0KICB9LA0KDQogIC8qKg0KICAgKiBJdGVyYXRlIG92ZXIgYSBOb2RlTGlzdCwgcmV0dXJuIHRydWUgaWYgYWxsIG9mIHRoZSBwcm92aWRlZCBpdGVyYXRlDQogICAqIGZ1bmN0aW9uIGNhbGxzIHJldHVybiB0cnVlLCBmYWxzZSBvdGhlcndpc2UuDQogICAqDQogICAqIEZvciBjb252ZW5pZW5jZSwgdGhlIGN1cnJlbnQgb2JqZWN0IGNvbnRleHQgaXMgYXBwbGllZCB0byB0aGUNCiAgICogcHJvdmlkZWQgaXRlcmF0ZSBmdW5jdGlvbi4NCiAgICoNCiAgICogQHBhcmFtICBOb2RlTGlzdCBub2RlTGlzdCBUaGUgTm9kZUxpc3QuDQogICAqIEBwYXJhbSAgRnVuY3Rpb24gZm4gICAgICAgVGhlIGl0ZXJhdGUgZnVuY3Rpb24uDQogICAqIEByZXR1cm4gQm9vbGVhbg0KICAgKi8NCiAgX2V2ZXJ5Tm9kZTogZnVuY3Rpb24gKG5vZGVMaXN0LCBmbikgew0KICAgIHJldHVybiBBcnJheS5wcm90b3R5cGUuZXZlcnkuY2FsbChub2RlTGlzdCwgZm4sIHRoaXMpOw0KICB9LA0KDQogIC8qKg0KICAgKiBDb25jYXQgYWxsIG5vZGVsaXN0cyBwYXNzZWQgYXMgYXJndW1lbnRzLg0KICAgKg0KICAgKiBAcmV0dXJuIC4uLk5vZGVMaXN0DQogICAqIEByZXR1cm4gQXJyYXkNCiAgICovDQogIF9jb25jYXROb2RlTGlzdHM6IGZ1bmN0aW9uICgpIHsNCiAgICB2YXIgc2xpY2UgPSBBcnJheS5wcm90b3R5cGUuc2xpY2U7DQogICAgdmFyIGFyZ3MgPSBzbGljZS5jYWxsKGFyZ3VtZW50cyk7DQogICAgdmFyIG5vZGVMaXN0cyA9IGFyZ3MubWFwKGZ1bmN0aW9uIChsaXN0KSB7DQogICAgICByZXR1cm4gc2xpY2UuY2FsbChsaXN0KTsNCiAgICB9KTsNCiAgICByZXR1cm4gQXJyYXkucHJvdG90eXBlLmNvbmNhdC5hcHBseShbXSwgbm9kZUxpc3RzKTsNCiAgfSwNCg0KICBfZ2V0QWxsTm9kZXNXaXRoVGFnOiBmdW5jdGlvbiAobm9kZSwgdGFnTmFtZXMpIHsNCiAgICBpZiAobm9kZS5xdWVyeVNlbGVjdG9yQWxsKSB7DQogICAgICByZXR1cm4gbm9kZS5xdWVyeVNlbGVjdG9yQWxsKHRhZ05hbWVzLmpvaW4oIiwiKSk7DQogICAgfQ0KICAgIHJldHVybiBbXS5jb25jYXQuYXBwbHkoW10sIHRhZ05hbWVzLm1hcChmdW5jdGlvbiAodGFnKSB7DQogICAgICB2YXIgY29sbGVjdGlvbiA9IG5vZGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUodGFnKTsNCiAgICAgIHJldHVybiBBcnJheS5pc0FycmF5KGNvbGxlY3Rpb24pID8gY29sbGVjdGlvbiA6IEFycmF5LmZyb20oY29sbGVjdGlvbik7DQogICAgfSkpOw0KICB9LA0KDQogIC8qKg0KICAgKiBSZW1vdmVzIHRoZSBjbGFzcz0iIiBhdHRyaWJ1dGUgZnJvbSBldmVyeSBlbGVtZW50IGluIHRoZSBnaXZlbg0KICAgKiBzdWJ0cmVlLCBleGNlcHQgdGhvc2UgdGhhdCBtYXRjaCBDTEFTU0VTX1RPX1BSRVNFUlZFIGFuZA0KICAgKiB0aGUgY2xhc3Nlc1RvUHJlc2VydmUgYXJyYXkgZnJvbSB0aGUgb3B0aW9ucyBvYmplY3QuDQogICAqDQogICAqIEBwYXJhbSBFbGVtZW50DQogICAqIEByZXR1cm4gdm9pZA0KICAgKi8NCiAgX2NsZWFuQ2xhc3NlczogZnVuY3Rpb24gKG5vZGUpIHsNCiAgICB2YXIgY2xhc3Nlc1RvUHJlc2VydmUgPSB0aGlzLl9jbGFzc2VzVG9QcmVzZXJ2ZTsNCiAgICB2YXIgY2xhc3NOYW1lID0gKG5vZGUuZ2V0QXR0cmlidXRlKCJjbGFzcyIpIHx8ICIiKQ0KICAgICAgLnNwbGl0KC9ccysvKQ0KICAgICAgLmZpbHRlcihmdW5jdGlvbiAoY2xzKSB7DQogICAgICAgIHJldHVybiBjbGFzc2VzVG9QcmVzZXJ2ZS5pbmRleE9mKGNscykgIT0gLTE7DQogICAgICB9KQ0KICAgICAgLmpvaW4oIiAiKTsNCg0KICAgIGlmIChjbGFzc05hbWUpIHsNCiAgICAgIG5vZGUuc2V0QXR0cmlidXRlKCJjbGFzcyIsIGNsYXNzTmFtZSk7DQogICAgfSBlbHNlIHsNCiAgICAgIG5vZGUucmVtb3ZlQXR0cmlidXRlKCJjbGFzcyIpOw0KICAgIH0NCg0KICAgIGZvciAobm9kZSA9IG5vZGUuZmlyc3RFbGVtZW50Q2hpbGQ7IG5vZGU7IG5vZGUgPSBub2RlLm5leHRFbGVtZW50U2libGluZykgew0KICAgICAgdGhpcy5fY2xlYW5DbGFzc2VzKG5vZGUpOw0KICAgIH0NCiAgfSwNCg0KICAvKioNCiAgICogQ29udmVydHMgZWFjaCA8YT4gYW5kIDxpbWc+IHVyaSBpbiB0aGUgZ2l2ZW4gZWxlbWVudCB0byBhbiBhYnNvbHV0ZSBVUkksDQogICAqIGlnbm9yaW5nICNyZWYgVVJJcy4NCiAgICoNCiAgICogQHBhcmFtIEVsZW1lbnQNCiAgICogQHJldHVybiB2b2lkDQogICAqLw0KICBfZml4UmVsYXRpdmVVcmlzOiBmdW5jdGlvbiAoYXJ0aWNsZUNvbnRlbnQpIHsNCiAgICB2YXIgYmFzZVVSSSA9IHRoaXMubmV3QmFzZVVSSTsNCiAgICB2YXIgZG9jdW1lbnRVUkkgPSB0aGlzLl9kb2MuZG9jdW1lbnRVUkk7DQogICAgZnVuY3Rpb24gdG9BYnNvbHV0ZVVSSSh1cmkpIHsNCiAgICAgIC8vIExlYXZlIGhhc2ggbGlua3MgYWxvbmUgaWYgdGhlIGJhc2UgVVJJIG1hdGNoZXMgdGhlIGRvY3VtZW50IFVSSToNCiAgICAgIGlmIChiYXNlVVJJID09IGRvY3VtZW50VVJJICYmIHVyaS5jaGFyQXQoMCkgPT0gIiMiKSB7DQogICAgICAgIHJldHVybiB1cmk7DQogICAgICB9DQoNCiAgICAgIC8vIE90aGVyd2lzZSwgcmVzb2x2ZSBhZ2FpbnN0IGJhc2UgVVJJOg0KICAgICAgdHJ5IHsNCiAgICAgICAgcmV0dXJuIG5ldyBVUkwodXJpLCBiYXNlVVJJKS5ocmVmOw0KICAgICAgfSBjYXRjaCAoZXgpIHsNCiAgICAgICAgLy8gU29tZXRoaW5nIHdlbnQgd3JvbmcsIGp1c3QgcmV0dXJuIHRoZSBvcmlnaW5hbDoNCiAgICAgIH0NCiAgICAgIHJldHVybiB1cmk7DQogICAgfQ0KDQogICAgdmFyIGxpbmtzID0gdGhpcy5fZ2V0QWxsTm9kZXNXaXRoVGFnKGFydGljbGVDb250ZW50LCBbImEiXSk7DQogICAgdGhpcy5fZm9yRWFjaE5vZGUobGlua3MsIGZ1bmN0aW9uIChsaW5rKSB7DQogICAgICB2YXIgaHJlZiA9IGxpbmsuZ2V0QXR0cmlidXRlKCJocmVmIik7DQogICAgICBpZiAoaHJlZikgew0KICAgICAgICAvLyBSZW1vdmUgbGlua3Mgd2l0aCBqYXZhc2NyaXB0OiBVUklzLCBzaW5jZQ0KICAgICAgICAvLyB0aGV5IHdvbid0IHdvcmsgYWZ0ZXIgc2NyaXB0cyBoYXZlIGJlZW4gcmVtb3ZlZCBmcm9tIHRoZSBwYWdlLg0KICAgICAgICBpZiAoaHJlZi5pbmRleE9mKCJqYXZhc2NyaXB0OiIpID09PSAwKSB7DQogICAgICAgICAgLy8gaWYgdGhlIGxpbmsgb25seSBjb250YWlucyBzaW1wbGUgdGV4dCBjb250ZW50LCBpdCBjYW4gYmUgY29udmVydGVkIHRvIGEgdGV4dCBub2RlDQogICAgICAgICAgaWYgKGxpbmsuY2hpbGROb2Rlcy5sZW5ndGggPT09IDEgJiYgbGluay5jaGlsZE5vZGVzWzBdLm5vZGVUeXBlID09PSB0aGlzLlRFWFRfTk9ERSkgew0KICAgICAgICAgICAgdmFyIHRleHQgPSB0aGlzLl9kb2MuY3JlYXRlVGV4dE5vZGUobGluay50ZXh0Q29udGVudCk7DQogICAgICAgICAgICBsaW5rLnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKHRleHQsIGxpbmspOw0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAvLyBpZiB0aGUgbGluayBoYXMgbXVsdGlwbGUgY2hpbGRyZW4sIHRoZXkgc2hvdWxkIGFsbCBiZSBwcmVzZXJ2ZWQNCiAgICAgICAgICAgIHZhciBjb250YWluZXIgPSB0aGlzLl9kb2MuY3JlYXRlRWxlbWVudCgic3BhbiIpOw0KICAgICAgICAgICAgd2hpbGUgKGxpbmsuZmlyc3RDaGlsZCkgew0KICAgICAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQobGluay5maXJzdENoaWxkKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGxpbmsucGFyZW50Tm9kZS5yZXBsYWNlQ2hpbGQoY29udGFpbmVyLCBsaW5rKTsNCiAgICAgICAgICB9DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgbGluay5zZXRBdHRyaWJ1dGUoImhyZWYiLCB0b0Fic29sdXRlVVJJKGhyZWYpKTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0pOw0KDQogICAgdmFyIG1lZGlhcyA9IHRoaXMuX2dldEFsbE5vZGVzV2l0aFRhZyhhcnRpY2xlQ29udGVudCwgWw0KICAgICAgImltZyIsICJwaWN0dXJlIiwgImZpZ3VyZSIsICJ2aWRlbyIsICJhdWRpbyIsICJzb3VyY2UiDQogICAgXSk7DQoNCiAgICB0aGlzLl9mb3JFYWNoTm9kZShtZWRpYXMsIGZ1bmN0aW9uIChtZWRpYSkgew0KICAgICAgdmFyIHNyYyA9IG1lZGlhLmdldEF0dHJpYnV0ZSgic3JjIik7DQogICAgICB2YXIgcG9zdGVyID0gbWVkaWEuZ2V0QXR0cmlidXRlKCJwb3N0ZXIiKTsNCiAgICAgIHZhciBzcmNzZXQgPSBtZWRpYS5nZXRBdHRyaWJ1dGUoInNyY3NldCIpOw0KDQogICAgICBpZiAoc3JjKSB7DQogICAgICAgIG1lZGlhLnNldEF0dHJpYnV0ZSgic3JjIiwgdG9BYnNvbHV0ZVVSSShzcmMpKTsNCiAgICAgIH0NCg0KICAgICAgaWYgKHBvc3Rlcikgew0KICAgICAgICBtZWRpYS5zZXRBdHRyaWJ1dGUoInBvc3RlciIsIHRvQWJzb2x1dGVVUkkocG9zdGVyKSk7DQogICAgICB9DQoNCiAgICAgIGlmIChzcmNzZXQpIHsNCiAgICAgICAgdmFyIG5ld1NyY3NldCA9IHNyY3NldC5yZXBsYWNlKHRoaXMuUkVHRVhQUy5zcmNzZXRVcmwsIGZ1bmN0aW9uIChfLCBwMSwgcDIsIHAzKSB7DQogICAgICAgICAgcmV0dXJuIHRvQWJzb2x1dGVVUkkocDEpICsgKHAyIHx8ICIiKSArIHAzOw0KICAgICAgICB9KTsNCg0KICAgICAgICBtZWRpYS5zZXRBdHRyaWJ1dGUoInNyY3NldCIsIG5ld1NyY3NldCk7DQogICAgICB9DQogICAgfSk7DQogIH0sDQoNCiAgX3NpbXBsaWZ5TmVzdGVkRWxlbWVudHM6IGZ1bmN0aW9uIChhcnRpY2xlQ29udGVudCkgew0KICAgIHZhciBub2RlID0gYXJ0aWNsZUNvbnRlbnQ7DQoNCiAgICB3aGlsZSAobm9kZSkgew0KICAgICAgaWYgKG5vZGUucGFyZW50Tm9kZSAmJiBbIkRJViIsICJTRUNUSU9OIl0uaW5jbHVkZXMobm9kZS50YWdOYW1lKSAmJiAhKG5vZGUuaWQgJiYgbm9kZS5pZC5zdGFydHNXaXRoKCJyZWFkYWJpbGl0eSIpKSkgew0KICAgICAgICBpZiAodGhpcy5faXNFbGVtZW50V2l0aG91dENvbnRlbnQobm9kZSkpIHsNCiAgICAgICAgICBub2RlID0gdGhpcy5fcmVtb3ZlQW5kR2V0TmV4dChub2RlKTsNCiAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgfSBlbHNlIGlmICh0aGlzLl9oYXNTaW5nbGVUYWdJbnNpZGVFbGVtZW50KG5vZGUsICJESVYiKSB8fCB0aGlzLl9oYXNTaW5nbGVUYWdJbnNpZGVFbGVtZW50KG5vZGUsICJTRUNUSU9OIikpIHsNCiAgICAgICAgICB2YXIgY2hpbGQgPSBub2RlLmNoaWxkcmVuWzBdOw0KICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbm9kZS5hdHRyaWJ1dGVzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICBjaGlsZC5zZXRBdHRyaWJ1dGUobm9kZS5hdHRyaWJ1dGVzW2ldLm5hbWUsIG5vZGUuYXR0cmlidXRlc1tpXS52YWx1ZSk7DQogICAgICAgICAgfQ0KICAgICAgICAgIG5vZGUucGFyZW50Tm9kZS5yZXBsYWNlQ2hpbGQoY2hpbGQsIG5vZGUpOw0KICAgICAgICAgIG5vZGUgPSBjaGlsZDsNCiAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgfQ0KICAgICAgfQ0KDQogICAgICBub2RlID0gdGhpcy5fZ2V0TmV4dE5vZGUobm9kZSk7DQogICAgfQ0KICB9LA0KDQogIC8qKg0KICAgKiBHZXQgdGhlIGFydGljbGUgdGl0bGUgYXMgYW4gSDEuDQogICAqDQogICAqIEByZXR1cm4gc3RyaW5nDQogICAqKi8NCiAgX2dldEFydGljbGVUaXRsZTogZnVuY3Rpb24gKCkgew0KICAgIHZhciBkb2MgPSB0aGlzLl9kb2M7DQogICAgdmFyIGN1clRpdGxlID0gIiI7DQogICAgdmFyIG9yaWdUaXRsZSA9ICIiOw0KDQogICAgdHJ5IHsNCiAgICAgIGN1clRpdGxlID0gb3JpZ1RpdGxlID0gZG9jLnRpdGxlLnRyaW0oKTsNCg0KICAgICAgLy8gSWYgdGhleSBoYWQgYW4gZWxlbWVudCB3aXRoIGlkICJ0aXRsZSIgaW4gdGhlaXIgSFRNTA0KICAgICAgaWYgKHR5cGVvZiBjdXJUaXRsZSAhPT0gInN0cmluZyIpDQogICAgICAgIGN1clRpdGxlID0gb3JpZ1RpdGxlID0gdGhpcy5fZ2V0SW5uZXJUZXh0KGRvYy5nZXRFbGVtZW50c0J5VGFnTmFtZSgidGl0bGUiKVswXSk7DQogICAgfSBjYXRjaCAoZSkgey8qIGlnbm9yZSBleGNlcHRpb25zIHNldHRpbmcgdGhlIHRpdGxlLiAqLyB9DQoNCiAgICB2YXIgdGl0bGVIYWRIaWVyYXJjaGljYWxTZXBhcmF0b3JzID0gZmFsc2U7DQogICAgZnVuY3Rpb24gd29yZENvdW50KHN0cikgew0KICAgICAgcmV0dXJuIHN0ci5zcGxpdCgvXHMrLykubGVuZ3RoOw0KICAgIH0NCg0KICAgIC8vIElmIHRoZXJlJ3MgYSBzZXBhcmF0b3IgaW4gdGhlIHRpdGxlLCBmaXJzdCByZW1vdmUgdGhlIGZpbmFsIHBhcnQNCiAgICBpZiAoKC8gW1x8XC1cXFwvPsK7XSAvKS50ZXN0KGN1clRpdGxlKSkgew0KICAgICAgdGl0bGVIYWRIaWVyYXJjaGljYWxTZXBhcmF0b3JzID0gLyBbXFxcLz7Cu10gLy50ZXN0KGN1clRpdGxlKTsNCiAgICAgIGN1clRpdGxlID0gb3JpZ1RpdGxlLnJlcGxhY2UoLyguKilbXHxcLVxcXC8+wrtdIC4qL2dpLCAiJDEiKTsNCg0KICAgICAgLy8gSWYgdGhlIHJlc3VsdGluZyB0aXRsZSBpcyB0b28gc2hvcnQgKDMgd29yZHMgb3IgZmV3ZXIpLCByZW1vdmUNCiAgICAgIC8vIHRoZSBmaXJzdCBwYXJ0IGluc3RlYWQ6DQogICAgICBpZiAod29yZENvdW50KGN1clRpdGxlKSA8IDMpDQogICAgICAgIGN1clRpdGxlID0gb3JpZ1RpdGxlLnJlcGxhY2UoL1teXHxcLVxcXC8+wrtdKltcfFwtXFxcLz7Cu10oLiopL2dpLCAiJDEiKTsNCiAgICB9IGVsc2UgaWYgKGN1clRpdGxlLmluZGV4T2YoIjogIikgIT09IC0xKSB7DQogICAgICAvLyBDaGVjayBpZiB3ZSBoYXZlIGFuIGhlYWRpbmcgY29udGFpbmluZyB0aGlzIGV4YWN0IHN0cmluZywgc28gd2UNCiAgICAgIC8vIGNvdWxkIGFzc3VtZSBpdCdzIHRoZSBmdWxsIHRpdGxlLg0KICAgICAgdmFyIGhlYWRpbmdzID0gdGhpcy5fY29uY2F0Tm9kZUxpc3RzKA0KICAgICAgICBkb2MuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImgxIiksDQogICAgICAgIGRvYy5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaDIiKQ0KICAgICAgKTsNCiAgICAgIHZhciB0cmltbWVkVGl0bGUgPSBjdXJUaXRsZS50cmltKCk7DQogICAgICB2YXIgbWF0Y2ggPSB0aGlzLl9zb21lTm9kZShoZWFkaW5ncywgZnVuY3Rpb24gKGhlYWRpbmcpIHsNCiAgICAgICAgcmV0dXJuIGhlYWRpbmcudGV4dENvbnRlbnQudHJpbSgpID09PSB0cmltbWVkVGl0bGU7DQogICAgICB9KTsNCg0KICAgICAgLy8gSWYgd2UgZG9uJ3QsIGxldCdzIGV4dHJhY3QgdGhlIHRpdGxlIG91dCBvZiB0aGUgb3JpZ2luYWwgdGl0bGUgc3RyaW5nLg0KICAgICAgaWYgKCFtYXRjaCkgew0KICAgICAgICBjdXJUaXRsZSA9IG9yaWdUaXRsZS5zdWJzdHJpbmcob3JpZ1RpdGxlLmxhc3RJbmRleE9mKCI6IikgKyAxKTsNCg0KICAgICAgICAvLyBJZiB0aGUgdGl0bGUgaXMgbm93IHRvbyBzaG9ydCwgdHJ5IHRoZSBmaXJzdCBjb2xvbiBpbnN0ZWFkOg0KICAgICAgICBpZiAod29yZENvdW50KGN1clRpdGxlKSA8IDMpIHsNCiAgICAgICAgICBjdXJUaXRsZSA9IG9yaWdUaXRsZS5zdWJzdHJpbmcob3JpZ1RpdGxlLmluZGV4T2YoIjoiKSArIDEpOw0KICAgICAgICAgIC8vIEJ1dCBpZiB3ZSBoYXZlIHRvbyBtYW55IHdvcmRzIGJlZm9yZSB0aGUgY29sb24gdGhlcmUncyBzb21ldGhpbmcgd2VpcmQNCiAgICAgICAgICAvLyB3aXRoIHRoZSB0aXRsZXMgYW5kIHRoZSBIIHRhZ3Mgc28gbGV0J3MganVzdCB1c2UgdGhlIG9yaWdpbmFsIHRpdGxlIGluc3RlYWQNCiAgICAgICAgfSBlbHNlIGlmICh3b3JkQ291bnQob3JpZ1RpdGxlLnN1YnN0cigwLCBvcmlnVGl0bGUuaW5kZXhPZigiOiIpKSkgPiA1KSB7DQogICAgICAgICAgY3VyVGl0bGUgPSBvcmlnVGl0bGU7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9IGVsc2UgaWYgKGN1clRpdGxlLmxlbmd0aCA+IDE1MCB8fCBjdXJUaXRsZS5sZW5ndGggPCAxNSkgew0KICAgICAgdmFyIGhPbmVzID0gZG9jLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJoMSIpOw0KDQogICAgICBpZiAoaE9uZXMubGVuZ3RoID09PSAxKQ0KICAgICAgICBjdXJUaXRsZSA9IHRoaXMuX2dldElubmVyVGV4dChoT25lc1swXSk7DQogICAgfQ0KDQogICAgY3VyVGl0bGUgPSBjdXJUaXRsZS50cmltKCkucmVwbGFjZSh0aGlzLlJFR0VYUFMubm9ybWFsaXplLCAiICIpOw0KICAgIC8vIElmIHdlIG5vdyBoYXZlIDQgd29yZHMgb3IgZmV3ZXIgYXMgb3VyIHRpdGxlLCBhbmQgZWl0aGVyIG5vDQogICAgLy8gJ2hpZXJhcmNoaWNhbCcgc2VwYXJhdG9ycyAoXCwgLywgPiBvciDCuykgd2VyZSBmb3VuZCBpbiB0aGUgb3JpZ2luYWwNCiAgICAvLyB0aXRsZSBvciB3ZSBkZWNyZWFzZWQgdGhlIG51bWJlciBvZiB3b3JkcyBieSBtb3JlIHRoYW4gMSB3b3JkLCB1c2UNCiAgICAvLyB0aGUgb3JpZ2luYWwgdGl0bGUuDQogICAgdmFyIGN1clRpdGxlV29yZENvdW50ID0gd29yZENvdW50KGN1clRpdGxlKTsNCiAgICBpZiAoY3VyVGl0bGVXb3JkQ291bnQgPD0gNCAmJg0KICAgICAgKCF0aXRsZUhhZEhpZXJhcmNoaWNhbFNlcGFyYXRvcnMgfHwNCiAgICAgICAgY3VyVGl0bGVXb3JkQ291bnQgIT0gd29yZENvdW50KG9yaWdUaXRsZS5yZXBsYWNlKC9bXHxcLVxcXC8+wrtdKy9nLCAiIikpIC0gMSkpIHsNCiAgICAgIGN1clRpdGxlID0gb3JpZ1RpdGxlOw0KICAgIH0NCg0KICAgIHJldHVybiBjdXJUaXRsZTsNCiAgfSwNCg0KICAvKioNCiAgICogUHJlcGFyZSB0aGUgSFRNTCBkb2N1bWVudCBmb3IgcmVhZGFiaWxpdHkgdG8gc2NyYXBlIGl0Lg0KICAgKiBUaGlzIGluY2x1ZGVzIHRoaW5ncyBsaWtlIHN0cmlwcGluZyBqYXZhc2NyaXB0LCBDU1MsIGFuZCBoYW5kbGluZyB0ZXJyaWJsZSBtYXJrdXAuDQogICAqDQogICAqIEByZXR1cm4gdm9pZA0KICAgKiovDQogIF9wcmVwRG9jdW1lbnQ6IGZ1bmN0aW9uICgpIHsNCiAgICB2YXIgZG9jID0gdGhpcy5fZG9jOw0KDQogICAgLy8gUmVtb3ZlIGFsbCBzdHlsZSB0YWdzIGluIGhlYWQNCiAgICB0aGlzLl9yZW1vdmVOb2Rlcyh0aGlzLl9nZXRBbGxOb2Rlc1dpdGhUYWcoZG9jLCBbInN0eWxlIl0pKTsNCg0KICAgIGlmIChkb2MuYm9keSkgew0KICAgICAgdGhpcy5fcmVwbGFjZUJycyhkb2MuYm9keSk7DQogICAgfQ0KDQogICAgdGhpcy5fcmVwbGFjZU5vZGVUYWdzKHRoaXMuX2dldEFsbE5vZGVzV2l0aFRhZyhkb2MsIFsiZm9udCJdKSwgIlNQQU4iKTsNCiAgfSwNCg0KICAvKioNCiAgICogRmluZHMgdGhlIG5leHQgbm9kZSwgc3RhcnRpbmcgZnJvbSB0aGUgZ2l2ZW4gbm9kZSwgYW5kIGlnbm9yaW5nDQogICAqIHdoaXRlc3BhY2UgaW4gYmV0d2Vlbi4gSWYgdGhlIGdpdmVuIG5vZGUgaXMgYW4gZWxlbWVudCwgdGhlIHNhbWUgbm9kZSBpcw0KICAgKiByZXR1cm5lZC4NCiAgICovDQogIF9uZXh0Tm9kZTogZnVuY3Rpb24gKG5vZGUpIHsNCiAgICB2YXIgbmV4dCA9IG5vZGU7DQogICAgd2hpbGUgKG5leHQNCiAgICAgICYmIChuZXh0Lm5vZGVUeXBlICE9IHRoaXMuRUxFTUVOVF9OT0RFKQ0KICAgICAgJiYgdGhpcy5SRUdFWFBTLndoaXRlc3BhY2UudGVzdChuZXh0LnRleHRDb250ZW50KSkgew0KICAgICAgbmV4dCA9IG5leHQubmV4dFNpYmxpbmc7DQogICAgfQ0KICAgIHJldHVybiBuZXh0Ow0KICB9LA0KDQogIC8qKg0KICAgKiBSZXBsYWNlcyAyIG9yIG1vcmUgc3VjY2Vzc2l2ZSA8YnI+IGVsZW1lbnRzIHdpdGggYSBzaW5nbGUgPHA+Lg0KICAgKiBXaGl0ZXNwYWNlIGJldHdlZW4gPGJyPiBlbGVtZW50cyBhcmUgaWdub3JlZC4gRm9yIGV4YW1wbGU6DQogICAqICAgPGRpdj5mb288YnI+YmFyPGJyPiA8YnI+PGJyPmFiYzwvZGl2Pg0KICAgKiB3aWxsIGJlY29tZToNCiAgICogICA8ZGl2PmZvbzxicj5iYXI8cD5hYmM8L3A+PC9kaXY+DQogICAqLw0KICBfcmVwbGFjZUJyczogZnVuY3Rpb24gKGVsZW0pIHsNCiAgICB0aGlzLl9mb3JFYWNoTm9kZSh0aGlzLl9nZXRBbGxOb2Rlc1dpdGhUYWcoZWxlbSwgWyJiciJdKSwgZnVuY3Rpb24gKGJyKSB7DQogICAgICB2YXIgbmV4dCA9IGJyLm5leHRTaWJsaW5nOw0KDQogICAgICAvLyBXaGV0aGVyIDIgb3IgbW9yZSA8YnI+IGVsZW1lbnRzIGhhdmUgYmVlbiBmb3VuZCBhbmQgcmVwbGFjZWQgd2l0aCBhDQogICAgICAvLyA8cD4gYmxvY2suDQogICAgICB2YXIgcmVwbGFjZWQgPSBmYWxzZTsNCg0KICAgICAgLy8gSWYgd2UgZmluZCBhIDxicj4gY2hhaW4sIHJlbW92ZSB0aGUgPGJyPnMgdW50aWwgd2UgaGl0IGFub3RoZXIgbm9kZQ0KICAgICAgLy8gb3Igbm9uLXdoaXRlc3BhY2UuIFRoaXMgbGVhdmVzIGJlaGluZCB0aGUgZmlyc3QgPGJyPiBpbiB0aGUgY2hhaW4NCiAgICAgIC8vICh3aGljaCB3aWxsIGJlIHJlcGxhY2VkIHdpdGggYSA8cD4gbGF0ZXIpLg0KICAgICAgd2hpbGUgKChuZXh0ID0gdGhpcy5fbmV4dE5vZGUobmV4dCkpICYmIChuZXh0LnRhZ05hbWUgPT0gIkJSIikpIHsNCiAgICAgICAgcmVwbGFjZWQgPSB0cnVlOw0KICAgICAgICB2YXIgYnJTaWJsaW5nID0gbmV4dC5uZXh0U2libGluZzsNCiAgICAgICAgbmV4dC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKG5leHQpOw0KICAgICAgICBuZXh0ID0gYnJTaWJsaW5nOw0KICAgICAgfQ0KDQogICAgICAvLyBJZiB3ZSByZW1vdmVkIGEgPGJyPiBjaGFpbiwgcmVwbGFjZSB0aGUgcmVtYWluaW5nIDxicj4gd2l0aCBhIDxwPi4gQWRkDQogICAgICAvLyBhbGwgc2libGluZyBub2RlcyBhcyBjaGlsZHJlbiBvZiB0aGUgPHA+IHVudGlsIHdlIGhpdCBhbm90aGVyIDxicj4NCiAgICAgIC8vIGNoYWluLg0KICAgICAgaWYgKHJlcGxhY2VkKSB7DQogICAgICAgIHZhciBwID0gdGhpcy5fZG9jLmNyZWF0ZUVsZW1lbnQoInAiKTsNCiAgICAgICAgYnIucGFyZW50Tm9kZS5yZXBsYWNlQ2hpbGQocCwgYnIpOw0KDQogICAgICAgIG5leHQgPSBwLm5leHRTaWJsaW5nOw0KICAgICAgICB3aGlsZSAobmV4dCkgew0KICAgICAgICAgIC8vIElmIHdlJ3ZlIGhpdCBhbm90aGVyIDxicj48YnI+LCB3ZSdyZSBkb25lIGFkZGluZyBjaGlsZHJlbiB0byB0aGlzIDxwPi4NCiAgICAgICAgICBpZiAobmV4dC50YWdOYW1lID09ICJCUiIpIHsNCiAgICAgICAgICAgIHZhciBuZXh0RWxlbSA9IHRoaXMuX25leHROb2RlKG5leHQubmV4dFNpYmxpbmcpOw0KICAgICAgICAgICAgaWYgKG5leHRFbGVtICYmIG5leHRFbGVtLnRhZ05hbWUgPT0gIkJSIikNCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgaWYgKCF0aGlzLl9pc1BocmFzaW5nQ29udGVudChuZXh0KSkNCiAgICAgICAgICAgIGJyZWFrOw0KDQogICAgICAgICAgLy8gT3RoZXJ3aXNlLCBtYWtlIHRoaXMgbm9kZSBhIGNoaWxkIG9mIHRoZSBuZXcgPHA+Lg0KICAgICAgICAgIHZhciBzaWJsaW5nID0gbmV4dC5uZXh0U2libGluZzsNCiAgICAgICAgICBwLmFwcGVuZENoaWxkKG5leHQpOw0KICAgICAgICAgIG5leHQgPSBzaWJsaW5nOw0KICAgICAgICB9DQoNCiAgICAgICAgd2hpbGUgKHAubGFzdENoaWxkICYmIHRoaXMuX2lzV2hpdGVzcGFjZShwLmxhc3RDaGlsZCkpIHsNCiAgICAgICAgICBwLnJlbW92ZUNoaWxkKHAubGFzdENoaWxkKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChwLnBhcmVudE5vZGUudGFnTmFtZSA9PT0gIlAiKQ0KICAgICAgICAgIHRoaXMuX3NldE5vZGVUYWcocC5wYXJlbnROb2RlLCAiRElWIik7DQogICAgICB9DQogICAgfSk7DQogIH0sDQoNCiAgX3NldE5vZGVUYWc6IGZ1bmN0aW9uIChub2RlLCB0YWcpIHsNCiAgICB0aGlzLmxvZygiX3NldE5vZGVUYWciLCBub2RlLCB0YWcpOw0KICAgIGlmICh0aGlzLl9kb2NKU0RPTVBhcnNlcikgew0KICAgICAgbm9kZS5sb2NhbE5hbWUgPSB0YWcudG9Mb3dlckNhc2UoKTsNCiAgICAgIG5vZGUudGFnTmFtZSA9IHRhZy50b1VwcGVyQ2FzZSgpOw0KICAgICAgcmV0dXJuIG5vZGU7DQogICAgfQ0KDQogICAgdmFyIHJlcGxhY2VtZW50ID0gbm9kZS5vd25lckRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTsNCiAgICB3aGlsZSAobm9kZS5maXJzdENoaWxkKSB7DQogICAgICByZXBsYWNlbWVudC5hcHBlbmRDaGlsZChub2RlLmZpcnN0Q2hpbGQpOw0KICAgIH0NCiAgICBub2RlLnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKHJlcGxhY2VtZW50LCBub2RlKTsNCiAgICBpZiAobm9kZS5yZWFkYWJpbGl0eSkNCiAgICAgIHJlcGxhY2VtZW50LnJlYWRhYmlsaXR5ID0gbm9kZS5yZWFkYWJpbGl0eTsNCg0KICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbm9kZS5hdHRyaWJ1dGVzLmxlbmd0aDsgaSsrKSB7DQogICAgICB0cnkgew0KICAgICAgICByZXBsYWNlbWVudC5zZXRBdHRyaWJ1dGUobm9kZS5hdHRyaWJ1dGVzW2ldLm5hbWUsIG5vZGUuYXR0cmlidXRlc1tpXS52YWx1ZSk7DQogICAgICB9IGNhdGNoIChleCkgew0KICAgICAgICAvKiBpdCdzIHBvc3NpYmxlIGZvciBzZXRBdHRyaWJ1dGUoKSB0byB0aHJvdyBpZiB0aGUgYXR0cmlidXRlIG5hbWUNCiAgICAgICAgICogaXNuJ3QgYSB2YWxpZCBYTUwgTmFtZS4gU3VjaCBhdHRyaWJ1dGVzIGNhbiBob3dldmVyIGJlIHBhcnNlZCBmcm9tDQogICAgICAgICAqIHNvdXJjZSBpbiBIVE1MIGRvY3MsIHNlZSBodHRwczovL2dpdGh1Yi5jb20vd2hhdHdnL2h0bWwvaXNzdWVzLzQyNzUsDQogICAgICAgICAqIHNvIHdlIGNhbiBoaXQgdGhlbSBoZXJlIGFuZCB0aGVuIHRocm93LiBXZSBkb24ndCBjYXJlIGFib3V0IHN1Y2gNCiAgICAgICAgICogYXR0cmlidXRlcyBzbyB3ZSBpZ25vcmUgdGhlbS4NCiAgICAgICAgICovDQogICAgICB9DQogICAgfQ0KICAgIHJldHVybiByZXBsYWNlbWVudDsNCiAgfSwNCg0KICAvKioNCiAgICogUHJlcGFyZSB0aGUgYXJ0aWNsZSBub2RlIGZvciBkaXNwbGF5LiBDbGVhbiBvdXQgYW55IGlubGluZSBzdHlsZXMsDQogICAqIGlmcmFtZXMsIGZvcm1zLCBzdHJpcCBleHRyYW5lb3VzIDxwPiB0YWdzLCBldGMuDQogICAqDQogICAqIEBwYXJhbSBFbGVtZW50DQogICAqIEByZXR1cm4gdm9pZA0KICAgKiovDQogIF9wcmVwQXJ0aWNsZTogZnVuY3Rpb24gKGFydGljbGVDb250ZW50KSB7DQogICAgdGhpcy5fY2xlYW5TdHlsZXMoYXJ0aWNsZUNvbnRlbnQpOw0KDQogICAgLy8gQ2hlY2sgZm9yIGRhdGEgdGFibGVzIGJlZm9yZSB3ZSBjb250aW51ZSwgdG8gYXZvaWQgcmVtb3ZpbmcgaXRlbXMgaW4NCiAgICAvLyB0aG9zZSB0YWJsZXMsIHdoaWNoIHdpbGwgb2Z0ZW4gYmUgaXNvbGF0ZWQgZXZlbiB0aG91Z2ggdGhleSdyZQ0KICAgIC8vIHZpc3VhbGx5IGxpbmtlZCB0byBvdGhlciBjb250ZW50LWZ1bCBlbGVtZW50cyAodGV4dCwgaW1hZ2VzLCBldGMuKS4NCiAgICB0aGlzLl9tYXJrRGF0YVRhYmxlcyhhcnRpY2xlQ29udGVudCk7DQoNCiAgICB0aGlzLl9maXhMYXp5SW1hZ2VzKGFydGljbGVDb250ZW50KTsNCg0KICAgIC8vIENsZWFuIG91dCBqdW5rIGZyb20gdGhlIGFydGljbGUgY29udGVudA0KICAgIHRoaXMuX2NsZWFuQ29uZGl0aW9uYWxseShhcnRpY2xlQ29udGVudCwgImZvcm0iKTsNCiAgICB0aGlzLl9jbGVhbkNvbmRpdGlvbmFsbHkoYXJ0aWNsZUNvbnRlbnQsICJmaWVsZHNldCIpOw0KICAgIHRoaXMuX2NsZWFuKGFydGljbGVDb250ZW50LCAib2JqZWN0Iik7DQogICAgdGhpcy5fY2xlYW4oYXJ0aWNsZUNvbnRlbnQsICJlbWJlZCIpOw0KICAgIHRoaXMuX2NsZWFuKGFydGljbGVDb250ZW50LCAiZm9vdGVyIik7DQogICAgdGhpcy5fY2xlYW4oYXJ0aWNsZUNvbnRlbnQsICJsaW5rIik7DQogICAgdGhpcy5fY2xlYW4oYXJ0aWNsZUNvbnRlbnQsICJhc2lkZSIpOw0KDQogICAgLy8gQ2xlYW4gb3V0IGVsZW1lbnRzIHdpdGggbGl0dGxlIGNvbnRlbnQgdGhhdCBoYXZlICJzaGFyZSIgaW4gdGhlaXIgaWQvY2xhc3MgY29tYmluYXRpb25zIGZyb20gZmluYWwgdG9wIGNhbmRpZGF0ZXMsDQogICAgLy8gd2hpY2ggbWVhbnMgd2UgZG9uJ3QgcmVtb3ZlIHRoZSB0b3AgY2FuZGlkYXRlcyBldmVuIHRoZXkgaGF2ZSAic2hhcmUiLg0KDQogICAgdmFyIHNoYXJlRWxlbWVudFRocmVzaG9sZCA9IHRoaXMuREVGQVVMVF9DSEFSX1RIUkVTSE9MRDsNCg0KICAgIHRoaXMuX2ZvckVhY2hOb2RlKGFydGljbGVDb250ZW50LmNoaWxkcmVuLCBmdW5jdGlvbiAodG9wQ2FuZGlkYXRlKSB7DQogICAgICB0aGlzLl9jbGVhbk1hdGNoZWROb2Rlcyh0b3BDYW5kaWRhdGUsIGZ1bmN0aW9uIChub2RlLCBtYXRjaFN0cmluZykgew0KICAgICAgICByZXR1cm4gdGhpcy5SRUdFWFBTLnNoYXJlRWxlbWVudHMudGVzdChtYXRjaFN0cmluZykgJiYgbm9kZS50ZXh0Q29udGVudC5sZW5ndGggPCBzaGFyZUVsZW1lbnRUaHJlc2hvbGQ7DQogICAgICB9KTsNCiAgICB9KTsNCg0KICAgIHRoaXMuX2NsZWFuKGFydGljbGVDb250ZW50LCAiaWZyYW1lIik7DQogICAgdGhpcy5fY2xlYW4oYXJ0aWNsZUNvbnRlbnQsICJpbnB1dCIpOw0KICAgIHRoaXMuX2NsZWFuKGFydGljbGVDb250ZW50LCAidGV4dGFyZWEiKTsNCiAgICB0aGlzLl9jbGVhbihhcnRpY2xlQ29udGVudCwgInNlbGVjdCIpOw0KICAgIHRoaXMuX2NsZWFuKGFydGljbGVDb250ZW50LCAiYnV0dG9uIik7DQogICAgdGhpcy5fY2xlYW5IZWFkZXJzKGFydGljbGVDb250ZW50KTsNCg0KICAgIC8vIERvIHRoZXNlIGxhc3QgYXMgdGhlIHByZXZpb3VzIHN0dWZmIG1heSBoYXZlIHJlbW92ZWQganVuaw0KICAgIC8vIHRoYXQgd2lsbCBhZmZlY3QgdGhlc2UNCiAgICB0aGlzLl9jbGVhbkNvbmRpdGlvbmFsbHkoYXJ0aWNsZUNvbnRlbnQsICJ0YWJsZSIpOw0KICAgIHRoaXMuX2NsZWFuQ29uZGl0aW9uYWxseShhcnRpY2xlQ29udGVudCwgInVsIik7DQogICAgdGhpcy5fY2xlYW5Db25kaXRpb25hbGx5KGFydGljbGVDb250ZW50LCAiZGl2Iik7DQoNCiAgICAvLyByZXBsYWNlIEgxIHdpdGggSDIgYXMgSDEgc2hvdWxkIGJlIG9ubHkgdGl0bGUgdGhhdCBpcyBkaXNwbGF5ZWQgc2VwYXJhdGVseQ0KICAgIHRoaXMuX3JlcGxhY2VOb2RlVGFncyh0aGlzLl9nZXRBbGxOb2Rlc1dpdGhUYWcoYXJ0aWNsZUNvbnRlbnQsIFsiaDEiXSksICJoMiIpOw0KDQogICAgLy8gUmVtb3ZlIGV4dHJhIHBhcmFncmFwaHMNCiAgICB0aGlzLl9yZW1vdmVOb2Rlcyh0aGlzLl9nZXRBbGxOb2Rlc1dpdGhUYWcoYXJ0aWNsZUNvbnRlbnQsIFsicCJdKSwgZnVuY3Rpb24gKHBhcmFncmFwaCkgew0KICAgICAgdmFyIGltZ0NvdW50ID0gcGFyYWdyYXBoLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJpbWciKS5sZW5ndGg7DQogICAgICB2YXIgZW1iZWRDb3VudCA9IHBhcmFncmFwaC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiZW1iZWQiKS5sZW5ndGg7DQogICAgICB2YXIgb2JqZWN0Q291bnQgPSBwYXJhZ3JhcGguZ2V0RWxlbWVudHNCeVRhZ05hbWUoIm9iamVjdCIpLmxlbmd0aDsNCiAgICAgIC8vIEF0IHRoaXMgcG9pbnQsIG5hc3R5IGlmcmFtZXMgaGF2ZSBiZWVuIHJlbW92ZWQsIG9ubHkgcmVtYWluIGVtYmVkZGVkIHZpZGVvIG9uZXMuDQogICAgICB2YXIgaWZyYW1lQ291bnQgPSBwYXJhZ3JhcGguZ2V0RWxlbWVudHNCeVRhZ05hbWUoImlmcmFtZSIpLmxlbmd0aDsNCiAgICAgIHZhciB0b3RhbENvdW50ID0gaW1nQ291bnQgKyBlbWJlZENvdW50ICsgb2JqZWN0Q291bnQgKyBpZnJhbWVDb3VudDsNCg0KICAgICAgcmV0dXJuIHRvdGFsQ291bnQgPT09IDAgJiYgIXRoaXMuX2dldElubmVyVGV4dChwYXJhZ3JhcGgsIGZhbHNlKTsNCiAgICB9KTsNCg0KICAgIHRoaXMuX2ZvckVhY2hOb2RlKHRoaXMuX2dldEFsbE5vZGVzV2l0aFRhZyhhcnRpY2xlQ29udGVudCwgWyJiciJdKSwgZnVuY3Rpb24gKGJyKSB7DQogICAgICB2YXIgbmV4dCA9IHRoaXMuX25leHROb2RlKGJyLm5leHRTaWJsaW5nKTsNCiAgICAgIGlmIChuZXh0ICYmIG5leHQudGFnTmFtZSA9PSAiUCIpDQogICAgICAgIGJyLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoYnIpOw0KICAgIH0pOw0KDQogICAgLy8gUmVtb3ZlIHNpbmdsZS1jZWxsIHRhYmxlcw0KICAgIHRoaXMuX2ZvckVhY2hOb2RlKHRoaXMuX2dldEFsbE5vZGVzV2l0aFRhZyhhcnRpY2xlQ29udGVudCwgWyJ0YWJsZSJdKSwgZnVuY3Rpb24gKHRhYmxlKSB7DQogICAgICB2YXIgdGJvZHkgPSB0aGlzLl9oYXNTaW5nbGVUYWdJbnNpZGVFbGVtZW50KHRhYmxlLCAiVEJPRFkiKSA/IHRhYmxlLmZpcnN0RWxlbWVudENoaWxkIDogdGFibGU7DQogICAgICBpZiAodGhpcy5faGFzU2luZ2xlVGFnSW5zaWRlRWxlbWVudCh0Ym9keSwgIlRSIikpIHsNCiAgICAgICAgdmFyIHJvdyA9IHRib2R5LmZpcnN0RWxlbWVudENoaWxkOw0KICAgICAgICBpZiAodGhpcy5faGFzU2luZ2xlVGFnSW5zaWRlRWxlbWVudChyb3csICJURCIpKSB7DQogICAgICAgICAgdmFyIGNlbGwgPSByb3cuZmlyc3RFbGVtZW50Q2hpbGQ7DQogICAgICAgICAgY2VsbCA9IHRoaXMuX3NldE5vZGVUYWcoY2VsbCwgdGhpcy5fZXZlcnlOb2RlKGNlbGwuY2hpbGROb2RlcywgdGhpcy5faXNQaHJhc2luZ0NvbnRlbnQpID8gIlAiIDogIkRJViIpOw0KICAgICAgICAgIHRhYmxlLnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKGNlbGwsIHRhYmxlKTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0pOw0KICB9LA0KDQogIC8qKg0KICAgKiBJbml0aWFsaXplIGEgbm9kZSB3aXRoIHRoZSByZWFkYWJpbGl0eSBvYmplY3QuIEFsc28gY2hlY2tzIHRoZQ0KICAgKiBjbGFzc05hbWUvaWQgZm9yIHNwZWNpYWwgbmFtZXMgdG8gYWRkIHRvIGl0cyBzY29yZS4NCiAgICoNCiAgICogQHBhcmFtIEVsZW1lbnQNCiAgICogQHJldHVybiB2b2lkDQogICoqLw0KICBfaW5pdGlhbGl6ZU5vZGU6IGZ1bmN0aW9uIChub2RlKSB7DQogICAgbm9kZS5yZWFkYWJpbGl0eSA9IHsgImNvbnRlbnRTY29yZSI6IDAgfTsNCg0KICAgIHN3aXRjaCAobm9kZS50YWdOYW1lKSB7DQogICAgICBjYXNlICJESVYiOg0KICAgICAgICBub2RlLnJlYWRhYmlsaXR5LmNvbnRlbnRTY29yZSArPSA1Ow0KICAgICAgICBicmVhazsNCg0KICAgICAgY2FzZSAiUFJFIjoNCiAgICAgIGNhc2UgIlREIjoNCiAgICAgIGNhc2UgIkJMT0NLUVVPVEUiOg0KICAgICAgICBub2RlLnJlYWRhYmlsaXR5LmNvbnRlbnRTY29yZSArPSAzOw0KICAgICAgICBicmVhazsNCg0KICAgICAgY2FzZSAiQUREUkVTUyI6DQogICAgICBjYXNlICJPTCI6DQogICAgICBjYXNlICJVTCI6DQogICAgICBjYXNlICJETCI6DQogICAgICBjYXNlICJERCI6DQogICAgICBjYXNlICJEVCI6DQogICAgICBjYXNlICJMSSI6DQogICAgICBjYXNlICJGT1JNIjoNCiAgICAgICAgbm9kZS5yZWFkYWJpbGl0eS5jb250ZW50U2NvcmUgLT0gMzsNCiAgICAgICAgYnJlYWs7DQoNCiAgICAgIGNhc2UgIkgxIjoNCiAgICAgIGNhc2UgIkgyIjoNCiAgICAgIGNhc2UgIkgzIjoNCiAgICAgIGNhc2UgIkg0IjoNCiAgICAgIGNhc2UgIkg1IjoNCiAgICAgIGNhc2UgIkg2IjoNCiAgICAgIGNhc2UgIlRIIjoNCiAgICAgICAgbm9kZS5yZWFkYWJpbGl0eS5jb250ZW50U2NvcmUgLT0gNTsNCiAgICAgICAgYnJlYWs7DQogICAgfQ0KDQogICAgbm9kZS5yZWFkYWJpbGl0eS5jb250ZW50U2NvcmUgKz0gdGhpcy5fZ2V0Q2xhc3NXZWlnaHQobm9kZSk7DQogIH0sDQoNCiAgX3JlbW92ZUFuZEdldE5leHQ6IGZ1bmN0aW9uIChub2RlKSB7DQogICAgdmFyIG5leHROb2RlID0gdGhpcy5fZ2V0TmV4dE5vZGUobm9kZSwgdHJ1ZSk7DQogICAgbm9kZS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKG5vZGUpOw0KICAgIHJldHVybiBuZXh0Tm9kZTsNCiAgfSwNCg0KICAvKioNCiAgICogVHJhdmVyc2UgdGhlIERPTSBmcm9tIG5vZGUgdG8gbm9kZSwgc3RhcnRpbmcgYXQgdGhlIG5vZGUgcGFzc2VkIGluLg0KICAgKiBQYXNzIHRydWUgZm9yIHRoZSBzZWNvbmQgcGFyYW1ldGVyIHRvIGluZGljYXRlIHRoaXMgbm9kZSBpdHNlbGYNCiAgICogKGFuZCBpdHMga2lkcykgYXJlIGdvaW5nIGF3YXksIGFuZCB3ZSB3YW50IHRoZSBuZXh0IG5vZGUgb3Zlci4NCiAgICoNCiAgICogQ2FsbGluZyB0aGlzIGluIGEgbG9vcCB3aWxsIHRyYXZlcnNlIHRoZSBET00gZGVwdGgtZmlyc3QuDQogICAqLw0KICBfZ2V0TmV4dE5vZGU6IGZ1bmN0aW9uIChub2RlLCBpZ25vcmVTZWxmQW5kS2lkcykgew0KICAgIC8vIEZpcnN0IGNoZWNrIGZvciBraWRzIGlmIHRob3NlIGFyZW4ndCBiZWluZyBpZ25vcmVkDQogICAgaWYgKCFpZ25vcmVTZWxmQW5kS2lkcyAmJiBub2RlLmZpcnN0RWxlbWVudENoaWxkKSB7DQogICAgICByZXR1cm4gbm9kZS5maXJzdEVsZW1lbnRDaGlsZDsNCiAgICB9DQogICAgLy8gVGhlbiBmb3Igc2libGluZ3MuLi4NCiAgICBpZiAobm9kZS5uZXh0RWxlbWVudFNpYmxpbmcpIHsNCiAgICAgIHJldHVybiBub2RlLm5leHRFbGVtZW50U2libGluZzsNCiAgICB9DQogICAgLy8gQW5kIGZpbmFsbHksIG1vdmUgdXAgdGhlIHBhcmVudCBjaGFpbiAqYW5kKiBmaW5kIGEgc2libGluZw0KICAgIC8vIChiZWNhdXNlIHRoaXMgaXMgZGVwdGgtZmlyc3QgdHJhdmVyc2FsLCB3ZSB3aWxsIGhhdmUgYWxyZWFkeQ0KICAgIC8vIHNlZW4gdGhlIHBhcmVudCBub2RlcyB0aGVtc2VsdmVzKS4NCiAgICBkbyB7DQogICAgICBub2RlID0gbm9kZS5wYXJlbnROb2RlOw0KICAgIH0gd2hpbGUgKG5vZGUgJiYgIW5vZGUubmV4dEVsZW1lbnRTaWJsaW5nKTsNCiAgICByZXR1cm4gbm9kZSAmJiBub2RlLm5leHRFbGVtZW50U2libGluZzsNCiAgfSwNCg0KICAvLyBjb21wYXJlcyBzZWNvbmQgdGV4dCB0byBmaXJzdCBvbmUNCiAgLy8gMSA9IHNhbWUgdGV4dCwgMCA9IGNvbXBsZXRlbHkgZGlmZmVyZW50IHRleHQNCiAgLy8gd29ya3MgdGhlIHdheSB0aGF0IGl0IHNwbGl0cyBib3RoIHRleHRzIGludG8gd29yZHMgYW5kIHRoZW4gZmluZHMgd29yZHMgdGhhdCBhcmUgdW5pcXVlIGluIHNlY29uZCB0ZXh0DQogIC8vIHRoZSByZXN1bHQgaXMgZ2l2ZW4gYnkgdGhlIGxvd2VyIGxlbmd0aCBvZiB1bmlxdWUgcGFydHMNCiAgX3RleHRTaW1pbGFyaXR5OiBmdW5jdGlvbiAodGV4dEEsIHRleHRCKSB7DQogICAgdmFyIHRva2Vuc0EgPSB0ZXh0QS50b0xvd2VyQ2FzZSgpLnNwbGl0KHRoaXMuUkVHRVhQUy50b2tlbml6ZSkuZmlsdGVyKEJvb2xlYW4pOw0KICAgIHZhciB0b2tlbnNCID0gdGV4dEIudG9Mb3dlckNhc2UoKS5zcGxpdCh0aGlzLlJFR0VYUFMudG9rZW5pemUpLmZpbHRlcihCb29sZWFuKTsNCiAgICBpZiAoIXRva2Vuc0EubGVuZ3RoIHx8ICF0b2tlbnNCLmxlbmd0aCkgew0KICAgICAgcmV0dXJuIDA7DQogICAgfQ0KICAgIHZhciB1bmlxVG9rZW5zQiA9IHRva2Vuc0IuZmlsdGVyKHRva2VuID0+ICF0b2tlbnNBLmluY2x1ZGVzKHRva2VuKSk7DQogICAgdmFyIGRpc3RhbmNlQiA9IHVuaXFUb2tlbnNCLmpvaW4oIiAiKS5sZW5ndGggLyB0b2tlbnNCLmpvaW4oIiAiKS5sZW5ndGg7DQogICAgcmV0dXJuIDEgLSBkaXN0YW5jZUI7DQogIH0sDQoNCiAgX2NoZWNrQnlsaW5lOiBmdW5jdGlvbiAobm9kZSwgbWF0Y2hTdHJpbmcpIHsNCiAgICBpZiAodGhpcy5fYXJ0aWNsZUJ5bGluZSkgew0KICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCg0KICAgIGlmIChub2RlLmdldEF0dHJpYnV0ZSAhPT0gdW5kZWZpbmVkKSB7DQogICAgICB2YXIgcmVsID0gbm9kZS5nZXRBdHRyaWJ1dGUoInJlbCIpOw0KICAgICAgdmFyIGl0ZW1wcm9wID0gbm9kZS5nZXRBdHRyaWJ1dGUoIml0ZW1wcm9wIik7DQogICAgfQ0KDQogICAgaWYgKChyZWwgPT09ICJhdXRob3IiIHx8IChpdGVtcHJvcCAmJiBpdGVtcHJvcC5pbmRleE9mKCJhdXRob3IiKSAhPT0gLTEpIHx8IHRoaXMuUkVHRVhQUy5ieWxpbmUudGVzdChtYXRjaFN0cmluZykpICYmIHRoaXMuX2lzVmFsaWRCeWxpbmUobm9kZS50ZXh0Q29udGVudCkpIHsNCiAgICAgIHRoaXMuX2FydGljbGVCeWxpbmUgPSBub2RlLnRleHRDb250ZW50LnRyaW0oKTsNCiAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KICAgIHJldHVybiBmYWxzZTsNCiAgfSwNCg0KICBfZ2V0Tm9kZUFuY2VzdG9yczogZnVuY3Rpb24gKG5vZGUsIG1heERlcHRoKSB7DQogICAgbWF4RGVwdGggPSBtYXhEZXB0aCB8fCAwOw0KICAgIHZhciBpID0gMCwgYW5jZXN0b3JzID0gW107DQogICAgd2hpbGUgKG5vZGUucGFyZW50Tm9kZSkgew0KICAgICAgYW5jZXN0b3JzLnB1c2gobm9kZS5wYXJlbnROb2RlKTsNCiAgICAgIGlmIChtYXhEZXB0aCAmJiArK2kgPT09IG1heERlcHRoKQ0KICAgICAgICBicmVhazsNCiAgICAgIG5vZGUgPSBub2RlLnBhcmVudE5vZGU7DQogICAgfQ0KICAgIHJldHVybiBhbmNlc3RvcnM7DQogIH0sDQoNCiAgLyoqKg0KICAgKiBncmFiQXJ0aWNsZSAtIFVzaW5nIGEgdmFyaWV0eSBvZiBtZXRyaWNzIChjb250ZW50IHNjb3JlLCBjbGFzc25hbWUsIGVsZW1lbnQgdHlwZXMpLCBmaW5kIHRoZSBjb250ZW50IHRoYXQgaXMNCiAgICogICAgICAgICBtb3N0IGxpa2VseSB0byBiZSB0aGUgc3R1ZmYgYSB1c2VyIHdhbnRzIHRvIHJlYWQuIFRoZW4gcmV0dXJuIGl0IHdyYXBwZWQgdXAgaW4gYSBkaXYuDQogICAqDQogICAqIEBwYXJhbSBwYWdlIGEgZG9jdW1lbnQgdG8gcnVuIHVwb24uIE5lZWRzIHRvIGJlIGEgZnVsbCBkb2N1bWVudCwgY29tcGxldGUgd2l0aCBib2R5Lg0KICAgKiBAcmV0dXJuIEVsZW1lbnQNCiAgKiovDQogIF9ncmFiQXJ0aWNsZTogZnVuY3Rpb24gKHBhZ2UpIHsNCiAgICB0aGlzLmxvZygiKioqKiBncmFiQXJ0aWNsZSAqKioqIik7DQogICAgdmFyIGRvYyA9IHRoaXMuX2RvYzsNCiAgICB2YXIgaXNQYWdpbmcgPSBwYWdlICE9PSBudWxsOw0KICAgIHBhZ2UgPSBwYWdlID8gcGFnZSA6IHRoaXMuX2RvYy5ib2R5Ow0KDQogICAgLy8gV2UgY2FuJ3QgZ3JhYiBhbiBhcnRpY2xlIGlmIHdlIGRvbid0IGhhdmUgYSBwYWdlIQ0KICAgIGlmICghcGFnZSkgew0KICAgICAgdGhpcy5sb2coIk5vIGJvZHkgZm91bmQgaW4gZG9jdW1lbnQuIEFib3J0LiIpOw0KICAgICAgcmV0dXJuIG51bGw7DQogICAgfQ0KDQogICAgdmFyIHBhZ2VDYWNoZUh0bWwgPSBwYWdlLmlubmVySFRNTDsNCg0KICAgIHdoaWxlICh0cnVlKSB7DQogICAgICB0aGlzLmxvZygiU3RhcnRpbmcgZ3JhYkFydGljbGUgbG9vcCIpOw0KICAgICAgdmFyIHN0cmlwVW5saWtlbHlDYW5kaWRhdGVzID0gdGhpcy5fZmxhZ0lzQWN0aXZlKHRoaXMuRkxBR19TVFJJUF9VTkxJS0VMWVMpOw0KDQogICAgICAvLyBGaXJzdCwgbm9kZSBwcmVwcGluZy4gVHJhc2ggbm9kZXMgdGhhdCBsb29rIGNydWRkeSAobGlrZSBvbmVzIHdpdGggdGhlDQogICAgICAvLyBjbGFzcyBuYW1lICJjb21tZW50IiwgZXRjKSwgYW5kIHR1cm4gZGl2cyBpbnRvIFAgdGFncyB3aGVyZSB0aGV5IGhhdmUgYmVlbg0KICAgICAgLy8gdXNlZCBpbmFwcHJvcHJpYXRlbHkgKGFzIGluLCB3aGVyZSB0aGV5IGNvbnRhaW4gbm8gb3RoZXIgYmxvY2sgbGV2ZWwgZWxlbWVudHMuKQ0KICAgICAgdmFyIGVsZW1lbnRzVG9TY29yZSA9IFtdOw0KICAgICAgdmFyIG5vZGUgPSB0aGlzLl9kb2MuZG9jdW1lbnRFbGVtZW50Ow0KDQogICAgICBsZXQgc2hvdWxkUmVtb3ZlVGl0bGVIZWFkZXIgPSB0cnVlOw0KDQogICAgICB3aGlsZSAobm9kZSkgew0KDQogICAgICAgIGlmIChub2RlLnRhZ05hbWUgPT09ICJIVE1MIikgew0KICAgICAgICAgIHRoaXMuX2FydGljbGVMYW5nID0gbm9kZS5nZXRBdHRyaWJ1dGUoImxhbmciKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHZhciBtYXRjaFN0cmluZyA9IG5vZGUuY2xhc3NOYW1lICsgIiAiICsgbm9kZS5pZDsNCg0KICAgICAgICBpZiAoIXRoaXMuX2lzUHJvYmFibHlWaXNpYmxlKG5vZGUpKSB7DQogICAgICAgICAgdGhpcy5sb2coIlJlbW92aW5nIGhpZGRlbiBub2RlIC0gIiArIG1hdGNoU3RyaW5nKTsNCiAgICAgICAgICBub2RlID0gdGhpcy5fcmVtb3ZlQW5kR2V0TmV4dChub2RlKTsNCiAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIFVzZXIgaXMgbm90IGFibGUgdG8gc2VlIGVsZW1lbnRzIGFwcGxpZWQgd2l0aCBib3RoICJhcmlhLW1vZGFsID0gdHJ1ZSIgYW5kICJyb2xlID0gZGlhbG9nIg0KICAgICAgICBpZiAobm9kZS5nZXRBdHRyaWJ1dGUoImFyaWEtbW9kYWwiKSA9PSAidHJ1ZSIgJiYgbm9kZS5nZXRBdHRyaWJ1dGUoInJvbGUiKSA9PSAiZGlhbG9nIikgew0KICAgICAgICAgIG5vZGUgPSB0aGlzLl9yZW1vdmVBbmRHZXROZXh0KG5vZGUpOw0KICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gQ2hlY2sgdG8gc2VlIGlmIHRoaXMgbm9kZSBpcyBhIGJ5bGluZSwgYW5kIHJlbW92ZSBpdCBpZiBpdCBpcy4NCiAgICAgICAgaWYgKHRoaXMuX2NoZWNrQnlsaW5lKG5vZGUsIG1hdGNoU3RyaW5nKSkgew0KICAgICAgICAgIG5vZGUgPSB0aGlzLl9yZW1vdmVBbmRHZXROZXh0KG5vZGUpOw0KICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKHNob3VsZFJlbW92ZVRpdGxlSGVhZGVyICYmIHRoaXMuX2hlYWRlckR1cGxpY2F0ZXNUaXRsZShub2RlKSkgew0KICAgICAgICAgIHRoaXMubG9nKCJSZW1vdmluZyBoZWFkZXI6ICIsIG5vZGUudGV4dENvbnRlbnQudHJpbSgpLCB0aGlzLl9hcnRpY2xlVGl0bGUudHJpbSgpKTsNCiAgICAgICAgICBzaG91bGRSZW1vdmVUaXRsZUhlYWRlciA9IGZhbHNlOw0KICAgICAgICAgIG5vZGUgPSB0aGlzLl9yZW1vdmVBbmRHZXROZXh0KG5vZGUpOw0KICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gUmVtb3ZlIHVubGlrZWx5IGNhbmRpZGF0ZXMNCiAgICAgICAgaWYgKHN0cmlwVW5saWtlbHlDYW5kaWRhdGVzKSB7DQogICAgICAgICAgaWYgKHRoaXMuUkVHRVhQUy51bmxpa2VseUNhbmRpZGF0ZXMudGVzdChtYXRjaFN0cmluZykgJiYNCiAgICAgICAgICAgICF0aGlzLlJFR0VYUFMub2tNYXliZUl0c0FDYW5kaWRhdGUudGVzdChtYXRjaFN0cmluZykgJiYNCiAgICAgICAgICAgICF0aGlzLl9oYXNBbmNlc3RvclRhZyhub2RlLCAidGFibGUiKSAmJg0KICAgICAgICAgICAgIXRoaXMuX2hhc0FuY2VzdG9yVGFnKG5vZGUsICJjb2RlIikgJiYNCiAgICAgICAgICAgIG5vZGUudGFnTmFtZSAhPT0gIkJPRFkiICYmDQogICAgICAgICAgICBub2RlLnRhZ05hbWUgIT09ICJBIikgew0KICAgICAgICAgICAgdGhpcy5sb2coIlJlbW92aW5nIHVubGlrZWx5IGNhbmRpZGF0ZSAtICIgKyBtYXRjaFN0cmluZyk7DQogICAgICAgICAgICBub2RlID0gdGhpcy5fcmVtb3ZlQW5kR2V0TmV4dChub2RlKTsNCiAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGlmICh0aGlzLlVOTElLRUxZX1JPTEVTLmluY2x1ZGVzKG5vZGUuZ2V0QXR0cmlidXRlKCJyb2xlIikpKSB7DQogICAgICAgICAgICB0aGlzLmxvZygiUmVtb3ZpbmcgY29udGVudCB3aXRoIHJvbGUgIiArIG5vZGUuZ2V0QXR0cmlidXRlKCJyb2xlIikgKyAiIC0gIiArIG1hdGNoU3RyaW5nKTsNCiAgICAgICAgICAgIG5vZGUgPSB0aGlzLl9yZW1vdmVBbmRHZXROZXh0KG5vZGUpOw0KICAgICAgICAgICAgY29udGludWU7DQogICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8gUmVtb3ZlIERJViwgU0VDVElPTiwgYW5kIEhFQURFUiBub2RlcyB3aXRob3V0IGFueSBjb250ZW50KGUuZy4gdGV4dCwgaW1hZ2UsIHZpZGVvLCBvciBpZnJhbWUpLg0KICAgICAgICBpZiAoKG5vZGUudGFnTmFtZSA9PT0gIkRJViIgfHwgbm9kZS50YWdOYW1lID09PSAiU0VDVElPTiIgfHwgbm9kZS50YWdOYW1lID09PSAiSEVBREVSIiB8fA0KICAgICAgICAgIG5vZGUudGFnTmFtZSA9PT0gIkgxIiB8fCBub2RlLnRhZ05hbWUgPT09ICJIMiIgfHwgbm9kZS50YWdOYW1lID09PSAiSDMiIHx8DQogICAgICAgICAgbm9kZS50YWdOYW1lID09PSAiSDQiIHx8IG5vZGUudGFnTmFtZSA9PT0gIkg1IiB8fCBub2RlLnRhZ05hbWUgPT09ICJINiIpICYmDQogICAgICAgICAgdGhpcy5faXNFbGVtZW50V2l0aG91dENvbnRlbnQobm9kZSkpIHsNCiAgICAgICAgICBub2RlID0gdGhpcy5fcmVtb3ZlQW5kR2V0TmV4dChub2RlKTsNCiAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmICh0aGlzLkRFRkFVTFRfVEFHU19UT19TQ09SRS5pbmRleE9mKG5vZGUudGFnTmFtZSkgIT09IC0xKSB7DQogICAgICAgICAgZWxlbWVudHNUb1Njb3JlLnB1c2gobm9kZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBUdXJuIGFsbCBkaXZzIHRoYXQgZG9uJ3QgaGF2ZSBjaGlsZHJlbiBibG9jayBsZXZlbCBlbGVtZW50cyBpbnRvIHAncw0KICAgICAgICBpZiAobm9kZS50YWdOYW1lID09PSAiRElWIikgew0KICAgICAgICAgIC8vIFB1dCBwaHJhc2luZyBjb250ZW50IGludG8gcGFyYWdyYXBocy4NCiAgICAgICAgICB2YXIgcCA9IG51bGw7DQogICAgICAgICAgdmFyIGNoaWxkTm9kZSA9IG5vZGUuZmlyc3RDaGlsZDsNCiAgICAgICAgICB3aGlsZSAoY2hpbGROb2RlKSB7DQogICAgICAgICAgICB2YXIgbmV4dFNpYmxpbmcgPSBjaGlsZE5vZGUubmV4dFNpYmxpbmc7DQogICAgICAgICAgICBpZiAodGhpcy5faXNQaHJhc2luZ0NvbnRlbnQoY2hpbGROb2RlKSkgew0KICAgICAgICAgICAgICBpZiAocCAhPT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIHAuYXBwZW5kQ2hpbGQoY2hpbGROb2RlKTsNCiAgICAgICAgICAgICAgfSBlbHNlIGlmICghdGhpcy5faXNXaGl0ZXNwYWNlKGNoaWxkTm9kZSkpIHsNCiAgICAgICAgICAgICAgICBwID0gZG9jLmNyZWF0ZUVsZW1lbnQoInAiKTsNCiAgICAgICAgICAgICAgICBub2RlLnJlcGxhY2VDaGlsZChwLCBjaGlsZE5vZGUpOw0KICAgICAgICAgICAgICAgIHAuYXBwZW5kQ2hpbGQoY2hpbGROb2RlKTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSBlbHNlIGlmIChwICE9PSBudWxsKSB7DQogICAgICAgICAgICAgIHdoaWxlIChwLmxhc3RDaGlsZCAmJiB0aGlzLl9pc1doaXRlc3BhY2UocC5sYXN0Q2hpbGQpKSB7DQogICAgICAgICAgICAgICAgcC5yZW1vdmVDaGlsZChwLmxhc3RDaGlsZCk7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgcCA9IG51bGw7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjaGlsZE5vZGUgPSBuZXh0U2libGluZzsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICAvLyBTaXRlcyBsaWtlIGh0dHA6Ly9tb2JpbGUuc2xhdGUuY29tIGVuY2xvc2VzIGVhY2ggcGFyYWdyYXBoIHdpdGggYSBESVYNCiAgICAgICAgICAvLyBlbGVtZW50LiBESVZzIHdpdGggb25seSBhIFAgZWxlbWVudCBpbnNpZGUgYW5kIG5vIHRleHQgY29udGVudCBjYW4gYmUNCiAgICAgICAgICAvLyBzYWZlbHkgY29udmVydGVkIGludG8gcGxhaW4gUCBlbGVtZW50cyB0byBhdm9pZCBjb25mdXNpbmcgdGhlIHNjb3JpbmcNCiAgICAgICAgICAvLyBhbGdvcml0aG0gd2l0aCBESVZzIHdpdGggYXJlLCBpbiBwcmFjdGljZSwgcGFyYWdyYXBocy4NCiAgICAgICAgICBpZiAodGhpcy5faGFzU2luZ2xlVGFnSW5zaWRlRWxlbWVudChub2RlLCAiUCIpICYmIHRoaXMuX2dldExpbmtEZW5zaXR5KG5vZGUpIDwgMC4yNSkgew0KICAgICAgICAgICAgdmFyIG5ld05vZGUgPSBub2RlLmNoaWxkcmVuWzBdOw0KICAgICAgICAgICAgbm9kZS5wYXJlbnROb2RlLnJlcGxhY2VDaGlsZChuZXdOb2RlLCBub2RlKTsNCiAgICAgICAgICAgIG5vZGUgPSBuZXdOb2RlOw0KICAgICAgICAgICAgZWxlbWVudHNUb1Njb3JlLnB1c2gobm9kZSk7DQogICAgICAgICAgfSBlbHNlIGlmICghdGhpcy5faGFzQ2hpbGRCbG9ja0VsZW1lbnQobm9kZSkpIHsNCiAgICAgICAgICAgIG5vZGUgPSB0aGlzLl9zZXROb2RlVGFnKG5vZGUsICJQIik7DQogICAgICAgICAgICBlbGVtZW50c1RvU2NvcmUucHVzaChub2RlKTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgbm9kZSA9IHRoaXMuX2dldE5leHROb2RlKG5vZGUpOw0KICAgICAgfQ0KDQogICAgICAvKioNCiAgICAgICAqIExvb3AgdGhyb3VnaCBhbGwgcGFyYWdyYXBocywgYW5kIGFzc2lnbiBhIHNjb3JlIHRvIHRoZW0gYmFzZWQgb24gaG93IGNvbnRlbnQteSB0aGV5IGxvb2suDQogICAgICAgKiBUaGVuIGFkZCB0aGVpciBzY29yZSB0byB0aGVpciBwYXJlbnQgbm9kZS4NCiAgICAgICAqDQogICAgICAgKiBBIHNjb3JlIGlzIGRldGVybWluZWQgYnkgdGhpbmdzIGxpa2UgbnVtYmVyIG9mIGNvbW1hcywgY2xhc3MgbmFtZXMsIGV0Yy4gTWF5YmUgZXZlbnR1YWxseSBsaW5rIGRlbnNpdHkuDQogICAgICAqKi8NCiAgICAgIHZhciBjYW5kaWRhdGVzID0gW107DQogICAgICB0aGlzLl9mb3JFYWNoTm9kZShlbGVtZW50c1RvU2NvcmUsIGZ1bmN0aW9uIChlbGVtZW50VG9TY29yZSkgew0KICAgICAgICBpZiAoIWVsZW1lbnRUb1Njb3JlLnBhcmVudE5vZGUgfHwgdHlwZW9mIChlbGVtZW50VG9TY29yZS5wYXJlbnROb2RlLnRhZ05hbWUpID09PSAidW5kZWZpbmVkIikNCiAgICAgICAgICByZXR1cm47DQoNCiAgICAgICAgLy8gSWYgdGhpcyBwYXJhZ3JhcGggaXMgbGVzcyB0aGFuIDI1IGNoYXJhY3RlcnMsIGRvbid0IGV2ZW4gY291bnQgaXQuDQogICAgICAgIHZhciBpbm5lclRleHQgPSB0aGlzLl9nZXRJbm5lclRleHQoZWxlbWVudFRvU2NvcmUpOw0KICAgICAgICBpZiAoaW5uZXJUZXh0Lmxlbmd0aCA8IDI1KQ0KICAgICAgICAgIHJldHVybjsNCg0KICAgICAgICAvLyBFeGNsdWRlIG5vZGVzIHdpdGggbm8gYW5jZXN0b3IuDQogICAgICAgIHZhciBhbmNlc3RvcnMgPSB0aGlzLl9nZXROb2RlQW5jZXN0b3JzKGVsZW1lbnRUb1Njb3JlLCA1KTsNCiAgICAgICAgaWYgKGFuY2VzdG9ycy5sZW5ndGggPT09IDApDQogICAgICAgICAgcmV0dXJuOw0KDQogICAgICAgIHZhciBjb250ZW50U2NvcmUgPSAwOw0KDQogICAgICAgIC8vIEFkZCBhIHBvaW50IGZvciB0aGUgcGFyYWdyYXBoIGl0c2VsZiBhcyBhIGJhc2UuDQogICAgICAgIGNvbnRlbnRTY29yZSArPSAxOw0KDQogICAgICAgIC8vIEFkZCBwb2ludHMgZm9yIGFueSBjb21tYXMgd2l0aGluIHRoaXMgcGFyYWdyYXBoLg0KICAgICAgICBjb250ZW50U2NvcmUgKz0gaW5uZXJUZXh0LnNwbGl0KHRoaXMuUkVHRVhQUy5jb21tYXMpLmxlbmd0aDsNCg0KICAgICAgICAvLyBGb3IgZXZlcnkgMTAwIGNoYXJhY3RlcnMgaW4gdGhpcyBwYXJhZ3JhcGgsIGFkZCBhbm90aGVyIHBvaW50LiBVcCB0byAzIHBvaW50cy4NCiAgICAgICAgY29udGVudFNjb3JlICs9IE1hdGgubWluKE1hdGguZmxvb3IoaW5uZXJUZXh0Lmxlbmd0aCAvIDEwMCksIDMpOw0KDQogICAgICAgIC8vIEluaXRpYWxpemUgYW5kIHNjb3JlIGFuY2VzdG9ycy4NCiAgICAgICAgdGhpcy5fZm9yRWFjaE5vZGUoYW5jZXN0b3JzLCBmdW5jdGlvbiAoYW5jZXN0b3IsIGxldmVsKSB7DQogICAgICAgICAgaWYgKCFhbmNlc3Rvci50YWdOYW1lIHx8ICFhbmNlc3Rvci5wYXJlbnROb2RlIHx8IHR5cGVvZiAoYW5jZXN0b3IucGFyZW50Tm9kZS50YWdOYW1lKSA9PT0gInVuZGVmaW5lZCIpDQogICAgICAgICAgICByZXR1cm47DQoNCiAgICAgICAgICBpZiAodHlwZW9mIChhbmNlc3Rvci5yZWFkYWJpbGl0eSkgPT09ICJ1bmRlZmluZWQiKSB7DQogICAgICAgICAgICB0aGlzLl9pbml0aWFsaXplTm9kZShhbmNlc3Rvcik7DQogICAgICAgICAgICBjYW5kaWRhdGVzLnB1c2goYW5jZXN0b3IpOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIC8vIE5vZGUgc2NvcmUgZGl2aWRlcjoNCiAgICAgICAgICAvLyAtIHBhcmVudDogICAgICAgICAgICAgMSAobm8gZGl2aXNpb24pDQogICAgICAgICAgLy8gLSBncmFuZHBhcmVudDogICAgICAgIDINCiAgICAgICAgICAvLyAtIGdyZWF0IGdyYW5kcGFyZW50KzogYW5jZXN0b3IgbGV2ZWwgKiAzDQogICAgICAgICAgaWYgKGxldmVsID09PSAwKQ0KICAgICAgICAgICAgdmFyIHNjb3JlRGl2aWRlciA9IDE7DQogICAgICAgICAgZWxzZSBpZiAobGV2ZWwgPT09IDEpDQogICAgICAgICAgICBzY29yZURpdmlkZXIgPSAyOw0KICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgIHNjb3JlRGl2aWRlciA9IGxldmVsICogMzsNCiAgICAgICAgICBhbmNlc3Rvci5yZWFkYWJpbGl0eS5jb250ZW50U2NvcmUgKz0gY29udGVudFNjb3JlIC8gc2NvcmVEaXZpZGVyOw0KICAgICAgICB9KTsNCiAgICAgIH0pOw0KDQogICAgICAvLyBBZnRlciB3ZSd2ZSBjYWxjdWxhdGVkIHNjb3JlcywgbG9vcCB0aHJvdWdoIGFsbCBvZiB0aGUgcG9zc2libGUNCiAgICAgIC8vIGNhbmRpZGF0ZSBub2RlcyB3ZSBmb3VuZCBhbmQgZmluZCB0aGUgb25lIHdpdGggdGhlIGhpZ2hlc3Qgc2NvcmUuDQogICAgICB2YXIgdG9wQ2FuZGlkYXRlcyA9IFtdOw0KICAgICAgZm9yICh2YXIgYyA9IDAsIGNsID0gY2FuZGlkYXRlcy5sZW5ndGg7IGMgPCBjbDsgYyArPSAxKSB7DQogICAgICAgIHZhciBjYW5kaWRhdGUgPSBjYW5kaWRhdGVzW2NdOw0KDQogICAgICAgIC8vIFNjYWxlIHRoZSBmaW5hbCBjYW5kaWRhdGVzIHNjb3JlIGJhc2VkIG9uIGxpbmsgZGVuc2l0eS4gR29vZCBjb250ZW50DQogICAgICAgIC8vIHNob3VsZCBoYXZlIGEgcmVsYXRpdmVseSBzbWFsbCBsaW5rIGRlbnNpdHkgKDUlIG9yIGxlc3MpIGFuZCBiZSBtb3N0bHkNCiAgICAgICAgLy8gdW5hZmZlY3RlZCBieSB0aGlzIG9wZXJhdGlvbi4NCiAgICAgICAgdmFyIGNhbmRpZGF0ZVNjb3JlID0gY2FuZGlkYXRlLnJlYWRhYmlsaXR5LmNvbnRlbnRTY29yZSAqICgxIC0gdGhpcy5fZ2V0TGlua0RlbnNpdHkoY2FuZGlkYXRlKSk7DQogICAgICAgIGNhbmRpZGF0ZS5yZWFkYWJpbGl0eS5jb250ZW50U2NvcmUgPSBjYW5kaWRhdGVTY29yZTsNCg0KICAgICAgICB0aGlzLmxvZygiQ2FuZGlkYXRlOiIsIGNhbmRpZGF0ZSwgIndpdGggc2NvcmUgIiArIGNhbmRpZGF0ZVNjb3JlKTsNCg0KICAgICAgICBmb3IgKHZhciB0ID0gMDsgdCA8IHRoaXMuX25iVG9wQ2FuZGlkYXRlczsgdCsrKSB7DQogICAgICAgICAgdmFyIGFUb3BDYW5kaWRhdGUgPSB0b3BDYW5kaWRhdGVzW3RdOw0KDQogICAgICAgICAgaWYgKCFhVG9wQ2FuZGlkYXRlIHx8IGNhbmRpZGF0ZVNjb3JlID4gYVRvcENhbmRpZGF0ZS5yZWFkYWJpbGl0eS5jb250ZW50U2NvcmUpIHsNCiAgICAgICAgICAgIHRvcENhbmRpZGF0ZXMuc3BsaWNlKHQsIDAsIGNhbmRpZGF0ZSk7DQogICAgICAgICAgICBpZiAodG9wQ2FuZGlkYXRlcy5sZW5ndGggPiB0aGlzLl9uYlRvcENhbmRpZGF0ZXMpDQogICAgICAgICAgICAgIHRvcENhbmRpZGF0ZXMucG9wKCk7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgdmFyIHRvcENhbmRpZGF0ZSA9IHRvcENhbmRpZGF0ZXNbMF0gfHwgbnVsbDsNCiAgICAgIHZhciBuZWVkZWRUb0NyZWF0ZVRvcENhbmRpZGF0ZSA9IGZhbHNlOw0KICAgICAgdmFyIHBhcmVudE9mVG9wQ2FuZGlkYXRlOw0KDQogICAgICAvLyBJZiB3ZSBzdGlsbCBoYXZlIG5vIHRvcCBjYW5kaWRhdGUsIGp1c3QgdXNlIHRoZSBib2R5IGFzIGEgbGFzdCByZXNvcnQuDQogICAgICAvLyBXZSBhbHNvIGhhdmUgdG8gY29weSB0aGUgYm9keSBub2RlIHNvIGl0IGlzIHNvbWV0aGluZyB3ZSBjYW4gbW9kaWZ5Lg0KICAgICAgaWYgKHRvcENhbmRpZGF0ZSA9PT0gbnVsbCB8fCB0b3BDYW5kaWRhdGUudGFnTmFtZSA9PT0gIkJPRFkiKSB7DQogICAgICAgIC8vIE1vdmUgYWxsIG9mIHRoZSBwYWdlJ3MgY2hpbGRyZW4gaW50byB0b3BDYW5kaWRhdGUNCiAgICAgICAgdG9wQ2FuZGlkYXRlID0gZG9jLmNyZWF0ZUVsZW1lbnQoIkRJViIpOw0KICAgICAgICBuZWVkZWRUb0NyZWF0ZVRvcENhbmRpZGF0ZSA9IHRydWU7DQogICAgICAgIC8vIE1vdmUgZXZlcnl0aGluZyAobm90IGp1c3QgZWxlbWVudHMsIGFsc28gdGV4dCBub2RlcyBldGMuKSBpbnRvIHRoZSBjb250YWluZXINCiAgICAgICAgLy8gc28gd2UgZXZlbiBpbmNsdWRlIHRleHQgZGlyZWN0bHkgaW4gdGhlIGJvZHk6DQogICAgICAgIHdoaWxlIChwYWdlLmZpcnN0Q2hpbGQpIHsNCiAgICAgICAgICB0aGlzLmxvZygiTW92aW5nIGNoaWxkIG91dDoiLCBwYWdlLmZpcnN0Q2hpbGQpOw0KICAgICAgICAgIHRvcENhbmRpZGF0ZS5hcHBlbmRDaGlsZChwYWdlLmZpcnN0Q2hpbGQpOw0KICAgICAgICB9DQoNCiAgICAgICAgcGFnZS5hcHBlbmRDaGlsZCh0b3BDYW5kaWRhdGUpOw0KDQogICAgICAgIHRoaXMuX2luaXRpYWxpemVOb2RlKHRvcENhbmRpZGF0ZSk7DQogICAgICB9IGVsc2UgaWYgKHRvcENhbmRpZGF0ZSkgew0KICAgICAgICAvLyBGaW5kIGEgYmV0dGVyIHRvcCBjYW5kaWRhdGUgbm9kZSBpZiBpdCBjb250YWlucyAoYXQgbGVhc3QgdGhyZWUpIG5vZGVzIHdoaWNoIGJlbG9uZyB0byBgdG9wQ2FuZGlkYXRlc2AgYXJyYXkNCiAgICAgICAgLy8gYW5kIHdob3NlIHNjb3JlcyBhcmUgcXVpdGUgY2xvc2VkIHdpdGggY3VycmVudCBgdG9wQ2FuZGlkYXRlYCBub2RlLg0KICAgICAgICB2YXIgYWx0ZXJuYXRpdmVDYW5kaWRhdGVBbmNlc3RvcnMgPSBbXTsNCiAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCB0b3BDYW5kaWRhdGVzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgaWYgKHRvcENhbmRpZGF0ZXNbaV0ucmVhZGFiaWxpdHkuY29udGVudFNjb3JlIC8gdG9wQ2FuZGlkYXRlLnJlYWRhYmlsaXR5LmNvbnRlbnRTY29yZSA+PSAwLjc1KSB7DQogICAgICAgICAgICBhbHRlcm5hdGl2ZUNhbmRpZGF0ZUFuY2VzdG9ycy5wdXNoKHRoaXMuX2dldE5vZGVBbmNlc3RvcnModG9wQ2FuZGlkYXRlc1tpXSkpOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICB2YXIgTUlOSU1VTV9UT1BDQU5ESURBVEVTID0gMzsNCiAgICAgICAgaWYgKGFsdGVybmF0aXZlQ2FuZGlkYXRlQW5jZXN0b3JzLmxlbmd0aCA+PSBNSU5JTVVNX1RPUENBTkRJREFURVMpIHsNCiAgICAgICAgICBwYXJlbnRPZlRvcENhbmRpZGF0ZSA9IHRvcENhbmRpZGF0ZS5wYXJlbnROb2RlOw0KICAgICAgICAgIHdoaWxlIChwYXJlbnRPZlRvcENhbmRpZGF0ZS50YWdOYW1lICE9PSAiQk9EWSIpIHsNCiAgICAgICAgICAgIHZhciBsaXN0c0NvbnRhaW5pbmdUaGlzQW5jZXN0b3IgPSAwOw0KICAgICAgICAgICAgZm9yICh2YXIgYW5jZXN0b3JJbmRleCA9IDA7IGFuY2VzdG9ySW5kZXggPCBhbHRlcm5hdGl2ZUNhbmRpZGF0ZUFuY2VzdG9ycy5sZW5ndGggJiYgbGlzdHNDb250YWluaW5nVGhpc0FuY2VzdG9yIDwgTUlOSU1VTV9UT1BDQU5ESURBVEVTOyBhbmNlc3RvckluZGV4KyspIHsNCiAgICAgICAgICAgICAgbGlzdHNDb250YWluaW5nVGhpc0FuY2VzdG9yICs9IE51bWJlcihhbHRlcm5hdGl2ZUNhbmRpZGF0ZUFuY2VzdG9yc1thbmNlc3RvckluZGV4XS5pbmNsdWRlcyhwYXJlbnRPZlRvcENhbmRpZGF0ZSkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKGxpc3RzQ29udGFpbmluZ1RoaXNBbmNlc3RvciA+PSBNSU5JTVVNX1RPUENBTkRJREFURVMpIHsNCiAgICAgICAgICAgICAgdG9wQ2FuZGlkYXRlID0gcGFyZW50T2ZUb3BDYW5kaWRhdGU7DQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcGFyZW50T2ZUb3BDYW5kaWRhdGUgPSBwYXJlbnRPZlRvcENhbmRpZGF0ZS5wYXJlbnROb2RlOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBpZiAoIXRvcENhbmRpZGF0ZS5yZWFkYWJpbGl0eSkgew0KICAgICAgICAgIHRoaXMuX2luaXRpYWxpemVOb2RlKHRvcENhbmRpZGF0ZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBCZWNhdXNlIG9mIG91ciBib251cyBzeXN0ZW0sIHBhcmVudHMgb2YgY2FuZGlkYXRlcyBtaWdodCBoYXZlIHNjb3Jlcw0KICAgICAgICAvLyB0aGVtc2VsdmVzLiBUaGV5IGdldCBoYWxmIG9mIHRoZSBub2RlLiBUaGVyZSB3b24ndCBiZSBub2RlcyB3aXRoIGhpZ2hlcg0KICAgICAgICAvLyBzY29yZXMgdGhhbiBvdXIgdG9wQ2FuZGlkYXRlLCBidXQgaWYgd2Ugc2VlIHRoZSBzY29yZSBnb2luZyAqdXAqIGluIHRoZSBmaXJzdA0KICAgICAgICAvLyBmZXcgc3RlcHMgdXAgdGhlIHRyZWUsIHRoYXQncyBhIGRlY2VudCBzaWduIHRoYXQgdGhlcmUgbWlnaHQgYmUgbW9yZSBjb250ZW50DQogICAgICAgIC8vIGx1cmtpbmcgaW4gb3RoZXIgcGxhY2VzIHRoYXQgd2Ugd2FudCB0byB1bmlmeSBpbi4gVGhlIHNpYmxpbmcgc3R1ZmYNCiAgICAgICAgLy8gYmVsb3cgZG9lcyBzb21lIG9mIHRoYXQgLSBidXQgb25seSBpZiB3ZSd2ZSBsb29rZWQgaGlnaCBlbm91Z2ggdXAgdGhlIERPTQ0KICAgICAgICAvLyB0cmVlLg0KICAgICAgICBwYXJlbnRPZlRvcENhbmRpZGF0ZSA9IHRvcENhbmRpZGF0ZS5wYXJlbnROb2RlOw0KICAgICAgICB2YXIgbGFzdFNjb3JlID0gdG9wQ2FuZGlkYXRlLnJlYWRhYmlsaXR5LmNvbnRlbnRTY29yZTsNCiAgICAgICAgLy8gVGhlIHNjb3JlcyBzaG91bGRuJ3QgZ2V0IHRvbyBsb3cuDQogICAgICAgIHZhciBzY29yZVRocmVzaG9sZCA9IGxhc3RTY29yZSAvIDM7DQogICAgICAgIHdoaWxlIChwYXJlbnRPZlRvcENhbmRpZGF0ZS50YWdOYW1lICE9PSAiQk9EWSIpIHsNCiAgICAgICAgICBpZiAoIXBhcmVudE9mVG9wQ2FuZGlkYXRlLnJlYWRhYmlsaXR5KSB7DQogICAgICAgICAgICBwYXJlbnRPZlRvcENhbmRpZGF0ZSA9IHBhcmVudE9mVG9wQ2FuZGlkYXRlLnBhcmVudE5vZGU7DQogICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgICB9DQogICAgICAgICAgdmFyIHBhcmVudFNjb3JlID0gcGFyZW50T2ZUb3BDYW5kaWRhdGUucmVhZGFiaWxpdHkuY29udGVudFNjb3JlOw0KICAgICAgICAgIGlmIChwYXJlbnRTY29yZSA8IHNjb3JlVGhyZXNob2xkKQ0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgaWYgKHBhcmVudFNjb3JlID4gbGFzdFNjb3JlKSB7DQogICAgICAgICAgICAvLyBBbHJpZ2h0ISBXZSBmb3VuZCBhIGJldHRlciBwYXJlbnQgdG8gdXNlLg0KICAgICAgICAgICAgdG9wQ2FuZGlkYXRlID0gcGFyZW50T2ZUb3BDYW5kaWRhdGU7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgICB9DQogICAgICAgICAgbGFzdFNjb3JlID0gcGFyZW50T2ZUb3BDYW5kaWRhdGUucmVhZGFiaWxpdHkuY29udGVudFNjb3JlOw0KICAgICAgICAgIHBhcmVudE9mVG9wQ2FuZGlkYXRlID0gcGFyZW50T2ZUb3BDYW5kaWRhdGUucGFyZW50Tm9kZTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIElmIHRoZSB0b3AgY2FuZGlkYXRlIGlzIHRoZSBvbmx5IGNoaWxkLCB1c2UgcGFyZW50IGluc3RlYWQuIFRoaXMgd2lsbCBoZWxwIHNpYmxpbmcNCiAgICAgICAgLy8gam9pbmluZyBsb2dpYyB3aGVuIGFkamFjZW50IGNvbnRlbnQgaXMgYWN0dWFsbHkgbG9jYXRlZCBpbiBwYXJlbnQncyBzaWJsaW5nIG5vZGUuDQogICAgICAgIHBhcmVudE9mVG9wQ2FuZGlkYXRlID0gdG9wQ2FuZGlkYXRlLnBhcmVudE5vZGU7DQogICAgICAgIHdoaWxlIChwYXJlbnRPZlRvcENhbmRpZGF0ZS50YWdOYW1lICE9ICJCT0RZIiAmJiBwYXJlbnRPZlRvcENhbmRpZGF0ZS5jaGlsZHJlbi5sZW5ndGggPT0gMSkgew0KICAgICAgICAgIHRvcENhbmRpZGF0ZSA9IHBhcmVudE9mVG9wQ2FuZGlkYXRlOw0KICAgICAgICAgIHBhcmVudE9mVG9wQ2FuZGlkYXRlID0gdG9wQ2FuZGlkYXRlLnBhcmVudE5vZGU7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCF0b3BDYW5kaWRhdGUucmVhZGFiaWxpdHkpIHsNCiAgICAgICAgICB0aGlzLl9pbml0aWFsaXplTm9kZSh0b3BDYW5kaWRhdGUpOw0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIC8vIE5vdyB0aGF0IHdlIGhhdmUgdGhlIHRvcCBjYW5kaWRhdGUsIGxvb2sgdGhyb3VnaCBpdHMgc2libGluZ3MgZm9yIGNvbnRlbnQNCiAgICAgIC8vIHRoYXQgbWlnaHQgYWxzbyBiZSByZWxhdGVkLiBUaGluZ3MgbGlrZSBwcmVhbWJsZXMsIGNvbnRlbnQgc3BsaXQgYnkgYWRzDQogICAgICAvLyB0aGF0IHdlIHJlbW92ZWQsIGV0Yy4NCiAgICAgIHZhciBhcnRpY2xlQ29udGVudCA9IGRvYy5jcmVhdGVFbGVtZW50KCJESVYiKTsNCiAgICAgIGlmIChpc1BhZ2luZykNCiAgICAgICAgYXJ0aWNsZUNvbnRlbnQuaWQgPSAicmVhZGFiaWxpdHktY29udGVudCI7DQoNCiAgICAgIHZhciBzaWJsaW5nU2NvcmVUaHJlc2hvbGQgPSBNYXRoLm1heCgxMCwgdG9wQ2FuZGlkYXRlLnJlYWRhYmlsaXR5LmNvbnRlbnRTY29yZSAqIDAuMik7DQogICAgICAvLyBLZWVwIHBvdGVudGlhbCB0b3AgY2FuZGlkYXRlJ3MgcGFyZW50IG5vZGUgdG8gdHJ5IHRvIGdldCB0ZXh0IGRpcmVjdGlvbiBvZiBpdCBsYXRlci4NCiAgICAgIHBhcmVudE9mVG9wQ2FuZGlkYXRlID0gdG9wQ2FuZGlkYXRlLnBhcmVudE5vZGU7DQogICAgICB2YXIgc2libGluZ3MgPSBwYXJlbnRPZlRvcENhbmRpZGF0ZS5jaGlsZHJlbjsNCg0KICAgICAgZm9yICh2YXIgcyA9IDAsIHNsID0gc2libGluZ3MubGVuZ3RoOyBzIDwgc2w7IHMrKykgew0KICAgICAgICB2YXIgc2libGluZyA9IHNpYmxpbmdzW3NdOw0KICAgICAgICB2YXIgYXBwZW5kID0gZmFsc2U7DQoNCiAgICAgICAgdGhpcy5sb2coIkxvb2tpbmcgYXQgc2libGluZyBub2RlOiIsIHNpYmxpbmcsIHNpYmxpbmcucmVhZGFiaWxpdHkgPyAoIndpdGggc2NvcmUgIiArIHNpYmxpbmcucmVhZGFiaWxpdHkuY29udGVudFNjb3JlKSA6ICIiKTsNCiAgICAgICAgdGhpcy5sb2coIlNpYmxpbmcgaGFzIHNjb3JlIiwgc2libGluZy5yZWFkYWJpbGl0eSA/IHNpYmxpbmcucmVhZGFiaWxpdHkuY29udGVudFNjb3JlIDogIlVua25vd24iKTsNCg0KICAgICAgICBpZiAoc2libGluZyA9PT0gdG9wQ2FuZGlkYXRlKSB7DQogICAgICAgICAgYXBwZW5kID0gdHJ1ZTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICB2YXIgY29udGVudEJvbnVzID0gMDsNCg0KICAgICAgICAgIC8vIEdpdmUgYSBib251cyBpZiBzaWJsaW5nIG5vZGVzIGFuZCB0b3AgY2FuZGlkYXRlcyBoYXZlIHRoZSBleGFtcGxlIHNhbWUgY2xhc3NuYW1lDQogICAgICAgICAgaWYgKHNpYmxpbmcuY2xhc3NOYW1lID09PSB0b3BDYW5kaWRhdGUuY2xhc3NOYW1lICYmIHRvcENhbmRpZGF0ZS5jbGFzc05hbWUgIT09ICIiKQ0KICAgICAgICAgICAgY29udGVudEJvbnVzICs9IHRvcENhbmRpZGF0ZS5yZWFkYWJpbGl0eS5jb250ZW50U2NvcmUgKiAwLjI7DQoNCiAgICAgICAgICBpZiAoc2libGluZy5yZWFkYWJpbGl0eSAmJg0KICAgICAgICAgICAgKChzaWJsaW5nLnJlYWRhYmlsaXR5LmNvbnRlbnRTY29yZSArIGNvbnRlbnRCb251cykgPj0gc2libGluZ1Njb3JlVGhyZXNob2xkKSkgew0KICAgICAgICAgICAgYXBwZW5kID0gdHJ1ZTsNCiAgICAgICAgICB9IGVsc2UgaWYgKHNpYmxpbmcubm9kZU5hbWUgPT09ICJQIikgew0KICAgICAgICAgICAgdmFyIGxpbmtEZW5zaXR5ID0gdGhpcy5fZ2V0TGlua0RlbnNpdHkoc2libGluZyk7DQogICAgICAgICAgICB2YXIgbm9kZUNvbnRlbnQgPSB0aGlzLl9nZXRJbm5lclRleHQoc2libGluZyk7DQogICAgICAgICAgICB2YXIgbm9kZUxlbmd0aCA9IG5vZGVDb250ZW50Lmxlbmd0aDsNCg0KICAgICAgICAgICAgaWYgKG5vZGVMZW5ndGggPiA4MCAmJiBsaW5rRGVuc2l0eSA8IDAuMjUpIHsNCiAgICAgICAgICAgICAgYXBwZW5kID0gdHJ1ZTsNCiAgICAgICAgICAgIH0gZWxzZSBpZiAobm9kZUxlbmd0aCA8IDgwICYmIG5vZGVMZW5ndGggPiAwICYmIGxpbmtEZW5zaXR5ID09PSAwICYmDQogICAgICAgICAgICAgIG5vZGVDb250ZW50LnNlYXJjaCgvXC4oIHwkKS8pICE9PSAtMSkgew0KICAgICAgICAgICAgICBhcHBlbmQgPSB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChhcHBlbmQpIHsNCiAgICAgICAgICB0aGlzLmxvZygiQXBwZW5kaW5nIG5vZGU6Iiwgc2libGluZyk7DQoNCiAgICAgICAgICBpZiAodGhpcy5BTFRFUl9UT19ESVZfRVhDRVBUSU9OUy5pbmRleE9mKHNpYmxpbmcubm9kZU5hbWUpID09PSAtMSkgew0KICAgICAgICAgICAgLy8gV2UgaGF2ZSBhIG5vZGUgdGhhdCBpc24ndCBhIGNvbW1vbiBibG9jayBsZXZlbCBlbGVtZW50LCBsaWtlIGEgZm9ybSBvciB0ZCB0YWcuDQogICAgICAgICAgICAvLyBUdXJuIGl0IGludG8gYSBkaXYgc28gaXQgZG9lc24ndCBnZXQgZmlsdGVyZWQgb3V0IGxhdGVyIGJ5IGFjY2lkZW50Lg0KICAgICAgICAgICAgdGhpcy5sb2coIkFsdGVyaW5nIHNpYmxpbmc6Iiwgc2libGluZywgInRvIGRpdi4iKTsNCg0KICAgICAgICAgICAgc2libGluZyA9IHRoaXMuX3NldE5vZGVUYWcoc2libGluZywgIkRJViIpOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGFydGljbGVDb250ZW50LmFwcGVuZENoaWxkKHNpYmxpbmcpOw0KICAgICAgICAgIC8vIEZldGNoIGNoaWxkcmVuIGFnYWluIHRvIG1ha2UgaXQgY29tcGF0aWJsZQ0KICAgICAgICAgIC8vIHdpdGggRE9NIHBhcnNlcnMgd2l0aG91dCBsaXZlIGNvbGxlY3Rpb24gc3VwcG9ydC4NCiAgICAgICAgICBzaWJsaW5ncyA9IHBhcmVudE9mVG9wQ2FuZGlkYXRlLmNoaWxkcmVuOw0KICAgICAgICAgIC8vIHNpYmxpbmdzIGlzIGEgcmVmZXJlbmNlIHRvIHRoZSBjaGlsZHJlbiBhcnJheSwgYW5kDQogICAgICAgICAgLy8gc2libGluZyBpcyByZW1vdmVkIGZyb20gdGhlIGFycmF5IHdoZW4gd2UgY2FsbCBhcHBlbmRDaGlsZCgpLg0KICAgICAgICAgIC8vIEFzIGEgcmVzdWx0LCB3ZSBtdXN0IHJldmlzaXQgdGhpcyBpbmRleCBzaW5jZSB0aGUgbm9kZXMNCiAgICAgICAgICAvLyBoYXZlIGJlZW4gc2hpZnRlZC4NCiAgICAgICAgICBzIC09IDE7DQogICAgICAgICAgc2wgLT0gMTsNCiAgICAgICAgfQ0KICAgICAgfQ0KDQogICAgICBpZiAodGhpcy5fZGVidWcpDQogICAgICAgIHRoaXMubG9nKCJBcnRpY2xlIGNvbnRlbnQgcHJlLXByZXA6ICIgKyBhcnRpY2xlQ29udGVudC5pbm5lckhUTUwpOw0KICAgICAgLy8gU28gd2UgaGF2ZSBhbGwgb2YgdGhlIGNvbnRlbnQgdGhhdCB3ZSBuZWVkLiBOb3cgd2UgY2xlYW4gaXQgdXAgZm9yIHByZXNlbnRhdGlvbi4NCiAgICAgIHRoaXMuX3ByZXBBcnRpY2xlKGFydGljbGVDb250ZW50KTsNCiAgICAgIGlmICh0aGlzLl9kZWJ1ZykNCiAgICAgICAgdGhpcy5sb2coIkFydGljbGUgY29udGVudCBwb3N0LXByZXA6ICIgKyBhcnRpY2xlQ29udGVudC5pbm5lckhUTUwpOw0KDQogICAgICBpZiAobmVlZGVkVG9DcmVhdGVUb3BDYW5kaWRhdGUpIHsNCiAgICAgICAgLy8gV2UgYWxyZWFkeSBjcmVhdGVkIGEgZmFrZSBkaXYgdGhpbmcsIGFuZCB0aGVyZSB3b3VsZG4ndCBoYXZlIGJlZW4gYW55IHNpYmxpbmdzIGxlZnQNCiAgICAgICAgLy8gZm9yIHRoZSBwcmV2aW91cyBsb29wLCBzbyB0aGVyZSdzIG5vIHBvaW50IHRyeWluZyB0byBjcmVhdGUgYSBuZXcgZGl2LCBhbmQgdGhlbg0KICAgICAgICAvLyBtb3ZlIGFsbCB0aGUgY2hpbGRyZW4gb3Zlci4gSnVzdCBhc3NpZ24gSURzIGFuZCBjbGFzcyBuYW1lcyBoZXJlLiBObyBuZWVkIHRvIGFwcGVuZA0KICAgICAgICAvLyBiZWNhdXNlIHRoYXQgYWxyZWFkeSBoYXBwZW5lZCBhbnl3YXkuDQogICAgICAgIHRvcENhbmRpZGF0ZS5pZCA9ICJyZWFkYWJpbGl0eS1wYWdlLTEiOw0KICAgICAgICB0b3BDYW5kaWRhdGUuY2xhc3NOYW1lID0gInBhZ2UiOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdmFyIGRpdiA9IGRvYy5jcmVhdGVFbGVtZW50KCJESVYiKTsNCiAgICAgICAgZGl2LmlkID0gInJlYWRhYmlsaXR5LXBhZ2UtMSI7DQogICAgICAgIGRpdi5jbGFzc05hbWUgPSAicGFnZSI7DQogICAgICAgIHdoaWxlIChhcnRpY2xlQ29udGVudC5maXJzdENoaWxkKSB7DQogICAgICAgICAgZGl2LmFwcGVuZENoaWxkKGFydGljbGVDb250ZW50LmZpcnN0Q2hpbGQpOw0KICAgICAgICB9DQogICAgICAgIGFydGljbGVDb250ZW50LmFwcGVuZENoaWxkKGRpdik7DQogICAgICB9DQoNCiAgICAgIGlmICh0aGlzLl9kZWJ1ZykNCiAgICAgICAgdGhpcy5sb2coIkFydGljbGUgY29udGVudCBhZnRlciBwYWdpbmc6ICIgKyBhcnRpY2xlQ29udGVudC5pbm5lckhUTUwpOw0KDQogICAgICB2YXIgcGFyc2VTdWNjZXNzZnVsID0gdHJ1ZTsNCg0KICAgICAgLy8gTm93IHRoYXQgd2UndmUgZ29uZSB0aHJvdWdoIHRoZSBmdWxsIGFsZ29yaXRobSwgY2hlY2sgdG8gc2VlIGlmDQogICAgICAvLyB3ZSBnb3QgYW55IG1lYW5pbmdmdWwgY29udGVudC4gSWYgd2UgZGlkbid0LCB3ZSBtYXkgbmVlZCB0byByZS1ydW4NCiAgICAgIC8vIGdyYWJBcnRpY2xlIHdpdGggZGlmZmVyZW50IGZsYWdzIHNldC4gVGhpcyBnaXZlcyB1cyBhIGhpZ2hlciBsaWtlbGlob29kIG9mDQogICAgICAvLyBmaW5kaW5nIHRoZSBjb250ZW50LCBhbmQgdGhlIHNpZXZlIGFwcHJvYWNoIGdpdmVzIHVzIGEgaGlnaGVyIGxpa2VsaWhvb2Qgb2YNCiAgICAgIC8vIGZpbmRpbmcgdGhlIC1yaWdodC0gY29udGVudC4NCiAgICAgIHZhciB0ZXh0TGVuZ3RoID0gdGhpcy5fZ2V0SW5uZXJUZXh0KGFydGljbGVDb250ZW50LCB0cnVlKS5sZW5ndGg7DQogICAgICBpZiAodGV4dExlbmd0aCA8IHRoaXMuX2NoYXJUaHJlc2hvbGQpIHsNCiAgICAgICAgcGFyc2VTdWNjZXNzZnVsID0gZmFsc2U7DQogICAgICAgIHBhZ2UuaW5uZXJIVE1MID0gcGFnZUNhY2hlSHRtbDsNCg0KICAgICAgICBpZiAodGhpcy5fZmxhZ0lzQWN0aXZlKHRoaXMuRkxBR19TVFJJUF9VTkxJS0VMWVMpKSB7DQogICAgICAgICAgdGhpcy5fcmVtb3ZlRmxhZyh0aGlzLkZMQUdfU1RSSVBfVU5MSUtFTFlTKTsNCiAgICAgICAgICB0aGlzLl9hdHRlbXB0cy5wdXNoKHsgYXJ0aWNsZUNvbnRlbnQ6IGFydGljbGVDb250ZW50LCB0ZXh0TGVuZ3RoOiB0ZXh0TGVuZ3RoIH0pOw0KICAgICAgICB9IGVsc2UgaWYgKHRoaXMuX2ZsYWdJc0FjdGl2ZSh0aGlzLkZMQUdfV0VJR0hUX0NMQVNTRVMpKSB7DQogICAgICAgICAgdGhpcy5fcmVtb3ZlRmxhZyh0aGlzLkZMQUdfV0VJR0hUX0NMQVNTRVMpOw0KICAgICAgICAgIHRoaXMuX2F0dGVtcHRzLnB1c2goeyBhcnRpY2xlQ29udGVudDogYXJ0aWNsZUNvbnRlbnQsIHRleHRMZW5ndGg6IHRleHRMZW5ndGggfSk7DQogICAgICAgIH0gZWxzZSBpZiAodGhpcy5fZmxhZ0lzQWN0aXZlKHRoaXMuRkxBR19DTEVBTl9DT05ESVRJT05BTExZKSkgew0KICAgICAgICAgIHRoaXMuX3JlbW92ZUZsYWcodGhpcy5GTEFHX0NMRUFOX0NPTkRJVElPTkFMTFkpOw0KICAgICAgICAgIHRoaXMuX2F0dGVtcHRzLnB1c2goeyBhcnRpY2xlQ29udGVudDogYXJ0aWNsZUNvbnRlbnQsIHRleHRMZW5ndGg6IHRleHRMZW5ndGggfSk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgdGhpcy5fYXR0ZW1wdHMucHVzaCh7IGFydGljbGVDb250ZW50OiBhcnRpY2xlQ29udGVudCwgdGV4dExlbmd0aDogdGV4dExlbmd0aCB9KTsNCiAgICAgICAgICAvLyBObyBsdWNrIGFmdGVyIHJlbW92aW5nIGZsYWdzLCBqdXN0IHJldHVybiB0aGUgbG9uZ2VzdCB0ZXh0IHdlIGZvdW5kIGR1cmluZyB0aGUgZGlmZmVyZW50IGxvb3BzDQogICAgICAgICAgdGhpcy5fYXR0ZW1wdHMuc29ydChmdW5jdGlvbiAoYSwgYikgew0KICAgICAgICAgICAgcmV0dXJuIGIudGV4dExlbmd0aCAtIGEudGV4dExlbmd0aDsNCiAgICAgICAgICB9KTsNCg0KICAgICAgICAgIC8vIEJ1dCBmaXJzdCBjaGVjayBpZiB3ZSBhY3R1YWxseSBoYXZlIHNvbWV0aGluZw0KICAgICAgICAgIGlmICghdGhpcy5fYXR0ZW1wdHNbMF0udGV4dExlbmd0aCkgew0KICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgYXJ0aWNsZUNvbnRlbnQgPSB0aGlzLl9hdHRlbXB0c1swXS5hcnRpY2xlQ29udGVudDsNCiAgICAgICAgICBwYXJzZVN1Y2Nlc3NmdWwgPSB0cnVlOw0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIGlmIChwYXJzZVN1Y2Nlc3NmdWwpIHsNCiAgICAgICAgLy8gRmluZCBvdXQgdGV4dCBkaXJlY3Rpb24gZnJvbSBhbmNlc3RvcnMgb2YgZmluYWwgdG9wIGNhbmRpZGF0ZS4NCiAgICAgICAgdmFyIGFuY2VzdG9ycyA9IFtwYXJlbnRPZlRvcENhbmRpZGF0ZSwgdG9wQ2FuZGlkYXRlXS5jb25jYXQodGhpcy5fZ2V0Tm9kZUFuY2VzdG9ycyhwYXJlbnRPZlRvcENhbmRpZGF0ZSkpOw0KICAgICAgICB0aGlzLl9zb21lTm9kZShhbmNlc3RvcnMsIGZ1bmN0aW9uIChhbmNlc3Rvcikgew0KICAgICAgICAgIGlmICghYW5jZXN0b3IudGFnTmFtZSkNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICB2YXIgYXJ0aWNsZURpciA9IGFuY2VzdG9yLmdldEF0dHJpYnV0ZSgiZGlyIik7DQogICAgICAgICAgaWYgKGFydGljbGVEaXIpIHsNCiAgICAgICAgICAgIHRoaXMuX2FydGljbGVEaXIgPSBhcnRpY2xlRGlyOw0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgfQ0KICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfSk7DQogICAgICAgIHJldHVybiBhcnRpY2xlQ29udGVudDsNCiAgICAgIH0NCiAgICB9DQogIH0sDQoNCiAgLyoqDQogICAqIENoZWNrIHdoZXRoZXIgdGhlIGlucHV0IHN0cmluZyBjb3VsZCBiZSBhIGJ5bGluZS4NCiAgICogVGhpcyB2ZXJpZmllcyB0aGF0IHRoZSBpbnB1dCBpcyBhIHN0cmluZywgYW5kIHRoYXQgdGhlIGxlbmd0aA0KICAgKiBpcyBsZXNzIHRoYW4gMTAwIGNoYXJzLg0KICAgKg0KICAgKiBAcGFyYW0gcG9zc2libGVCeWxpbmUge3N0cmluZ30gLSBhIHN0cmluZyB0byBjaGVjayB3aGV0aGVyIGl0cyBhIGJ5bGluZS4NCiAgICogQHJldHVybiBCb29sZWFuIC0gd2hldGhlciB0aGUgaW5wdXQgc3RyaW5nIGlzIGEgYnlsaW5lLg0KICAgKi8NCiAgX2lzVmFsaWRCeWxpbmU6IGZ1bmN0aW9uIChieWxpbmUpIHsNCiAgICBpZiAodHlwZW9mIGJ5bGluZSA9PSAic3RyaW5nIiB8fCBieWxpbmUgaW5zdGFuY2VvZiBTdHJpbmcpIHsNCiAgICAgIGJ5bGluZSA9IGJ5bGluZS50cmltKCk7DQogICAgICByZXR1cm4gKGJ5bGluZS5sZW5ndGggPiAwKSAmJiAoYnlsaW5lLmxlbmd0aCA8IDEwMCk7DQogICAgfQ0KICAgIHJldHVybiBmYWxzZTsNCiAgfSwNCg0KICAvKioNCiAgICogQ29udmVydHMgc29tZSBvZiB0aGUgY29tbW9uIEhUTUwgZW50aXRpZXMgaW4gc3RyaW5nIHRvIHRoZWlyIGNvcnJlc3BvbmRpbmcgY2hhcmFjdGVycy4NCiAgICoNCiAgICogQHBhcmFtIHN0ciB7c3RyaW5nfSAtIGEgc3RyaW5nIHRvIHVuZXNjYXBlLg0KICAgKiBAcmV0dXJuIHN0cmluZyB3aXRob3V0IEhUTUwgZW50aXR5Lg0KICAgKi8NCiAgX3VuZXNjYXBlSHRtbEVudGl0aWVzOiBmdW5jdGlvbiAoc3RyKSB7DQogICAgaWYgKCFzdHIpIHsNCiAgICAgIHJldHVybiBzdHI7DQogICAgfQ0KDQogICAgdmFyIGh0bWxFc2NhcGVNYXAgPSB0aGlzLkhUTUxfRVNDQVBFX01BUDsNCiAgICByZXR1cm4gc3RyLnJlcGxhY2UoLyYocXVvdHxhbXB8YXBvc3xsdHxndCk7L2csIGZ1bmN0aW9uIChfLCB0YWcpIHsNCiAgICAgIHJldHVybiBodG1sRXNjYXBlTWFwW3RhZ107DQogICAgfSkucmVwbGFjZSgvJiMoPzp4KFswLTlhLXpdezEsNH0pfChbMC05XXsxLDR9KSk7L2dpLCBmdW5jdGlvbiAoXywgaGV4LCBudW1TdHIpIHsNCiAgICAgIHZhciBudW0gPSBwYXJzZUludChoZXggfHwgbnVtU3RyLCBoZXggPyAxNiA6IDEwKTsNCiAgICAgIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKG51bSk7DQogICAgfSk7DQogIH0sDQoNCiAgLyoqDQogICAqIFRyeSB0byBleHRyYWN0IG1ldGFkYXRhIGZyb20gSlNPTi1MRCBvYmplY3QuDQogICAqIEZvciBub3csIG9ubHkgU2NoZW1hLm9yZyBvYmplY3RzIG9mIHR5cGUgQXJ0aWNsZSBvciBpdHMgc3VidHlwZXMgYXJlIHN1cHBvcnRlZC4NCiAgICogQHJldHVybiBPYmplY3Qgd2l0aCBhbnkgbWV0YWRhdGEgdGhhdCBjb3VsZCBiZSBleHRyYWN0ZWQgKHBvc3NpYmx5IG5vbmUpDQogICAqLw0KICBfZ2V0SlNPTkxEOiBmdW5jdGlvbiAoZG9jKSB7DQogICAgdmFyIHNjcmlwdHMgPSB0aGlzLl9nZXRBbGxOb2Rlc1dpdGhUYWcoZG9jLCBbInNjcmlwdCJdKTsNCg0KICAgIHZhciBtZXRhZGF0YTsNCg0KICAgIHRoaXMuX2ZvckVhY2hOb2RlKHNjcmlwdHMsIGZ1bmN0aW9uIChqc29uTGRFbGVtZW50KSB7DQogICAgICBpZiAoIW1ldGFkYXRhICYmIGpzb25MZEVsZW1lbnQuZ2V0QXR0cmlidXRlKCJ0eXBlIikgPT09ICJhcHBsaWNhdGlvbi9sZCtqc29uIikgew0KICAgICAgICB0cnkgew0KICAgICAgICAgIC8vIFN0cmlwIENEQVRBIG1hcmtlcnMgaWYgcHJlc2VudA0KICAgICAgICAgIHZhciBjb250ZW50ID0ganNvbkxkRWxlbWVudC50ZXh0Q29udGVudC5yZXBsYWNlKC9eXHMqPCFcW0NEQVRBXFt8XF1cXT5ccyokL2csICIiKTsNCiAgICAgICAgICB2YXIgcGFyc2VkID0gSlNPTi5wYXJzZShjb250ZW50KTsNCiAgICAgICAgICBpZiAoDQogICAgICAgICAgICAhcGFyc2VkWyJAY29udGV4dCJdIHx8DQogICAgICAgICAgICAhcGFyc2VkWyJAY29udGV4dCJdLm1hdGNoKC9eaHR0cHM/XDpcL1wvc2NoZW1hXC5vcmckLykNCiAgICAgICAgICApIHsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICBpZiAoIXBhcnNlZFsiQHR5cGUiXSAmJiBBcnJheS5pc0FycmF5KHBhcnNlZFsiQGdyYXBoIl0pKSB7DQogICAgICAgICAgICBwYXJzZWQgPSBwYXJzZWRbIkBncmFwaCJdLmZpbmQoZnVuY3Rpb24gKGl0KSB7DQogICAgICAgICAgICAgIHJldHVybiAoaXRbIkB0eXBlIl0gfHwgIiIpLm1hdGNoKA0KICAgICAgICAgICAgICAgIHRoaXMuUkVHRVhQUy5qc29uTGRBcnRpY2xlVHlwZXMNCiAgICAgICAgICAgICAgKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGlmICgNCiAgICAgICAgICAgICFwYXJzZWQgfHwNCiAgICAgICAgICAgICFwYXJzZWRbIkB0eXBlIl0gfHwNCiAgICAgICAgICAgICFwYXJzZWRbIkB0eXBlIl0ubWF0Y2godGhpcy5SRUdFWFBTLmpzb25MZEFydGljbGVUeXBlcykNCiAgICAgICAgICApIHsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICBtZXRhZGF0YSA9IHt9Ow0KDQogICAgICAgICAgaWYgKHR5cGVvZiBwYXJzZWQubmFtZSA9PT0gInN0cmluZyIgJiYgdHlwZW9mIHBhcnNlZC5oZWFkbGluZSA9PT0gInN0cmluZyIgJiYgcGFyc2VkLm5hbWUgIT09IHBhcnNlZC5oZWFkbGluZSkgew0KICAgICAgICAgICAgLy8gd2UgaGF2ZSBib3RoIG5hbWUgYW5kIGhlYWRsaW5lIGVsZW1lbnQgaW4gdGhlIEpTT04tTEQuIFRoZXkgc2hvdWxkIGJvdGggYmUgdGhlIHNhbWUgYnV0IHNvbWUgd2Vic2l0ZXMgbGlrZSBha3R1YWxuZS5jeg0KICAgICAgICAgICAgLy8gcHV0IHRoZWlyIG93biBuYW1lIGludG8gIm5hbWUiIGFuZCB0aGUgYXJ0aWNsZSB0aXRsZSB0byAiaGVhZGxpbmUiIHdoaWNoIGNvbmZ1c2VzIFJlYWRhYmlsaXR5LiBTbyB3ZSB0cnkgdG8gY2hlY2sgaWYgZWl0aGVyDQogICAgICAgICAgICAvLyAibmFtZSIgb3IgImhlYWRsaW5lIiBjbG9zZWx5IG1hdGNoZXMgdGhlIGh0bWwgdGl0bGUsIGFuZCBpZiBzbywgdXNlIHRoYXQgb25lLiBJZiBub3QsIHRoZW4gd2UgdXNlICJuYW1lIiBieSBkZWZhdWx0Lg0KDQogICAgICAgICAgICB2YXIgdGl0bGUgPSB0aGlzLl9nZXRBcnRpY2xlVGl0bGUoKTsNCiAgICAgICAgICAgIHZhciBuYW1lTWF0Y2hlcyA9IHRoaXMuX3RleHRTaW1pbGFyaXR5KHBhcnNlZC5uYW1lLCB0aXRsZSkgPiAwLjc1Ow0KICAgICAgICAgICAgdmFyIGhlYWRsaW5lTWF0Y2hlcyA9IHRoaXMuX3RleHRTaW1pbGFyaXR5KHBhcnNlZC5oZWFkbGluZSwgdGl0bGUpID4gMC43NTsNCg0KICAgICAgICAgICAgaWYgKGhlYWRsaW5lTWF0Y2hlcyAmJiAhbmFtZU1hdGNoZXMpIHsNCiAgICAgICAgICAgICAgbWV0YWRhdGEudGl0bGUgPSBwYXJzZWQuaGVhZGxpbmU7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICBtZXRhZGF0YS50aXRsZSA9IHBhcnNlZC5uYW1lOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHBhcnNlZC5uYW1lID09PSAic3RyaW5nIikgew0KICAgICAgICAgICAgbWV0YWRhdGEudGl0bGUgPSBwYXJzZWQubmFtZS50cmltKCk7DQogICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgcGFyc2VkLmhlYWRsaW5lID09PSAic3RyaW5nIikgew0KICAgICAgICAgICAgbWV0YWRhdGEudGl0bGUgPSBwYXJzZWQuaGVhZGxpbmUudHJpbSgpOw0KICAgICAgICAgIH0NCiAgICAgICAgICBpZiAocGFyc2VkLmF1dGhvcikgew0KICAgICAgICAgICAgaWYgKHR5cGVvZiBwYXJzZWQuYXV0aG9yLm5hbWUgPT09ICJzdHJpbmciKSB7DQogICAgICAgICAgICAgIG1ldGFkYXRhLmJ5bGluZSA9IHBhcnNlZC5hdXRob3IubmFtZS50cmltKCk7DQogICAgICAgICAgICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkocGFyc2VkLmF1dGhvcikgJiYgcGFyc2VkLmF1dGhvclswXSAmJiB0eXBlb2YgcGFyc2VkLmF1dGhvclswXS5uYW1lID09PSAic3RyaW5nIikgew0KICAgICAgICAgICAgICBtZXRhZGF0YS5ieWxpbmUgPSBwYXJzZWQuYXV0aG9yDQogICAgICAgICAgICAgICAgLmZpbHRlcihmdW5jdGlvbiAoYXV0aG9yKSB7DQogICAgICAgICAgICAgICAgICByZXR1cm4gYXV0aG9yICYmIHR5cGVvZiBhdXRob3IubmFtZSA9PT0gInN0cmluZyI7DQogICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgICAubWFwKGZ1bmN0aW9uIChhdXRob3IpIHsNCiAgICAgICAgICAgICAgICAgIHJldHVybiBhdXRob3IubmFtZS50cmltKCk7DQogICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgICAuam9pbigiLCAiKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgICAgaWYgKHR5cGVvZiBwYXJzZWQuZGVzY3JpcHRpb24gPT09ICJzdHJpbmciKSB7DQogICAgICAgICAgICBtZXRhZGF0YS5leGNlcnB0ID0gcGFyc2VkLmRlc2NyaXB0aW9uLnRyaW0oKTsNCiAgICAgICAgICB9DQogICAgICAgICAgaWYgKA0KICAgICAgICAgICAgcGFyc2VkLnB1Ymxpc2hlciAmJg0KICAgICAgICAgICAgdHlwZW9mIHBhcnNlZC5wdWJsaXNoZXIubmFtZSA9PT0gInN0cmluZyINCiAgICAgICAgICApIHsNCiAgICAgICAgICAgIG1ldGFkYXRhLnNpdGVOYW1lID0gcGFyc2VkLnB1Ymxpc2hlci5uYW1lLnRyaW0oKTsNCiAgICAgICAgICB9DQogICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9IGNhdGNoIChlcnIpIHsNCiAgICAgICAgICB0aGlzLmxvZyhlcnIubWVzc2FnZSk7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9KTsNCiAgICByZXR1cm4gbWV0YWRhdGEgPyBtZXRhZGF0YSA6IHt9Ow0KICB9LA0KDQogIC8qKg0KICAgKiBBdHRlbXB0cyB0byBnZXQgZXhjZXJwdCBhbmQgYnlsaW5lIG1ldGFkYXRhIGZvciB0aGUgYXJ0aWNsZS4NCiAgICoNCiAgICogQHBhcmFtIHtPYmplY3R9IGpzb25sZCDigJQgb2JqZWN0IGNvbnRhaW5pbmcgYW55IG1ldGFkYXRhIHRoYXQNCiAgICogY291bGQgYmUgZXh0cmFjdGVkIGZyb20gSlNPTi1MRCBvYmplY3QuDQogICAqDQogICAqIEByZXR1cm4gT2JqZWN0IHdpdGggb3B0aW9uYWwgImV4Y2VycHQiIGFuZCAiYnlsaW5lIiBwcm9wZXJ0aWVzDQogICAqLw0KICBfZ2V0QXJ0aWNsZU1ldGFkYXRhOiBmdW5jdGlvbiAoanNvbmxkKSB7DQogICAgdmFyIG1ldGFkYXRhID0ge307DQogICAgdmFyIHZhbHVlcyA9IHt9Ow0KICAgIHZhciBtZXRhRWxlbWVudHMgPSB0aGlzLl9kb2MuZ2V0RWxlbWVudHNCeVRhZ05hbWUoIm1ldGEiKTsNCg0KICAgIC8vIHByb3BlcnR5IGlzIGEgc3BhY2Utc2VwYXJhdGVkIGxpc3Qgb2YgdmFsdWVzDQogICAgdmFyIHByb3BlcnR5UGF0dGVybiA9IC9ccyooZGN8ZGN0ZXJtfG9nfHR3aXR0ZXIpXHMqOlxzKihhdXRob3J8Y3JlYXRvcnxkZXNjcmlwdGlvbnx0aXRsZXxzaXRlX25hbWUpXHMqL2dpOw0KDQogICAgLy8gbmFtZSBpcyBhIHNpbmdsZSB2YWx1ZQ0KICAgIHZhciBuYW1lUGF0dGVybiA9IC9eXHMqKD86KGRjfGRjdGVybXxvZ3x0d2l0dGVyfHdlaWJvOihhcnRpY2xlfHdlYnBhZ2UpKVxzKltcLjpdXHMqKT8oYXV0aG9yfGNyZWF0b3J8ZGVzY3JpcHRpb258dGl0bGV8c2l0ZV9uYW1lKVxzKiQvaTsNCg0KICAgIC8vIEZpbmQgZGVzY3JpcHRpb24gdGFncy4NCiAgICB0aGlzLl9mb3JFYWNoTm9kZShtZXRhRWxlbWVudHMsIGZ1bmN0aW9uIChlbGVtZW50KSB7DQogICAgICB2YXIgZWxlbWVudE5hbWUgPSBlbGVtZW50LmdldEF0dHJpYnV0ZSgibmFtZSIpOw0KICAgICAgdmFyIGVsZW1lbnRQcm9wZXJ0eSA9IGVsZW1lbnQuZ2V0QXR0cmlidXRlKCJwcm9wZXJ0eSIpOw0KICAgICAgdmFyIGNvbnRlbnQgPSBlbGVtZW50LmdldEF0dHJpYnV0ZSgiY29udGVudCIpOw0KICAgICAgaWYgKCFjb250ZW50KSB7DQogICAgICAgIHJldHVybjsNCiAgICAgIH0NCiAgICAgIHZhciBtYXRjaGVzID0gbnVsbDsNCiAgICAgIHZhciBuYW1lID0gbnVsbDsNCg0KICAgICAgaWYgKGVsZW1lbnRQcm9wZXJ0eSkgew0KICAgICAgICBtYXRjaGVzID0gZWxlbWVudFByb3BlcnR5Lm1hdGNoKHByb3BlcnR5UGF0dGVybik7DQogICAgICAgIGlmIChtYXRjaGVzKSB7DQogICAgICAgICAgLy8gQ29udmVydCB0byBsb3dlcmNhc2UsIGFuZCByZW1vdmUgYW55IHdoaXRlc3BhY2UNCiAgICAgICAgICAvLyBzbyB3ZSBjYW4gbWF0Y2ggYmVsb3cuDQogICAgICAgICAgbmFtZSA9IG1hdGNoZXNbMF0udG9Mb3dlckNhc2UoKS5yZXBsYWNlKC9ccy9nLCAiIik7DQogICAgICAgICAgLy8gbXVsdGlwbGUgYXV0aG9ycw0KICAgICAgICAgIHZhbHVlc1tuYW1lXSA9IGNvbnRlbnQudHJpbSgpOw0KICAgICAgICB9DQogICAgICB9DQogICAgICBpZiAoIW1hdGNoZXMgJiYgZWxlbWVudE5hbWUgJiYgbmFtZVBhdHRlcm4udGVzdChlbGVtZW50TmFtZSkpIHsNCiAgICAgICAgbmFtZSA9IGVsZW1lbnROYW1lOw0KICAgICAgICBpZiAoY29udGVudCkgew0KICAgICAgICAgIC8vIENvbnZlcnQgdG8gbG93ZXJjYXNlLCByZW1vdmUgYW55IHdoaXRlc3BhY2UsIGFuZCBjb252ZXJ0IGRvdHMNCiAgICAgICAgICAvLyB0byBjb2xvbnMgc28gd2UgY2FuIG1hdGNoIGJlbG93Lg0KICAgICAgICAgIG5hbWUgPSBuYW1lLnRvTG93ZXJDYXNlKCkucmVwbGFjZSgvXHMvZywgIiIpLnJlcGxhY2UoL1wuL2csICI6Iik7DQogICAgICAgICAgdmFsdWVzW25hbWVdID0gY29udGVudC50cmltKCk7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9KTsNCg0KICAgIC8vIGdldCB0aXRsZQ0KICAgIG1ldGFkYXRhLnRpdGxlID0ganNvbmxkLnRpdGxlIHx8DQogICAgICB2YWx1ZXNbImRjOnRpdGxlIl0gfHwNCiAgICAgIHZhbHVlc1siZGN0ZXJtOnRpdGxlIl0gfHwNCiAgICAgIHZhbHVlc1sib2c6dGl0bGUiXSB8fA0KICAgICAgdmFsdWVzWyJ3ZWlibzphcnRpY2xlOnRpdGxlIl0gfHwNCiAgICAgIHZhbHVlc1sid2VpYm86d2VicGFnZTp0aXRsZSJdIHx8DQogICAgICB2YWx1ZXNbInRpdGxlIl0gfHwNCiAgICAgIHZhbHVlc1sidHdpdHRlcjp0aXRsZSJdOw0KDQogICAgaWYgKCFtZXRhZGF0YS50aXRsZSkgew0KICAgICAgbWV0YWRhdGEudGl0bGUgPSB0aGlzLl9nZXRBcnRpY2xlVGl0bGUoKTsNCiAgICB9DQoNCiAgICAvLyBnZXQgYXV0aG9yDQogICAgbWV0YWRhdGEuYnlsaW5lID0ganNvbmxkLmJ5bGluZSB8fA0KICAgICAgdmFsdWVzWyJkYzpjcmVhdG9yIl0gfHwNCiAgICAgIHZhbHVlc1siZGN0ZXJtOmNyZWF0b3IiXSB8fA0KICAgICAgdmFsdWVzWyJhdXRob3IiXTsNCg0KICAgIC8vIGdldCBkZXNjcmlwdGlvbg0KICAgIG1ldGFkYXRhLmV4Y2VycHQgPSBqc29ubGQuZXhjZXJwdCB8fA0KICAgICAgdmFsdWVzWyJkYzpkZXNjcmlwdGlvbiJdIHx8DQogICAgICB2YWx1ZXNbImRjdGVybTpkZXNjcmlwdGlvbiJdIHx8DQogICAgICB2YWx1ZXNbIm9nOmRlc2NyaXB0aW9uIl0gfHwNCiAgICAgIHZhbHVlc1sid2VpYm86YXJ0aWNsZTpkZXNjcmlwdGlvbiJdIHx8DQogICAgICB2YWx1ZXNbIndlaWJvOndlYnBhZ2U6ZGVzY3JpcHRpb24iXSB8fA0KICAgICAgdmFsdWVzWyJkZXNjcmlwdGlvbiJdIHx8DQogICAgICB2YWx1ZXNbInR3aXR0ZXI6ZGVzY3JpcHRpb24iXTsNCg0KICAgIC8vIGdldCBzaXRlIG5hbWUNCiAgICBtZXRhZGF0YS5zaXRlTmFtZSA9IGpzb25sZC5zaXRlTmFtZSB8fA0KICAgICAgdmFsdWVzWyJvZzpzaXRlX25hbWUiXTsNCg0KICAgIC8vIGluIG1hbnkgc2l0ZXMgdGhlIG1ldGEgdmFsdWUgaXMgZXNjYXBlZCB3aXRoIEhUTUwgZW50aXRpZXMsDQogICAgLy8gc28gaGVyZSB3ZSBuZWVkIHRvIHVuZXNjYXBlIGl0DQogICAgbWV0YWRhdGEudGl0bGUgPSB0aGlzLl91bmVzY2FwZUh0bWxFbnRpdGllcyhtZXRhZGF0YS50aXRsZSk7DQogICAgbWV0YWRhdGEuYnlsaW5lID0gdGhpcy5fdW5lc2NhcGVIdG1sRW50aXRpZXMobWV0YWRhdGEuYnlsaW5lKTsNCiAgICBtZXRhZGF0YS5leGNlcnB0ID0gdGhpcy5fdW5lc2NhcGVIdG1sRW50aXRpZXMobWV0YWRhdGEuZXhjZXJwdCk7DQogICAgbWV0YWRhdGEuc2l0ZU5hbWUgPSB0aGlzLl91bmVzY2FwZUh0bWxFbnRpdGllcyhtZXRhZGF0YS5zaXRlTmFtZSk7DQoNCiAgICByZXR1cm4gbWV0YWRhdGE7DQogIH0sDQoNCiAgLyoqDQogICAqIENoZWNrIGlmIG5vZGUgaXMgaW1hZ2UsIG9yIGlmIG5vZGUgY29udGFpbnMgZXhhY3RseSBvbmx5IG9uZSBpbWFnZQ0KICAgKiB3aGV0aGVyIGFzIGEgZGlyZWN0IGNoaWxkIG9yIGFzIGl0cyBkZXNjZW5kYW50cy4NCiAgICoNCiAgICogQHBhcmFtIEVsZW1lbnQNCiAgKiovDQogIF9pc1NpbmdsZUltYWdlOiBmdW5jdGlvbiAobm9kZSkgew0KICAgIGlmIChub2RlLnRhZ05hbWUgPT09ICJJTUciKSB7DQogICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQoNCiAgICBpZiAobm9kZS5jaGlsZHJlbi5sZW5ndGggIT09IDEgfHwgbm9kZS50ZXh0Q29udGVudC50cmltKCkgIT09ICIiKSB7DQogICAgICByZXR1cm4gZmFsc2U7DQogICAgfQ0KDQogICAgcmV0dXJuIHRoaXMuX2lzU2luZ2xlSW1hZ2Uobm9kZS5jaGlsZHJlblswXSk7DQogIH0sDQoNCiAgLyoqDQogICAqIEZpbmQgYWxsIDxub3NjcmlwdD4gdGhhdCBhcmUgbG9jYXRlZCBhZnRlciA8aW1nPiBub2RlcywgYW5kIHdoaWNoIGNvbnRhaW4gb25seSBvbmUNCiAgICogPGltZz4gZWxlbWVudC4gUmVwbGFjZSB0aGUgZmlyc3QgaW1hZ2Ugd2l0aCB0aGUgaW1hZ2UgZnJvbSBpbnNpZGUgdGhlIDxub3NjcmlwdD4gdGFnLA0KICAgKiBhbmQgcmVtb3ZlIHRoZSA8bm9zY3JpcHQ+IHRhZy4gVGhpcyBpbXByb3ZlcyB0aGUgcXVhbGl0eSBvZiB0aGUgaW1hZ2VzIHdlIHVzZSBvbg0KICAgKiBzb21lIHNpdGVzIChlLmcuIE1lZGl1bSkuDQogICAqDQogICAqIEBwYXJhbSBFbGVtZW50DQogICoqLw0KICBfdW53cmFwTm9zY3JpcHRJbWFnZXM6IGZ1bmN0aW9uIChkb2MpIHsNCiAgICAvLyBGaW5kIGltZyB3aXRob3V0IHNvdXJjZSBvciBhdHRyaWJ1dGVzIHRoYXQgbWlnaHQgY29udGFpbnMgaW1hZ2UsIGFuZCByZW1vdmUgaXQuDQogICAgLy8gVGhpcyBpcyBkb25lIHRvIHByZXZlbnQgYSBwbGFjZWhvbGRlciBpbWcgaXMgcmVwbGFjZWQgYnkgaW1nIGZyb20gbm9zY3JpcHQgaW4gbmV4dCBzdGVwLg0KICAgIHZhciBpbWdzID0gQXJyYXkuZnJvbShkb2MuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImltZyIpKTsNCiAgICB0aGlzLl9mb3JFYWNoTm9kZShpbWdzLCBmdW5jdGlvbiAoaW1nKSB7DQogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGltZy5hdHRyaWJ1dGVzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgIHZhciBhdHRyID0gaW1nLmF0dHJpYnV0ZXNbaV07DQogICAgICAgIHN3aXRjaCAoYXR0ci5uYW1lKSB7DQogICAgICAgICAgY2FzZSAic3JjIjoNCiAgICAgICAgICBjYXNlICJzcmNzZXQiOg0KICAgICAgICAgIGNhc2UgImRhdGEtc3JjIjoNCiAgICAgICAgICBjYXNlICJkYXRhLXNyY3NldCI6DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoL1wuKGpwZ3xqcGVnfHBuZ3x3ZWJwKS9pLnRlc3QoYXR0ci52YWx1ZSkpIHsNCiAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgaW1nLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoaW1nKTsNCiAgICB9KTsNCg0KICAgIC8vIE5leHQgZmluZCBub3NjcmlwdCBhbmQgdHJ5IHRvIGV4dHJhY3QgaXRzIGltYWdlDQogICAgdmFyIG5vc2NyaXB0cyA9IEFycmF5LmZyb20oZG9jLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJub3NjcmlwdCIpKTsNCiAgICB0aGlzLl9mb3JFYWNoTm9kZShub3NjcmlwdHMsIGZ1bmN0aW9uIChub3NjcmlwdCkgew0KICAgICAgLy8gUGFyc2UgY29udGVudCBvZiBub3NjcmlwdCBhbmQgbWFrZSBzdXJlIGl0IG9ubHkgY29udGFpbnMgaW1hZ2UNCiAgICAgIHZhciB0bXAgPSBkb2MuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQogICAgICB0bXAuaW5uZXJIVE1MID0gbm9zY3JpcHQuaW5uZXJIVE1MOw0KICAgICAgaWYgKCF0aGlzLl9pc1NpbmdsZUltYWdlKHRtcCkpIHsNCiAgICAgICAgcmV0dXJuOw0KICAgICAgfQ0KDQogICAgICAvLyBJZiBub3NjcmlwdCBoYXMgcHJldmlvdXMgc2libGluZyBhbmQgaXQgb25seSBjb250YWlucyBpbWFnZSwNCiAgICAgIC8vIHJlcGxhY2UgaXQgd2l0aCBub3NjcmlwdCBjb250ZW50LiBIb3dldmVyIHdlIGFsc28ga2VlcCBvbGQNCiAgICAgIC8vIGF0dHJpYnV0ZXMgdGhhdCBtaWdodCBjb250YWlucyBpbWFnZS4NCiAgICAgIHZhciBwcmV2RWxlbWVudCA9IG5vc2NyaXB0LnByZXZpb3VzRWxlbWVudFNpYmxpbmc7DQogICAgICBpZiAocHJldkVsZW1lbnQgJiYgdGhpcy5faXNTaW5nbGVJbWFnZShwcmV2RWxlbWVudCkpIHsNCiAgICAgICAgdmFyIHByZXZJbWcgPSBwcmV2RWxlbWVudDsNCiAgICAgICAgaWYgKHByZXZJbWcudGFnTmFtZSAhPT0gIklNRyIpIHsNCiAgICAgICAgICBwcmV2SW1nID0gcHJldkVsZW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImltZyIpWzBdOw0KICAgICAgICB9DQoNCiAgICAgICAgdmFyIG5ld0ltZyA9IHRtcC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaW1nIilbMF07DQogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcHJldkltZy5hdHRyaWJ1dGVzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgdmFyIGF0dHIgPSBwcmV2SW1nLmF0dHJpYnV0ZXNbaV07DQogICAgICAgICAgaWYgKGF0dHIudmFsdWUgPT09ICIiKSB7DQogICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICBpZiAoYXR0ci5uYW1lID09PSAic3JjIiB8fCBhdHRyLm5hbWUgPT09ICJzcmNzZXQiIHx8IC9cLihqcGd8anBlZ3xwbmd8d2VicCkvaS50ZXN0KGF0dHIudmFsdWUpKSB7DQogICAgICAgICAgICBpZiAobmV3SW1nLmdldEF0dHJpYnV0ZShhdHRyLm5hbWUpID09PSBhdHRyLnZhbHVlKSB7DQogICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB2YXIgYXR0ck5hbWUgPSBhdHRyLm5hbWU7DQogICAgICAgICAgICBpZiAobmV3SW1nLmhhc0F0dHJpYnV0ZShhdHRyTmFtZSkpIHsNCiAgICAgICAgICAgICAgYXR0ck5hbWUgPSAiZGF0YS1vbGQtIiArIGF0dHJOYW1lOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBuZXdJbWcuc2V0QXR0cmlidXRlKGF0dHJOYW1lLCBhdHRyLnZhbHVlKTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBub3NjcmlwdC5wYXJlbnROb2RlLnJlcGxhY2VDaGlsZCh0bXAuZmlyc3RFbGVtZW50Q2hpbGQsIHByZXZFbGVtZW50KTsNCiAgICAgIH0NCiAgICB9KTsNCiAgfSwNCg0KICAvKioNCiAgICogUmVtb3ZlcyBzY3JpcHQgdGFncyBmcm9tIHRoZSBkb2N1bWVudC4NCiAgICoNCiAgICogQHBhcmFtIEVsZW1lbnQNCiAgKiovDQogIF9yZW1vdmVTY3JpcHRzOiBmdW5jdGlvbiAoZG9jKSB7DQogICAgdGhpcy5fcmVtb3ZlTm9kZXModGhpcy5fZ2V0QWxsTm9kZXNXaXRoVGFnKGRvYywgWyJzY3JpcHQiLCAibm9zY3JpcHQiXSkpOw0KICB9LA0KDQogIC8qKg0KICAgKiBDaGVjayBpZiB0aGlzIG5vZGUgaGFzIG9ubHkgd2hpdGVzcGFjZSBhbmQgYSBzaW5nbGUgZWxlbWVudCB3aXRoIGdpdmVuIHRhZw0KICAgKiBSZXR1cm5zIGZhbHNlIGlmIHRoZSBESVYgbm9kZSBjb250YWlucyBub24tZW1wdHkgdGV4dCBub2Rlcw0KICAgKiBvciBpZiBpdCBjb250YWlucyBubyBlbGVtZW50IHdpdGggZ2l2ZW4gdGFnIG9yIG1vcmUgdGhhbiAxIGVsZW1lbnQuDQogICAqDQogICAqIEBwYXJhbSBFbGVtZW50DQogICAqIEBwYXJhbSBzdHJpbmcgdGFnIG9mIGNoaWxkIGVsZW1lbnQNCiAgKiovDQogIF9oYXNTaW5nbGVUYWdJbnNpZGVFbGVtZW50OiBmdW5jdGlvbiAoZWxlbWVudCwgdGFnKSB7DQogICAgLy8gVGhlcmUgc2hvdWxkIGJlIGV4YWN0bHkgMSBlbGVtZW50IGNoaWxkIHdpdGggZ2l2ZW4gdGFnDQogICAgaWYgKGVsZW1lbnQuY2hpbGRyZW4ubGVuZ3RoICE9IDEgfHwgZWxlbWVudC5jaGlsZHJlblswXS50YWdOYW1lICE9PSB0YWcpIHsNCiAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQoNCiAgICAvLyBBbmQgdGhlcmUgc2hvdWxkIGJlIG5vIHRleHQgbm9kZXMgd2l0aCByZWFsIGNvbnRlbnQNCiAgICByZXR1cm4gIXRoaXMuX3NvbWVOb2RlKGVsZW1lbnQuY2hpbGROb2RlcywgZnVuY3Rpb24gKG5vZGUpIHsNCiAgICAgIHJldHVybiBub2RlLm5vZGVUeXBlID09PSB0aGlzLlRFWFRfTk9ERSAmJg0KICAgICAgICB0aGlzLlJFR0VYUFMuaGFzQ29udGVudC50ZXN0KG5vZGUudGV4dENvbnRlbnQpOw0KICAgIH0pOw0KICB9LA0KDQogIF9pc0VsZW1lbnRXaXRob3V0Q29udGVudDogZnVuY3Rpb24gKG5vZGUpIHsNCiAgICByZXR1cm4gbm9kZS5ub2RlVHlwZSA9PT0gdGhpcy5FTEVNRU5UX05PREUgJiYNCiAgICAgIG5vZGUudGV4dENvbnRlbnQudHJpbSgpLmxlbmd0aCA9PSAwICYmDQogICAgICAobm9kZS5jaGlsZHJlbi5sZW5ndGggPT0gMCB8fA0KICAgICAgICBub2RlLmNoaWxkcmVuLmxlbmd0aCA9PSBub2RlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJiciIpLmxlbmd0aCArIG5vZGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImhyIikubGVuZ3RoKTsNCiAgfSwNCg0KICAvKioNCiAgICogRGV0ZXJtaW5lIHdoZXRoZXIgZWxlbWVudCBoYXMgYW55IGNoaWxkcmVuIGJsb2NrIGxldmVsIGVsZW1lbnRzLg0KICAgKg0KICAgKiBAcGFyYW0gRWxlbWVudA0KICAgKi8NCiAgX2hhc0NoaWxkQmxvY2tFbGVtZW50OiBmdW5jdGlvbiAoZWxlbWVudCkgew0KICAgIHJldHVybiB0aGlzLl9zb21lTm9kZShlbGVtZW50LmNoaWxkTm9kZXMsIGZ1bmN0aW9uIChub2RlKSB7DQogICAgICByZXR1cm4gdGhpcy5ESVZfVE9fUF9FTEVNUy5oYXMobm9kZS50YWdOYW1lKSB8fA0KICAgICAgICB0aGlzLl9oYXNDaGlsZEJsb2NrRWxlbWVudChub2RlKTsNCiAgICB9KTsNCiAgfSwNCg0KICAvKioqDQogICAqIERldGVybWluZSBpZiBhIG5vZGUgcXVhbGlmaWVzIGFzIHBocmFzaW5nIGNvbnRlbnQuDQogICAqIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0d1aWRlL0hUTUwvQ29udGVudF9jYXRlZ29yaWVzI1BocmFzaW5nX2NvbnRlbnQNCiAgKiovDQogIF9pc1BocmFzaW5nQ29udGVudDogZnVuY3Rpb24gKG5vZGUpIHsNCiAgICByZXR1cm4gbm9kZS5ub2RlVHlwZSA9PT0gdGhpcy5URVhUX05PREUgfHwgdGhpcy5QSFJBU0lOR19FTEVNUy5pbmRleE9mKG5vZGUudGFnTmFtZSkgIT09IC0xIHx8DQogICAgICAoKG5vZGUudGFnTmFtZSA9PT0gIkEiIHx8IG5vZGUudGFnTmFtZSA9PT0gIkRFTCIgfHwgbm9kZS50YWdOYW1lID09PSAiSU5TIikgJiYNCiAgICAgICAgdGhpcy5fZXZlcnlOb2RlKG5vZGUuY2hpbGROb2RlcywgdGhpcy5faXNQaHJhc2luZ0NvbnRlbnQpKTsNCiAgfSwNCg0KICBfaXNXaGl0ZXNwYWNlOiBmdW5jdGlvbiAobm9kZSkgew0KICAgIHJldHVybiAobm9kZS5ub2RlVHlwZSA9PT0gdGhpcy5URVhUX05PREUgJiYgbm9kZS50ZXh0Q29udGVudC50cmltKCkubGVuZ3RoID09PSAwKSB8fA0KICAgICAgKG5vZGUubm9kZVR5cGUgPT09IHRoaXMuRUxFTUVOVF9OT0RFICYmIG5vZGUudGFnTmFtZSA9PT0gIkJSIik7DQogIH0sDQoNCiAgLyoqDQogICAqIEdldCB0aGUgaW5uZXIgdGV4dCBvZiBhIG5vZGUgLSBjcm9zcyBicm93c2VyIGNvbXBhdGlibHkuDQogICAqIFRoaXMgYWxzbyBzdHJpcHMgb3V0IGFueSBleGNlc3Mgd2hpdGVzcGFjZSB0byBiZSBmb3VuZC4NCiAgICoNCiAgICogQHBhcmFtIEVsZW1lbnQNCiAgICogQHBhcmFtIEJvb2xlYW4gbm9ybWFsaXplU3BhY2VzIChkZWZhdWx0OiB0cnVlKQ0KICAgKiBAcmV0dXJuIHN0cmluZw0KICAqKi8NCiAgX2dldElubmVyVGV4dDogZnVuY3Rpb24gKGUsIG5vcm1hbGl6ZVNwYWNlcykgew0KICAgIG5vcm1hbGl6ZVNwYWNlcyA9ICh0eXBlb2Ygbm9ybWFsaXplU3BhY2VzID09PSAidW5kZWZpbmVkIikgPyB0cnVlIDogbm9ybWFsaXplU3BhY2VzOw0KICAgIHZhciB0ZXh0Q29udGVudCA9IGUudGV4dENvbnRlbnQudHJpbSgpOw0KDQogICAgaWYgKG5vcm1hbGl6ZVNwYWNlcykgew0KICAgICAgcmV0dXJuIHRleHRDb250ZW50LnJlcGxhY2UodGhpcy5SRUdFWFBTLm5vcm1hbGl6ZSwgIiAiKTsNCiAgICB9DQogICAgcmV0dXJuIHRleHRDb250ZW50Ow0KICB9LA0KDQogIC8qKg0KICAgKiBHZXQgdGhlIG51bWJlciBvZiB0aW1lcyBhIHN0cmluZyBzIGFwcGVhcnMgaW4gdGhlIG5vZGUgZS4NCiAgICoNCiAgICogQHBhcmFtIEVsZW1lbnQNCiAgICogQHBhcmFtIHN0cmluZyAtIHdoYXQgdG8gc3BsaXQgb24uIERlZmF1bHQgaXMgIiwiDQogICAqIEByZXR1cm4gbnVtYmVyIChpbnRlZ2VyKQ0KICAqKi8NCiAgX2dldENoYXJDb3VudDogZnVuY3Rpb24gKGUsIHMpIHsNCiAgICBzID0gcyB8fCAiLCI7DQogICAgcmV0dXJuIHRoaXMuX2dldElubmVyVGV4dChlKS5zcGxpdChzKS5sZW5ndGggLSAxOw0KICB9LA0KDQogIC8qKg0KICAgKiBSZW1vdmUgdGhlIHN0eWxlIGF0dHJpYnV0ZSBvbiBldmVyeSBlIGFuZCB1bmRlci4NCiAgICogVE9ETzogVGVzdCBpZiBnZXRFbGVtZW50c0J5VGFnTmFtZSgqKSBpcyBmYXN0ZXIuDQogICAqDQogICAqIEBwYXJhbSBFbGVtZW50DQogICAqIEByZXR1cm4gdm9pZA0KICAqKi8NCiAgX2NsZWFuU3R5bGVzOiBmdW5jdGlvbiAoZSkgew0KICAgIGlmICghZSB8fCBlLnRhZ05hbWUudG9Mb3dlckNhc2UoKSA9PT0gInN2ZyIpDQogICAgICByZXR1cm47DQoNCiAgICAvLyBSZW1vdmUgYHN0eWxlYCBhbmQgZGVwcmVjYXRlZCBwcmVzZW50YXRpb25hbCBhdHRyaWJ1dGVzDQogICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLlBSRVNFTlRBVElPTkFMX0FUVFJJQlVURVMubGVuZ3RoOyBpKyspIHsNCiAgICAgIGUucmVtb3ZlQXR0cmlidXRlKHRoaXMuUFJFU0VOVEFUSU9OQUxfQVRUUklCVVRFU1tpXSk7DQogICAgfQ0KDQogICAgaWYgKHRoaXMuREVQUkVDQVRFRF9TSVpFX0FUVFJJQlVURV9FTEVNUy5pbmRleE9mKGUudGFnTmFtZSkgIT09IC0xKSB7DQogICAgICBlLnJlbW92ZUF0dHJpYnV0ZSgid2lkdGgiKTsNCiAgICAgIGUucmVtb3ZlQXR0cmlidXRlKCJoZWlnaHQiKTsNCiAgICB9DQoNCiAgICB2YXIgY3VyID0gZS5maXJzdEVsZW1lbnRDaGlsZDsNCiAgICB3aGlsZSAoY3VyICE9PSBudWxsKSB7DQogICAgICB0aGlzLl9jbGVhblN0eWxlcyhjdXIpOw0KICAgICAgY3VyID0gY3VyLm5leHRFbGVtZW50U2libGluZzsNCiAgICB9DQogIH0sDQoNCiAgLyoqDQogICAqIEdldCB0aGUgZGVuc2l0eSBvZiBsaW5rcyBhcyBhIHBlcmNlbnRhZ2Ugb2YgdGhlIGNvbnRlbnQNCiAgICogVGhpcyBpcyB0aGUgYW1vdW50IG9mIHRleHQgdGhhdCBpcyBpbnNpZGUgYSBsaW5rIGRpdmlkZWQgYnkgdGhlIHRvdGFsIHRleHQgaW4gdGhlIG5vZGUuDQogICAqDQogICAqIEBwYXJhbSBFbGVtZW50DQogICAqIEByZXR1cm4gbnVtYmVyIChmbG9hdCkNCiAgKiovDQogIF9nZXRMaW5rRGVuc2l0eTogZnVuY3Rpb24gKGVsZW1lbnQpIHsNCiAgICB2YXIgdGV4dExlbmd0aCA9IHRoaXMuX2dldElubmVyVGV4dChlbGVtZW50KS5sZW5ndGg7DQogICAgaWYgKHRleHRMZW5ndGggPT09IDApDQogICAgICByZXR1cm4gMDsNCg0KICAgIHZhciBsaW5rTGVuZ3RoID0gMDsNCg0KICAgIC8vIFhYWCBpbXBsZW1lbnQgX3JlZHVjZU5vZGVMaXN0Pw0KICAgIHRoaXMuX2ZvckVhY2hOb2RlKGVsZW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImEiKSwgZnVuY3Rpb24gKGxpbmtOb2RlKSB7DQogICAgICB2YXIgaHJlZiA9IGxpbmtOb2RlLmdldEF0dHJpYnV0ZSgiaHJlZiIpOw0KICAgICAgdmFyIGNvZWZmaWNpZW50ID0gaHJlZiAmJiB0aGlzLlJFR0VYUFMuaGFzaFVybC50ZXN0KGhyZWYpID8gMC4zIDogMTsNCiAgICAgIGxpbmtMZW5ndGggKz0gdGhpcy5fZ2V0SW5uZXJUZXh0KGxpbmtOb2RlKS5sZW5ndGggKiBjb2VmZmljaWVudDsNCiAgICB9KTsNCg0KICAgIHJldHVybiBsaW5rTGVuZ3RoIC8gdGV4dExlbmd0aDsNCiAgfSwNCg0KICAvKioNCiAgICogR2V0IGFuIGVsZW1lbnRzIGNsYXNzL2lkIHdlaWdodC4gVXNlcyByZWd1bGFyIGV4cHJlc3Npb25zIHRvIHRlbGwgaWYgdGhpcw0KICAgKiBlbGVtZW50IGxvb2tzIGdvb2Qgb3IgYmFkLg0KICAgKg0KICAgKiBAcGFyYW0gRWxlbWVudA0KICAgKiBAcmV0dXJuIG51bWJlciAoSW50ZWdlcikNCiAgKiovDQogIF9nZXRDbGFzc1dlaWdodDogZnVuY3Rpb24gKGUpIHsNCiAgICBpZiAoIXRoaXMuX2ZsYWdJc0FjdGl2ZSh0aGlzLkZMQUdfV0VJR0hUX0NMQVNTRVMpKQ0KICAgICAgcmV0dXJuIDA7DQoNCiAgICB2YXIgd2VpZ2h0ID0gMDsNCg0KICAgIC8vIExvb2sgZm9yIGEgc3BlY2lhbCBjbGFzc25hbWUNCiAgICBpZiAodHlwZW9mIChlLmNsYXNzTmFtZSkgPT09ICJzdHJpbmciICYmIGUuY2xhc3NOYW1lICE9PSAiIikgew0KICAgICAgaWYgKHRoaXMuUkVHRVhQUy5uZWdhdGl2ZS50ZXN0KGUuY2xhc3NOYW1lKSkNCiAgICAgICAgd2VpZ2h0IC09IDI1Ow0KDQogICAgICBpZiAodGhpcy5SRUdFWFBTLnBvc2l0aXZlLnRlc3QoZS5jbGFzc05hbWUpKQ0KICAgICAgICB3ZWlnaHQgKz0gMjU7DQogICAgfQ0KDQogICAgLy8gTG9vayBmb3IgYSBzcGVjaWFsIElEDQogICAgaWYgKHR5cGVvZiAoZS5pZCkgPT09ICJzdHJpbmciICYmIGUuaWQgIT09ICIiKSB7DQogICAgICBpZiAodGhpcy5SRUdFWFBTLm5lZ2F0aXZlLnRlc3QoZS5pZCkpDQogICAgICAgIHdlaWdodCAtPSAyNTsNCg0KICAgICAgaWYgKHRoaXMuUkVHRVhQUy5wb3NpdGl2ZS50ZXN0KGUuaWQpKQ0KICAgICAgICB3ZWlnaHQgKz0gMjU7DQogICAgfQ0KDQogICAgcmV0dXJuIHdlaWdodDsNCiAgfSwNCg0KICAvKioNCiAgICogQ2xlYW4gYSBub2RlIG9mIGFsbCBlbGVtZW50cyBvZiB0eXBlICJ0YWciLg0KICAgKiAoVW5sZXNzIGl0J3MgYSB5b3V0dWJlL3ZpbWVvIHZpZGVvLiBQZW9wbGUgbG92ZSBtb3ZpZXMuKQ0KICAgKg0KICAgKiBAcGFyYW0gRWxlbWVudA0KICAgKiBAcGFyYW0gc3RyaW5nIHRhZyB0byBjbGVhbg0KICAgKiBAcmV0dXJuIHZvaWQNCiAgICoqLw0KICBfY2xlYW46IGZ1bmN0aW9uIChlLCB0YWcpIHsNCiAgICB2YXIgaXNFbWJlZCA9IFsib2JqZWN0IiwgImVtYmVkIiwgImlmcmFtZSJdLmluZGV4T2YodGFnKSAhPT0gLTE7DQoNCiAgICB0aGlzLl9yZW1vdmVOb2Rlcyh0aGlzLl9nZXRBbGxOb2Rlc1dpdGhUYWcoZSwgW3RhZ10pLCBmdW5jdGlvbiAoZWxlbWVudCkgew0KICAgICAgLy8gQWxsb3cgeW91dHViZSBhbmQgdmltZW8gdmlkZW9zIHRocm91Z2ggYXMgcGVvcGxlIHVzdWFsbHkgd2FudCB0byBzZWUgdGhvc2UuDQogICAgICBpZiAoaXNFbWJlZCkgew0KICAgICAgICAvLyBGaXJzdCwgY2hlY2sgdGhlIGVsZW1lbnRzIGF0dHJpYnV0ZXMgdG8gc2VlIGlmIGFueSBvZiB0aGVtIGNvbnRhaW4geW91dHViZSBvciB2aW1lbw0KICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGVsZW1lbnQuYXR0cmlidXRlcy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgIGlmICh0aGlzLl9hbGxvd2VkVmlkZW9SZWdleC50ZXN0KGVsZW1lbnQuYXR0cmlidXRlc1tpXS52YWx1ZSkpIHsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvLyBGb3IgZW1iZWQgd2l0aCA8b2JqZWN0PiB0YWcsIGNoZWNrIGlubmVyIEhUTUwgYXMgd2VsbC4NCiAgICAgICAgaWYgKGVsZW1lbnQudGFnTmFtZSA9PT0gIm9iamVjdCIgJiYgdGhpcy5fYWxsb3dlZFZpZGVvUmVnZXgudGVzdChlbGVtZW50LmlubmVySFRNTCkpIHsNCiAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgcmV0dXJuIHRydWU7DQogICAgfSk7DQogIH0sDQoNCiAgLyoqDQogICAqIENoZWNrIGlmIGEgZ2l2ZW4gbm9kZSBoYXMgb25lIG9mIGl0cyBhbmNlc3RvciB0YWcgbmFtZSBtYXRjaGluZyB0aGUNCiAgICogcHJvdmlkZWQgb25lLg0KICAgKiBAcGFyYW0gIEhUTUxFbGVtZW50IG5vZGUNCiAgICogQHBhcmFtICBTdHJpbmcgICAgICB0YWdOYW1lDQogICAqIEBwYXJhbSAgTnVtYmVyICAgICAgbWF4RGVwdGgNCiAgICogQHBhcmFtICBGdW5jdGlvbiAgICBmaWx0ZXJGbiBhIGZpbHRlciB0byBpbnZva2UgdG8gZGV0ZXJtaW5lIHdoZXRoZXIgdGhpcyBub2RlICdjb3VudHMnDQogICAqIEByZXR1cm4gQm9vbGVhbg0KICAgKi8NCiAgX2hhc0FuY2VzdG9yVGFnOiBmdW5jdGlvbiAobm9kZSwgdGFnTmFtZSwgbWF4RGVwdGgsIGZpbHRlckZuKSB7DQogICAgbWF4RGVwdGggPSBtYXhEZXB0aCB8fCAzOw0KICAgIHRhZ05hbWUgPSB0YWdOYW1lLnRvVXBwZXJDYXNlKCk7DQogICAgdmFyIGRlcHRoID0gMDsNCiAgICB3aGlsZSAobm9kZS5wYXJlbnROb2RlKSB7DQogICAgICBpZiAobWF4RGVwdGggPiAwICYmIGRlcHRoID4gbWF4RGVwdGgpDQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgIGlmIChub2RlLnBhcmVudE5vZGUudGFnTmFtZSA9PT0gdGFnTmFtZSAmJiAoIWZpbHRlckZuIHx8IGZpbHRlckZuKG5vZGUucGFyZW50Tm9kZSkpKQ0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgIG5vZGUgPSBub2RlLnBhcmVudE5vZGU7DQogICAgICBkZXB0aCsrOw0KICAgIH0NCiAgICByZXR1cm4gZmFsc2U7DQogIH0sDQoNCiAgLyoqDQogICAqIFJldHVybiBhbiBvYmplY3QgaW5kaWNhdGluZyBob3cgbWFueSByb3dzIGFuZCBjb2x1bW5zIHRoaXMgdGFibGUgaGFzLg0KICAgKi8NCiAgX2dldFJvd0FuZENvbHVtbkNvdW50OiBmdW5jdGlvbiAodGFibGUpIHsNCiAgICB2YXIgcm93cyA9IDA7DQogICAgdmFyIGNvbHVtbnMgPSAwOw0KICAgIHZhciB0cnMgPSB0YWJsZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgidHIiKTsNCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRycy5sZW5ndGg7IGkrKykgew0KICAgICAgdmFyIHJvd3NwYW4gPSB0cnNbaV0uZ2V0QXR0cmlidXRlKCJyb3dzcGFuIikgfHwgMDsNCiAgICAgIGlmIChyb3dzcGFuKSB7DQogICAgICAgIHJvd3NwYW4gPSBwYXJzZUludChyb3dzcGFuLCAxMCk7DQogICAgICB9DQogICAgICByb3dzICs9IChyb3dzcGFuIHx8IDEpOw0KDQogICAgICAvLyBOb3cgbG9vayBmb3IgY29sdW1uLXJlbGF0ZWQgaW5mbw0KICAgICAgdmFyIGNvbHVtbnNJblRoaXNSb3cgPSAwOw0KICAgICAgdmFyIGNlbGxzID0gdHJzW2ldLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJ0ZCIpOw0KICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBjZWxscy5sZW5ndGg7IGorKykgew0KICAgICAgICB2YXIgY29sc3BhbiA9IGNlbGxzW2pdLmdldEF0dHJpYnV0ZSgiY29sc3BhbiIpIHx8IDA7DQogICAgICAgIGlmIChjb2xzcGFuKSB7DQogICAgICAgICAgY29sc3BhbiA9IHBhcnNlSW50KGNvbHNwYW4sIDEwKTsNCiAgICAgICAgfQ0KICAgICAgICBjb2x1bW5zSW5UaGlzUm93ICs9IChjb2xzcGFuIHx8IDEpOw0KICAgICAgfQ0KICAgICAgY29sdW1ucyA9IE1hdGgubWF4KGNvbHVtbnMsIGNvbHVtbnNJblRoaXNSb3cpOw0KICAgIH0NCiAgICByZXR1cm4geyByb3dzOiByb3dzLCBjb2x1bW5zOiBjb2x1bW5zIH07DQogIH0sDQoNCiAgLyoqDQogICAqIExvb2sgZm9yICdkYXRhJyAoYXMgb3Bwb3NlZCB0byAnbGF5b3V0JykgdGFibGVzLCBmb3Igd2hpY2ggd2UgdXNlDQogICAqIHNpbWlsYXIgY2hlY2tzIGFzDQogICAqIGh0dHBzOi8vc2VhcmNoZm94Lm9yZy9tb3ppbGxhLWNlbnRyYWwvcmV2L2Y4MmQ1YzU0OWYwNDZjYjY0Y2U1NjAyYmZkODk0YjdhZTgwN2M4ZjgvYWNjZXNzaWJsZS9nZW5lcmljL1RhYmxlQWNjZXNzaWJsZS5jcHAjMTkNCiAgICovDQogIF9tYXJrRGF0YVRhYmxlczogZnVuY3Rpb24gKHJvb3QpIHsNCiAgICB2YXIgdGFibGVzID0gcm9vdC5nZXRFbGVtZW50c0J5VGFnTmFtZSgidGFibGUiKTsNCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRhYmxlcy5sZW5ndGg7IGkrKykgew0KICAgICAgdmFyIHRhYmxlID0gdGFibGVzW2ldOw0KICAgICAgdmFyIHJvbGUgPSB0YWJsZS5nZXRBdHRyaWJ1dGUoInJvbGUiKTsNCiAgICAgIGlmIChyb2xlID09ICJwcmVzZW50YXRpb24iKSB7DQogICAgICAgIHRhYmxlLl9yZWFkYWJpbGl0eURhdGFUYWJsZSA9IGZhbHNlOw0KICAgICAgICBjb250aW51ZTsNCiAgICAgIH0NCiAgICAgIHZhciBkYXRhdGFibGUgPSB0YWJsZS5nZXRBdHRyaWJ1dGUoImRhdGF0YWJsZSIpOw0KICAgICAgaWYgKGRhdGF0YWJsZSA9PSAiMCIpIHsNCiAgICAgICAgdGFibGUuX3JlYWRhYmlsaXR5RGF0YVRhYmxlID0gZmFsc2U7DQogICAgICAgIGNvbnRpbnVlOw0KICAgICAgfQ0KICAgICAgdmFyIHN1bW1hcnkgPSB0YWJsZS5nZXRBdHRyaWJ1dGUoInN1bW1hcnkiKTsNCiAgICAgIGlmIChzdW1tYXJ5KSB7DQogICAgICAgIHRhYmxlLl9yZWFkYWJpbGl0eURhdGFUYWJsZSA9IHRydWU7DQogICAgICAgIGNvbnRpbnVlOw0KICAgICAgfQ0KDQogICAgICB2YXIgY2FwdGlvbiA9IHRhYmxlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJjYXB0aW9uIilbMF07DQogICAgICBpZiAoY2FwdGlvbiAmJiBjYXB0aW9uLmNoaWxkTm9kZXMubGVuZ3RoID4gMCkgew0KICAgICAgICB0YWJsZS5fcmVhZGFiaWxpdHlEYXRhVGFibGUgPSB0cnVlOw0KICAgICAgICBjb250aW51ZTsNCiAgICAgIH0NCg0KICAgICAgLy8gSWYgdGhlIHRhYmxlIGhhcyBhIGRlc2NlbmRhbnQgd2l0aCBhbnkgb2YgdGhlc2UgdGFncywgY29uc2lkZXIgYSBkYXRhIHRhYmxlOg0KICAgICAgdmFyIGRhdGFUYWJsZURlc2NlbmRhbnRzID0gWyJjb2wiLCAiY29sZ3JvdXAiLCAidGZvb3QiLCAidGhlYWQiLCAidGgiXTsNCiAgICAgIHZhciBkZXNjZW5kYW50RXhpc3RzID0gZnVuY3Rpb24gKHRhZykgew0KICAgICAgICByZXR1cm4gISF0YWJsZS5nZXRFbGVtZW50c0J5VGFnTmFtZSh0YWcpWzBdOw0KICAgICAgfTsNCiAgICAgIGlmIChkYXRhVGFibGVEZXNjZW5kYW50cy5zb21lKGRlc2NlbmRhbnRFeGlzdHMpKSB7DQogICAgICAgIHRoaXMubG9nKCJEYXRhIHRhYmxlIGJlY2F1c2UgZm91bmQgZGF0YS15IGRlc2NlbmRhbnQiKTsNCiAgICAgICAgdGFibGUuX3JlYWRhYmlsaXR5RGF0YVRhYmxlID0gdHJ1ZTsNCiAgICAgICAgY29udGludWU7DQogICAgICB9DQoNCiAgICAgIC8vIE5lc3RlZCB0YWJsZXMgaW5kaWNhdGUgYSBsYXlvdXQgdGFibGU6DQogICAgICBpZiAodGFibGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoInRhYmxlIilbMF0pIHsNCiAgICAgICAgdGFibGUuX3JlYWRhYmlsaXR5RGF0YVRhYmxlID0gZmFsc2U7DQogICAgICAgIGNvbnRpbnVlOw0KICAgICAgfQ0KDQogICAgICB2YXIgc2l6ZUluZm8gPSB0aGlzLl9nZXRSb3dBbmRDb2x1bW5Db3VudCh0YWJsZSk7DQogICAgICBpZiAoc2l6ZUluZm8ucm93cyA+PSAxMCB8fCBzaXplSW5mby5jb2x1bW5zID4gNCkgew0KICAgICAgICB0YWJsZS5fcmVhZGFiaWxpdHlEYXRhVGFibGUgPSB0cnVlOw0KICAgICAgICBjb250aW51ZTsNCiAgICAgIH0NCiAgICAgIC8vIE5vdyBqdXN0IGdvIGJ5IHNpemUgZW50aXJlbHk6DQogICAgICB0YWJsZS5fcmVhZGFiaWxpdHlEYXRhVGFibGUgPSBzaXplSW5mby5yb3dzICogc2l6ZUluZm8uY29sdW1ucyA+IDEwOw0KICAgIH0NCiAgfSwNCg0KICAvKiBjb252ZXJ0IGltYWdlcyBhbmQgZmlndXJlcyB0aGF0IGhhdmUgcHJvcGVydGllcyBsaWtlIGRhdGEtc3JjIGludG8gaW1hZ2VzIHRoYXQgY2FuIGJlIGxvYWRlZCB3aXRob3V0IEpTICovDQogIF9maXhMYXp5SW1hZ2VzOiBmdW5jdGlvbiAocm9vdCkgew0KICAgIHRoaXMuX2ZvckVhY2hOb2RlKHRoaXMuX2dldEFsbE5vZGVzV2l0aFRhZyhyb290LCBbImltZyIsICJwaWN0dXJlIiwgImZpZ3VyZSJdKSwgZnVuY3Rpb24gKGVsZW0pIHsNCiAgICAgIC8vIEluIHNvbWUgc2l0ZXMgKGUuZy4gS290YWt1KSwgdGhleSBwdXQgMXB4IHNxdWFyZSBpbWFnZSBhcyBiYXNlNjQgZGF0YSB1cmkgaW4gdGhlIHNyYyBhdHRyaWJ1dGUuDQogICAgICAvLyBTbywgaGVyZSB3ZSBjaGVjayBpZiB0aGUgZGF0YSB1cmkgaXMgdG9vIHNob3J0LCBqdXN0IG1pZ2h0IGFzIHdlbGwgcmVtb3ZlIGl0Lg0KICAgICAgaWYgKGVsZW0uc3JjICYmIHRoaXMuUkVHRVhQUy5iNjREYXRhVXJsLnRlc3QoZWxlbS5zcmMpKSB7DQogICAgICAgIC8vIE1ha2Ugc3VyZSBpdCdzIG5vdCBTVkcsIGJlY2F1c2UgU1ZHIGNhbiBoYXZlIGEgbWVhbmluZ2Z1bCBpbWFnZSBpbiB1bmRlciAxMzMgYnl0ZXMuDQogICAgICAgIHZhciBwYXJ0cyA9IHRoaXMuUkVHRVhQUy5iNjREYXRhVXJsLmV4ZWMoZWxlbS5zcmMpOw0KICAgICAgICBpZiAocGFydHNbMV0gPT09ICJpbWFnZS9zdmcreG1sIikgew0KICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIE1ha2Ugc3VyZSB0aGlzIGVsZW1lbnQgaGFzIG90aGVyIGF0dHJpYnV0ZXMgd2hpY2ggY29udGFpbnMgaW1hZ2UuDQogICAgICAgIC8vIElmIGl0IGRvZXNuJ3QsIHRoZW4gdGhpcyBzcmMgaXMgaW1wb3J0YW50IGFuZCBzaG91bGRuJ3QgYmUgcmVtb3ZlZC4NCiAgICAgICAgdmFyIHNyY0NvdWxkQmVSZW1vdmVkID0gZmFsc2U7DQogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZWxlbS5hdHRyaWJ1dGVzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgdmFyIGF0dHIgPSBlbGVtLmF0dHJpYnV0ZXNbaV07DQogICAgICAgICAgaWYgKGF0dHIubmFtZSA9PT0gInNyYyIpIHsNCiAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGlmICgvXC4oanBnfGpwZWd8cG5nfHdlYnApL2kudGVzdChhdHRyLnZhbHVlKSkgew0KICAgICAgICAgICAgc3JjQ291bGRCZVJlbW92ZWQgPSB0cnVlOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8gSGVyZSB3ZSBhc3N1bWUgaWYgaW1hZ2UgaXMgbGVzcyB0aGFuIDEwMCBieXRlcyAob3IgMTMzQiBhZnRlciBlbmNvZGVkIHRvIGJhc2U2NCkNCiAgICAgICAgLy8gaXQgd2lsbCBiZSB0b28gc21hbGwsIHRoZXJlZm9yZSBpdCBtaWdodCBiZSBwbGFjZWhvbGRlciBpbWFnZS4NCiAgICAgICAgaWYgKHNyY0NvdWxkQmVSZW1vdmVkKSB7DQogICAgICAgICAgdmFyIGI2NHN0YXJ0cyA9IGVsZW0uc3JjLnNlYXJjaCgvYmFzZTY0XHMqL2kpICsgNzsNCiAgICAgICAgICB2YXIgYjY0bGVuZ3RoID0gZWxlbS5zcmMubGVuZ3RoIC0gYjY0c3RhcnRzOw0KICAgICAgICAgIGlmIChiNjRsZW5ndGggPCAxMzMpIHsNCiAgICAgICAgICAgIGVsZW0ucmVtb3ZlQXR0cmlidXRlKCJzcmMiKTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgLy8gYWxzbyBjaGVjayBmb3IgIm51bGwiIHRvIHdvcmsgYXJvdW5kIGh0dHBzOi8vZ2l0aHViLmNvbS9qc2RvbS9qc2RvbS9pc3N1ZXMvMjU4MA0KICAgICAgaWYgKChlbGVtLnNyYyB8fCAoZWxlbS5zcmNzZXQgJiYgZWxlbS5zcmNzZXQgIT0gIm51bGwiKSkgJiYgZWxlbS5jbGFzc05hbWUudG9Mb3dlckNhc2UoKS5pbmRleE9mKCJsYXp5IikgPT09IC0xKSB7DQogICAgICAgIHJldHVybjsNCiAgICAgIH0NCg0KICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBlbGVtLmF0dHJpYnV0ZXMubGVuZ3RoOyBqKyspIHsNCiAgICAgICAgYXR0ciA9IGVsZW0uYXR0cmlidXRlc1tqXTsNCiAgICAgICAgaWYgKGF0dHIubmFtZSA9PT0gInNyYyIgfHwgYXR0ci5uYW1lID09PSAic3Jjc2V0IiB8fCBhdHRyLm5hbWUgPT09ICJhbHQiKSB7DQogICAgICAgICAgY29udGludWU7DQogICAgICAgIH0NCiAgICAgICAgdmFyIGNvcHlUbyA9IG51bGw7DQogICAgICAgIGlmICgvXC4oanBnfGpwZWd8cG5nfHdlYnApXHMrXGQvLnRlc3QoYXR0ci52YWx1ZSkpIHsNCiAgICAgICAgICBjb3B5VG8gPSAic3Jjc2V0IjsNCiAgICAgICAgfSBlbHNlIGlmICgvXlxzKlxTK1wuKGpwZ3xqcGVnfHBuZ3x3ZWJwKVxTKlxzKiQvLnRlc3QoYXR0ci52YWx1ZSkpIHsNCiAgICAgICAgICBjb3B5VG8gPSAic3JjIjsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoY29weVRvKSB7DQogICAgICAgICAgLy9pZiB0aGlzIGlzIGFuIGltZyBvciBwaWN0dXJlLCBzZXQgdGhlIGF0dHJpYnV0ZSBkaXJlY3RseQ0KICAgICAgICAgIGlmIChlbGVtLnRhZ05hbWUgPT09ICJJTUciIHx8IGVsZW0udGFnTmFtZSA9PT0gIlBJQ1RVUkUiKSB7DQogICAgICAgICAgICBlbGVtLnNldEF0dHJpYnV0ZShjb3B5VG8sIGF0dHIudmFsdWUpOw0KICAgICAgICAgIH0gZWxzZSBpZiAoZWxlbS50YWdOYW1lID09PSAiRklHVVJFIiAmJiAhdGhpcy5fZ2V0QWxsTm9kZXNXaXRoVGFnKGVsZW0sIFsiaW1nIiwgInBpY3R1cmUiXSkubGVuZ3RoKSB7DQogICAgICAgICAgICAvL2lmIHRoZSBpdGVtIGlzIGEgPGZpZ3VyZT4gdGhhdCBkb2VzIG5vdCBjb250YWluIGFuIGltYWdlIG9yIHBpY3R1cmUsIGNyZWF0ZSBvbmUgYW5kIHBsYWNlIGl0IGluc2lkZSB0aGUgZmlndXJlDQogICAgICAgICAgICAvL3NlZSB0aGUgbnl0aW1lcy0zIHRlc3RjYXNlIGZvciBhbiBleGFtcGxlDQogICAgICAgICAgICB2YXIgaW1nID0gdGhpcy5fZG9jLmNyZWF0ZUVsZW1lbnQoImltZyIpOw0KICAgICAgICAgICAgaW1nLnNldEF0dHJpYnV0ZShjb3B5VG8sIGF0dHIudmFsdWUpOw0KICAgICAgICAgICAgZWxlbS5hcHBlbmRDaGlsZChpbWcpOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0pOw0KICB9LA0KDQogIF9nZXRUZXh0RGVuc2l0eTogZnVuY3Rpb24gKGUsIHRhZ3MpIHsNCiAgICB2YXIgdGV4dExlbmd0aCA9IHRoaXMuX2dldElubmVyVGV4dChlLCB0cnVlKS5sZW5ndGg7DQogICAgaWYgKHRleHRMZW5ndGggPT09IDApIHsNCiAgICAgIHJldHVybiAwOw0KICAgIH0NCiAgICB2YXIgY2hpbGRyZW5MZW5ndGggPSAwOw0KICAgIHZhciBjaGlsZHJlbiA9IHRoaXMuX2dldEFsbE5vZGVzV2l0aFRhZyhlLCB0YWdzKTsNCiAgICB0aGlzLl9mb3JFYWNoTm9kZShjaGlsZHJlbiwgKGNoaWxkKSA9PiBjaGlsZHJlbkxlbmd0aCArPSB0aGlzLl9nZXRJbm5lclRleHQoY2hpbGQsIHRydWUpLmxlbmd0aCk7DQogICAgcmV0dXJuIGNoaWxkcmVuTGVuZ3RoIC8gdGV4dExlbmd0aDsNCiAgfSwNCg0KICAvKioNCiAgICogQ2xlYW4gYW4gZWxlbWVudCBvZiBhbGwgdGFncyBvZiB0eXBlICJ0YWciIGlmIHRoZXkgbG9vayBmaXNoeS4NCiAgICogIkZpc2h5IiBpcyBhbiBhbGdvcml0aG0gYmFzZWQgb24gY29udGVudCBsZW5ndGgsIGNsYXNzbmFtZXMsIGxpbmsgZGVuc2l0eSwgbnVtYmVyIG9mIGltYWdlcyAmIGVtYmVkcywgZXRjLg0KICAgKg0KICAgKiBAcmV0dXJuIHZvaWQNCiAgICoqLw0KICBfY2xlYW5Db25kaXRpb25hbGx5OiBmdW5jdGlvbiAoZSwgdGFnKSB7DQogICAgaWYgKCF0aGlzLl9mbGFnSXNBY3RpdmUodGhpcy5GTEFHX0NMRUFOX0NPTkRJVElPTkFMTFkpKQ0KICAgICAgcmV0dXJuOw0KDQogICAgLy8gR2F0aGVyIGNvdW50cyBmb3Igb3RoZXIgdHlwaWNhbCBlbGVtZW50cyBlbWJlZGRlZCB3aXRoaW4uDQogICAgLy8gVHJhdmVyc2UgYmFja3dhcmRzIHNvIHdlIGNhbiByZW1vdmUgbm9kZXMgYXQgdGhlIHNhbWUgdGltZQ0KICAgIC8vIHdpdGhvdXQgZWZmZWN0aW5nIHRoZSB0cmF2ZXJzYWwuDQogICAgLy8NCiAgICAvLyBUT0RPOiBDb25zaWRlciB0YWtpbmcgaW50byBhY2NvdW50IG9yaWdpbmFsIGNvbnRlbnRTY29yZSBoZXJlLg0KICAgIHRoaXMuX3JlbW92ZU5vZGVzKHRoaXMuX2dldEFsbE5vZGVzV2l0aFRhZyhlLCBbdGFnXSksIGZ1bmN0aW9uIChub2RlKSB7DQogICAgICAvLyBGaXJzdCBjaGVjayBpZiB0aGlzIG5vZGUgSVMgZGF0YSB0YWJsZSwgaW4gd2hpY2ggY2FzZSBkb24ndCByZW1vdmUgaXQuDQogICAgICB2YXIgaXNEYXRhVGFibGUgPSBmdW5jdGlvbiAodCkgew0KICAgICAgICByZXR1cm4gdC5fcmVhZGFiaWxpdHlEYXRhVGFibGU7DQogICAgICB9Ow0KDQogICAgICB2YXIgaXNMaXN0ID0gdGFnID09PSAidWwiIHx8IHRhZyA9PT0gIm9sIjsNCiAgICAgIGlmICghaXNMaXN0KSB7DQogICAgICAgIHZhciBsaXN0TGVuZ3RoID0gMDsNCiAgICAgICAgdmFyIGxpc3ROb2RlcyA9IHRoaXMuX2dldEFsbE5vZGVzV2l0aFRhZyhub2RlLCBbInVsIiwgIm9sIl0pOw0KICAgICAgICB0aGlzLl9mb3JFYWNoTm9kZShsaXN0Tm9kZXMsIChsaXN0KSA9PiBsaXN0TGVuZ3RoICs9IHRoaXMuX2dldElubmVyVGV4dChsaXN0KS5sZW5ndGgpOw0KICAgICAgICBpc0xpc3QgPSBsaXN0TGVuZ3RoIC8gdGhpcy5fZ2V0SW5uZXJUZXh0KG5vZGUpLmxlbmd0aCA+IDAuOTsNCiAgICAgIH0NCg0KICAgICAgaWYgKHRhZyA9PT0gInRhYmxlIiAmJiBpc0RhdGFUYWJsZShub2RlKSkgew0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICB9DQoNCiAgICAgIC8vIE5leHQgY2hlY2sgaWYgd2UncmUgaW5zaWRlIGEgZGF0YSB0YWJsZSwgaW4gd2hpY2ggY2FzZSBkb24ndCByZW1vdmUgaXQgYXMgd2VsbC4NCiAgICAgIGlmICh0aGlzLl9oYXNBbmNlc3RvclRhZyhub2RlLCAidGFibGUiLCAtMSwgaXNEYXRhVGFibGUpKSB7DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgIH0NCg0KICAgICAgaWYgKHRoaXMuX2hhc0FuY2VzdG9yVGFnKG5vZGUsICJjb2RlIikpIHsNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgfQ0KDQogICAgICB2YXIgd2VpZ2h0ID0gdGhpcy5fZ2V0Q2xhc3NXZWlnaHQobm9kZSk7DQoNCiAgICAgIHRoaXMubG9nKCJDbGVhbmluZyBDb25kaXRpb25hbGx5Iiwgbm9kZSk7DQoNCiAgICAgIHZhciBjb250ZW50U2NvcmUgPSAwOw0KDQogICAgICBpZiAod2VpZ2h0ICsgY29udGVudFNjb3JlIDwgMCkgew0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgIH0NCg0KICAgICAgaWYgKHRoaXMuX2dldENoYXJDb3VudChub2RlLCAiLCIpIDwgMTApIHsNCiAgICAgICAgLy8gSWYgdGhlcmUgYXJlIG5vdCB2ZXJ5IG1hbnkgY29tbWFzLCBhbmQgdGhlIG51bWJlciBvZg0KICAgICAgICAvLyBub24tcGFyYWdyYXBoIGVsZW1lbnRzIGlzIG1vcmUgdGhhbiBwYXJhZ3JhcGhzIG9yIG90aGVyDQogICAgICAgIC8vIG9taW5vdXMgc2lnbnMsIHJlbW92ZSB0aGUgZWxlbWVudC4NCiAgICAgICAgdmFyIHAgPSBub2RlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJwIikubGVuZ3RoOw0KICAgICAgICB2YXIgaW1nID0gbm9kZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaW1nIikubGVuZ3RoOw0KICAgICAgICB2YXIgbGkgPSBub2RlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJsaSIpLmxlbmd0aCAtIDEwMDsNCiAgICAgICAgdmFyIGlucHV0ID0gbm9kZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaW5wdXQiKS5sZW5ndGg7DQogICAgICAgIHZhciBoZWFkaW5nRGVuc2l0eSA9IHRoaXMuX2dldFRleHREZW5zaXR5KG5vZGUsIFsiaDEiLCAiaDIiLCAiaDMiLCAiaDQiLCAiaDUiLCAiaDYiXSk7DQoNCiAgICAgICAgdmFyIGVtYmVkQ291bnQgPSAwOw0KICAgICAgICB2YXIgZW1iZWRzID0gdGhpcy5fZ2V0QWxsTm9kZXNXaXRoVGFnKG5vZGUsIFsib2JqZWN0IiwgImVtYmVkIiwgImlmcmFtZSJdKTsNCg0KICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGVtYmVkcy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgIC8vIElmIHRoaXMgZW1iZWQgaGFzIGF0dHJpYnV0ZSB0aGF0IG1hdGNoZXMgdmlkZW8gcmVnZXgsIGRvbid0IGRlbGV0ZSBpdC4NCiAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGVtYmVkc1tpXS5hdHRyaWJ1dGVzLmxlbmd0aDsgaisrKSB7DQogICAgICAgICAgICBpZiAodGhpcy5fYWxsb3dlZFZpZGVvUmVnZXgudGVzdChlbWJlZHNbaV0uYXR0cmlidXRlc1tqXS52YWx1ZSkpIHsNCiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCg0KICAgICAgICAgIC8vIEZvciBlbWJlZCB3aXRoIDxvYmplY3Q+IHRhZywgY2hlY2sgaW5uZXIgSFRNTCBhcyB3ZWxsLg0KICAgICAgICAgIGlmIChlbWJlZHNbaV0udGFnTmFtZSA9PT0gIm9iamVjdCIgJiYgdGhpcy5fYWxsb3dlZFZpZGVvUmVnZXgudGVzdChlbWJlZHNbaV0uaW5uZXJIVE1MKSkgew0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGVtYmVkQ291bnQrKzsNCiAgICAgICAgfQ0KDQogICAgICAgIHZhciBsaW5rRGVuc2l0eSA9IHRoaXMuX2dldExpbmtEZW5zaXR5KG5vZGUpOw0KICAgICAgICB2YXIgY29udGVudExlbmd0aCA9IHRoaXMuX2dldElubmVyVGV4dChub2RlKS5sZW5ndGg7DQoNCiAgICAgICAgdmFyIGhhdmVUb1JlbW92ZSA9DQogICAgICAgICAgKGltZyA+IDEgJiYgcCAvIGltZyA8IDAuNSAmJiAhdGhpcy5faGFzQW5jZXN0b3JUYWcobm9kZSwgImZpZ3VyZSIpKSB8fA0KICAgICAgICAgICghaXNMaXN0ICYmIGxpID4gcCkgfHwNCiAgICAgICAgICAoaW5wdXQgPiBNYXRoLmZsb29yKHAgLyAzKSkgfHwNCiAgICAgICAgICAoIWlzTGlzdCAmJiBoZWFkaW5nRGVuc2l0eSA8IDAuOSAmJiBjb250ZW50TGVuZ3RoIDwgMjUgJiYgKGltZyA9PT0gMCB8fCBpbWcgPiAyKSAmJiAhdGhpcy5faGFzQW5jZXN0b3JUYWcobm9kZSwgImZpZ3VyZSIpKSB8fA0KICAgICAgICAgICghaXNMaXN0ICYmIHdlaWdodCA8IDI1ICYmIGxpbmtEZW5zaXR5ID4gMC4yKSB8fA0KICAgICAgICAgICh3ZWlnaHQgPj0gMjUgJiYgbGlua0RlbnNpdHkgPiAwLjUpIHx8DQogICAgICAgICAgKChlbWJlZENvdW50ID09PSAxICYmIGNvbnRlbnRMZW5ndGggPCA3NSkgfHwgZW1iZWRDb3VudCA+IDEpOw0KICAgICAgICAvLyBBbGxvdyBzaW1wbGUgbGlzdHMgb2YgaW1hZ2VzIHRvIHJlbWFpbiBpbiBwYWdlcw0KICAgICAgICBpZiAoaXNMaXN0ICYmIGhhdmVUb1JlbW92ZSkgew0KICAgICAgICAgIGZvciAodmFyIHggPSAwOyB4IDwgbm9kZS5jaGlsZHJlbi5sZW5ndGg7IHgrKykgew0KICAgICAgICAgICAgbGV0IGNoaWxkID0gbm9kZS5jaGlsZHJlblt4XTsNCiAgICAgICAgICAgIC8vIERvbid0IGZpbHRlciBpbiBsaXN0cyB3aXRoIGxpJ3MgdGhhdCBjb250YWluIG1vcmUgdGhhbiBvbmUgY2hpbGQNCiAgICAgICAgICAgIGlmIChjaGlsZC5jaGlsZHJlbi5sZW5ndGggPiAxKSB7DQogICAgICAgICAgICAgIHJldHVybiBoYXZlVG9SZW1vdmU7DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICAgIGxldCBsaV9jb3VudCA9IG5vZGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImxpIikubGVuZ3RoOw0KICAgICAgICAgIC8vIE9ubHkgYWxsb3cgdGhlIGxpc3QgdG8gcmVtYWluIGlmIGV2ZXJ5IGxpIGNvbnRhaW5zIGFuIGltYWdlDQogICAgICAgICAgaWYgKGltZyA9PSBsaV9jb3VudCkgew0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gaGF2ZVRvUmVtb3ZlOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0pOw0KICB9LA0KDQogIC8qKg0KICAgKiBDbGVhbiBvdXQgZWxlbWVudHMgdGhhdCBtYXRjaCB0aGUgc3BlY2lmaWVkIGNvbmRpdGlvbnMNCiAgICoNCiAgICogQHBhcmFtIEVsZW1lbnQNCiAgICogQHBhcmFtIEZ1bmN0aW9uIGRldGVybWluZXMgd2hldGhlciBhIG5vZGUgc2hvdWxkIGJlIHJlbW92ZWQNCiAgICogQHJldHVybiB2b2lkDQogICAqKi8NCiAgX2NsZWFuTWF0Y2hlZE5vZGVzOiBmdW5jdGlvbiAoZSwgZmlsdGVyKSB7DQogICAgdmFyIGVuZE9mU2VhcmNoTWFya2VyTm9kZSA9IHRoaXMuX2dldE5leHROb2RlKGUsIHRydWUpOw0KICAgIHZhciBuZXh0ID0gdGhpcy5fZ2V0TmV4dE5vZGUoZSk7DQogICAgd2hpbGUgKG5leHQgJiYgbmV4dCAhPSBlbmRPZlNlYXJjaE1hcmtlck5vZGUpIHsNCiAgICAgIGlmIChmaWx0ZXIuY2FsbCh0aGlzLCBuZXh0LCBuZXh0LmNsYXNzTmFtZSArICIgIiArIG5leHQuaWQpKSB7DQogICAgICAgIG5leHQgPSB0aGlzLl9yZW1vdmVBbmRHZXROZXh0KG5leHQpOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgbmV4dCA9IHRoaXMuX2dldE5leHROb2RlKG5leHQpOw0KICAgICAgfQ0KICAgIH0NCiAgfSwNCg0KICAvKioNCiAgICogQ2xlYW4gb3V0IHNwdXJpb3VzIGhlYWRlcnMgZnJvbSBhbiBFbGVtZW50Lg0KICAgKg0KICAgKiBAcGFyYW0gRWxlbWVudA0KICAgKiBAcmV0dXJuIHZvaWQNCiAgKiovDQogIF9jbGVhbkhlYWRlcnM6IGZ1bmN0aW9uIChlKSB7DQogICAgbGV0IGhlYWRpbmdOb2RlcyA9IHRoaXMuX2dldEFsbE5vZGVzV2l0aFRhZyhlLCBbImgxIiwgImgyIl0pOw0KICAgIHRoaXMuX3JlbW92ZU5vZGVzKGhlYWRpbmdOb2RlcywgZnVuY3Rpb24gKG5vZGUpIHsNCiAgICAgIGxldCBzaG91bGRSZW1vdmUgPSB0aGlzLl9nZXRDbGFzc1dlaWdodChub2RlKSA8IDA7DQogICAgICBpZiAoc2hvdWxkUmVtb3ZlKSB7DQogICAgICAgIHRoaXMubG9nKCJSZW1vdmluZyBoZWFkZXIgd2l0aCBsb3cgY2xhc3Mgd2VpZ2h0OiIsIG5vZGUpOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIHNob3VsZFJlbW92ZTsNCiAgICB9KTsNCiAgfSwNCg0KICAvKioNCiAgICogQ2hlY2sgaWYgdGhpcyBub2RlIGlzIGFuIEgxIG9yIEgyIGVsZW1lbnQgd2hvc2UgY29udGVudCBpcyBtb3N0bHkNCiAgICogdGhlIHNhbWUgYXMgdGhlIGFydGljbGUgdGl0bGUuDQogICAqDQogICAqIEBwYXJhbSBFbGVtZW50ICB0aGUgbm9kZSB0byBjaGVjay4NCiAgICogQHJldHVybiBib29sZWFuIGluZGljYXRpbmcgd2hldGhlciB0aGlzIGlzIGEgdGl0bGUtbGlrZSBoZWFkZXIuDQogICAqLw0KICBfaGVhZGVyRHVwbGljYXRlc1RpdGxlOiBmdW5jdGlvbiAobm9kZSkgew0KICAgIGlmIChub2RlLnRhZ05hbWUgIT0gIkgxIiAmJiBub2RlLnRhZ05hbWUgIT0gIkgyIikgew0KICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCiAgICB2YXIgaGVhZGluZyA9IHRoaXMuX2dldElubmVyVGV4dChub2RlLCBmYWxzZSk7DQogICAgdGhpcy5sb2coIkV2YWx1YXRpbmcgc2ltaWxhcml0eSBvZiBoZWFkZXI6IiwgaGVhZGluZywgdGhpcy5fYXJ0aWNsZVRpdGxlKTsNCiAgICByZXR1cm4gdGhpcy5fdGV4dFNpbWlsYXJpdHkodGhpcy5fYXJ0aWNsZVRpdGxlLCBoZWFkaW5nKSA+IDAuNzU7DQogIH0sDQoNCiAgX2ZsYWdJc0FjdGl2ZTogZnVuY3Rpb24gKGZsYWcpIHsNCiAgICByZXR1cm4gKHRoaXMuX2ZsYWdzICYgZmxhZykgPiAwOw0KICB9LA0KDQogIF9yZW1vdmVGbGFnOiBmdW5jdGlvbiAoZmxhZykgew0KICAgIHRoaXMuX2ZsYWdzID0gdGhpcy5fZmxhZ3MgJiB+ZmxhZzsNCiAgfSwNCg0KICBfaXNQcm9iYWJseVZpc2libGU6IGZ1bmN0aW9uIChub2RlKSB7DQogICAgLy8gSGF2ZSB0byBudWxsLWNoZWNrIG5vZGUuc3R5bGUgYW5kIG5vZGUuY2xhc3NOYW1lLmluZGV4T2YgdG8gZGVhbCB3aXRoIFNWRyBhbmQgTWF0aE1MIG5vZGVzLg0KICAgIHJldHVybiAoIW5vZGUuc3R5bGUgfHwgbm9kZS5zdHlsZS5kaXNwbGF5ICE9ICJub25lIikNCiAgICAgICYmICFub2RlLmhhc0F0dHJpYnV0ZSgiaGlkZGVuIikNCiAgICAgIC8vY2hlY2sgZm9yICJmYWxsYmFjay1pbWFnZSIgc28gdGhhdCB3aWtpbWVkaWEgbWF0aCBpbWFnZXMgYXJlIGRpc3BsYXllZA0KICAgICAgJiYgKCFub2RlLmhhc0F0dHJpYnV0ZSgiYXJpYS1oaWRkZW4iKSB8fCBub2RlLmdldEF0dHJpYnV0ZSgiYXJpYS1oaWRkZW4iKSAhPSAidHJ1ZSIgfHwgKG5vZGUuY2xhc3NOYW1lICYmIG5vZGUuY2xhc3NOYW1lLmluZGV4T2YgJiYgbm9kZS5jbGFzc05hbWUuaW5kZXhPZigiZmFsbGJhY2staW1hZ2UiKSAhPT0gLTEpKTsNCiAgfSwNCg0KICAvKioNCiAgICogUnVucyByZWFkYWJpbGl0eS4NCiAgICoNCiAgICogV29ya2Zsb3c6DQogICAqICAxLiBQcmVwIHRoZSBkb2N1bWVudCBieSByZW1vdmluZyBzY3JpcHQgdGFncywgY3NzLCBldGMuDQogICAqICAyLiBCdWlsZCByZWFkYWJpbGl0eSdzIERPTSB0cmVlLg0KICAgKiAgMy4gR3JhYiB0aGUgYXJ0aWNsZSBjb250ZW50IGZyb20gdGhlIGN1cnJlbnQgZG9tIHRyZWUuDQogICAqICA0LiBSZXBsYWNlIHRoZSBjdXJyZW50IERPTSB0cmVlIHdpdGggdGhlIG5ldyBvbmUuDQogICAqICA1LiBSZWFkIHBlYWNlZnVsbHkuDQogICAqDQogICAqIEByZXR1cm4gdm9pZA0KICAgKiovDQogIHBhcnNlOiBmdW5jdGlvbiAoKSB7DQogICAgLy8gQXZvaWQgcGFyc2luZyB0b28gbGFyZ2UgZG9jdW1lbnRzLCBhcyBwZXIgY29uZmlndXJhdGlvbiBvcHRpb24NCiAgICBpZiAodGhpcy5fbWF4RWxlbXNUb1BhcnNlID4gMCkgew0KICAgICAgdmFyIG51bVRhZ3MgPSB0aGlzLl9kb2MuZ2V0RWxlbWVudHNCeVRhZ05hbWUoIioiKS5sZW5ndGg7DQogICAgICBpZiAobnVtVGFncyA+IHRoaXMuX21heEVsZW1zVG9QYXJzZSkgew0KICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkFib3J0aW5nIHBhcnNpbmcgZG9jdW1lbnQ7ICIgKyBudW1UYWdzICsgIiBlbGVtZW50cyBmb3VuZCIpOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIC8vIFVud3JhcCBpbWFnZSBmcm9tIG5vc2NyaXB0DQogICAgdGhpcy5fdW53cmFwTm9zY3JpcHRJbWFnZXModGhpcy5fZG9jKTsNCg0KICAgIC8vIEV4dHJhY3QgSlNPTi1MRCBtZXRhZGF0YSBiZWZvcmUgcmVtb3Zpbmcgc2NyaXB0cw0KICAgIHZhciBqc29uTGQgPSB0aGlzLl9kaXNhYmxlSlNPTkxEID8ge30gOiB0aGlzLl9nZXRKU09OTEQodGhpcy5fZG9jKTsNCg0KICAgIC8vIFJlbW92ZSBzY3JpcHQgdGFncyBmcm9tIHRoZSBkb2N1bWVudC4NCiAgICB0aGlzLl9yZW1vdmVTY3JpcHRzKHRoaXMuX2RvYyk7DQoNCiAgICB0aGlzLl9wcmVwRG9jdW1lbnQoKTsNCg0KICAgIHZhciBtZXRhZGF0YSA9IHRoaXMuX2dldEFydGljbGVNZXRhZGF0YShqc29uTGQpOw0KICAgIHRoaXMuX2FydGljbGVUaXRsZSA9IG1ldGFkYXRhLnRpdGxlOw0KDQogICAgdmFyIGFydGljbGVDb250ZW50ID0gdGhpcy5fZ3JhYkFydGljbGUoKTsNCiAgICBpZiAoIWFydGljbGVDb250ZW50KQ0KICAgICAgcmV0dXJuIG51bGw7DQoNCiAgICB0aGlzLmxvZygiR3JhYmJlZDogIiArIGFydGljbGVDb250ZW50LmlubmVySFRNTCk7DQoNCiAgICB0aGlzLl9wb3N0UHJvY2Vzc0NvbnRlbnQoYXJ0aWNsZUNvbnRlbnQpOw0KDQogICAgLy8gSWYgd2UgaGF2ZW4ndCBmb3VuZCBhbiBleGNlcnB0IGluIHRoZSBhcnRpY2xlJ3MgbWV0YWRhdGEsIHVzZSB0aGUgYXJ0aWNsZSdzDQogICAgLy8gZmlyc3QgcGFyYWdyYXBoIGFzIHRoZSBleGNlcnB0LiBUaGlzIGlzIHVzZWQgZm9yIGRpc3BsYXlpbmcgYSBwcmV2aWV3IG9mDQogICAgLy8gdGhlIGFydGljbGUncyBjb250ZW50Lg0KICAgIGlmICghbWV0YWRhdGEuZXhjZXJwdCkgew0KICAgICAgdmFyIHBhcmFncmFwaHMgPSBhcnRpY2xlQ29udGVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgicCIpOw0KICAgICAgaWYgKHBhcmFncmFwaHMubGVuZ3RoID4gMCkgew0KICAgICAgICBtZXRhZGF0YS5leGNlcnB0ID0gcGFyYWdyYXBoc1swXS50ZXh0Q29udGVudC50cmltKCk7DQogICAgICB9DQogICAgfQ0KDQogICAgdmFyIHRleHRDb250ZW50ID0gYXJ0aWNsZUNvbnRlbnQudGV4dENvbnRlbnQ7DQogICAgcmV0dXJuIHsNCiAgICAgIHRpdGxlOiB0aGlzLl9hcnRpY2xlVGl0bGUsDQogICAgICBieWxpbmU6IG1ldGFkYXRhLmJ5bGluZSB8fCB0aGlzLl9hcnRpY2xlQnlsaW5lLA0KICAgICAgZGlyOiB0aGlzLl9hcnRpY2xlRGlyLA0KICAgICAgbGFuZzogdGhpcy5fYXJ0aWNsZUxhbmcsDQogICAgICBjb250ZW50OiB0aGlzLl9zZXJpYWxpemVyKGFydGljbGVDb250ZW50KSwNCiAgICAgIHRleHRDb250ZW50OiB0ZXh0Q29udGVudCwNCiAgICAgIGxlbmd0aDogdGV4dENvbnRlbnQubGVuZ3RoLA0KICAgICAgZXhjZXJwdDogbWV0YWRhdGEuZXhjZXJwdCwNCiAgICAgIHNpdGVOYW1lOiBtZXRhZGF0YS5zaXRlTmFtZSB8fCB0aGlzLl9hcnRpY2xlU2l0ZU5hbWUNCiAgICB9Ow0KICB9DQp9Ow0KDQpSZWFkYWJpbGl0eQ==", "run.js": "U3lzdGVtLnByb2dyYW0ucnVuUHJvZ3JhbShQQVRILmZvbGRlcigpICsgIi9tYWluLmpzIik=", "style.css": "LndpbmRvd1t3aW5kb3dpZD0ie3t3aW5kb3dJZH19Il0gaHRtbCwNCi53aW5kb3dbd2luZG93aWQ9Int7d2luZG93SWR9fSJdIGJvZHkgew0KICAgIG1hcmdpbjogMDsNCiAgICBwYWRkaW5nOiAwOw0KICAgIGZvbnQtc2l6ZTogMTVweDsNCn0NCg0KLndpbmRvd1t3aW5kb3dpZD0ie3t3aW5kb3dJZH19Il0gLmRvd25sb2FkZWRQYWdlIHsNCiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZjJmMmYyOw0KICAgIHBhZGRpbmc6IDIwcHg7DQogICAgbWFyZ2luOiAyMHB4Ow0KICAgIGJvcmRlci1yYWRpdXM6IDEwcHg7DQogICAgYm94LXNoYWRvdzogMCAwIDEwcHggI2NjYzsNCiAgICB0cmFuc2l0aW9uOiBib3gtc2hhZG93IDAuM3MgZWFzZS1pbi1vdXQ7DQogICAgY3Vyc29yOiBwb2ludGVyOw0KICAgIGRpc3BsYXk6IGZsZXg7DQogICAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOw0KICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQogICAgZmxleC1kaXJlY3Rpb246IHJvdzsNCn0NCg0KLndpbmRvd1t3aW5kb3dpZD0ie3t3aW5kb3dJZH19Il0gLmRvd25sb2FkZWRQYWdlOmhvdmVyIHsNCiAgICBib3gtc2hhZG93OiAwIDAgMTBweCAjYWFhOw0KfQ0KDQoud2luZG93W3dpbmRvd2lkPSJ7e3dpbmRvd0lkfX0iXSAuZG93bmxvYWRlZFBhZ2UgLnRpdGxlIHsNCiAgICBmb250LXNpemU6IDIwcHg7DQogICAgZm9udC13ZWlnaHQ6IGJvbGQ7DQp9DQoNCi53aW5kb3dbd2luZG93aWQ9Int7d2luZG93SWR9fSJdIGJ1dHRvbiB7DQogICAgY3Vyc29yOiBwb2ludGVyOw0KICAgIGNvbG9yOiAjMDAwOw0KICAgIGJhY2tncm91bmQtY29sb3I6ICNmZmY7DQogICAgYm9yZGVyOiAxcHggc29saWQgI2NjYzsNCiAgICBib3JkZXItcmFkaXVzOiA1cHg7DQogICAgcGFkZGluZzogNXB4IDEwcHg7DQogICAgdHJhbnNpdGlvbjogYWxsIDAuM3MgZWFzZS1pbi1vdXQ7DQp9DQoNCi53aW5kb3dbd2luZG93aWQ9Int7d2luZG93SWR9fSJdIGJ1dHRvbjpob3ZlciB7DQogICAgYmFja2dyb3VuZC1jb2xvcjogI2YwZjBmMDsNCiAgICBib3JkZXI6IDFweCBzb2xpZCAjYWFhOw0KICAgIGJveC1zaGFkb3c6IDAgMCA1cHggI2Q4ZDhkODsNCn0NCg0KLndpbmRvd1t3aW5kb3dpZD0ie3t3aW5kb3dJZH19Il0gI2xvYWRpbmcgew0KICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICB6LWluZGV4OiAxMDAwOw0KICAgIHdpZHRoOiAxMDAlOw0KICAgIGhlaWdodDogMTAwJTsNCiAgICB0b3A6IDA7DQogICAgbGVmdDogMDsNCiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZmZmOw0KICAgIGRpc3BsYXk6IGZsZXg7DQogICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7DQogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCiAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOw0KfQ0KDQoud2luZG93W3dpbmRvd2lkPSJ7e3dpbmRvd0lkfX0iXSAubGRzLWVsbGlwc2lzIHsNCiAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQogICAgcG9zaXRpb246IHJlbGF0aXZlOw0KICAgIHdpZHRoOiA4MHB4Ow0KICAgIGhlaWdodDogODBweDsNCn0NCg0KLndpbmRvd1t3aW5kb3dpZD0ie3t3aW5kb3dJZH19Il0gLmxkcy1lbGxpcHNpcyBkaXYgew0KICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICB0b3A6IDMzcHg7DQogICAgd2lkdGg6IDEzcHg7DQogICAgaGVpZ2h0OiAxM3B4Ow0KICAgIGJvcmRlci1yYWRpdXM6IDUwJTsNCiAgICBiYWNrZ3JvdW5kOiAjMDAwOw0KICAgIGFuaW1hdGlvbi10aW1pbmctZnVuY3Rpb246IGN1YmljLWJlemllcigwLCAxLCAxLCAwKTsNCn0NCg0KLndpbmRvd1t3aW5kb3dpZD0ie3t3aW5kb3dJZH19Il0gLmxkcy1lbGxpcHNpcyBkaXY6bnRoLWNoaWxkKDEpIHsNCiAgICBsZWZ0OiA4cHg7DQogICAgYW5pbWF0aW9uOiBsZHMtZWxsaXBzaXMxIDAuNnMgaW5maW5pdGU7DQp9DQoNCi53aW5kb3dbd2luZG93aWQ9Int7d2luZG93SWR9fSJdIC5sZHMtZWxsaXBzaXMgZGl2Om50aC1jaGlsZCgyKSB7DQogICAgbGVmdDogOHB4Ow0KICAgIGFuaW1hdGlvbjogbGRzLWVsbGlwc2lzMiAwLjZzIGluZmluaXRlOw0KfQ0KDQoud2luZG93W3dpbmRvd2lkPSJ7e3dpbmRvd0lkfX0iXSAubGRzLWVsbGlwc2lzIGRpdjpudGgtY2hpbGQoMykgew0KICAgIGxlZnQ6IDMycHg7DQogICAgYW5pbWF0aW9uOiBsZHMtZWxsaXBzaXMyIDAuNnMgaW5maW5pdGU7DQp9DQoNCi53aW5kb3dbd2luZG93aWQ9Int7d2luZG93SWR9fSJdIC5sZHMtZWxsaXBzaXMgZGl2Om50aC1jaGlsZCg0KSB7DQogICAgbGVmdDogNTZweDsNCiAgICBhbmltYXRpb246IGxkcy1lbGxpcHNpczMgMC42cyBpbmZpbml0ZTsNCn0NCg0KQGtleWZyYW1lcyBsZHMtZWxsaXBzaXMxIHsNCiAgICAwJSB7DQogICAgICAgIHRyYW5zZm9ybTogc2NhbGUoMCk7DQogICAgfQ0KDQogICAgMTAwJSB7DQogICAgICAgIHRyYW5zZm9ybTogc2NhbGUoMSk7DQogICAgfQ0KfQ0KDQpAa2V5ZnJhbWVzIGxkcy1lbGxpcHNpczMgew0KICAgIDAlIHsNCiAgICAgICAgdHJhbnNmb3JtOiBzY2FsZSgxKTsNCiAgICB9DQoNCiAgICAxMDAlIHsNCiAgICAgICAgdHJhbnNmb3JtOiBzY2FsZSgwKTsNCiAgICB9DQp9DQoNCkBrZXlmcmFtZXMgbGRzLWVsbGlwc2lzMiB7DQogICAgMCUgew0KICAgICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgwLCAwKTsNCiAgICB9DQoNCiAgICAxMDAlIHsNCiAgICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUoMjRweCwgMCk7DQogICAgfQ0KfQ0KDQoud2luZG93W3dpbmRvd2lkPSJ7e3dpbmRvd0lkfX0iXSAjZWRpdFBhbmVsIHsNCiAgICBwb3NpdGlvbjogZml4ZWQ7DQogICAgei1pbmRleDogOTk5Ow0KICAgIHdpZHRoOiA3MCU7DQogICAgaGVpZ2h0OiA3MCU7DQogICAgbWluLXdpZHRoOiA1MDBweDsNCiAgICBtaW4taGVpZ2h0OiA1MDBweDsNCiAgICBtYXgtd2lkdGg6IDEwMCU7DQogICAgbWF4LWhlaWdodDogMTAwJTsNCiAgICB0b3A6IDUwJTsNCiAgICBsZWZ0OiA1MCU7DQogICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgLTUwJSk7DQogICAgcGFkZGluZzogMjBweDsNCiAgICBkaXNwbGF5OiBmbGV4Ow0KICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQogICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsNCiAgICBib3JkZXI6IDFweCBzb2xpZCAjY2NjOw0KfQ0KDQoud2luZG93W3dpbmRvd2lkPSJ7e3dpbmRvd0lkfX0iXSAjZWRpdFBhbmVsUmVtb3ZlVGV4dHNMaXN0IHsNCiAgICBib3JkZXI6IDFweCBzb2xpZCAjY2NjOw0KICAgIGJvcmRlci1yYWRpdXM6IDVweDsNCiAgICBwYWRkaW5nOiAxMHB4Ow0KfQ0KDQoud2luZG93W3dpbmRvd2lkPSJ7e3dpbmRvd0lkfX0iXSAjZWRpdFBhbmVsUmVtb3ZlVGV4dHNMaXN0IHAgew0KICAgIG1hcmdpbjogMDsNCiAgICBwYWRkaW5nOiAwOw0KICAgIG1hcmdpbi1ib3R0b206IDVweDsNCiAgICBjdXJzb3I6IHBvaW50ZXI7DQogICAgZm9udC1zaXplOiAxNXB4Ow0KfQ0KDQoud2luZG93W3dpbmRvd2lkPSJ7e3dpbmRvd0lkfX0iXSAjZWRpdFBhbmVsUmVtb3ZlVGV4dHNMaXN0IHA6aG92ZXIgew0KICAgIHRleHQtZGVjb3JhdGlvbjogdW5kZXJsaW5lOw0KfQ0KDQoud2luZG93W3dpbmRvd2lkPSJ7e3dpbmRvd0lkfX0iXSAjcGFnZU9wdGlvbnMgLnNlbGVjdGVkIHsNCiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZjBmMGYwOw0KICAgIGJvcmRlcjogMXB4IHNvbGlkICNhYWE7DQogICAgYm94LXNoYWRvdzogMCAwIDVweCAjZDhkOGQ4Ow0KfQ0KDQoud2luZG93W3dpbmRvd2lkPSJ7e3dpbmRvd0lkfX0iXSAuZGlzcGxheVR5cGVTZWxlY3RSb3cgew0KICAgIGRpc3BsYXk6IGZsZXg7DQogICAgZmxleC13cmFwOiB3cmFwOw0KICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQogICAgbWFyZ2luLWJvdHRvbTogMjBweDsNCn0NCg0KLndpbmRvd1t3aW5kb3dpZD0ie3t3aW5kb3dJZH19Il0gI3BhZ2Ugew0KICAgIHRyYW5zaXRpb246IGFsbCAwLjNzIGVhc2UtaW4tb3V0Ow0KICAgIG1pbi1oZWlnaHQ6IDEwMHZoOw0KfQ0KDQoud2luZG93W3dpbmRvd2lkPSJ7e3dpbmRvd0lkfX0iXSAjcGFnZU9wdGlvbnMgew0KICAgIHBvc2l0aW9uOiBmaXhlZDsNCiAgICB6LWluZGV4OiA5OTg7DQogICAgYm90dG9tOiAwOw0KICAgIGRpc3BsYXk6IGZsZXg7DQogICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsNCiAgICB3aWR0aDogMTAwJTsNCiAgICBib3JkZXItdG9wOiAxcHggc29saWQgI2NjYzsNCiAgICBwYWRkaW5nLXRvcDogMjBweDsNCiAgICBmb250LWZhbWlseTogc2Fucy1zZXJpZjsNCiAgICBmb250LXNpemU6IDE1cHg7DQogICAgYm94LXNoYWRvdzogMCAwIDMwcHggIzNkM2QzZDgwOw0KfQ0KDQoud2luZG93W3dpbmRvd2lkPSJ7e3dpbmRvd0lkfX0iXSAjcGFnZUNvbnRlbnRUaXRsZSB7DQogICAgZm9udC1zaXplOiAzMHB4Ow0KICAgIGZvbnQtd2VpZ2h0OiBib2xkOw0KICAgIG1hcmdpbi1ib3R0b206IDIwcHg7DQogICAgb3ZlcmZsb3ctd3JhcDogYW55d2hlcmU7DQp9DQoNCi53aW5kb3dbd2luZG93aWQ9Int7d2luZG93SWR9fSJdICNwYWdlVXJsIHsNCiAgICBmb250LXNpemU6IDE1cHg7DQogICAgZm9udC13ZWlnaHQ6IGJvbGQ7DQogICAgbWFyZ2luLWJvdHRvbTogMjBweDsNCiAgICB3b3JkLWJyZWFrOiBicmVhay1hbGw7DQogICAgY3Vyc29yOiBwb2ludGVyOw0KICAgIHRleHQtZGVjb3JhdGlvbjogdW5kZXJsaW5lOw0KICAgIG1hcmdpbjogMDsNCiAgICBwYWRkaW5nOiAxMHB4Ow0KfQ0KDQoud2luZG93W3dpbmRvd2lkPSJ7e3dpbmRvd0lkfX0iXSAucGFnZSAubGluayB7DQogICAgY29sb3I6ICMwMDA7DQogICAgdGV4dC1kZWNvcmF0aW9uOiBkb3R0ZWQgdW5kZXJsaW5lOw0KfQ0KDQoud2luZG93W3dpbmRvd2lkPSJ7e3dpbmRvd0lkfX0iXSAjc2VsZWN0IHsNCiAgICBwb3NpdGlvbjogZml4ZWQ7DQogICAgei1pbmRleDogMTAwMjsNCiAgICB3aWR0aDogMTAwJTsNCiAgICBoZWlnaHQ6IDEwMCU7DQogICAgdG9wOiAwOw0KICAgIGxlZnQ6IDA7DQogICAgYmFja2dyb3VuZC1jb2xvcjogIzAwMDAwMDI1Ow0KICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOw0KICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQp9DQoNCi53aW5kb3dbd2luZG93aWQ9Int7d2luZG93SWR9fSJdICNzZWxlY3RXcmFwZXIgew0KICAgIGRpc3BsYXk6IGZsZXg7DQogICAgZmxleC13cmFwOiB3cmFwOw0KICAgIG1hcmdpbi1ib3R0b206IDIwcHg7DQogICAgd2lkdGg6IDcwJTsNCiAgICBoZWlnaHQ6IDcwJTsNCiAgICBwYWRkaW5nOiAyMHB4Ow0KICAgIGJvcmRlci1yYWRpdXM6IDEwcHg7DQogICAgYm9yZGVyOiAxcHggc29saWQgI2NjYzsNCiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZmZmOw0KICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOw0KICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47DQp9DQoNCi53aW5kb3dbd2luZG93aWQ9Int7d2luZG93SWR9fSJdICNzZWxlY3RUaXRsZSB7DQogICAgZm9udC1zaXplOiAzMHB4Ow0KICAgIGZvbnQtd2VpZ2h0OiBib2xkOw0KICAgIG1hcmdpbi1ib3R0b206IDIwcHg7DQogICAgb3ZlcmZsb3ctd3JhcDogYW55d2hlcmU7DQp9DQoNCi53aW5kb3dbd2luZG93aWQ9Int7d2luZG93SWR9fSJdICNzZWxlY3RPcHRpb25zIGJ1dHRvbiB7DQogICAgbWFyZ2luOiA1cHg7DQogICAgcGFkZGluZzogMjBweDsNCn0NCg0KLndpbmRvd1t3aW5kb3dpZD0ie3t3aW5kb3dJZH19Il0gI3NlbGVjdE9wdGlvbnMgew0KICAgIGRpc3BsYXk6IGZsZXg7DQogICAgZmxleC13cmFwOiB3cmFwOw0KICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOw0KICAgIGJvcmRlcjogMXB4IHNvbGlkICNjY2M7DQogICAgYm9yZGVyLXJhZGl1czogNXB4Ow0KICAgIHBhZGRpbmctdG9wOiAyMHB4Ow0KICAgIHBhZGRpbmctYm90dG9tOiAyMHB4Ow0KfQ0KDQoud2luZG93W3dpbmRvd2lkPSJ7e3dpbmRvd0lkfX0iXSAudHlwZTFjb250YWluZXIgI3BhZ2VDb250ZW50IHsNCiAgICBib3JkZXI6IDVweDsNCiAgICBwYWRkaW5nOiAyMHB4Ow0KICAgIGJvcmRlci1yYWRpdXM6IDEwcHg7DQogICAgb3ZlcmZsb3c6IGF1dG87DQogICAgYm94LXNoYWRvdzogMCAwIDEwcHggI2NjYzsNCiAgICBtYXJnaW46IDEwcHg7DQp9DQoNCi53aW5kb3dbd2luZG93aWQ9Int7d2luZG93SWR9fSJdIC50eXBlMWNvbnRhaW5lci50eXBlMWNvbG9yICNwYWdlQ29udGVudCB7DQogICAgYm94LXNoYWRvdzogMCAwIDEwcHggI2NjYzsNCn0NCg0KLndpbmRvd1t3aW5kb3dpZD0ie3t3aW5kb3dJZH19Il0gLnR5cGUxY29udGFpbmVyLnR5cGUyY29sb3IgI3BhZ2VDb250ZW50IHsNCiAgICBib3gtc2hhZG93OiAwIDAgMTBweCAjNWY1ZjVmOw0KfQ0KDQoud2luZG93W3dpbmRvd2lkPSJ7e3dpbmRvd0lkfX0iXSAudHlwZTFjb250YWluZXIudHlwZTIzY29sb3IgI3BhZ2VDb250ZW50IHsNCiAgICBib3gtc2hhZG93OiAwIDAgMTBweCAjMmUyZTJlOw0KfQ0KDQoud2luZG93W3dpbmRvd2lkPSJ7e3dpbmRvd0lkfX0iXSAudHlwZTJjb250YWluZXIgI3BhZ2VDb250ZW50IHsNCiAgICBvdmVyZmxvdzogYXV0bzsNCn0NCg0KLndpbmRvd1t3aW5kb3dpZD0ie3t3aW5kb3dJZH19Il0gLnR5cGUxY29sb3Igew0KICAgIGNvbG9yOiAjMWUxZDI1Ow0KICAgIGJhY2tncm91bmQtY29sb3I6ICNmZmY7DQp9DQoNCi53aW5kb3dbd2luZG93aWQ9Int7d2luZG93SWR9fSJdIC50eXBlMWNvbG9yIGJ1dHRvbi5zZWxlY3RlZCB7DQogICAgYmFja2dyb3VuZC1jb2xvcjogI2Q2ZDZkNiAhaW1wb3J0YW50Ow0KfQ0KDQoud2luZG93W3dpbmRvd2lkPSJ7e3dpbmRvd0lkfX0iXSAudHlwZTFjb2xvciAuc3R5bGVDb2xvclVwZGF0ZSwNCi53aW5kb3dbd2luZG93aWQ9Int7d2luZG93SWR9fSJdIC50eXBlMWNvbG9yIGJ1dHRvbiwNCi53aW5kb3dbd2luZG93aWQ9Int7d2luZG93SWR9fSJdIC50eXBlMWNvbG9yIGJ1dHRvbjpob3ZlciwNCi53aW5kb3dbd2luZG93aWQ9Int7d2luZG93SWR9fSJdIC50eXBlMWNvbG9yIC5saW5rIHsNCiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZmZmOw0KICAgIGNvbG9yOiAjMWUxZDI1Ow0KfQ0KDQoud2luZG93W3dpbmRvd2lkPSJ7e3dpbmRvd0lkfX0iXSAudHlwZTJjb2xvciB7DQogICAgY29sb3I6ICNmZmY7DQogICAgYmFja2dyb3VuZC1jb2xvcjogIzAwMDAwMDsNCn0NCg0KLndpbmRvd1t3aW5kb3dpZD0ie3t3aW5kb3dJZH19Il0gLnR5cGUyY29sb3IgYnV0dG9uLnNlbGVjdGVkIHsNCiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZDZkNmQ2ICFpbXBvcnRhbnQ7DQp9DQoNCi53aW5kb3dbd2luZG93aWQ9Int7d2luZG93SWR9fSJdIC50eXBlMmNvbG9yIC5zdHlsZUNvbG9yVXBkYXRlLA0KLndpbmRvd1t3aW5kb3dpZD0ie3t3aW5kb3dJZH19Il0gLnR5cGUyY29sb3IgYnV0dG9uLA0KLndpbmRvd1t3aW5kb3dpZD0ie3t3aW5kb3dJZH19Il0gLnR5cGUyY29sb3IgYnV0dG9uOmhvdmVyLA0KLndpbmRvd1t3aW5kb3dpZD0ie3t3aW5kb3dJZH19Il0gLnR5cGUyY29sb3IgLmxpbmsgew0KICAgIGJhY2tncm91bmQtY29sb3I6ICMwMDAwMDA7DQogICAgY29sb3I6ICNmZmY7DQp9DQoNCi53aW5kb3dbd2luZG93aWQ9Int7d2luZG93SWR9fSJdIC50eXBlMjNjb2xvciB7DQogICAgY29sb3I6ICM5ZTllOWU7DQogICAgYmFja2dyb3VuZC1jb2xvcjogIzAwMDAwMDsNCn0NCg0KLndpbmRvd1t3aW5kb3dpZD0ie3t3aW5kb3dJZH19Il0gLnR5cGUyM2NvbG9yIGJ1dHRvbi5zZWxlY3RlZCB7DQogICAgYmFja2dyb3VuZC1jb2xvcjogI2Q2ZDZkNiAhaW1wb3J0YW50Ow0KfQ0KDQoud2luZG93W3dpbmRvd2lkPSJ7e3dpbmRvd0lkfX0iXSAudHlwZTIzY29sb3IgLnN0eWxlQ29sb3JVcGRhdGUsDQoud2luZG93W3dpbmRvd2lkPSJ7e3dpbmRvd0lkfX0iXSAudHlwZTIzY29sb3IgYnV0dG9uLA0KLndpbmRvd1t3aW5kb3dpZD0ie3t3aW5kb3dJZH19Il0gLnR5cGUyM2NvbG9yIGJ1dHRvbjpob3ZlciwNCi53aW5kb3dbd2luZG93aWQ9Int7d2luZG93SWR9fSJdIC50eXBlMjNjb2xvciAubGluayB7DQogICAgYmFja2dyb3VuZC1jb2xvcjogIzAwMDAwMDsNCiAgICBjb2xvcjogIzllOWU5ZTsNCn0NCg0KLndpbmRvd1t3aW5kb3dpZD0ie3t3aW5kb3dJZH19Il0gLnR5cGUzY29sb3Igew0KICAgIGNvbG9yOiAjZmZmOw0KICAgIGJhY2tncm91bmQtY29sb3I6ICM1YTUxNTE7DQp9DQoNCi53aW5kb3dbd2luZG93aWQ9Int7d2luZG93SWR9fSJdIC50eXBlM2NvbG9yIGJ1dHRvbi5zZWxlY3RlZCB7DQogICAgYmFja2dyb3VuZC1jb2xvcjogI2Q2ZDZkNiAhaW1wb3J0YW50Ow0KfQ0KDQoud2luZG93W3dpbmRvd2lkPSJ7e3dpbmRvd0lkfX0iXSAudHlwZTNjb2xvciAuc3R5bGVDb2xvclVwZGF0ZSwNCi53aW5kb3dbd2luZG93aWQ9Int7d2luZG93SWR9fSJdIC50eXBlM2NvbG9yIGJ1dHRvbiwNCi53aW5kb3dbd2luZG93aWQ9Int7d2luZG93SWR9fSJdIC50eXBlM2NvbG9yIGJ1dHRvbjpob3ZlciwNCi53aW5kb3dbd2luZG93aWQ9Int7d2luZG93SWR9fSJdIC50eXBlM2NvbG9yIC5saW5rIHsNCiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjNWE1MTUxOw0KICAgIGNvbG9yOiAjZmZmOw0KfQ0KDQoud2luZG93W3dpbmRvd2lkPSJ7e3dpbmRvd0lkfX0iXSAudHlwZTFmb250ICogew0KICAgIGZvbnQtZmFtaWx5OiBzZXJpZjsNCn0NCg0KLndpbmRvd1t3aW5kb3dpZD0ie3t3aW5kb3dJZH19Il0gLnR5cGUyZm9udCAqIHsNCiAgICBmb250LWZhbWlseTogc2Fucy1zZXJpZjsNCn0NCg0KLndpbmRvd1t3aW5kb3dpZD0ie3t3aW5kb3dJZH19Il0gLnR5cGUzZm9udCAqIHsNCiAgICBmb250LWZhbWlseTogbW9ub3NwYWNlOw0KfQ0KDQoud2luZG93W3dpbmRvd2lkPSJ7e3dpbmRvd0lkfX0iXSAudHlwZTBzaXplICogew0KICAgIGZvbnQtc2l6ZTogMTBweDsNCn0NCg0KLndpbmRvd1t3aW5kb3dpZD0ie3t3aW5kb3dJZH19Il0gLnR5cGUxc2l6ZSAqIHsNCiAgICBmb250LXNpemU6IDE1cHg7DQp9DQoNCi53aW5kb3dbd2luZG93aWQ9Int7d2luZG93SWR9fSJdIC50eXBlMnNpemUgKiB7DQogICAgZm9udC1zaXplOiAyMHB4Ow0KfQ0KDQoud2luZG93W3dpbmRvd2lkPSJ7e3dpbmRvd0lkfX0iXSAudHlwZTNzaXplICogew0KICAgIGZvbnQtc2l6ZTogMjVweDsNCn0="}