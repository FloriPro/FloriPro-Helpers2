{"run.js": "Y2xhc3MgcmVkZGl0IHsNCiAgICAvKioNCiAgICAgKiByZWRkaXQgcmVhZGVyIHdpdGggb25seSBvbmUgcG9zdCBldmVyeSByZXF1ZXN0DQogICAgICogQHBhcmFtIHtzdHJpbmdbXX0gc3VicmVkZGl0cyANCiAgICAgKi8NCiAgICBjb25zdHJ1Y3RvcihzdWJyZWRkaXRzKSB7DQogICAgICAgIGlmIChzdWJyZWRkaXRzID09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgc3VicmVkZGl0cyA9IFsiXyJdOw0KICAgICAgICB9DQogICAgICAgIHRoaXMuc3VicmVkZGl0cyA9IHN1YnJlZGRpdHM7DQogICAgICAgIHRoaXMuY3VycmVudFN1YnJlZGRpdElkID0gMDsNCg0KICAgICAgICB0aGlzLmJvb2xWYXJzID0gWyJvbmx5X2ltYWdlcyIsICJzYXZlX2RhdGEiLCAibm9fbnNmdyJdDQogICAgICAgIHRoaXMudmFycyA9IHsgImxpbWl0IjogIjEwIiwgInNvcnRfdGltZSI6ICJhbGwiLCAic29ydF9ieSI6ICJob3QiLCAib25seV9pbWFnZXMiOiBmYWxzZSwgInNhdmVfZGF0YSI6IGZhbHNlLCAibm9fbnNmdyI6IGZhbHNlLCAibmVlZHNfYm9vbF9hcmd1bWVudCI6ICIiIH07DQoNCiAgICAgICAgdGhpcy5hbGxyZWFkeUZldGNoaW5nID0gZmFsc2U7DQoNCg0KICAgICAgICB0aGlzLmdlbkFmdGVycygpOw0KICAgIH0NCiAgICBnZW5BZnRlcnMoKSB7DQogICAgICAgIHRoaXMuc3RvcmVkUG9zdHMgPSBbXTsNCiAgICAgICAgdGhpcy5hZnRlciA9IFtdDQogICAgICAgIGZvciAodmFyIHggb2YgdGhpcy5zdWJyZWRkaXRzKSB7DQogICAgICAgICAgICB0aGlzLmFmdGVyLnB1c2goIiIpOw0KICAgICAgICAgICAgdGhpcy5zdG9yZWRQb3N0cy5wdXNoKFtdKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHRpbWVvdXQobXMpIHsNCiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCBtcykpOw0KICAgIH0NCg0KICAgIHNldFN1YnJlZGRpdHMoc3VicmVkZGl0cykgew0KICAgICAgICB0aGlzLnN1YnJlZGRpdHMgPSBzdWJyZWRkaXRzOw0KICAgICAgICB0aGlzLmdlbkFmdGVycygpOw0KICAgIH0NCg0KDQogICAgLyoqDQogICAgICogZ2V0cyBhIHBvc3QgZnJvbSBhIHN1YnJlZGRpdCB3aXRoIHRoZSBzcGVjZWZpZWQgaWQNCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gaWQgZnJvbSB0aGlzLnN1YnJlZGRpdHMNCiAgICAgKiBAcmV0dXJucyB7e3N0cmluZzpzdHJpbmcgfCBzdHJpbmdbXSB8IG51bWJlcn19IHRoZSBzdGFuZGFyZCByZWRkaXQgcmVzcG9zZSBmb3IgYSBwb3N0DQogICAgICovDQogICAgYXN5bmMgZ2V0KGlkKSB7DQogICAgICAgIC8vY2hlY2sgaWYgYWxscmVhZHkgaW4gY2FjaGUNCiAgICAgICAgaWYgKHRoaXMuc3RvcmVkUG9zdHNbaWRdLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgIHJldHVybiBbdGhpcy5zdG9yZWRQb3N0c1tpZF0uc2hpZnQoKSwgbnVsbF07DQogICAgICAgIH0NCg0KICAgICAgICB0aGlzLmFsbHJlYWR5RmV0Y2hpbmcgPSB0cnVlOw0KDQogICAgICAgIHZhciB1cmwgPSB0aGlzLmdlblVybCh0aGlzLnN1YnJlZGRpdHNbaWRdLCB0aGlzLmFmdGVyW2lkXSwgdGhpcy52YXJzWyJsaW1pdCJdLCB0aGlzLnZhcnNbInNvcnRfdGltZSJdLCB0aGlzLnZhcnNbInNvcnRfYnkiXSk7DQogICAgICAgIHZhciBkYXQgPSBhd2FpdCBmZXRjaCh1cmwpOw0KICAgICAgICBkYXQgPSBKU09OLnBhcnNlKGF3YWl0IGRhdC50ZXh0KCkpDQoNCiAgICAgICAgdmFyIG5ld0FmdGVyID0gZGF0WyJkYXRhIl1bImFmdGVyIl07DQoNCiAgICAgICAgdmFyIGFsbFN0dWZmID0gZGF0WyJkYXRhIl1bImNoaWxkcmVuIl0NCg0KICAgICAgICBpZiAoYWxsU3R1ZmYubGVuZ3RoID09IDApIHsNCiAgICAgICAgICAgIGNvbnNvbGUud2FybigicmF0ZWxpbWl0OiB0aW1lb3V0IDIwMDBtcyIpDQogICAgICAgICAgICBhd2FpdCB0aGlzLnRpbWVvdXQoMjAwMCk7DQogICAgICAgICAgICByZXR1cm4gdGhpcy5nZXQoaWQpOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKGFsbFN0dWZmLmxlbmd0aCA+IDEpIHsNCiAgICAgICAgICAgIHZhciBvdGhlclBvc3RzID0gYWxsU3R1ZmYuc2xpY2UoMSk7DQogICAgICAgICAgICB0aGlzLnN0b3JlZFBvc3RzW2lkXSA9IG90aGVyUG9zdHM7DQogICAgICAgIH0NCg0KICAgICAgICB0aGlzLmFsbHJlYWR5RmV0Y2hpbmcgPSBmYWxzZTsNCiAgICAgICAgcmV0dXJuIFthbGxTdHVmZlswXSwgbmV3QWZ0ZXJdOw0KICAgIH0NCg0KICAgIGFzeW5jIG5leHQoKSB7DQogICAgICAgIHZhciByID0gYXdhaXQgdGhpcy5nZXQodGhpcy5jdXJyZW50U3VicmVkZGl0SWQpOw0KICAgICAgICB2YXIgZGF0ID0gclswXTsNCiAgICAgICAgdmFyIG5ld0FmdGVyID0gclsxXTsNCiAgICAgICAgaWYgKG5ld0FmdGVyICE9IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgdGhpcy5hZnRlclt0aGlzLmN1cnJlbnRTdWJyZWRkaXRJZF0gPSBuZXdBZnRlcjsNCiAgICAgICAgfQ0KICAgICAgICB2YXIgcCA9IG5ldyBwb3N0KGRhdCk7DQogICAgICAgIHAuc2F2ZURhdGEgPSB0aGlzLnZhcnNbInNhdmVfZGF0YSJdOw0KICAgICAgICBpZiAoKHRoaXMudmFyc1sib25seV9pbWFnZXMiXSAmJiBwLkltYWdlKCkubGVuZ3RoID09IDApIHx8ICh0aGlzLnZhcnNbIm5vX25zZnciXSAmJiBwLmRhdGFbIm92ZXJfMTgiXSkpIHsNCiAgICAgICAgICAgIHJldHVybiBhd2FpdCB0aGlzLm5leHQoKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAodGhpcy52YXJzWyJuZWVkc19ib29sX2FyZ3VtZW50Il0gIT0gIiIpIHsNCiAgICAgICAgICAgIGZvciAodmFyIHggb2YgdGhpcy52YXJzWyJuZWVkc19ib29sX2FyZ3VtZW50Il0uc3BsaXQoIiwiKSkgew0KICAgICAgICAgICAgICAgIGlmICghcC5kYXRhW3hdKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBhd2FpdCB0aGlzLm5leHQoKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICB0aGlzLmN1cnJlbnRTdWJyZWRkaXRJZCsrOw0KICAgICAgICBpZiAodGhpcy5jdXJyZW50U3VicmVkZGl0SWQgPj0gdGhpcy5zdWJyZWRkaXRzLmxlbmd0aCkgeyB0aGlzLmN1cnJlbnRTdWJyZWRkaXRJZCA9IDA7IH0NCiAgICAgICAgcmV0dXJuIHA7DQogICAgfQ0KICAgIGdlblVybChzdWJyZWRkaXQsIGFmdGVyLCBsaW1pdCwgc29ydF90aW1lLCBzb3J0X2J5KSB7DQogICAgICAgIHJldHVybiAnaHR0cHM6Ly93d3cucmVkZGl0LmNvbS9yLycgKyBzdWJyZWRkaXQgKyAnLycgKyBzb3J0X2J5ICsgJy8uanNvbj9yYXdfanNvbj0xJnQ9JyArIHNvcnRfdGltZSArICcmbGltaXQ9JyArIGxpbWl0ICsgIiZhZnRlcj0iICsgYWZ0ZXI7DQogICAgfQ0KICAgIGdldFBvc3RGcm9tRGF0YShkYXRhKSB7DQogICAgICAgIHZhciBwID0gbmV3IHBvc3QoZGF0YSk7DQogICAgICAgIHAuc2F2ZURhdGEgPSB0aGlzLnZhcnNbInNhdmVfZGF0YSJdOw0KICAgICAgICByZXR1cm4gcA0KICAgIH0NCn0NCmNsYXNzIHBvc3Qgew0KICAgIGNvbnN0cnVjdG9yKGRhdGEpIHsNCiAgICAgICAgdGhpcy5kYXRhID0gZGF0YVsiZGF0YSJdOw0KICAgICAgICB0aGlzLnNhdmVEYXRhID0gZmFsc2UNCiAgICB9DQoNCiAgICBjb21wb3NlZEltYWdlKCkgew0KICAgICAgICB2YXIgaW1ncyA9IFtdOw0KICAgICAgICBpZiAoIm1lZGlhX21ldGFkYXRhIiBpbiB0aGlzLmRhdGEpIHsNCiAgICAgICAgICAgIGZvciAoeCBpbiB0aGlzLmRhdGFbIm1lZGlhX21ldGFkYXRhIl0pIHsNCiAgICAgICAgICAgICAgICB2YXIgZCA9IHsNCiAgICAgICAgICAgICAgICAgICAgImZ1bGwiOiB0aGlzLmRhdGFbIm1lZGlhX21ldGFkYXRhIl1beF1bInMiXVsidSJdLA0KICAgICAgICAgICAgICAgICAgICAiY29tcHJlc3NlZCI6IHRoaXMuZGF0YVsibWVkaWFfbWV0YWRhdGEiXVt4XVsicCJdWzBdWyJ1Il0NCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIGltZ3MucHVzaChkKQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKCJwcmV2aWV3IiBpbiB0aGlzLmRhdGEpIHsNCiAgICAgICAgICAgIGZvciAodmFyIHggaW4gdGhpcy5kYXRhWyJwcmV2aWV3Il1bImltYWdlcyJdKSB7DQogICAgICAgICAgICAgICAgdmFyIGEgPSB0aGlzLmRhdGFbInByZXZpZXciXVsiaW1hZ2VzIl1beF1bInJlc29sdXRpb25zIl07DQoNCiAgICAgICAgICAgICAgICB2YXIgZCA9IHsNCiAgICAgICAgICAgICAgICAgICAgImZ1bGwiOiBhW2EubGVuZ3RoIC0gMV1bInVybCJdLA0KICAgICAgICAgICAgICAgICAgICAiY29tcHJlc3NlZCI6IGFbMF1bInVybCJdDQogICAgICAgICAgICAgICAgfTsNCg0KICAgICAgICAgICAgICAgIGlmICgidXJsIiBpbiB0aGlzLmRhdGEpIHsNCiAgICAgICAgICAgICAgICAgICAgZFsiZnVsbCJdID0gdGhpcy5kYXRhWyJ1cmwiXTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBpbWdzLnB1c2goZCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gaW1nczsNCiAgICB9DQoNCiAgICBJbWFnZSgpIHsNCiAgICAgICAgdmFyIGltZ3MgPSBbXTsNCiAgICAgICAgaWYgKCJtZWRpYV9tZXRhZGF0YSIgaW4gdGhpcy5kYXRhKSB7DQogICAgICAgICAgICBmb3IgKHggaW4gdGhpcy5kYXRhWyJtZWRpYV9tZXRhZGF0YSJdKSB7DQogICAgICAgICAgICAgICAgaWYgKHRoaXMuc2F2ZURhdGEgPT0gZmFsc2UpIHsNCiAgICAgICAgICAgICAgICAgICAgaW1ncy5wdXNoKHRoaXMuZGF0YVsibWVkaWFfbWV0YWRhdGEiXVt4XVsicyJdWyJ1Il0pOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIHAgPSBNYXRoLnJvdW5kKHRoaXMuZGF0YVsibWVkaWFfbWV0YWRhdGEiXVt4XVsicCJdLmxlbmd0aCAvIDQpOw0KICAgICAgICAgICAgICAgICAgICAvL3AgPSA0Ow0KICAgICAgICAgICAgICAgICAgICBpbWdzLnB1c2godGhpcy5kYXRhWyJtZWRpYV9tZXRhZGF0YSJdW3hdWyJwIl1bcF1bInUiXSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGlmICgicHJldmlldyIgaW4gdGhpcy5kYXRhICYmIHRoaXMuc2F2ZURhdGEgPT0gdHJ1ZSkgew0KICAgICAgICAgICAgZm9yICh2YXIgeCBpbiB0aGlzLmRhdGFbInByZXZpZXciXVsiaW1hZ2VzIl0pIHsNCiAgICAgICAgICAgICAgICB2YXIgYSA9IHRoaXMuZGF0YVsicHJldmlldyJdWyJpbWFnZXMiXVt4XVsicmVzb2x1dGlvbnMiXTsNCiAgICAgICAgICAgICAgICB2YXIgcCA9IE1hdGgucm91bmQoYS5sZW5ndGggLyA0KTsNCiAgICAgICAgICAgICAgICBpZiAoYS5pbmNsdWRlcyhwKSkgew0KICAgICAgICAgICAgICAgICAgICBpbWdzLnB1c2goYVtwXVsidXJsIl0pOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChhLmxlbmd0aCAhPSAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpbWdzLnB1c2goYVswXVsidXJsIl0pOw0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KDQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0gZWxzZSBpZiAoInVybCIgaW4gdGhpcy5kYXRhKSB7DQogICAgICAgICAgICB0aGlzLmRhdGFbInVybCJdID0gdGhpcy5kYXRhWyJ1cmwiXS5yZXBsYWNlKCJnaWZ2IiwgImpwZyIpDQogICAgICAgICAgICBpZiAoIXRoaXMuZGF0YVsidXJsIl0ubWF0Y2goLy4oanBnfGpwZWd8cG5nfGdpZikkL2kpKSB7IH0gZWxzZSB7DQogICAgICAgICAgICAgICAgaW1ncy5wdXNoKHRoaXMuZGF0YVsidXJsIl0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9IC8vdXJsX292ZXJyaWRkZW5fYnlfZGVzdA0KICAgICAgICByZXR1cm4gaW1ncw0KICAgIH0NCiAgICBJbWFnZUZ1bGwoKSB7DQogICAgICAgIC8vZGlzYWJsZSBzYXZlZGF0YQ0KICAgICAgICB2YXIgcyA9IHRoaXMuc2F2ZURhdGENCiAgICAgICAgdGhpcy5zYXZlRGF0YSA9IGZhbHNlOw0KDQogICAgICAgIHZhciBkID0gdGhpcy5JbWFnZSgpOw0KDQogICAgICAgIC8vcmUtZW5hYmFsZSBzYXZlZGF0YQ0KICAgICAgICB0aGlzLnNhdmVEYXRhID0gczsNCiAgICAgICAgcmV0dXJuIGQ7DQogICAgfQ0KICAgIEF1dGhvcigpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuZGF0YVsiYXV0aG9yIl07DQogICAgfQ0KICAgIFRpdGxlKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5kYXRhWyJ0aXRsZSJdOw0KICAgIH0NCiAgICBUZXh0KCkgew0KICAgICAgICByZXR1cm4gdGhpcy5kYXRhWyJzZWxmdGV4dCJdOw0KICAgIH0NCiAgICBIdG1sVGV4dCgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuZGF0YVsic2VsZnRleHRfaHRtbCJdOw0KICAgIH0NCiAgICBhc3luYyBjb21tZW50cygpIHsNCiAgICAgICAgdmFyIGNvbW1lbnRMaW5rID0gImh0dHBzOi8vd3d3LnJlZGRpdC5jb20iICsgdGhpcy5kYXRhLnBlcm1hbGluayArICIuanNvbj9yYXdfanNvbj0xIjsNCiAgICAgICAgdmFyIHRleHQgPSBhd2FpdCAoYXdhaXQgZmV0Y2goY29tbWVudExpbmspKS50ZXh0KCkNCiAgICAgICAgdmFyIGpzb24gPSBKU09OLnBhcnNlKHRleHQpOw0KICAgICAgICB2YXIgZGF0ID0ganNvblsiMSJdWyJkYXRhIl1bImNoaWxkcmVuIl07DQogICAgICAgIHJldHVybiB0aGlzLmxvYWRDb21tZW50RWFzeShkYXQpOw0KICAgIH0NCiAgICBtZWRpYSgpIHsNCiAgICAgICAgaWYgKHRoaXMuZGF0YVsibWVkaWEiXSAhPSBudWxsKSB7DQogICAgICAgICAgICBpZiAodGhpcy5kYXRhWyJtZWRpYSJdWyJ0eXBlIl0gPT0gInlvdXR1YmUuY29tIikgew0KICAgICAgICAgICAgICAgIHJldHVybiB7ICJ0eXBlIjogInlvdXR1YmUiLCAiZGF0IjogdGhpcy5kYXRhWyJtZWRpYSJdWyJvZW1iZWQiXVsiaHRtbCJdIH07DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmICh0aGlzLmRhdGFbImlzX3ZpZGVvIl0gPT0gdHJ1ZSkgew0KICAgICAgICAgICAgICAgIGlmICh0aGlzLmRhdGFbIm1lZGlhIl1bInJlZGRpdF92aWRlbyJdID09IHVuZGVmaW5lZCkgeyByZXR1cm4gZmFsc2U7IH0NCiAgICAgICAgICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgICAgICAgICB0eXBlOiAicmVkZGl0VmlkZW8iLCAiZGF0IjogWw0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kYXRhWyJtZWRpYSJdWyJyZWRkaXRfdmlkZW8iXVsiZmFsbGJhY2tfdXJsIl0sDQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRhdGFbIm1lZGlhIl1bInJlZGRpdF92aWRlbyJdWyJmYWxsYmFja191cmwiXS5zcGxpdCgiREFTSF8iKVswXSArICJEQVNIX2F1ZGlvLm1wNCINCiAgICAgICAgICAgICAgICAgICAgXQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gbnVsbDsNCiAgICB9DQogICAgbG9hZENvbW1lbnRFYXN5KGRhdCkgew0KICAgICAgICB2YXIgb3V0ID0gW107DQogICAgICAgIGZvciAodmFyIHggb2YgZGF0KSB7DQogICAgICAgICAgICB2YXIgY29tbWVudCA9IHsgImF1dGhvciI6ICItIiwgImJvZHlfaHRtbCI6ICI8cD4tPC9wPiIsICJib2R5IjogIiIsICJyZXBsaWVzIjogW10gfQ0KICAgICAgICAgICAgdmFyIGRhdGEgPSB4WyJkYXRhIl0NCiAgICAgICAgICAgIHZhciByZXBsaWVzID0gW10NCiAgICAgICAgICAgIGlmIChkYXRhWyJyZXBsaWVzIl0gIT0gIiIgJiYgZGF0YVsicmVwbGllcyJdICE9IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgICAgIHJlcGxpZXMgPSB0aGlzLmxvYWRDb21tZW50RWFzeShkYXRhWyJyZXBsaWVzIl1bImRhdGEiXVsiY2hpbGRyZW4iXSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjb21tZW50WyJhdXRob3IiXSA9IGRhdGFbImF1dGhvciJdDQogICAgICAgICAgICBjb21tZW50WyJib2R5X2h0bWwiXSA9IGRhdGFbImJvZHlfaHRtbCJdDQogICAgICAgICAgICBjb21tZW50WyJib2R5Il0gPSBkYXRhWyJib2R5Il0NCiAgICAgICAgICAgIGNvbW1lbnRbInJlcGxpZXMiXSA9IHJlcGxpZXM7DQogICAgICAgICAgICBvdXQucHVzaChjb21tZW50KQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBvdXQ7DQogICAgfQ0KDQp9DQoNCg0KcmVkZGl0Ow=="}